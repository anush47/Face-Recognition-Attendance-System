var yw=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var c3=yw((h3,ix)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var Rh={exports:{}},Au={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ey;function bw(){if(Ey)return Au;Ey=1;var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function t(e,a,o){var l=null;if(o!==void 0&&(l=""+o),a.key!==void 0&&(l=""+a.key),"key"in a){o={};for(var s in a)s!=="key"&&(o[s]=a[s])}else o=a;return a=o.ref,{$$typeof:r,type:e,key:l,ref:a!==void 0?a:null,props:o}}return Au.Fragment=n,Au.jsx=t,Au.jsxs=t,Au}var Cy;function xw(){return Cy||(Cy=1,Rh.exports=bw()),Rh.exports}var gt=xw(),Ah={exports:{}},Lt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sy;function ww(){if(Sy)return Lt;Sy=1;var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),e=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),v=Symbol.iterator;function g(k){return k===null||typeof k!="object"?null:(k=v&&k[v]||k["@@iterator"],typeof k=="function"?k:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,w={};function _(k,X,it){this.props=k,this.context=X,this.refs=w,this.updater=it||y}_.prototype.isReactComponent={},_.prototype.setState=function(k,X){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,X,"setState")},_.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function E(){}E.prototype=_.prototype;function R(k,X,it){this.props=k,this.context=X,this.refs=w,this.updater=it||y}var A=R.prototype=new E;A.constructor=R,x(A,_.prototype),A.isPureReactComponent=!0;var C=Array.isArray,T={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function L(k,X,it,ot,dt,mt){return it=mt.ref,{$$typeof:r,type:k,key:X,ref:it!==void 0?it:null,props:mt}}function B(k,X){return L(k.type,X,void 0,void 0,void 0,k.props)}function I(k){return typeof k=="object"&&k!==null&&k.$$typeof===r}function F(k){var X={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(it){return X[it]})}var W=/\/+/g;function U(k,X){return typeof k=="object"&&k!==null&&k.key!=null?F(""+k.key):X.toString(36)}function at(){}function nt(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(at,at):(k.status="pending",k.then(function(X){k.status==="pending"&&(k.status="fulfilled",k.value=X)},function(X){k.status==="pending"&&(k.status="rejected",k.reason=X)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function tt(k,X,it,ot,dt){var mt=typeof k;(mt==="undefined"||mt==="boolean")&&(k=null);var pt=!1;if(k===null)pt=!0;else switch(mt){case"bigint":case"string":case"number":pt=!0;break;case"object":switch(k.$$typeof){case r:case n:pt=!0;break;case p:return pt=k._init,tt(pt(k._payload),X,it,ot,dt)}}if(pt)return dt=dt(k),pt=ot===""?"."+U(k,0):ot,C(dt)?(it="",pt!=null&&(it=pt.replace(W,"$&/")+"/"),tt(dt,X,it,"",function(Ot){return Ot})):dt!=null&&(I(dt)&&(dt=B(dt,it+(dt.key==null||k&&k.key===dt.key?"":(""+dt.key).replace(W,"$&/")+"/")+pt)),X.push(dt)),1;pt=0;var Tt=ot===""?".":ot+":";if(C(k))for(var bt=0;bt<k.length;bt++)ot=k[bt],mt=Tt+U(ot,bt),pt+=tt(ot,X,it,mt,dt);else if(bt=g(k),typeof bt=="function")for(k=bt.call(k),bt=0;!(ot=k.next()).done;)ot=ot.value,mt=Tt+U(ot,bt++),pt+=tt(ot,X,it,mt,dt);else if(mt==="object"){if(typeof k.then=="function")return tt(nt(k),X,it,ot,dt);throw X=String(k),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return pt}function P(k,X,it){if(k==null)return k;var ot=[],dt=0;return tt(k,ot,"","",function(mt){return X.call(it,mt,dt++)}),ot}function q(k){if(k._status===-1){var X=k._result;X=X(),X.then(function(it){(k._status===0||k._status===-1)&&(k._status=1,k._result=it)},function(it){(k._status===0||k._status===-1)&&(k._status=2,k._result=it)}),k._status===-1&&(k._status=0,k._result=X)}if(k._status===1)return k._result.default;throw k._result}var K=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)};function rt(){}return Lt.Children={map:P,forEach:function(k,X,it){P(k,function(){X.apply(this,arguments)},it)},count:function(k){var X=0;return P(k,function(){X++}),X},toArray:function(k){return P(k,function(X){return X})||[]},only:function(k){if(!I(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},Lt.Component=_,Lt.Fragment=t,Lt.Profiler=a,Lt.PureComponent=R,Lt.StrictMode=e,Lt.Suspense=f,Lt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,Lt.__COMPILER_RUNTIME={__proto__:null,c:function(k){return T.H.useMemoCache(k)}},Lt.cache=function(k){return function(){return k.apply(null,arguments)}},Lt.cloneElement=function(k,X,it){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var ot=x({},k.props),dt=k.key,mt=void 0;if(X!=null)for(pt in X.ref!==void 0&&(mt=void 0),X.key!==void 0&&(dt=""+X.key),X)!N.call(X,pt)||pt==="key"||pt==="__self"||pt==="__source"||pt==="ref"&&X.ref===void 0||(ot[pt]=X[pt]);var pt=arguments.length-2;if(pt===1)ot.children=it;else if(1<pt){for(var Tt=Array(pt),bt=0;bt<pt;bt++)Tt[bt]=arguments[bt+2];ot.children=Tt}return L(k.type,dt,void 0,void 0,mt,ot)},Lt.createContext=function(k){return k={$$typeof:l,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:o,_context:k},k},Lt.createElement=function(k,X,it){var ot,dt={},mt=null;if(X!=null)for(ot in X.key!==void 0&&(mt=""+X.key),X)N.call(X,ot)&&ot!=="key"&&ot!=="__self"&&ot!=="__source"&&(dt[ot]=X[ot]);var pt=arguments.length-2;if(pt===1)dt.children=it;else if(1<pt){for(var Tt=Array(pt),bt=0;bt<pt;bt++)Tt[bt]=arguments[bt+2];dt.children=Tt}if(k&&k.defaultProps)for(ot in pt=k.defaultProps,pt)dt[ot]===void 0&&(dt[ot]=pt[ot]);return L(k,mt,void 0,void 0,null,dt)},Lt.createRef=function(){return{current:null}},Lt.forwardRef=function(k){return{$$typeof:s,render:k}},Lt.isValidElement=I,Lt.lazy=function(k){return{$$typeof:p,_payload:{_status:-1,_result:k},_init:q}},Lt.memo=function(k,X){return{$$typeof:h,type:k,compare:X===void 0?null:X}},Lt.startTransition=function(k){var X=T.T,it={};T.T=it;try{var ot=k(),dt=T.S;dt!==null&&dt(it,ot),typeof ot=="object"&&ot!==null&&typeof ot.then=="function"&&ot.then(rt,K)}catch(mt){K(mt)}finally{T.T=X}},Lt.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},Lt.use=function(k){return T.H.use(k)},Lt.useActionState=function(k,X,it){return T.H.useActionState(k,X,it)},Lt.useCallback=function(k,X){return T.H.useCallback(k,X)},Lt.useContext=function(k){return T.H.useContext(k)},Lt.useDebugValue=function(){},Lt.useDeferredValue=function(k,X){return T.H.useDeferredValue(k,X)},Lt.useEffect=function(k,X,it){var ot=T.H;if(typeof it=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ot.useEffect(k,X)},Lt.useId=function(){return T.H.useId()},Lt.useImperativeHandle=function(k,X,it){return T.H.useImperativeHandle(k,X,it)},Lt.useInsertionEffect=function(k,X){return T.H.useInsertionEffect(k,X)},Lt.useLayoutEffect=function(k,X){return T.H.useLayoutEffect(k,X)},Lt.useMemo=function(k,X){return T.H.useMemo(k,X)},Lt.useOptimistic=function(k,X){return T.H.useOptimistic(k,X)},Lt.useReducer=function(k,X,it){return T.H.useReducer(k,X,it)},Lt.useRef=function(k){return T.H.useRef(k)},Lt.useState=function(k){return T.H.useState(k)},Lt.useSyncExternalStore=function(k,X,it){return T.H.useSyncExternalStore(k,X,it)},Lt.useTransition=function(){return T.H.useTransition()},Lt.version="19.1.0",Lt}var Ry;function Nd(){return Ry||(Ry=1,Ah.exports=ww()),Ah.exports}var ue=Nd(),Th={exports:{}},Tu={},Dh={exports:{}},Nh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ay;function _w(){return Ay||(Ay=1,function(r){function n(P,q){var K=P.length;P.push(q);t:for(;0<K;){var rt=K-1>>>1,k=P[rt];if(0<a(k,q))P[rt]=q,P[K]=k,K=rt;else break t}}function t(P){return P.length===0?null:P[0]}function e(P){if(P.length===0)return null;var q=P[0],K=P.pop();if(K!==q){P[0]=K;t:for(var rt=0,k=P.length,X=k>>>1;rt<X;){var it=2*(rt+1)-1,ot=P[it],dt=it+1,mt=P[dt];if(0>a(ot,K))dt<k&&0>a(mt,ot)?(P[rt]=mt,P[dt]=K,rt=dt):(P[rt]=ot,P[it]=K,rt=it);else if(dt<k&&0>a(mt,K))P[rt]=mt,P[dt]=K,rt=dt;else break t}}return q}function a(P,q){var K=P.sortIndex-q.sortIndex;return K!==0?K:P.id-q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var l=Date,s=l.now();r.unstable_now=function(){return l.now()-s}}var f=[],h=[],p=1,v=null,g=3,y=!1,x=!1,w=!1,_=!1,E=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function C(P){for(var q=t(h);q!==null;){if(q.callback===null)e(h);else if(q.startTime<=P)e(h),q.sortIndex=q.expirationTime,n(f,q);else break;q=t(h)}}function T(P){if(w=!1,C(P),!x)if(t(f)!==null)x=!0,N||(N=!0,U());else{var q=t(h);q!==null&&tt(T,q.startTime-P)}}var N=!1,L=-1,B=5,I=-1;function F(){return _?!0:!(r.unstable_now()-I<B)}function W(){if(_=!1,N){var P=r.unstable_now();I=P;var q=!0;try{t:{x=!1,w&&(w=!1,R(L),L=-1),y=!0;var K=g;try{e:{for(C(P),v=t(f);v!==null&&!(v.expirationTime>P&&F());){var rt=v.callback;if(typeof rt=="function"){v.callback=null,g=v.priorityLevel;var k=rt(v.expirationTime<=P);if(P=r.unstable_now(),typeof k=="function"){v.callback=k,C(P),q=!0;break e}v===t(f)&&e(f),C(P)}else e(f);v=t(f)}if(v!==null)q=!0;else{var X=t(h);X!==null&&tt(T,X.startTime-P),q=!1}}break t}finally{v=null,g=K,y=!1}q=void 0}}finally{q?U():N=!1}}}var U;if(typeof A=="function")U=function(){A(W)};else if(typeof MessageChannel<"u"){var at=new MessageChannel,nt=at.port2;at.port1.onmessage=W,U=function(){nt.postMessage(null)}}else U=function(){E(W,0)};function tt(P,q){L=E(function(){P(r.unstable_now())},q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(P){P.callback=null},r.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<P?Math.floor(1e3/P):5},r.unstable_getCurrentPriorityLevel=function(){return g},r.unstable_next=function(P){switch(g){case 1:case 2:case 3:var q=3;break;default:q=g}var K=g;g=q;try{return P()}finally{g=K}},r.unstable_requestPaint=function(){_=!0},r.unstable_runWithPriority=function(P,q){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var K=g;g=P;try{return q()}finally{g=K}},r.unstable_scheduleCallback=function(P,q,K){var rt=r.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?rt+K:rt):K=rt,P){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=K+k,P={id:p++,callback:q,priorityLevel:P,startTime:K,expirationTime:k,sortIndex:-1},K>rt?(P.sortIndex=K,n(h,P),t(f)===null&&P===t(h)&&(w?(R(L),L=-1):w=!0,tt(T,K-rt))):(P.sortIndex=k,n(f,P),x||y||(x=!0,N||(N=!0,U()))),P},r.unstable_shouldYield=F,r.unstable_wrapCallback=function(P){var q=g;return function(){var K=g;g=q;try{return P.apply(this,arguments)}finally{g=K}}}}(Nh)),Nh}var Ty;function Ew(){return Ty||(Ty=1,Dh.exports=_w()),Dh.exports}var Mh={exports:{}},on={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dy;function Cw(){if(Dy)return on;Dy=1;var r=Nd();function n(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var e={d:{f:t,r:function(){throw Error(n(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(f,h,p){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:f,containerInfo:h,implementation:p}}var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return on.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=e,on.createPortal=function(f,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return o(f,h,null,p)},on.flushSync=function(f){var h=l.T,p=e.p;try{if(l.T=null,e.p=2,f)return f()}finally{l.T=h,e.p=p,e.d.f()}},on.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,e.d.C(f,h))},on.prefetchDNS=function(f){typeof f=="string"&&e.d.D(f)},on.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var p=h.as,v=s(p,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?e.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:v,integrity:g,fetchPriority:y}):p==="script"&&e.d.X(f,{crossOrigin:v,integrity:g,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},on.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=s(h.as,h.crossOrigin);e.d.M(f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&e.d.M(f)},on.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,v=s(p,h.crossOrigin);e.d.L(f,p,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},on.preloadModule=function(f,h){if(typeof f=="string")if(h){var p=s(h.as,h.crossOrigin);e.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else e.d.m(f)},on.requestFormReset=function(f){e.d.r(f)},on.unstable_batchedUpdates=function(f,h){return f(h)},on.useFormState=function(f,h,p){return l.H.useFormState(f,h,p)},on.useFormStatus=function(){return l.H.useHostTransitionStatus()},on.version="19.1.0",on}var Ny;function Sw(){if(Ny)return Mh.exports;Ny=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(n){console.error(n)}}return r(),Mh.exports=Cw(),Mh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var My;function Rw(){if(My)return Tu;My=1;var r=Ew(),n=Nd(),t=Sw();function e(i){var u="https://react.dev/errors/"+i;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)u+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var u=i,c=i;if(i.alternate)for(;u.return;)u=u.return;else{i=u;do u=i,(u.flags&4098)!==0&&(c=u.return),i=u.return;while(i)}return u.tag===3?c:null}function l(i){if(i.tag===13){var u=i.memoizedState;if(u===null&&(i=i.alternate,i!==null&&(u=i.memoizedState)),u!==null)return u.dehydrated}return null}function s(i){if(o(i)!==i)throw Error(e(188))}function f(i){var u=i.alternate;if(!u){if(u=o(i),u===null)throw Error(e(188));return u!==i?null:i}for(var c=i,d=u;;){var m=c.return;if(m===null)break;var b=m.alternate;if(b===null){if(d=m.return,d!==null){c=d;continue}break}if(m.child===b.child){for(b=m.child;b;){if(b===c)return s(m),i;if(b===d)return s(m),u;b=b.sibling}throw Error(e(188))}if(c.return!==d.return)c=m,d=b;else{for(var S=!1,D=m.child;D;){if(D===c){S=!0,c=m,d=b;break}if(D===d){S=!0,d=m,c=b;break}D=D.sibling}if(!S){for(D=b.child;D;){if(D===c){S=!0,c=b,d=m;break}if(D===d){S=!0,d=b,c=m;break}D=D.sibling}if(!S)throw Error(e(189))}}if(c.alternate!==d)throw Error(e(190))}if(c.tag!==3)throw Error(e(188));return c.stateNode.current===c?i:u}function h(i){var u=i.tag;if(u===5||u===26||u===27||u===6)return i;for(i=i.child;i!==null;){if(u=h(i),u!==null)return u;i=i.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),A=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function U(i){return i===null||typeof i!="object"?null:(i=W&&i[W]||i["@@iterator"],typeof i=="function"?i:null)}var at=Symbol.for("react.client.reference");function nt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===at?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case x:return"Fragment";case _:return"Profiler";case w:return"StrictMode";case T:return"Suspense";case N:return"SuspenseList";case I:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case y:return"Portal";case A:return(i.displayName||"Context")+".Provider";case R:return(i._context.displayName||"Context")+".Consumer";case C:var u=i.render;return i=i.displayName,i||(i=u.displayName||u.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case L:return u=i.displayName||null,u!==null?u:nt(i.type)||"Memo";case B:u=i._payload,i=i._init;try{return nt(i(u))}catch{}}return null}var tt=Array.isArray,P=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},rt=[],k=-1;function X(i){return{current:i}}function it(i){0>k||(i.current=rt[k],rt[k]=null,k--)}function ot(i,u){k++,rt[k]=i.current,i.current=u}var dt=X(null),mt=X(null),pt=X(null),Tt=X(null);function bt(i,u){switch(ot(pt,u),ot(mt,i),ot(dt,null),u.nodeType){case 9:case 11:i=(i=u.documentElement)&&(i=i.namespaceURI)?Zg(i):0;break;default:if(i=u.tagName,u=u.namespaceURI)u=Zg(u),i=Jg(u,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}it(dt),ot(dt,i)}function Ot(){it(dt),it(mt),it(pt)}function $t(i){i.memoizedState!==null&&ot(Tt,i);var u=dt.current,c=Jg(u,i.type);u!==c&&(ot(mt,i),ot(dt,c))}function Ft(i){mt.current===i&&(it(dt),it(mt)),Tt.current===i&&(it(Tt),_u._currentValue=K)}var Xt=Object.prototype.hasOwnProperty,Ut=r.unstable_scheduleCallback,re=r.unstable_cancelCallback,se=r.unstable_shouldYield,le=r.unstable_requestPaint,me=r.unstable_now,jt=r.unstable_getCurrentPriorityLevel,Ue=r.unstable_ImmediatePriority,qn=r.unstable_UserBlockingPriority,He=r.unstable_NormalPriority,jn=r.unstable_LowPriority,mn=r.unstable_IdlePriority,vr=r.log,Dn=r.unstable_setDisableYieldValue,Nn=null,we=null;function Se(i){if(typeof vr=="function"&&Dn(i),we&&typeof we.setStrictMode=="function")try{we.setStrictMode(Nn,i)}catch{}}var ht=Math.clz32?Math.clz32:mr,de=Math.log,Ve=Math.LN2;function mr(i){return i>>>=0,i===0?32:31-(de(i)/Ve|0)|0}var pn=256,gn=4194304;function We(i){var u=i&42;if(u!==0)return u;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function yn(i,u,c){var d=i.pendingLanes;if(d===0)return 0;var m=0,b=i.suspendedLanes,S=i.pingedLanes;i=i.warmLanes;var D=d&134217727;return D!==0?(d=D&~b,d!==0?m=We(d):(S&=D,S!==0?m=We(S):c||(c=D&~i,c!==0&&(m=We(c))))):(D=d&~b,D!==0?m=We(D):S!==0?m=We(S):c||(c=d&~i,c!==0&&(m=We(c)))),m===0?0:u!==0&&u!==m&&(u&b)===0&&(b=m&-m,c=u&-u,b>=c||b===32&&(c&4194048)!==0)?u:m}function gr(i,u){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&u)===0}function No(i,u){switch(i){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Mo(){var i=pn;return pn<<=1,(pn&4194048)===0&&(pn=256),i}function es(){var i=gn;return gn<<=1,(gn&62914560)===0&&(gn=4194304),i}function ko(i){for(var u=[],c=0;31>c;c++)u.push(i);return u}function Xn(i,u){i.pendingLanes|=u,u!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function ox(i,u,c,d,m,b){var S=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var D=i.entanglements,z=i.expirationTimes,Q=i.hiddenUpdates;for(c=S&~c;0<c;){var st=31-ht(c),ct=1<<st;D[st]=0,z[st]=-1;var Z=Q[st];if(Z!==null)for(Q[st]=null,st=0;st<Z.length;st++){var J=Z[st];J!==null&&(J.lane&=-536870913)}c&=~ct}d!==0&&Fp(i,d,0),b!==0&&m===0&&i.tag!==0&&(i.suspendedLanes|=b&~(S&~u))}function Fp(i,u,c){i.pendingLanes|=u,i.suspendedLanes&=~u;var d=31-ht(u);i.entangledLanes|=u,i.entanglements[d]=i.entanglements[d]|1073741824|c&4194090}function Lp(i,u){var c=i.entangledLanes|=u;for(i=i.entanglements;c;){var d=31-ht(c),m=1<<d;m&u|i[d]&u&&(i[d]|=u),c&=~m}}function vc(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function mc(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function zp(){var i=q.p;return i!==0?i:(i=window.event,i===void 0?32:gy(i.type))}function ux(i,u){var c=q.p;try{return q.p=i,u()}finally{q.p=c}}var sa=Math.random().toString(36).slice(2),rn="__reactFiber$"+sa,bn="__reactProps$"+sa,_i="__reactContainer$"+sa,gc="__reactEvents$"+sa,sx="__reactListeners$"+sa,lx="__reactHandles$"+sa,Pp="__reactResources$"+sa,Oo="__reactMarker$"+sa;function yc(i){delete i[rn],delete i[bn],delete i[gc],delete i[sx],delete i[lx]}function Ei(i){var u=i[rn];if(u)return u;for(var c=i.parentNode;c;){if(u=c[_i]||c[rn]){if(c=u.alternate,u.child!==null||c!==null&&c.child!==null)for(i=ny(i);i!==null;){if(c=i[rn])return c;i=ny(i)}return u}i=c,c=i.parentNode}return null}function Ci(i){if(i=i[rn]||i[_i]){var u=i.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return i}return null}function Io(i){var u=i.tag;if(u===5||u===26||u===27||u===6)return i.stateNode;throw Error(e(33))}function Si(i){var u=i[Pp];return u||(u=i[Pp]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function Ge(i){i[Oo]=!0}var Up=new Set,Hp={};function Ga(i,u){Ri(i,u),Ri(i+"Capture",u)}function Ri(i,u){for(Hp[i]=u,i=0;i<u.length;i++)Up.add(u[i])}var cx=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vp={},Wp={};function fx(i){return Xt.call(Wp,i)?!0:Xt.call(Vp,i)?!1:cx.test(i)?Wp[i]=!0:(Vp[i]=!0,!1)}function ns(i,u,c){if(fx(u))if(c===null)i.removeAttribute(u);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(u);return;case"boolean":var d=u.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){i.removeAttribute(u);return}}i.setAttribute(u,""+c)}}function rs(i,u,c){if(c===null)i.removeAttribute(u);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttribute(u,""+c)}}function zr(i,u,c,d){if(d===null)i.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(u,c,""+d)}}var bc,Gp;function Ai(i){if(bc===void 0)try{throw Error()}catch(c){var u=c.stack.trim().match(/\n( *(at )?)/);bc=u&&u[1]||"",Gp=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bc+i+Gp}var xc=!1;function wc(i,u){if(!i||xc)return"";xc=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(u){var ct=function(){throw Error()};if(Object.defineProperty(ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ct,[])}catch(J){var Z=J}Reflect.construct(i,[],ct)}else{try{ct.call()}catch(J){Z=J}i.call(ct.prototype)}}else{try{throw Error()}catch(J){Z=J}(ct=i())&&typeof ct.catch=="function"&&ct.catch(function(){})}}catch(J){if(J&&Z&&typeof J.stack=="string")return[J.stack,Z.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=d.DetermineComponentFrameRoot(),S=b[0],D=b[1];if(S&&D){var z=S.split(`
`),Q=D.split(`
`);for(m=d=0;d<z.length&&!z[d].includes("DetermineComponentFrameRoot");)d++;for(;m<Q.length&&!Q[m].includes("DetermineComponentFrameRoot");)m++;if(d===z.length||m===Q.length)for(d=z.length-1,m=Q.length-1;1<=d&&0<=m&&z[d]!==Q[m];)m--;for(;1<=d&&0<=m;d--,m--)if(z[d]!==Q[m]){if(d!==1||m!==1)do if(d--,m--,0>m||z[d]!==Q[m]){var st=`
`+z[d].replace(" at new "," at ");return i.displayName&&st.includes("<anonymous>")&&(st=st.replace("<anonymous>",i.displayName)),st}while(1<=d&&0<=m);break}}}finally{xc=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?Ai(c):""}function hx(i){switch(i.tag){case 26:case 27:case 5:return Ai(i.type);case 16:return Ai("Lazy");case 13:return Ai("Suspense");case 19:return Ai("SuspenseList");case 0:case 15:return wc(i.type,!1);case 11:return wc(i.type.render,!1);case 1:return wc(i.type,!0);case 31:return Ai("Activity");default:return""}}function qp(i){try{var u="";do u+=hx(i),i=i.return;while(i);return u}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function Kn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function jp(i){var u=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function dx(i){var u=jp(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,u),d=""+i[u];if(!i.hasOwnProperty(u)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,b=c.set;return Object.defineProperty(i,u,{configurable:!0,get:function(){return m.call(this)},set:function(S){d=""+S,b.call(this,S)}}),Object.defineProperty(i,u,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(S){d=""+S},stopTracking:function(){i._valueTracker=null,delete i[u]}}}}function as(i){i._valueTracker||(i._valueTracker=dx(i))}function Xp(i){if(!i)return!1;var u=i._valueTracker;if(!u)return!0;var c=u.getValue(),d="";return i&&(d=jp(i)?i.checked?"true":"false":i.value),i=d,i!==c?(u.setValue(i),!0):!1}function is(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var px=/[\n"\\]/g;function Yn(i){return i.replace(px,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function _c(i,u,c,d,m,b,S,D){i.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?i.type=S:i.removeAttribute("type"),u!=null?S==="number"?(u===0&&i.value===""||i.value!=u)&&(i.value=""+Kn(u)):i.value!==""+Kn(u)&&(i.value=""+Kn(u)):S!=="submit"&&S!=="reset"||i.removeAttribute("value"),u!=null?Ec(i,S,Kn(u)):c!=null?Ec(i,S,Kn(c)):d!=null&&i.removeAttribute("value"),m==null&&b!=null&&(i.defaultChecked=!!b),m!=null&&(i.checked=m&&typeof m!="function"&&typeof m!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+Kn(D):i.removeAttribute("name")}function Kp(i,u,c,d,m,b,S,D){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(i.type=b),u!=null||c!=null){if(!(b!=="submit"&&b!=="reset"||u!=null))return;c=c!=null?""+Kn(c):"",u=u!=null?""+Kn(u):c,D||u===i.value||(i.value=u),i.defaultValue=u}d=d??m,d=typeof d!="function"&&typeof d!="symbol"&&!!d,i.checked=D?i.checked:!!d,i.defaultChecked=!!d,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.name=S)}function Ec(i,u,c){u==="number"&&is(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Ti(i,u,c,d){if(i=i.options,u){u={};for(var m=0;m<c.length;m++)u["$"+c[m]]=!0;for(c=0;c<i.length;c++)m=u.hasOwnProperty("$"+i[c].value),i[c].selected!==m&&(i[c].selected=m),m&&d&&(i[c].defaultSelected=!0)}else{for(c=""+Kn(c),u=null,m=0;m<i.length;m++){if(i[m].value===c){i[m].selected=!0,d&&(i[m].defaultSelected=!0);return}u!==null||i[m].disabled||(u=i[m])}u!==null&&(u.selected=!0)}}function Yp(i,u,c){if(u!=null&&(u=""+Kn(u),u!==i.value&&(i.value=u),c==null)){i.defaultValue!==u&&(i.defaultValue=u);return}i.defaultValue=c!=null?""+Kn(c):""}function Qp(i,u,c,d){if(u==null){if(d!=null){if(c!=null)throw Error(e(92));if(tt(d)){if(1<d.length)throw Error(e(93));d=d[0]}c=d}c==null&&(c=""),u=c}c=Kn(u),i.defaultValue=c,d=i.textContent,d===c&&d!==""&&d!==null&&(i.value=d)}function Di(i,u){if(u){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=u;return}}i.textContent=u}var vx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zp(i,u,c){var d=u.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?i.setProperty(u,""):u==="float"?i.cssFloat="":i[u]="":d?i.setProperty(u,c):typeof c!="number"||c===0||vx.has(u)?u==="float"?i.cssFloat=c:i[u]=(""+c).trim():i[u]=c+"px"}function Jp(i,u,c){if(u!=null&&typeof u!="object")throw Error(e(62));if(i=i.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||u!=null&&u.hasOwnProperty(d)||(d.indexOf("--")===0?i.setProperty(d,""):d==="float"?i.cssFloat="":i[d]="");for(var m in u)d=u[m],u.hasOwnProperty(m)&&c[m]!==d&&Zp(i,m,d)}else for(var b in u)u.hasOwnProperty(b)&&Zp(i,b,u[b])}function Cc(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mx=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function os(i){return gx.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Sc=null;function Rc(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ni=null,Mi=null;function $p(i){var u=Ci(i);if(u&&(i=u.stateNode)){var c=i[bn]||null;t:switch(i=u.stateNode,u.type){case"input":if(_c(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),u=c.name,c.type==="radio"&&u!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Yn(""+u)+'"][type="radio"]'),u=0;u<c.length;u++){var d=c[u];if(d!==i&&d.form===i.form){var m=d[bn]||null;if(!m)throw Error(e(90));_c(d,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(u=0;u<c.length;u++)d=c[u],d.form===i.form&&Xp(d)}break t;case"textarea":Yp(i,c.value,c.defaultValue);break t;case"select":u=c.value,u!=null&&Ti(i,!!c.multiple,u,!1)}}}var Ac=!1;function tv(i,u,c){if(Ac)return i(u,c);Ac=!0;try{var d=i(u);return d}finally{if(Ac=!1,(Ni!==null||Mi!==null)&&(qs(),Ni&&(u=Ni,i=Mi,Mi=Ni=null,$p(u),i)))for(u=0;u<i.length;u++)$p(i[u])}}function Bo(i,u){var c=i.stateNode;if(c===null)return null;var d=c[bn]||null;if(d===null)return null;c=d[u];t:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(i=i.type,d=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!d;break t;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(e(231,u,typeof c));return c}var Pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Tc=!1;if(Pr)try{var Fo={};Object.defineProperty(Fo,"passive",{get:function(){Tc=!0}}),window.addEventListener("test",Fo,Fo),window.removeEventListener("test",Fo,Fo)}catch{Tc=!1}var la=null,Dc=null,us=null;function ev(){if(us)return us;var i,u=Dc,c=u.length,d,m="value"in la?la.value:la.textContent,b=m.length;for(i=0;i<c&&u[i]===m[i];i++);var S=c-i;for(d=1;d<=S&&u[c-d]===m[b-d];d++);return us=m.slice(i,1<d?1-d:void 0)}function ss(i){var u=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&u===13&&(i=13)):i=u,i===10&&(i=13),32<=i||i===13?i:0}function ls(){return!0}function nv(){return!1}function xn(i){function u(c,d,m,b,S){this._reactName=c,this._targetInst=m,this.type=d,this.nativeEvent=b,this.target=S,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(c=i[D],this[D]=c?c(b):b[D]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?ls:nv,this.isPropagationStopped=nv,this}return p(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=ls)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=ls)},persist:function(){},isPersistent:ls}),u}var qa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cs=xn(qa),Lo=p({},qa,{view:0,detail:0}),yx=xn(Lo),Nc,Mc,zo,fs=p({},Lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oc,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==zo&&(zo&&i.type==="mousemove"?(Nc=i.screenX-zo.screenX,Mc=i.screenY-zo.screenY):Mc=Nc=0,zo=i),Nc)},movementY:function(i){return"movementY"in i?i.movementY:Mc}}),rv=xn(fs),bx=p({},fs,{dataTransfer:0}),xx=xn(bx),wx=p({},Lo,{relatedTarget:0}),kc=xn(wx),_x=p({},qa,{animationName:0,elapsedTime:0,pseudoElement:0}),Ex=xn(_x),Cx=p({},qa,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Sx=xn(Cx),Rx=p({},qa,{data:0}),av=xn(Rx),Ax={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nx(i){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(i):(i=Dx[i])?!!u[i]:!1}function Oc(){return Nx}var Mx=p({},Lo,{key:function(i){if(i.key){var u=Ax[i.key]||i.key;if(u!=="Unidentified")return u}return i.type==="keypress"?(i=ss(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Tx[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oc,charCode:function(i){return i.type==="keypress"?ss(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?ss(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),kx=xn(Mx),Ox=p({},fs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iv=xn(Ox),Ix=p({},Lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oc}),Bx=xn(Ix),Fx=p({},qa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lx=xn(Fx),zx=p({},fs,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Px=xn(zx),Ux=p({},qa,{newState:0,oldState:0}),Hx=xn(Ux),Vx=[9,13,27,32],Ic=Pr&&"CompositionEvent"in window,Po=null;Pr&&"documentMode"in document&&(Po=document.documentMode);var Wx=Pr&&"TextEvent"in window&&!Po,ov=Pr&&(!Ic||Po&&8<Po&&11>=Po),uv=" ",sv=!1;function lv(i,u){switch(i){case"keyup":return Vx.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cv(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ki=!1;function Gx(i,u){switch(i){case"compositionend":return cv(u);case"keypress":return u.which!==32?null:(sv=!0,uv);case"textInput":return i=u.data,i===uv&&sv?null:i;default:return null}}function qx(i,u){if(ki)return i==="compositionend"||!Ic&&lv(i,u)?(i=ev(),us=Dc=la=null,ki=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return ov&&u.locale!=="ko"?null:u.data;default:return null}}var jx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fv(i){var u=i&&i.nodeName&&i.nodeName.toLowerCase();return u==="input"?!!jx[i.type]:u==="textarea"}function hv(i,u,c,d){Ni?Mi?Mi.push(d):Mi=[d]:Ni=d,u=Zs(u,"onChange"),0<u.length&&(c=new cs("onChange","change",null,c,d),i.push({event:c,listeners:u}))}var Uo=null,Ho=null;function Xx(i){jg(i,0)}function hs(i){var u=Io(i);if(Xp(u))return i}function dv(i,u){if(i==="change")return u}var pv=!1;if(Pr){var Bc;if(Pr){var Fc="oninput"in document;if(!Fc){var vv=document.createElement("div");vv.setAttribute("oninput","return;"),Fc=typeof vv.oninput=="function"}Bc=Fc}else Bc=!1;pv=Bc&&(!document.documentMode||9<document.documentMode)}function mv(){Uo&&(Uo.detachEvent("onpropertychange",gv),Ho=Uo=null)}function gv(i){if(i.propertyName==="value"&&hs(Ho)){var u=[];hv(u,Ho,i,Rc(i)),tv(Xx,u)}}function Kx(i,u,c){i==="focusin"?(mv(),Uo=u,Ho=c,Uo.attachEvent("onpropertychange",gv)):i==="focusout"&&mv()}function Yx(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return hs(Ho)}function Qx(i,u){if(i==="click")return hs(u)}function Zx(i,u){if(i==="input"||i==="change")return hs(u)}function Jx(i,u){return i===u&&(i!==0||1/i===1/u)||i!==i&&u!==u}var Mn=typeof Object.is=="function"?Object.is:Jx;function Vo(i,u){if(Mn(i,u))return!0;if(typeof i!="object"||i===null||typeof u!="object"||u===null)return!1;var c=Object.keys(i),d=Object.keys(u);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var m=c[d];if(!Xt.call(u,m)||!Mn(i[m],u[m]))return!1}return!0}function yv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function bv(i,u){var c=yv(i);i=0;for(var d;c;){if(c.nodeType===3){if(d=i+c.textContent.length,i<=u&&d>=u)return{node:c,offset:u-i};i=d}t:{for(;c;){if(c.nextSibling){c=c.nextSibling;break t}c=c.parentNode}c=void 0}c=yv(c)}}function xv(i,u){return i&&u?i===u?!0:i&&i.nodeType===3?!1:u&&u.nodeType===3?xv(i,u.parentNode):"contains"in i?i.contains(u):i.compareDocumentPosition?!!(i.compareDocumentPosition(u)&16):!1:!1}function wv(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var u=is(i.document);u instanceof i.HTMLIFrameElement;){try{var c=typeof u.contentWindow.location.href=="string"}catch{c=!1}if(c)i=u.contentWindow;else break;u=is(i.document)}return u}function Lc(i){var u=i&&i.nodeName&&i.nodeName.toLowerCase();return u&&(u==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||u==="textarea"||i.contentEditable==="true")}var $x=Pr&&"documentMode"in document&&11>=document.documentMode,Oi=null,zc=null,Wo=null,Pc=!1;function _v(i,u,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Pc||Oi==null||Oi!==is(d)||(d=Oi,"selectionStart"in d&&Lc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Wo&&Vo(Wo,d)||(Wo=d,d=Zs(zc,"onSelect"),0<d.length&&(u=new cs("onSelect","select",null,u,c),i.push({event:u,listeners:d}),u.target=Oi)))}function ja(i,u){var c={};return c[i.toLowerCase()]=u.toLowerCase(),c["Webkit"+i]="webkit"+u,c["Moz"+i]="moz"+u,c}var Ii={animationend:ja("Animation","AnimationEnd"),animationiteration:ja("Animation","AnimationIteration"),animationstart:ja("Animation","AnimationStart"),transitionrun:ja("Transition","TransitionRun"),transitionstart:ja("Transition","TransitionStart"),transitioncancel:ja("Transition","TransitionCancel"),transitionend:ja("Transition","TransitionEnd")},Uc={},Ev={};Pr&&(Ev=document.createElement("div").style,"AnimationEvent"in window||(delete Ii.animationend.animation,delete Ii.animationiteration.animation,delete Ii.animationstart.animation),"TransitionEvent"in window||delete Ii.transitionend.transition);function Xa(i){if(Uc[i])return Uc[i];if(!Ii[i])return i;var u=Ii[i],c;for(c in u)if(u.hasOwnProperty(c)&&c in Ev)return Uc[i]=u[c];return i}var Cv=Xa("animationend"),Sv=Xa("animationiteration"),Rv=Xa("animationstart"),t2=Xa("transitionrun"),e2=Xa("transitionstart"),n2=Xa("transitioncancel"),Av=Xa("transitionend"),Tv=new Map,Hc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Hc.push("scrollEnd");function ur(i,u){Tv.set(i,u),Ga(u,[i])}var Dv=new WeakMap;function Qn(i,u){if(typeof i=="object"&&i!==null){var c=Dv.get(i);return c!==void 0?c:(u={value:i,source:u,stack:qp(u)},Dv.set(i,u),u)}return{value:i,source:u,stack:qp(u)}}var Zn=[],Bi=0,Vc=0;function ds(){for(var i=Bi,u=Vc=Bi=0;u<i;){var c=Zn[u];Zn[u++]=null;var d=Zn[u];Zn[u++]=null;var m=Zn[u];Zn[u++]=null;var b=Zn[u];if(Zn[u++]=null,d!==null&&m!==null){var S=d.pending;S===null?m.next=m:(m.next=S.next,S.next=m),d.pending=m}b!==0&&Nv(c,m,b)}}function ps(i,u,c,d){Zn[Bi++]=i,Zn[Bi++]=u,Zn[Bi++]=c,Zn[Bi++]=d,Vc|=d,i.lanes|=d,i=i.alternate,i!==null&&(i.lanes|=d)}function Wc(i,u,c,d){return ps(i,u,c,d),vs(i)}function Fi(i,u){return ps(i,null,null,u),vs(i)}function Nv(i,u,c){i.lanes|=c;var d=i.alternate;d!==null&&(d.lanes|=c);for(var m=!1,b=i.return;b!==null;)b.childLanes|=c,d=b.alternate,d!==null&&(d.childLanes|=c),b.tag===22&&(i=b.stateNode,i===null||i._visibility&1||(m=!0)),i=b,b=b.return;return i.tag===3?(b=i.stateNode,m&&u!==null&&(m=31-ht(c),i=b.hiddenUpdates,d=i[m],d===null?i[m]=[u]:d.push(u),u.lane=c|536870912),b):null}function vs(i){if(50<pu)throw pu=0,Qf=null,Error(e(185));for(var u=i.return;u!==null;)i=u,u=i.return;return i.tag===3?i.stateNode:null}var Li={};function r2(i,u,c,d){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(i,u,c,d){return new r2(i,u,c,d)}function Gc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ur(i,u){var c=i.alternate;return c===null?(c=kn(i.tag,u,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=u,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,u=i.dependencies,c.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Mv(i,u){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=u,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,u=c.dependencies,i.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),i}function ms(i,u,c,d,m,b){var S=0;if(d=i,typeof i=="function")Gc(i)&&(S=1);else if(typeof i=="string")S=iw(i,c,dt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case I:return i=kn(31,c,u,m),i.elementType=I,i.lanes=b,i;case x:return Ka(c.children,m,b,u);case w:S=8,m|=24;break;case _:return i=kn(12,c,u,m|2),i.elementType=_,i.lanes=b,i;case T:return i=kn(13,c,u,m),i.elementType=T,i.lanes=b,i;case N:return i=kn(19,c,u,m),i.elementType=N,i.lanes=b,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case E:case A:S=10;break t;case R:S=9;break t;case C:S=11;break t;case L:S=14;break t;case B:S=16,d=null;break t}S=29,c=Error(e(130,i===null?"null":typeof i,"")),d=null}return u=kn(S,c,u,m),u.elementType=i,u.type=d,u.lanes=b,u}function Ka(i,u,c,d){return i=kn(7,i,d,u),i.lanes=c,i}function qc(i,u,c){return i=kn(6,i,null,u),i.lanes=c,i}function jc(i,u,c){return u=kn(4,i.children!==null?i.children:[],i.key,u),u.lanes=c,u.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},u}var zi=[],Pi=0,gs=null,ys=0,Jn=[],$n=0,Ya=null,Hr=1,Vr="";function Qa(i,u){zi[Pi++]=ys,zi[Pi++]=gs,gs=i,ys=u}function kv(i,u,c){Jn[$n++]=Hr,Jn[$n++]=Vr,Jn[$n++]=Ya,Ya=i;var d=Hr;i=Vr;var m=32-ht(d)-1;d&=~(1<<m),c+=1;var b=32-ht(u)+m;if(30<b){var S=m-m%5;b=(d&(1<<S)-1).toString(32),d>>=S,m-=S,Hr=1<<32-ht(u)+m|c<<m|d,Vr=b+i}else Hr=1<<b|c<<m|d,Vr=i}function Xc(i){i.return!==null&&(Qa(i,1),kv(i,1,0))}function Kc(i){for(;i===gs;)gs=zi[--Pi],zi[Pi]=null,ys=zi[--Pi],zi[Pi]=null;for(;i===Ya;)Ya=Jn[--$n],Jn[$n]=null,Vr=Jn[--$n],Jn[$n]=null,Hr=Jn[--$n],Jn[$n]=null}var vn=null,_e=null,Zt=!1,Za=null,yr=!1,Yc=Error(e(519));function Ja(i){var u=Error(e(418,""));throw jo(Qn(u,i)),Yc}function Ov(i){var u=i.stateNode,c=i.type,d=i.memoizedProps;switch(u[rn]=i,u[bn]=d,c){case"dialog":Gt("cancel",u),Gt("close",u);break;case"iframe":case"object":case"embed":Gt("load",u);break;case"video":case"audio":for(c=0;c<mu.length;c++)Gt(mu[c],u);break;case"source":Gt("error",u);break;case"img":case"image":case"link":Gt("error",u),Gt("load",u);break;case"details":Gt("toggle",u);break;case"input":Gt("invalid",u),Kp(u,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),as(u);break;case"select":Gt("invalid",u);break;case"textarea":Gt("invalid",u),Qp(u,d.value,d.defaultValue,d.children),as(u)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||u.textContent===""+c||d.suppressHydrationWarning===!0||Qg(u.textContent,c)?(d.popover!=null&&(Gt("beforetoggle",u),Gt("toggle",u)),d.onScroll!=null&&Gt("scroll",u),d.onScrollEnd!=null&&Gt("scrollend",u),d.onClick!=null&&(u.onclick=Js),u=!0):u=!1,u||Ja(i)}function Iv(i){for(vn=i.return;vn;)switch(vn.tag){case 5:case 13:yr=!1;return;case 27:case 3:yr=!0;return;default:vn=vn.return}}function Go(i){if(i!==vn)return!1;if(!Zt)return Iv(i),Zt=!0,!1;var u=i.tag,c;if((c=u!==3&&u!==27)&&((c=u===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||hh(i.type,i.memoizedProps)),c=!c),c&&_e&&Ja(i),Iv(i),u===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(e(317));t:{for(i=i.nextSibling,u=0;i;){if(i.nodeType===8)if(c=i.data,c==="/$"){if(u===0){_e=lr(i.nextSibling);break t}u--}else c!=="$"&&c!=="$!"&&c!=="$?"||u++;i=i.nextSibling}_e=null}}else u===27?(u=_e,Sa(i.type)?(i=mh,mh=null,_e=i):_e=u):_e=vn?lr(i.stateNode.nextSibling):null;return!0}function qo(){_e=vn=null,Zt=!1}function Bv(){var i=Za;return i!==null&&(En===null?En=i:En.push.apply(En,i),Za=null),i}function jo(i){Za===null?Za=[i]:Za.push(i)}var Qc=X(null),$a=null,Wr=null;function ca(i,u,c){ot(Qc,u._currentValue),u._currentValue=c}function Gr(i){i._currentValue=Qc.current,it(Qc)}function Zc(i,u,c){for(;i!==null;){var d=i.alternate;if((i.childLanes&u)!==u?(i.childLanes|=u,d!==null&&(d.childLanes|=u)):d!==null&&(d.childLanes&u)!==u&&(d.childLanes|=u),i===c)break;i=i.return}}function Jc(i,u,c,d){var m=i.child;for(m!==null&&(m.return=i);m!==null;){var b=m.dependencies;if(b!==null){var S=m.child;b=b.firstContext;t:for(;b!==null;){var D=b;b=m;for(var z=0;z<u.length;z++)if(D.context===u[z]){b.lanes|=c,D=b.alternate,D!==null&&(D.lanes|=c),Zc(b.return,c,i),d||(S=null);break t}b=D.next}}else if(m.tag===18){if(S=m.return,S===null)throw Error(e(341));S.lanes|=c,b=S.alternate,b!==null&&(b.lanes|=c),Zc(S,c,i),S=null}else S=m.child;if(S!==null)S.return=m;else for(S=m;S!==null;){if(S===i){S=null;break}if(m=S.sibling,m!==null){m.return=S.return,S=m;break}S=S.return}m=S}}function Xo(i,u,c,d){i=null;for(var m=u,b=!1;m!==null;){if(!b){if((m.flags&524288)!==0)b=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var S=m.alternate;if(S===null)throw Error(e(387));if(S=S.memoizedProps,S!==null){var D=m.type;Mn(m.pendingProps.value,S.value)||(i!==null?i.push(D):i=[D])}}else if(m===Tt.current){if(S=m.alternate,S===null)throw Error(e(387));S.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(i!==null?i.push(_u):i=[_u])}m=m.return}i!==null&&Jc(u,i,c,d),u.flags|=262144}function bs(i){for(i=i.firstContext;i!==null;){if(!Mn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function ti(i){$a=i,Wr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function an(i){return Fv($a,i)}function xs(i,u){return $a===null&&ti(i),Fv(i,u)}function Fv(i,u){var c=u._currentValue;if(u={context:u,memoizedValue:c,next:null},Wr===null){if(i===null)throw Error(e(308));Wr=u,i.dependencies={lanes:0,firstContext:u},i.flags|=524288}else Wr=Wr.next=u;return c}var a2=typeof AbortController<"u"?AbortController:function(){var i=[],u=this.signal={aborted:!1,addEventListener:function(c,d){i.push(d)}};this.abort=function(){u.aborted=!0,i.forEach(function(c){return c()})}},i2=r.unstable_scheduleCallback,o2=r.unstable_NormalPriority,ke={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $c(){return{controller:new a2,data:new Map,refCount:0}}function Ko(i){i.refCount--,i.refCount===0&&i2(o2,function(){i.controller.abort()})}var Yo=null,tf=0,Ui=0,Hi=null;function u2(i,u){if(Yo===null){var c=Yo=[];tf=0,Ui=rh(),Hi={status:"pending",value:void 0,then:function(d){c.push(d)}}}return tf++,u.then(Lv,Lv),u}function Lv(){if(--tf===0&&Yo!==null){Hi!==null&&(Hi.status="fulfilled");var i=Yo;Yo=null,Ui=0,Hi=null;for(var u=0;u<i.length;u++)(0,i[u])()}}function s2(i,u){var c=[],d={status:"pending",value:null,reason:null,then:function(m){c.push(m)}};return i.then(function(){d.status="fulfilled",d.value=u;for(var m=0;m<c.length;m++)(0,c[m])(u)},function(m){for(d.status="rejected",d.reason=m,m=0;m<c.length;m++)(0,c[m])(void 0)}),d}var zv=P.S;P.S=function(i,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&u2(i,u),zv!==null&&zv(i,u)};var ei=X(null);function ef(){var i=ei.current;return i!==null?i:fe.pooledCache}function ws(i,u){u===null?ot(ei,ei.current):ot(ei,u.pool)}function Pv(){var i=ef();return i===null?null:{parent:ke._currentValue,pool:i}}var Qo=Error(e(460)),Uv=Error(e(474)),_s=Error(e(542)),nf={then:function(){}};function Hv(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Es(){}function Vv(i,u,c){switch(c=i[c],c===void 0?i.push(u):c!==u&&(u.then(Es,Es),u=c),u.status){case"fulfilled":return u.value;case"rejected":throw i=u.reason,Gv(i),i;default:if(typeof u.status=="string")u.then(Es,Es);else{if(i=fe,i!==null&&100<i.shellSuspendCounter)throw Error(e(482));i=u,i.status="pending",i.then(function(d){if(u.status==="pending"){var m=u;m.status="fulfilled",m.value=d}},function(d){if(u.status==="pending"){var m=u;m.status="rejected",m.reason=d}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw i=u.reason,Gv(i),i}throw Zo=u,Qo}}var Zo=null;function Wv(){if(Zo===null)throw Error(e(459));var i=Zo;return Zo=null,i}function Gv(i){if(i===Qo||i===_s)throw Error(e(483))}var fa=!1;function rf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function af(i,u){i=i.updateQueue,u.updateQueue===i&&(u.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ha(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function da(i,u,c){var d=i.updateQueue;if(d===null)return null;if(d=d.shared,(ee&2)!==0){var m=d.pending;return m===null?u.next=u:(u.next=m.next,m.next=u),d.pending=u,u=vs(i),Nv(i,null,c),u}return ps(i,d,u,c),vs(i)}function Jo(i,u,c){if(u=u.updateQueue,u!==null&&(u=u.shared,(c&4194048)!==0)){var d=u.lanes;d&=i.pendingLanes,c|=d,u.lanes=c,Lp(i,c)}}function of(i,u){var c=i.updateQueue,d=i.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var m=null,b=null;if(c=c.firstBaseUpdate,c!==null){do{var S={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};b===null?m=b=S:b=b.next=S,c=c.next}while(c!==null);b===null?m=b=u:b=b.next=u}else m=b=u;c={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:b,shared:d.shared,callbacks:d.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=u:i.next=u,c.lastBaseUpdate=u}var uf=!1;function $o(){if(uf){var i=Hi;if(i!==null)throw i}}function tu(i,u,c,d){uf=!1;var m=i.updateQueue;fa=!1;var b=m.firstBaseUpdate,S=m.lastBaseUpdate,D=m.shared.pending;if(D!==null){m.shared.pending=null;var z=D,Q=z.next;z.next=null,S===null?b=Q:S.next=Q,S=z;var st=i.alternate;st!==null&&(st=st.updateQueue,D=st.lastBaseUpdate,D!==S&&(D===null?st.firstBaseUpdate=Q:D.next=Q,st.lastBaseUpdate=z))}if(b!==null){var ct=m.baseState;S=0,st=Q=z=null,D=b;do{var Z=D.lane&-536870913,J=Z!==D.lane;if(J?(Kt&Z)===Z:(d&Z)===Z){Z!==0&&Z===Ui&&(uf=!0),st!==null&&(st=st.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});t:{var Mt=i,Dt=D;Z=u;var oe=c;switch(Dt.tag){case 1:if(Mt=Dt.payload,typeof Mt=="function"){ct=Mt.call(oe,ct,Z);break t}ct=Mt;break t;case 3:Mt.flags=Mt.flags&-65537|128;case 0:if(Mt=Dt.payload,Z=typeof Mt=="function"?Mt.call(oe,ct,Z):Mt,Z==null)break t;ct=p({},ct,Z);break t;case 2:fa=!0}}Z=D.callback,Z!==null&&(i.flags|=64,J&&(i.flags|=8192),J=m.callbacks,J===null?m.callbacks=[Z]:J.push(Z))}else J={lane:Z,tag:D.tag,payload:D.payload,callback:D.callback,next:null},st===null?(Q=st=J,z=ct):st=st.next=J,S|=Z;if(D=D.next,D===null){if(D=m.shared.pending,D===null)break;J=D,D=J.next,J.next=null,m.lastBaseUpdate=J,m.shared.pending=null}}while(!0);st===null&&(z=ct),m.baseState=z,m.firstBaseUpdate=Q,m.lastBaseUpdate=st,b===null&&(m.shared.lanes=0),wa|=S,i.lanes=S,i.memoizedState=ct}}function qv(i,u){if(typeof i!="function")throw Error(e(191,i));i.call(u)}function jv(i,u){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)qv(c[i],u)}var Vi=X(null),Cs=X(0);function Xv(i,u){i=Zr,ot(Cs,i),ot(Vi,u),Zr=i|u.baseLanes}function sf(){ot(Cs,Zr),ot(Vi,Vi.current)}function lf(){Zr=Cs.current,it(Vi),it(Cs)}var pa=0,Pt=null,ae=null,De=null,Ss=!1,Wi=!1,ni=!1,Rs=0,eu=0,Gi=null,l2=0;function Re(){throw Error(e(321))}function cf(i,u){if(u===null)return!1;for(var c=0;c<u.length&&c<i.length;c++)if(!Mn(i[c],u[c]))return!1;return!0}function ff(i,u,c,d,m,b){return pa=b,Pt=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,P.H=i===null||i.memoizedState===null?Nm:Mm,ni=!1,b=c(d,m),ni=!1,Wi&&(b=Yv(u,c,d,m)),Kv(i),b}function Kv(i){P.H=ks;var u=ae!==null&&ae.next!==null;if(pa=0,De=ae=Pt=null,Ss=!1,eu=0,Gi=null,u)throw Error(e(300));i===null||qe||(i=i.dependencies,i!==null&&bs(i)&&(qe=!0))}function Yv(i,u,c,d){Pt=i;var m=0;do{if(Wi&&(Gi=null),eu=0,Wi=!1,25<=m)throw Error(e(301));if(m+=1,De=ae=null,i.updateQueue!=null){var b=i.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}P.H=m2,b=u(c,d)}while(Wi);return b}function c2(){var i=P.H,u=i.useState()[0];return u=typeof u.then=="function"?nu(u):u,i=i.useState()[0],(ae!==null?ae.memoizedState:null)!==i&&(Pt.flags|=1024),u}function hf(){var i=Rs!==0;return Rs=0,i}function df(i,u,c){u.updateQueue=i.updateQueue,u.flags&=-2053,i.lanes&=~c}function pf(i){if(Ss){for(i=i.memoizedState;i!==null;){var u=i.queue;u!==null&&(u.pending=null),i=i.next}Ss=!1}pa=0,De=ae=Pt=null,Wi=!1,eu=Rs=0,Gi=null}function wn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return De===null?Pt.memoizedState=De=i:De=De.next=i,De}function Ne(){if(ae===null){var i=Pt.alternate;i=i!==null?i.memoizedState:null}else i=ae.next;var u=De===null?Pt.memoizedState:De.next;if(u!==null)De=u,ae=i;else{if(i===null)throw Pt.alternate===null?Error(e(467)):Error(e(310));ae=i,i={memoizedState:ae.memoizedState,baseState:ae.baseState,baseQueue:ae.baseQueue,queue:ae.queue,next:null},De===null?Pt.memoizedState=De=i:De=De.next=i}return De}function vf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function nu(i){var u=eu;return eu+=1,Gi===null&&(Gi=[]),i=Vv(Gi,i,u),u=Pt,(De===null?u.memoizedState:De.next)===null&&(u=u.alternate,P.H=u===null||u.memoizedState===null?Nm:Mm),i}function As(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return nu(i);if(i.$$typeof===A)return an(i)}throw Error(e(438,String(i)))}function mf(i){var u=null,c=Pt.updateQueue;if(c!==null&&(u=c.memoCache),u==null){var d=Pt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(u={data:d.data.map(function(m){return m.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),c===null&&(c=vf(),Pt.updateQueue=c),c.memoCache=u,c=u.data[u.index],c===void 0)for(c=u.data[u.index]=Array(i),d=0;d<i;d++)c[d]=F;return u.index++,c}function qr(i,u){return typeof u=="function"?u(i):u}function Ts(i){var u=Ne();return gf(u,ae,i)}function gf(i,u,c){var d=i.queue;if(d===null)throw Error(e(311));d.lastRenderedReducer=c;var m=i.baseQueue,b=d.pending;if(b!==null){if(m!==null){var S=m.next;m.next=b.next,b.next=S}u.baseQueue=m=b,d.pending=null}if(b=i.baseState,m===null)i.memoizedState=b;else{u=m.next;var D=S=null,z=null,Q=u,st=!1;do{var ct=Q.lane&-536870913;if(ct!==Q.lane?(Kt&ct)===ct:(pa&ct)===ct){var Z=Q.revertLane;if(Z===0)z!==null&&(z=z.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),ct===Ui&&(st=!0);else if((pa&Z)===Z){Q=Q.next,Z===Ui&&(st=!0);continue}else ct={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},z===null?(D=z=ct,S=b):z=z.next=ct,Pt.lanes|=Z,wa|=Z;ct=Q.action,ni&&c(b,ct),b=Q.hasEagerState?Q.eagerState:c(b,ct)}else Z={lane:ct,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},z===null?(D=z=Z,S=b):z=z.next=Z,Pt.lanes|=ct,wa|=ct;Q=Q.next}while(Q!==null&&Q!==u);if(z===null?S=b:z.next=D,!Mn(b,i.memoizedState)&&(qe=!0,st&&(c=Hi,c!==null)))throw c;i.memoizedState=b,i.baseState=S,i.baseQueue=z,d.lastRenderedState=b}return m===null&&(d.lanes=0),[i.memoizedState,d.dispatch]}function yf(i){var u=Ne(),c=u.queue;if(c===null)throw Error(e(311));c.lastRenderedReducer=i;var d=c.dispatch,m=c.pending,b=u.memoizedState;if(m!==null){c.pending=null;var S=m=m.next;do b=i(b,S.action),S=S.next;while(S!==m);Mn(b,u.memoizedState)||(qe=!0),u.memoizedState=b,u.baseQueue===null&&(u.baseState=b),c.lastRenderedState=b}return[b,d]}function Qv(i,u,c){var d=Pt,m=Ne(),b=Zt;if(b){if(c===void 0)throw Error(e(407));c=c()}else c=u();var S=!Mn((ae||m).memoizedState,c);S&&(m.memoizedState=c,qe=!0),m=m.queue;var D=$v.bind(null,d,m,i);if(ru(2048,8,D,[i]),m.getSnapshot!==u||S||De!==null&&De.memoizedState.tag&1){if(d.flags|=2048,qi(9,Ds(),Jv.bind(null,d,m,c,u),null),fe===null)throw Error(e(349));b||(pa&124)!==0||Zv(d,u,c)}return c}function Zv(i,u,c){i.flags|=16384,i={getSnapshot:u,value:c},u=Pt.updateQueue,u===null?(u=vf(),Pt.updateQueue=u,u.stores=[i]):(c=u.stores,c===null?u.stores=[i]:c.push(i))}function Jv(i,u,c,d){u.value=c,u.getSnapshot=d,tm(u)&&em(i)}function $v(i,u,c){return c(function(){tm(u)&&em(i)})}function tm(i){var u=i.getSnapshot;i=i.value;try{var c=u();return!Mn(i,c)}catch{return!0}}function em(i){var u=Fi(i,2);u!==null&&Ln(u,i,2)}function bf(i){var u=wn();if(typeof i=="function"){var c=i;if(i=c(),ni){Se(!0);try{c()}finally{Se(!1)}}}return u.memoizedState=u.baseState=i,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qr,lastRenderedState:i},u}function nm(i,u,c,d){return i.baseState=c,gf(i,ae,typeof d=="function"?d:qr)}function f2(i,u,c,d,m){if(Ms(i))throw Error(e(485));if(i=u.action,i!==null){var b={payload:m,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){b.listeners.push(S)}};P.T!==null?c(!0):b.isTransition=!1,d(b),c=u.pending,c===null?(b.next=u.pending=b,rm(u,b)):(b.next=c.next,u.pending=c.next=b)}}function rm(i,u){var c=u.action,d=u.payload,m=i.state;if(u.isTransition){var b=P.T,S={};P.T=S;try{var D=c(m,d),z=P.S;z!==null&&z(S,D),am(i,u,D)}catch(Q){xf(i,u,Q)}finally{P.T=b}}else try{b=c(m,d),am(i,u,b)}catch(Q){xf(i,u,Q)}}function am(i,u,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){im(i,u,d)},function(d){return xf(i,u,d)}):im(i,u,c)}function im(i,u,c){u.status="fulfilled",u.value=c,om(u),i.state=c,u=i.pending,u!==null&&(c=u.next,c===u?i.pending=null:(c=c.next,u.next=c,rm(i,c)))}function xf(i,u,c){var d=i.pending;if(i.pending=null,d!==null){d=d.next;do u.status="rejected",u.reason=c,om(u),u=u.next;while(u!==d)}i.action=null}function om(i){i=i.listeners;for(var u=0;u<i.length;u++)(0,i[u])()}function um(i,u){return u}function sm(i,u){if(Zt){var c=fe.formState;if(c!==null){t:{var d=Pt;if(Zt){if(_e){e:{for(var m=_e,b=yr;m.nodeType!==8;){if(!b){m=null;break e}if(m=lr(m.nextSibling),m===null){m=null;break e}}b=m.data,m=b==="F!"||b==="F"?m:null}if(m){_e=lr(m.nextSibling),d=m.data==="F!";break t}}Ja(d)}d=!1}d&&(u=c[0])}}return c=wn(),c.memoizedState=c.baseState=u,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:um,lastRenderedState:u},c.queue=d,c=Am.bind(null,Pt,d),d.dispatch=c,d=bf(!1),b=Sf.bind(null,Pt,!1,d.queue),d=wn(),m={state:u,dispatch:null,action:i,pending:null},d.queue=m,c=f2.bind(null,Pt,m,b,c),m.dispatch=c,d.memoizedState=i,[u,c,!1]}function lm(i){var u=Ne();return cm(u,ae,i)}function cm(i,u,c){if(u=gf(i,u,um)[0],i=Ts(qr)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var d=nu(u)}catch(S){throw S===Qo?_s:S}else d=u;u=Ne();var m=u.queue,b=m.dispatch;return c!==u.memoizedState&&(Pt.flags|=2048,qi(9,Ds(),h2.bind(null,m,c),null)),[d,b,i]}function h2(i,u){i.action=u}function fm(i){var u=Ne(),c=ae;if(c!==null)return cm(u,c,i);Ne(),u=u.memoizedState,c=Ne();var d=c.queue.dispatch;return c.memoizedState=i,[u,d,!1]}function qi(i,u,c,d){return i={tag:i,create:c,deps:d,inst:u,next:null},u=Pt.updateQueue,u===null&&(u=vf(),Pt.updateQueue=u),c=u.lastEffect,c===null?u.lastEffect=i.next=i:(d=c.next,c.next=i,i.next=d,u.lastEffect=i),i}function Ds(){return{destroy:void 0,resource:void 0}}function hm(){return Ne().memoizedState}function Ns(i,u,c,d){var m=wn();d=d===void 0?null:d,Pt.flags|=i,m.memoizedState=qi(1|u,Ds(),c,d)}function ru(i,u,c,d){var m=Ne();d=d===void 0?null:d;var b=m.memoizedState.inst;ae!==null&&d!==null&&cf(d,ae.memoizedState.deps)?m.memoizedState=qi(u,b,c,d):(Pt.flags|=i,m.memoizedState=qi(1|u,b,c,d))}function dm(i,u){Ns(8390656,8,i,u)}function pm(i,u){ru(2048,8,i,u)}function vm(i,u){return ru(4,2,i,u)}function mm(i,u){return ru(4,4,i,u)}function gm(i,u){if(typeof u=="function"){i=i();var c=u(i);return function(){typeof c=="function"?c():u(null)}}if(u!=null)return i=i(),u.current=i,function(){u.current=null}}function ym(i,u,c){c=c!=null?c.concat([i]):null,ru(4,4,gm.bind(null,u,i),c)}function wf(){}function bm(i,u){var c=Ne();u=u===void 0?null:u;var d=c.memoizedState;return u!==null&&cf(u,d[1])?d[0]:(c.memoizedState=[i,u],i)}function xm(i,u){var c=Ne();u=u===void 0?null:u;var d=c.memoizedState;if(u!==null&&cf(u,d[1]))return d[0];if(d=i(),ni){Se(!0);try{i()}finally{Se(!1)}}return c.memoizedState=[d,u],d}function _f(i,u,c){return c===void 0||(pa&1073741824)!==0?i.memoizedState=u:(i.memoizedState=c,i=Eg(),Pt.lanes|=i,wa|=i,c)}function wm(i,u,c,d){return Mn(c,u)?c:Vi.current!==null?(i=_f(i,c,d),Mn(i,u)||(qe=!0),i):(pa&42)===0?(qe=!0,i.memoizedState=c):(i=Eg(),Pt.lanes|=i,wa|=i,u)}function _m(i,u,c,d,m){var b=q.p;q.p=b!==0&&8>b?b:8;var S=P.T,D={};P.T=D,Sf(i,!1,u,c);try{var z=m(),Q=P.S;if(Q!==null&&Q(D,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var st=s2(z,d);au(i,u,st,Fn(i))}else au(i,u,d,Fn(i))}catch(ct){au(i,u,{then:function(){},status:"rejected",reason:ct},Fn())}finally{q.p=b,P.T=S}}function d2(){}function Ef(i,u,c,d){if(i.tag!==5)throw Error(e(476));var m=Em(i).queue;_m(i,m,u,K,c===null?d2:function(){return Cm(i),c(d)})}function Em(i){var u=i.memoizedState;if(u!==null)return u;u={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qr,lastRenderedState:K},next:null};var c={};return u.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qr,lastRenderedState:c},next:null},i.memoizedState=u,i=i.alternate,i!==null&&(i.memoizedState=u),u}function Cm(i){var u=Em(i).next.queue;au(i,u,{},Fn())}function Cf(){return an(_u)}function Sm(){return Ne().memoizedState}function Rm(){return Ne().memoizedState}function p2(i){for(var u=i.return;u!==null;){switch(u.tag){case 24:case 3:var c=Fn();i=ha(c);var d=da(u,i,c);d!==null&&(Ln(d,u,c),Jo(d,u,c)),u={cache:$c()},i.payload=u;return}u=u.return}}function v2(i,u,c){var d=Fn();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},Ms(i)?Tm(u,c):(c=Wc(i,u,c,d),c!==null&&(Ln(c,i,d),Dm(c,u,d)))}function Am(i,u,c){var d=Fn();au(i,u,c,d)}function au(i,u,c,d){var m={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ms(i))Tm(u,m);else{var b=i.alternate;if(i.lanes===0&&(b===null||b.lanes===0)&&(b=u.lastRenderedReducer,b!==null))try{var S=u.lastRenderedState,D=b(S,c);if(m.hasEagerState=!0,m.eagerState=D,Mn(D,S))return ps(i,u,m,0),fe===null&&ds(),!1}catch{}finally{}if(c=Wc(i,u,m,d),c!==null)return Ln(c,i,d),Dm(c,u,d),!0}return!1}function Sf(i,u,c,d){if(d={lane:2,revertLane:rh(),action:d,hasEagerState:!1,eagerState:null,next:null},Ms(i)){if(u)throw Error(e(479))}else u=Wc(i,c,d,2),u!==null&&Ln(u,i,2)}function Ms(i){var u=i.alternate;return i===Pt||u!==null&&u===Pt}function Tm(i,u){Wi=Ss=!0;var c=i.pending;c===null?u.next=u:(u.next=c.next,c.next=u),i.pending=u}function Dm(i,u,c){if((c&4194048)!==0){var d=u.lanes;d&=i.pendingLanes,c|=d,u.lanes=c,Lp(i,c)}}var ks={readContext:an,use:As,useCallback:Re,useContext:Re,useEffect:Re,useImperativeHandle:Re,useLayoutEffect:Re,useInsertionEffect:Re,useMemo:Re,useReducer:Re,useRef:Re,useState:Re,useDebugValue:Re,useDeferredValue:Re,useTransition:Re,useSyncExternalStore:Re,useId:Re,useHostTransitionStatus:Re,useFormState:Re,useActionState:Re,useOptimistic:Re,useMemoCache:Re,useCacheRefresh:Re},Nm={readContext:an,use:As,useCallback:function(i,u){return wn().memoizedState=[i,u===void 0?null:u],i},useContext:an,useEffect:dm,useImperativeHandle:function(i,u,c){c=c!=null?c.concat([i]):null,Ns(4194308,4,gm.bind(null,u,i),c)},useLayoutEffect:function(i,u){return Ns(4194308,4,i,u)},useInsertionEffect:function(i,u){Ns(4,2,i,u)},useMemo:function(i,u){var c=wn();u=u===void 0?null:u;var d=i();if(ni){Se(!0);try{i()}finally{Se(!1)}}return c.memoizedState=[d,u],d},useReducer:function(i,u,c){var d=wn();if(c!==void 0){var m=c(u);if(ni){Se(!0);try{c(u)}finally{Se(!1)}}}else m=u;return d.memoizedState=d.baseState=m,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:m},d.queue=i,i=i.dispatch=v2.bind(null,Pt,i),[d.memoizedState,i]},useRef:function(i){var u=wn();return i={current:i},u.memoizedState=i},useState:function(i){i=bf(i);var u=i.queue,c=Am.bind(null,Pt,u);return u.dispatch=c,[i.memoizedState,c]},useDebugValue:wf,useDeferredValue:function(i,u){var c=wn();return _f(c,i,u)},useTransition:function(){var i=bf(!1);return i=_m.bind(null,Pt,i.queue,!0,!1),wn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,u,c){var d=Pt,m=wn();if(Zt){if(c===void 0)throw Error(e(407));c=c()}else{if(c=u(),fe===null)throw Error(e(349));(Kt&124)!==0||Zv(d,u,c)}m.memoizedState=c;var b={value:c,getSnapshot:u};return m.queue=b,dm($v.bind(null,d,b,i),[i]),d.flags|=2048,qi(9,Ds(),Jv.bind(null,d,b,c,u),null),c},useId:function(){var i=wn(),u=fe.identifierPrefix;if(Zt){var c=Vr,d=Hr;c=(d&~(1<<32-ht(d)-1)).toString(32)+c,u="«"+u+"R"+c,c=Rs++,0<c&&(u+="H"+c.toString(32)),u+="»"}else c=l2++,u="«"+u+"r"+c.toString(32)+"»";return i.memoizedState=u},useHostTransitionStatus:Cf,useFormState:sm,useActionState:sm,useOptimistic:function(i){var u=wn();u.memoizedState=u.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=c,u=Sf.bind(null,Pt,!0,c),c.dispatch=u,[i,u]},useMemoCache:mf,useCacheRefresh:function(){return wn().memoizedState=p2.bind(null,Pt)}},Mm={readContext:an,use:As,useCallback:bm,useContext:an,useEffect:pm,useImperativeHandle:ym,useInsertionEffect:vm,useLayoutEffect:mm,useMemo:xm,useReducer:Ts,useRef:hm,useState:function(){return Ts(qr)},useDebugValue:wf,useDeferredValue:function(i,u){var c=Ne();return wm(c,ae.memoizedState,i,u)},useTransition:function(){var i=Ts(qr)[0],u=Ne().memoizedState;return[typeof i=="boolean"?i:nu(i),u]},useSyncExternalStore:Qv,useId:Sm,useHostTransitionStatus:Cf,useFormState:lm,useActionState:lm,useOptimistic:function(i,u){var c=Ne();return nm(c,ae,i,u)},useMemoCache:mf,useCacheRefresh:Rm},m2={readContext:an,use:As,useCallback:bm,useContext:an,useEffect:pm,useImperativeHandle:ym,useInsertionEffect:vm,useLayoutEffect:mm,useMemo:xm,useReducer:yf,useRef:hm,useState:function(){return yf(qr)},useDebugValue:wf,useDeferredValue:function(i,u){var c=Ne();return ae===null?_f(c,i,u):wm(c,ae.memoizedState,i,u)},useTransition:function(){var i=yf(qr)[0],u=Ne().memoizedState;return[typeof i=="boolean"?i:nu(i),u]},useSyncExternalStore:Qv,useId:Sm,useHostTransitionStatus:Cf,useFormState:fm,useActionState:fm,useOptimistic:function(i,u){var c=Ne();return ae!==null?nm(c,ae,i,u):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:mf,useCacheRefresh:Rm},ji=null,iu=0;function Os(i){var u=iu;return iu+=1,ji===null&&(ji=[]),Vv(ji,i,u)}function ou(i,u){u=u.props.ref,i.ref=u!==void 0?u:null}function Is(i,u){throw u.$$typeof===v?Error(e(525)):(i=Object.prototype.toString.call(u),Error(e(31,i==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":i)))}function km(i){var u=i._init;return u(i._payload)}function Om(i){function u(j,V){if(i){var Y=j.deletions;Y===null?(j.deletions=[V],j.flags|=16):Y.push(V)}}function c(j,V){if(!i)return null;for(;V!==null;)u(j,V),V=V.sibling;return null}function d(j){for(var V=new Map;j!==null;)j.key!==null?V.set(j.key,j):V.set(j.index,j),j=j.sibling;return V}function m(j,V){return j=Ur(j,V),j.index=0,j.sibling=null,j}function b(j,V,Y){return j.index=Y,i?(Y=j.alternate,Y!==null?(Y=Y.index,Y<V?(j.flags|=67108866,V):Y):(j.flags|=67108866,V)):(j.flags|=1048576,V)}function S(j){return i&&j.alternate===null&&(j.flags|=67108866),j}function D(j,V,Y,lt){return V===null||V.tag!==6?(V=qc(Y,j.mode,lt),V.return=j,V):(V=m(V,Y),V.return=j,V)}function z(j,V,Y,lt){var xt=Y.type;return xt===x?st(j,V,Y.props.children,lt,Y.key):V!==null&&(V.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===B&&km(xt)===V.type)?(V=m(V,Y.props),ou(V,Y),V.return=j,V):(V=ms(Y.type,Y.key,Y.props,null,j.mode,lt),ou(V,Y),V.return=j,V)}function Q(j,V,Y,lt){return V===null||V.tag!==4||V.stateNode.containerInfo!==Y.containerInfo||V.stateNode.implementation!==Y.implementation?(V=jc(Y,j.mode,lt),V.return=j,V):(V=m(V,Y.children||[]),V.return=j,V)}function st(j,V,Y,lt,xt){return V===null||V.tag!==7?(V=Ka(Y,j.mode,lt,xt),V.return=j,V):(V=m(V,Y),V.return=j,V)}function ct(j,V,Y){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return V=qc(""+V,j.mode,Y),V.return=j,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case g:return Y=ms(V.type,V.key,V.props,null,j.mode,Y),ou(Y,V),Y.return=j,Y;case y:return V=jc(V,j.mode,Y),V.return=j,V;case B:var lt=V._init;return V=lt(V._payload),ct(j,V,Y)}if(tt(V)||U(V))return V=Ka(V,j.mode,Y,null),V.return=j,V;if(typeof V.then=="function")return ct(j,Os(V),Y);if(V.$$typeof===A)return ct(j,xs(j,V),Y);Is(j,V)}return null}function Z(j,V,Y,lt){var xt=V!==null?V.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return xt!==null?null:D(j,V,""+Y,lt);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case g:return Y.key===xt?z(j,V,Y,lt):null;case y:return Y.key===xt?Q(j,V,Y,lt):null;case B:return xt=Y._init,Y=xt(Y._payload),Z(j,V,Y,lt)}if(tt(Y)||U(Y))return xt!==null?null:st(j,V,Y,lt,null);if(typeof Y.then=="function")return Z(j,V,Os(Y),lt);if(Y.$$typeof===A)return Z(j,V,xs(j,Y),lt);Is(j,Y)}return null}function J(j,V,Y,lt,xt){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return j=j.get(Y)||null,D(V,j,""+lt,xt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case g:return j=j.get(lt.key===null?Y:lt.key)||null,z(V,j,lt,xt);case y:return j=j.get(lt.key===null?Y:lt.key)||null,Q(V,j,lt,xt);case B:var Ht=lt._init;return lt=Ht(lt._payload),J(j,V,Y,lt,xt)}if(tt(lt)||U(lt))return j=j.get(Y)||null,st(V,j,lt,xt,null);if(typeof lt.then=="function")return J(j,V,Y,Os(lt),xt);if(lt.$$typeof===A)return J(j,V,Y,xs(V,lt),xt);Is(V,lt)}return null}function Mt(j,V,Y,lt){for(var xt=null,Ht=null,At=V,Nt=V=0,Xe=null;At!==null&&Nt<Y.length;Nt++){At.index>Nt?(Xe=At,At=null):Xe=At.sibling;var Qt=Z(j,At,Y[Nt],lt);if(Qt===null){At===null&&(At=Xe);break}i&&At&&Qt.alternate===null&&u(j,At),V=b(Qt,V,Nt),Ht===null?xt=Qt:Ht.sibling=Qt,Ht=Qt,At=Xe}if(Nt===Y.length)return c(j,At),Zt&&Qa(j,Nt),xt;if(At===null){for(;Nt<Y.length;Nt++)At=ct(j,Y[Nt],lt),At!==null&&(V=b(At,V,Nt),Ht===null?xt=At:Ht.sibling=At,Ht=At);return Zt&&Qa(j,Nt),xt}for(At=d(At);Nt<Y.length;Nt++)Xe=J(At,j,Nt,Y[Nt],lt),Xe!==null&&(i&&Xe.alternate!==null&&At.delete(Xe.key===null?Nt:Xe.key),V=b(Xe,V,Nt),Ht===null?xt=Xe:Ht.sibling=Xe,Ht=Xe);return i&&At.forEach(function(Na){return u(j,Na)}),Zt&&Qa(j,Nt),xt}function Dt(j,V,Y,lt){if(Y==null)throw Error(e(151));for(var xt=null,Ht=null,At=V,Nt=V=0,Xe=null,Qt=Y.next();At!==null&&!Qt.done;Nt++,Qt=Y.next()){At.index>Nt?(Xe=At,At=null):Xe=At.sibling;var Na=Z(j,At,Qt.value,lt);if(Na===null){At===null&&(At=Xe);break}i&&At&&Na.alternate===null&&u(j,At),V=b(Na,V,Nt),Ht===null?xt=Na:Ht.sibling=Na,Ht=Na,At=Xe}if(Qt.done)return c(j,At),Zt&&Qa(j,Nt),xt;if(At===null){for(;!Qt.done;Nt++,Qt=Y.next())Qt=ct(j,Qt.value,lt),Qt!==null&&(V=b(Qt,V,Nt),Ht===null?xt=Qt:Ht.sibling=Qt,Ht=Qt);return Zt&&Qa(j,Nt),xt}for(At=d(At);!Qt.done;Nt++,Qt=Y.next())Qt=J(At,j,Nt,Qt.value,lt),Qt!==null&&(i&&Qt.alternate!==null&&At.delete(Qt.key===null?Nt:Qt.key),V=b(Qt,V,Nt),Ht===null?xt=Qt:Ht.sibling=Qt,Ht=Qt);return i&&At.forEach(function(gw){return u(j,gw)}),Zt&&Qa(j,Nt),xt}function oe(j,V,Y,lt){if(typeof Y=="object"&&Y!==null&&Y.type===x&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case g:t:{for(var xt=Y.key;V!==null;){if(V.key===xt){if(xt=Y.type,xt===x){if(V.tag===7){c(j,V.sibling),lt=m(V,Y.props.children),lt.return=j,j=lt;break t}}else if(V.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===B&&km(xt)===V.type){c(j,V.sibling),lt=m(V,Y.props),ou(lt,Y),lt.return=j,j=lt;break t}c(j,V);break}else u(j,V);V=V.sibling}Y.type===x?(lt=Ka(Y.props.children,j.mode,lt,Y.key),lt.return=j,j=lt):(lt=ms(Y.type,Y.key,Y.props,null,j.mode,lt),ou(lt,Y),lt.return=j,j=lt)}return S(j);case y:t:{for(xt=Y.key;V!==null;){if(V.key===xt)if(V.tag===4&&V.stateNode.containerInfo===Y.containerInfo&&V.stateNode.implementation===Y.implementation){c(j,V.sibling),lt=m(V,Y.children||[]),lt.return=j,j=lt;break t}else{c(j,V);break}else u(j,V);V=V.sibling}lt=jc(Y,j.mode,lt),lt.return=j,j=lt}return S(j);case B:return xt=Y._init,Y=xt(Y._payload),oe(j,V,Y,lt)}if(tt(Y))return Mt(j,V,Y,lt);if(U(Y)){if(xt=U(Y),typeof xt!="function")throw Error(e(150));return Y=xt.call(Y),Dt(j,V,Y,lt)}if(typeof Y.then=="function")return oe(j,V,Os(Y),lt);if(Y.$$typeof===A)return oe(j,V,xs(j,Y),lt);Is(j,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,V!==null&&V.tag===6?(c(j,V.sibling),lt=m(V,Y),lt.return=j,j=lt):(c(j,V),lt=qc(Y,j.mode,lt),lt.return=j,j=lt),S(j)):c(j,V)}return function(j,V,Y,lt){try{iu=0;var xt=oe(j,V,Y,lt);return ji=null,xt}catch(At){if(At===Qo||At===_s)throw At;var Ht=kn(29,At,null,j.mode);return Ht.lanes=lt,Ht.return=j,Ht}finally{}}}var Xi=Om(!0),Im=Om(!1),tr=X(null),br=null;function va(i){var u=i.alternate;ot(Oe,Oe.current&1),ot(tr,i),br===null&&(u===null||Vi.current!==null||u.memoizedState!==null)&&(br=i)}function Bm(i){if(i.tag===22){if(ot(Oe,Oe.current),ot(tr,i),br===null){var u=i.alternate;u!==null&&u.memoizedState!==null&&(br=i)}}else ma()}function ma(){ot(Oe,Oe.current),ot(tr,tr.current)}function jr(i){it(tr),br===i&&(br=null),it(Oe)}var Oe=X(0);function Bs(i){for(var u=i;u!==null;){if(u.tag===13){var c=u.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||vh(c)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===i)break;for(;u.sibling===null;){if(u.return===null||u.return===i)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function Rf(i,u,c,d){u=i.memoizedState,c=c(d,u),c=c==null?u:p({},u,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Af={enqueueSetState:function(i,u,c){i=i._reactInternals;var d=Fn(),m=ha(d);m.payload=u,c!=null&&(m.callback=c),u=da(i,m,d),u!==null&&(Ln(u,i,d),Jo(u,i,d))},enqueueReplaceState:function(i,u,c){i=i._reactInternals;var d=Fn(),m=ha(d);m.tag=1,m.payload=u,c!=null&&(m.callback=c),u=da(i,m,d),u!==null&&(Ln(u,i,d),Jo(u,i,d))},enqueueForceUpdate:function(i,u){i=i._reactInternals;var c=Fn(),d=ha(c);d.tag=2,u!=null&&(d.callback=u),u=da(i,d,c),u!==null&&(Ln(u,i,c),Jo(u,i,c))}};function Fm(i,u,c,d,m,b,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(d,b,S):u.prototype&&u.prototype.isPureReactComponent?!Vo(c,d)||!Vo(m,b):!0}function Lm(i,u,c,d){i=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(c,d),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(c,d),u.state!==i&&Af.enqueueReplaceState(u,u.state,null)}function ri(i,u){var c=u;if("ref"in u){c={};for(var d in u)d!=="ref"&&(c[d]=u[d])}if(i=i.defaultProps){c===u&&(c=p({},c));for(var m in i)c[m]===void 0&&(c[m]=i[m])}return c}var Fs=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function zm(i){Fs(i)}function Pm(i){console.error(i)}function Um(i){Fs(i)}function Ls(i,u){try{var c=i.onUncaughtError;c(u.value,{componentStack:u.stack})}catch(d){setTimeout(function(){throw d})}}function Hm(i,u,c){try{var d=i.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Tf(i,u,c){return c=ha(c),c.tag=3,c.payload={element:null},c.callback=function(){Ls(i,u)},c}function Vm(i){return i=ha(i),i.tag=3,i}function Wm(i,u,c,d){var m=c.type.getDerivedStateFromError;if(typeof m=="function"){var b=d.value;i.payload=function(){return m(b)},i.callback=function(){Hm(u,c,d)}}var S=c.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(i.callback=function(){Hm(u,c,d),typeof m!="function"&&(_a===null?_a=new Set([this]):_a.add(this));var D=d.stack;this.componentDidCatch(d.value,{componentStack:D!==null?D:""})})}function g2(i,u,c,d,m){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(u=c.alternate,u!==null&&Xo(u,c,m,!0),c=tr.current,c!==null){switch(c.tag){case 13:return br===null?Jf():c.alternate===null&&Ee===0&&(Ee=3),c.flags&=-257,c.flags|=65536,c.lanes=m,d===nf?c.flags|=16384:(u=c.updateQueue,u===null?c.updateQueue=new Set([d]):u.add(d),th(i,d,m)),!1;case 22:return c.flags|=65536,d===nf?c.flags|=16384:(u=c.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=u):(c=u.retryQueue,c===null?u.retryQueue=new Set([d]):c.add(d)),th(i,d,m)),!1}throw Error(e(435,c.tag))}return th(i,d,m),Jf(),!1}if(Zt)return u=tr.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=m,d!==Yc&&(i=Error(e(422),{cause:d}),jo(Qn(i,c)))):(d!==Yc&&(u=Error(e(423),{cause:d}),jo(Qn(u,c))),i=i.current.alternate,i.flags|=65536,m&=-m,i.lanes|=m,d=Qn(d,c),m=Tf(i.stateNode,d,m),of(i,m),Ee!==4&&(Ee=2)),!1;var b=Error(e(520),{cause:d});if(b=Qn(b,c),du===null?du=[b]:du.push(b),Ee!==4&&(Ee=2),u===null)return!0;d=Qn(d,c),c=u;do{switch(c.tag){case 3:return c.flags|=65536,i=m&-m,c.lanes|=i,i=Tf(c.stateNode,d,i),of(c,i),!1;case 1:if(u=c.type,b=c.stateNode,(c.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(_a===null||!_a.has(b))))return c.flags|=65536,m&=-m,c.lanes|=m,m=Vm(m),Wm(m,i,c,d),of(c,m),!1}c=c.return}while(c!==null);return!1}var Gm=Error(e(461)),qe=!1;function Ze(i,u,c,d){u.child=i===null?Im(u,null,c,d):Xi(u,i.child,c,d)}function qm(i,u,c,d,m){c=c.render;var b=u.ref;if("ref"in d){var S={};for(var D in d)D!=="ref"&&(S[D]=d[D])}else S=d;return ti(u),d=ff(i,u,c,S,b,m),D=hf(),i!==null&&!qe?(df(i,u,m),Xr(i,u,m)):(Zt&&D&&Xc(u),u.flags|=1,Ze(i,u,d,m),u.child)}function jm(i,u,c,d,m){if(i===null){var b=c.type;return typeof b=="function"&&!Gc(b)&&b.defaultProps===void 0&&c.compare===null?(u.tag=15,u.type=b,Xm(i,u,b,d,m)):(i=ms(c.type,null,d,u,u.mode,m),i.ref=u.ref,i.return=u,u.child=i)}if(b=i.child,!Ff(i,m)){var S=b.memoizedProps;if(c=c.compare,c=c!==null?c:Vo,c(S,d)&&i.ref===u.ref)return Xr(i,u,m)}return u.flags|=1,i=Ur(b,d),i.ref=u.ref,i.return=u,u.child=i}function Xm(i,u,c,d,m){if(i!==null){var b=i.memoizedProps;if(Vo(b,d)&&i.ref===u.ref)if(qe=!1,u.pendingProps=d=b,Ff(i,m))(i.flags&131072)!==0&&(qe=!0);else return u.lanes=i.lanes,Xr(i,u,m)}return Df(i,u,c,d,m)}function Km(i,u,c){var d=u.pendingProps,m=d.children,b=i!==null?i.memoizedState:null;if(d.mode==="hidden"){if((u.flags&128)!==0){if(d=b!==null?b.baseLanes|c:c,i!==null){for(m=u.child=i.child,b=0;m!==null;)b=b|m.lanes|m.childLanes,m=m.sibling;u.childLanes=b&~d}else u.childLanes=0,u.child=null;return Ym(i,u,d,c)}if((c&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},i!==null&&ws(u,b!==null?b.cachePool:null),b!==null?Xv(u,b):sf(),Bm(u);else return u.lanes=u.childLanes=536870912,Ym(i,u,b!==null?b.baseLanes|c:c,c)}else b!==null?(ws(u,b.cachePool),Xv(u,b),ma(),u.memoizedState=null):(i!==null&&ws(u,null),sf(),ma());return Ze(i,u,m,c),u.child}function Ym(i,u,c,d){var m=ef();return m=m===null?null:{parent:ke._currentValue,pool:m},u.memoizedState={baseLanes:c,cachePool:m},i!==null&&ws(u,null),sf(),Bm(u),i!==null&&Xo(i,u,d,!0),null}function zs(i,u){var c=u.ref;if(c===null)i!==null&&i.ref!==null&&(u.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(e(284));(i===null||i.ref!==c)&&(u.flags|=4194816)}}function Df(i,u,c,d,m){return ti(u),c=ff(i,u,c,d,void 0,m),d=hf(),i!==null&&!qe?(df(i,u,m),Xr(i,u,m)):(Zt&&d&&Xc(u),u.flags|=1,Ze(i,u,c,m),u.child)}function Qm(i,u,c,d,m,b){return ti(u),u.updateQueue=null,c=Yv(u,d,c,m),Kv(i),d=hf(),i!==null&&!qe?(df(i,u,b),Xr(i,u,b)):(Zt&&d&&Xc(u),u.flags|=1,Ze(i,u,c,b),u.child)}function Zm(i,u,c,d,m){if(ti(u),u.stateNode===null){var b=Li,S=c.contextType;typeof S=="object"&&S!==null&&(b=an(S)),b=new c(d,b),u.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Af,u.stateNode=b,b._reactInternals=u,b=u.stateNode,b.props=d,b.state=u.memoizedState,b.refs={},rf(u),S=c.contextType,b.context=typeof S=="object"&&S!==null?an(S):Li,b.state=u.memoizedState,S=c.getDerivedStateFromProps,typeof S=="function"&&(Rf(u,c,S,d),b.state=u.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(S=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),S!==b.state&&Af.enqueueReplaceState(b,b.state,null),tu(u,d,b,m),$o(),b.state=u.memoizedState),typeof b.componentDidMount=="function"&&(u.flags|=4194308),d=!0}else if(i===null){b=u.stateNode;var D=u.memoizedProps,z=ri(c,D);b.props=z;var Q=b.context,st=c.contextType;S=Li,typeof st=="object"&&st!==null&&(S=an(st));var ct=c.getDerivedStateFromProps;st=typeof ct=="function"||typeof b.getSnapshotBeforeUpdate=="function",D=u.pendingProps!==D,st||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(D||Q!==S)&&Lm(u,b,d,S),fa=!1;var Z=u.memoizedState;b.state=Z,tu(u,d,b,m),$o(),Q=u.memoizedState,D||Z!==Q||fa?(typeof ct=="function"&&(Rf(u,c,ct,d),Q=u.memoizedState),(z=fa||Fm(u,c,z,d,Z,Q,S))?(st||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(u.flags|=4194308)):(typeof b.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=d,u.memoizedState=Q),b.props=d,b.state=Q,b.context=S,d=z):(typeof b.componentDidMount=="function"&&(u.flags|=4194308),d=!1)}else{b=u.stateNode,af(i,u),S=u.memoizedProps,st=ri(c,S),b.props=st,ct=u.pendingProps,Z=b.context,Q=c.contextType,z=Li,typeof Q=="object"&&Q!==null&&(z=an(Q)),D=c.getDerivedStateFromProps,(Q=typeof D=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(S!==ct||Z!==z)&&Lm(u,b,d,z),fa=!1,Z=u.memoizedState,b.state=Z,tu(u,d,b,m),$o();var J=u.memoizedState;S!==ct||Z!==J||fa||i!==null&&i.dependencies!==null&&bs(i.dependencies)?(typeof D=="function"&&(Rf(u,c,D,d),J=u.memoizedState),(st=fa||Fm(u,c,st,d,Z,J,z)||i!==null&&i.dependencies!==null&&bs(i.dependencies))?(Q||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,J,z),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,J,z)),typeof b.componentDidUpdate=="function"&&(u.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof b.componentDidUpdate!="function"||S===i.memoizedProps&&Z===i.memoizedState||(u.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===i.memoizedProps&&Z===i.memoizedState||(u.flags|=1024),u.memoizedProps=d,u.memoizedState=J),b.props=d,b.state=J,b.context=z,d=st):(typeof b.componentDidUpdate!="function"||S===i.memoizedProps&&Z===i.memoizedState||(u.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===i.memoizedProps&&Z===i.memoizedState||(u.flags|=1024),d=!1)}return b=d,zs(i,u),d=(u.flags&128)!==0,b||d?(b=u.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:b.render(),u.flags|=1,i!==null&&d?(u.child=Xi(u,i.child,null,m),u.child=Xi(u,null,c,m)):Ze(i,u,c,m),u.memoizedState=b.state,i=u.child):i=Xr(i,u,m),i}function Jm(i,u,c,d){return qo(),u.flags|=256,Ze(i,u,c,d),u.child}var Nf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mf(i){return{baseLanes:i,cachePool:Pv()}}function kf(i,u,c){return i=i!==null?i.childLanes&~c:0,u&&(i|=er),i}function $m(i,u,c){var d=u.pendingProps,m=!1,b=(u.flags&128)!==0,S;if((S=b)||(S=i!==null&&i.memoizedState===null?!1:(Oe.current&2)!==0),S&&(m=!0,u.flags&=-129),S=(u.flags&32)!==0,u.flags&=-33,i===null){if(Zt){if(m?va(u):ma(),Zt){var D=_e,z;if(z=D){t:{for(z=D,D=yr;z.nodeType!==8;){if(!D){D=null;break t}if(z=lr(z.nextSibling),z===null){D=null;break t}}D=z}D!==null?(u.memoizedState={dehydrated:D,treeContext:Ya!==null?{id:Hr,overflow:Vr}:null,retryLane:536870912,hydrationErrors:null},z=kn(18,null,null,0),z.stateNode=D,z.return=u,u.child=z,vn=u,_e=null,z=!0):z=!1}z||Ja(u)}if(D=u.memoizedState,D!==null&&(D=D.dehydrated,D!==null))return vh(D)?u.lanes=32:u.lanes=536870912,null;jr(u)}return D=d.children,d=d.fallback,m?(ma(),m=u.mode,D=Ps({mode:"hidden",children:D},m),d=Ka(d,m,c,null),D.return=u,d.return=u,D.sibling=d,u.child=D,m=u.child,m.memoizedState=Mf(c),m.childLanes=kf(i,S,c),u.memoizedState=Nf,d):(va(u),Of(u,D))}if(z=i.memoizedState,z!==null&&(D=z.dehydrated,D!==null)){if(b)u.flags&256?(va(u),u.flags&=-257,u=If(i,u,c)):u.memoizedState!==null?(ma(),u.child=i.child,u.flags|=128,u=null):(ma(),m=d.fallback,D=u.mode,d=Ps({mode:"visible",children:d.children},D),m=Ka(m,D,c,null),m.flags|=2,d.return=u,m.return=u,d.sibling=m,u.child=d,Xi(u,i.child,null,c),d=u.child,d.memoizedState=Mf(c),d.childLanes=kf(i,S,c),u.memoizedState=Nf,u=m);else if(va(u),vh(D)){if(S=D.nextSibling&&D.nextSibling.dataset,S)var Q=S.dgst;S=Q,d=Error(e(419)),d.stack="",d.digest=S,jo({value:d,source:null,stack:null}),u=If(i,u,c)}else if(qe||Xo(i,u,c,!1),S=(c&i.childLanes)!==0,qe||S){if(S=fe,S!==null&&(d=c&-c,d=(d&42)!==0?1:vc(d),d=(d&(S.suspendedLanes|c))!==0?0:d,d!==0&&d!==z.retryLane))throw z.retryLane=d,Fi(i,d),Ln(S,i,d),Gm;D.data==="$?"||Jf(),u=If(i,u,c)}else D.data==="$?"?(u.flags|=192,u.child=i.child,u=null):(i=z.treeContext,_e=lr(D.nextSibling),vn=u,Zt=!0,Za=null,yr=!1,i!==null&&(Jn[$n++]=Hr,Jn[$n++]=Vr,Jn[$n++]=Ya,Hr=i.id,Vr=i.overflow,Ya=u),u=Of(u,d.children),u.flags|=4096);return u}return m?(ma(),m=d.fallback,D=u.mode,z=i.child,Q=z.sibling,d=Ur(z,{mode:"hidden",children:d.children}),d.subtreeFlags=z.subtreeFlags&65011712,Q!==null?m=Ur(Q,m):(m=Ka(m,D,c,null),m.flags|=2),m.return=u,d.return=u,d.sibling=m,u.child=d,d=m,m=u.child,D=i.child.memoizedState,D===null?D=Mf(c):(z=D.cachePool,z!==null?(Q=ke._currentValue,z=z.parent!==Q?{parent:Q,pool:Q}:z):z=Pv(),D={baseLanes:D.baseLanes|c,cachePool:z}),m.memoizedState=D,m.childLanes=kf(i,S,c),u.memoizedState=Nf,d):(va(u),c=i.child,i=c.sibling,c=Ur(c,{mode:"visible",children:d.children}),c.return=u,c.sibling=null,i!==null&&(S=u.deletions,S===null?(u.deletions=[i],u.flags|=16):S.push(i)),u.child=c,u.memoizedState=null,c)}function Of(i,u){return u=Ps({mode:"visible",children:u},i.mode),u.return=i,i.child=u}function Ps(i,u){return i=kn(22,i,null,u),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function If(i,u,c){return Xi(u,i.child,null,c),i=Of(u,u.pendingProps.children),i.flags|=2,u.memoizedState=null,i}function tg(i,u,c){i.lanes|=u;var d=i.alternate;d!==null&&(d.lanes|=u),Zc(i.return,u,c)}function Bf(i,u,c,d,m){var b=i.memoizedState;b===null?i.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:m}:(b.isBackwards=u,b.rendering=null,b.renderingStartTime=0,b.last=d,b.tail=c,b.tailMode=m)}function eg(i,u,c){var d=u.pendingProps,m=d.revealOrder,b=d.tail;if(Ze(i,u,d.children,c),d=Oe.current,(d&2)!==0)d=d&1|2,u.flags|=128;else{if(i!==null&&(i.flags&128)!==0)t:for(i=u.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&tg(i,c,u);else if(i.tag===19)tg(i,c,u);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===u)break t;for(;i.sibling===null;){if(i.return===null||i.return===u)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}d&=1}switch(ot(Oe,d),m){case"forwards":for(c=u.child,m=null;c!==null;)i=c.alternate,i!==null&&Bs(i)===null&&(m=c),c=c.sibling;c=m,c===null?(m=u.child,u.child=null):(m=c.sibling,c.sibling=null),Bf(u,!1,m,c,b);break;case"backwards":for(c=null,m=u.child,u.child=null;m!==null;){if(i=m.alternate,i!==null&&Bs(i)===null){u.child=m;break}i=m.sibling,m.sibling=c,c=m,m=i}Bf(u,!0,c,null,b);break;case"together":Bf(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Xr(i,u,c){if(i!==null&&(u.dependencies=i.dependencies),wa|=u.lanes,(c&u.childLanes)===0)if(i!==null){if(Xo(i,u,c,!1),(c&u.childLanes)===0)return null}else return null;if(i!==null&&u.child!==i.child)throw Error(e(153));if(u.child!==null){for(i=u.child,c=Ur(i,i.pendingProps),u.child=c,c.return=u;i.sibling!==null;)i=i.sibling,c=c.sibling=Ur(i,i.pendingProps),c.return=u;c.sibling=null}return u.child}function Ff(i,u){return(i.lanes&u)!==0?!0:(i=i.dependencies,!!(i!==null&&bs(i)))}function y2(i,u,c){switch(u.tag){case 3:bt(u,u.stateNode.containerInfo),ca(u,ke,i.memoizedState.cache),qo();break;case 27:case 5:$t(u);break;case 4:bt(u,u.stateNode.containerInfo);break;case 10:ca(u,u.type,u.memoizedProps.value);break;case 13:var d=u.memoizedState;if(d!==null)return d.dehydrated!==null?(va(u),u.flags|=128,null):(c&u.child.childLanes)!==0?$m(i,u,c):(va(u),i=Xr(i,u,c),i!==null?i.sibling:null);va(u);break;case 19:var m=(i.flags&128)!==0;if(d=(c&u.childLanes)!==0,d||(Xo(i,u,c,!1),d=(c&u.childLanes)!==0),m){if(d)return eg(i,u,c);u.flags|=128}if(m=u.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ot(Oe,Oe.current),d)break;return null;case 22:case 23:return u.lanes=0,Km(i,u,c);case 24:ca(u,ke,i.memoizedState.cache)}return Xr(i,u,c)}function ng(i,u,c){if(i!==null)if(i.memoizedProps!==u.pendingProps)qe=!0;else{if(!Ff(i,c)&&(u.flags&128)===0)return qe=!1,y2(i,u,c);qe=(i.flags&131072)!==0}else qe=!1,Zt&&(u.flags&1048576)!==0&&kv(u,ys,u.index);switch(u.lanes=0,u.tag){case 16:t:{i=u.pendingProps;var d=u.elementType,m=d._init;if(d=m(d._payload),u.type=d,typeof d=="function")Gc(d)?(i=ri(d,i),u.tag=1,u=Zm(null,u,d,i,c)):(u.tag=0,u=Df(null,u,d,i,c));else{if(d!=null){if(m=d.$$typeof,m===C){u.tag=11,u=qm(null,u,d,i,c);break t}else if(m===L){u.tag=14,u=jm(null,u,d,i,c);break t}}throw u=nt(d)||d,Error(e(306,u,""))}}return u;case 0:return Df(i,u,u.type,u.pendingProps,c);case 1:return d=u.type,m=ri(d,u.pendingProps),Zm(i,u,d,m,c);case 3:t:{if(bt(u,u.stateNode.containerInfo),i===null)throw Error(e(387));d=u.pendingProps;var b=u.memoizedState;m=b.element,af(i,u),tu(u,d,null,c);var S=u.memoizedState;if(d=S.cache,ca(u,ke,d),d!==b.cache&&Jc(u,[ke],c,!0),$o(),d=S.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:S.cache},u.updateQueue.baseState=b,u.memoizedState=b,u.flags&256){u=Jm(i,u,d,c);break t}else if(d!==m){m=Qn(Error(e(424)),u),jo(m),u=Jm(i,u,d,c);break t}else{switch(i=u.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(_e=lr(i.firstChild),vn=u,Zt=!0,Za=null,yr=!0,c=Im(u,null,d,c),u.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(qo(),d===m){u=Xr(i,u,c);break t}Ze(i,u,d,c)}u=u.child}return u;case 26:return zs(i,u),i===null?(c=oy(u.type,null,u.pendingProps,null))?u.memoizedState=c:Zt||(c=u.type,i=u.pendingProps,d=$s(pt.current).createElement(c),d[rn]=u,d[bn]=i,$e(d,c,i),Ge(d),u.stateNode=d):u.memoizedState=oy(u.type,i.memoizedProps,u.pendingProps,i.memoizedState),null;case 27:return $t(u),i===null&&Zt&&(d=u.stateNode=ry(u.type,u.pendingProps,pt.current),vn=u,yr=!0,m=_e,Sa(u.type)?(mh=m,_e=lr(d.firstChild)):_e=m),Ze(i,u,u.pendingProps.children,c),zs(i,u),i===null&&(u.flags|=4194304),u.child;case 5:return i===null&&Zt&&((m=d=_e)&&(d=j2(d,u.type,u.pendingProps,yr),d!==null?(u.stateNode=d,vn=u,_e=lr(d.firstChild),yr=!1,m=!0):m=!1),m||Ja(u)),$t(u),m=u.type,b=u.pendingProps,S=i!==null?i.memoizedProps:null,d=b.children,hh(m,b)?d=null:S!==null&&hh(m,S)&&(u.flags|=32),u.memoizedState!==null&&(m=ff(i,u,c2,null,null,c),_u._currentValue=m),zs(i,u),Ze(i,u,d,c),u.child;case 6:return i===null&&Zt&&((i=c=_e)&&(c=X2(c,u.pendingProps,yr),c!==null?(u.stateNode=c,vn=u,_e=null,i=!0):i=!1),i||Ja(u)),null;case 13:return $m(i,u,c);case 4:return bt(u,u.stateNode.containerInfo),d=u.pendingProps,i===null?u.child=Xi(u,null,d,c):Ze(i,u,d,c),u.child;case 11:return qm(i,u,u.type,u.pendingProps,c);case 7:return Ze(i,u,u.pendingProps,c),u.child;case 8:return Ze(i,u,u.pendingProps.children,c),u.child;case 12:return Ze(i,u,u.pendingProps.children,c),u.child;case 10:return d=u.pendingProps,ca(u,u.type,d.value),Ze(i,u,d.children,c),u.child;case 9:return m=u.type._context,d=u.pendingProps.children,ti(u),m=an(m),d=d(m),u.flags|=1,Ze(i,u,d,c),u.child;case 14:return jm(i,u,u.type,u.pendingProps,c);case 15:return Xm(i,u,u.type,u.pendingProps,c);case 19:return eg(i,u,c);case 31:return d=u.pendingProps,c=u.mode,d={mode:d.mode,children:d.children},i===null?(c=Ps(d,c),c.ref=u.ref,u.child=c,c.return=u,u=c):(c=Ur(i.child,d),c.ref=u.ref,u.child=c,c.return=u,u=c),u;case 22:return Km(i,u,c);case 24:return ti(u),d=an(ke),i===null?(m=ef(),m===null&&(m=fe,b=$c(),m.pooledCache=b,b.refCount++,b!==null&&(m.pooledCacheLanes|=c),m=b),u.memoizedState={parent:d,cache:m},rf(u),ca(u,ke,m)):((i.lanes&c)!==0&&(af(i,u),tu(u,null,null,c),$o()),m=i.memoizedState,b=u.memoizedState,m.parent!==d?(m={parent:d,cache:d},u.memoizedState=m,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=m),ca(u,ke,d)):(d=b.cache,ca(u,ke,d),d!==m.cache&&Jc(u,[ke],c,!0))),Ze(i,u,u.pendingProps.children,c),u.child;case 29:throw u.pendingProps}throw Error(e(156,u.tag))}function Kr(i){i.flags|=4}function rg(i,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!fy(u)){if(u=tr.current,u!==null&&((Kt&4194048)===Kt?br!==null:(Kt&62914560)!==Kt&&(Kt&536870912)===0||u!==br))throw Zo=nf,Uv;i.flags|=8192}}function Us(i,u){u!==null&&(i.flags|=4),i.flags&16384&&(u=i.tag!==22?es():536870912,i.lanes|=u,Zi|=u)}function uu(i,u){if(!Zt)switch(i.tailMode){case"hidden":u=i.tail;for(var c=null;u!==null;)u.alternate!==null&&(c=u),u=u.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?u||i.tail===null?i.tail=null:i.tail.sibling=null:d.sibling=null}}function ge(i){var u=i.alternate!==null&&i.alternate.child===i.child,c=0,d=0;if(u)for(var m=i.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags&65011712,d|=m.flags&65011712,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=d,i.childLanes=c,u}function b2(i,u,c){var d=u.pendingProps;switch(Kc(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ge(u),null;case 1:return ge(u),null;case 3:return c=u.stateNode,d=null,i!==null&&(d=i.memoizedState.cache),u.memoizedState.cache!==d&&(u.flags|=2048),Gr(ke),Ot(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Go(u)?Kr(u):i===null||i.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Bv())),ge(u),null;case 26:return c=u.memoizedState,i===null?(Kr(u),c!==null?(ge(u),rg(u,c)):(ge(u),u.flags&=-16777217)):c?c!==i.memoizedState?(Kr(u),ge(u),rg(u,c)):(ge(u),u.flags&=-16777217):(i.memoizedProps!==d&&Kr(u),ge(u),u.flags&=-16777217),null;case 27:Ft(u),c=pt.current;var m=u.type;if(i!==null&&u.stateNode!=null)i.memoizedProps!==d&&Kr(u);else{if(!d){if(u.stateNode===null)throw Error(e(166));return ge(u),null}i=dt.current,Go(u)?Ov(u):(i=ry(m,d,c),u.stateNode=i,Kr(u))}return ge(u),null;case 5:if(Ft(u),c=u.type,i!==null&&u.stateNode!=null)i.memoizedProps!==d&&Kr(u);else{if(!d){if(u.stateNode===null)throw Error(e(166));return ge(u),null}if(i=dt.current,Go(u))Ov(u);else{switch(m=$s(pt.current),i){case 1:i=m.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:i=m.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":i=m.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":i=m.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":i=m.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof d.is=="string"?m.createElement("select",{is:d.is}):m.createElement("select"),d.multiple?i.multiple=!0:d.size&&(i.size=d.size);break;default:i=typeof d.is=="string"?m.createElement(c,{is:d.is}):m.createElement(c)}}i[rn]=u,i[bn]=d;t:for(m=u.child;m!==null;){if(m.tag===5||m.tag===6)i.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===u)break t;for(;m.sibling===null;){if(m.return===null||m.return===u)break t;m=m.return}m.sibling.return=m.return,m=m.sibling}u.stateNode=i;t:switch($e(i,c,d),c){case"button":case"input":case"select":case"textarea":i=!!d.autoFocus;break t;case"img":i=!0;break t;default:i=!1}i&&Kr(u)}}return ge(u),u.flags&=-16777217,null;case 6:if(i&&u.stateNode!=null)i.memoizedProps!==d&&Kr(u);else{if(typeof d!="string"&&u.stateNode===null)throw Error(e(166));if(i=pt.current,Go(u)){if(i=u.stateNode,c=u.memoizedProps,d=null,m=vn,m!==null)switch(m.tag){case 27:case 5:d=m.memoizedProps}i[rn]=u,i=!!(i.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||Qg(i.nodeValue,c)),i||Ja(u)}else i=$s(i).createTextNode(d),i[rn]=u,u.stateNode=i}return ge(u),null;case 13:if(d=u.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(m=Go(u),d!==null&&d.dehydrated!==null){if(i===null){if(!m)throw Error(e(318));if(m=u.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(e(317));m[rn]=u}else qo(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;ge(u),m=!1}else m=Bv(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=m),m=!0;if(!m)return u.flags&256?(jr(u),u):(jr(u),null)}if(jr(u),(u.flags&128)!==0)return u.lanes=c,u;if(c=d!==null,i=i!==null&&i.memoizedState!==null,c){d=u.child,m=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(m=d.alternate.memoizedState.cachePool.pool);var b=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(b=d.memoizedState.cachePool.pool),b!==m&&(d.flags|=2048)}return c!==i&&c&&(u.child.flags|=8192),Us(u,u.updateQueue),ge(u),null;case 4:return Ot(),i===null&&uh(u.stateNode.containerInfo),ge(u),null;case 10:return Gr(u.type),ge(u),null;case 19:if(it(Oe),m=u.memoizedState,m===null)return ge(u),null;if(d=(u.flags&128)!==0,b=m.rendering,b===null)if(d)uu(m,!1);else{if(Ee!==0||i!==null&&(i.flags&128)!==0)for(i=u.child;i!==null;){if(b=Bs(i),b!==null){for(u.flags|=128,uu(m,!1),i=b.updateQueue,u.updateQueue=i,Us(u,i),u.subtreeFlags=0,i=c,c=u.child;c!==null;)Mv(c,i),c=c.sibling;return ot(Oe,Oe.current&1|2),u.child}i=i.sibling}m.tail!==null&&me()>Ws&&(u.flags|=128,d=!0,uu(m,!1),u.lanes=4194304)}else{if(!d)if(i=Bs(b),i!==null){if(u.flags|=128,d=!0,i=i.updateQueue,u.updateQueue=i,Us(u,i),uu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!Zt)return ge(u),null}else 2*me()-m.renderingStartTime>Ws&&c!==536870912&&(u.flags|=128,d=!0,uu(m,!1),u.lanes=4194304);m.isBackwards?(b.sibling=u.child,u.child=b):(i=m.last,i!==null?i.sibling=b:u.child=b,m.last=b)}return m.tail!==null?(u=m.tail,m.rendering=u,m.tail=u.sibling,m.renderingStartTime=me(),u.sibling=null,i=Oe.current,ot(Oe,d?i&1|2:i&1),u):(ge(u),null);case 22:case 23:return jr(u),lf(),d=u.memoizedState!==null,i!==null?i.memoizedState!==null!==d&&(u.flags|=8192):d&&(u.flags|=8192),d?(c&536870912)!==0&&(u.flags&128)===0&&(ge(u),u.subtreeFlags&6&&(u.flags|=8192)):ge(u),c=u.updateQueue,c!==null&&Us(u,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),d=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(d=u.memoizedState.cachePool.pool),d!==c&&(u.flags|=2048),i!==null&&it(ei),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),u.memoizedState.cache!==c&&(u.flags|=2048),Gr(ke),ge(u),null;case 25:return null;case 30:return null}throw Error(e(156,u.tag))}function x2(i,u){switch(Kc(u),u.tag){case 1:return i=u.flags,i&65536?(u.flags=i&-65537|128,u):null;case 3:return Gr(ke),Ot(),i=u.flags,(i&65536)!==0&&(i&128)===0?(u.flags=i&-65537|128,u):null;case 26:case 27:case 5:return Ft(u),null;case 13:if(jr(u),i=u.memoizedState,i!==null&&i.dehydrated!==null){if(u.alternate===null)throw Error(e(340));qo()}return i=u.flags,i&65536?(u.flags=i&-65537|128,u):null;case 19:return it(Oe),null;case 4:return Ot(),null;case 10:return Gr(u.type),null;case 22:case 23:return jr(u),lf(),i!==null&&it(ei),i=u.flags,i&65536?(u.flags=i&-65537|128,u):null;case 24:return Gr(ke),null;case 25:return null;default:return null}}function ag(i,u){switch(Kc(u),u.tag){case 3:Gr(ke),Ot();break;case 26:case 27:case 5:Ft(u);break;case 4:Ot();break;case 13:jr(u);break;case 19:it(Oe);break;case 10:Gr(u.type);break;case 22:case 23:jr(u),lf(),i!==null&&it(ei);break;case 24:Gr(ke)}}function su(i,u){try{var c=u.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var m=d.next;c=m;do{if((c.tag&i)===i){d=void 0;var b=c.create,S=c.inst;d=b(),S.destroy=d}c=c.next}while(c!==m)}}catch(D){ce(u,u.return,D)}}function ga(i,u,c){try{var d=u.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var b=m.next;d=b;do{if((d.tag&i)===i){var S=d.inst,D=S.destroy;if(D!==void 0){S.destroy=void 0,m=u;var z=c,Q=D;try{Q()}catch(st){ce(m,z,st)}}}d=d.next}while(d!==b)}}catch(st){ce(u,u.return,st)}}function ig(i){var u=i.updateQueue;if(u!==null){var c=i.stateNode;try{jv(u,c)}catch(d){ce(i,i.return,d)}}}function og(i,u,c){c.props=ri(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(d){ce(i,u,d)}}function lu(i,u){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var d=i.stateNode;break;case 30:d=i.stateNode;break;default:d=i.stateNode}typeof c=="function"?i.refCleanup=c(d):c.current=d}}catch(m){ce(i,u,m)}}function xr(i,u){var c=i.ref,d=i.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(m){ce(i,u,m)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(m){ce(i,u,m)}else c.current=null}function ug(i){var u=i.type,c=i.memoizedProps,d=i.stateNode;try{t:switch(u){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break t;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(m){ce(i,i.return,m)}}function Lf(i,u,c){try{var d=i.stateNode;H2(d,i.type,c,u),d[bn]=u}catch(m){ce(i,i.return,m)}}function sg(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Sa(i.type)||i.tag===4}function zf(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||sg(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Sa(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Pf(i,u,c){var d=i.tag;if(d===5||d===6)i=i.stateNode,u?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,u):(u=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,u.appendChild(i),c=c._reactRootContainer,c!=null||u.onclick!==null||(u.onclick=Js));else if(d!==4&&(d===27&&Sa(i.type)&&(c=i.stateNode,u=null),i=i.child,i!==null))for(Pf(i,u,c),i=i.sibling;i!==null;)Pf(i,u,c),i=i.sibling}function Hs(i,u,c){var d=i.tag;if(d===5||d===6)i=i.stateNode,u?c.insertBefore(i,u):c.appendChild(i);else if(d!==4&&(d===27&&Sa(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(Hs(i,u,c),i=i.sibling;i!==null;)Hs(i,u,c),i=i.sibling}function lg(i){var u=i.stateNode,c=i.memoizedProps;try{for(var d=i.type,m=u.attributes;m.length;)u.removeAttributeNode(m[0]);$e(u,d,c),u[rn]=i,u[bn]=c}catch(b){ce(i,i.return,b)}}var Yr=!1,Ae=!1,Uf=!1,cg=typeof WeakSet=="function"?WeakSet:Set,je=null;function w2(i,u){if(i=i.containerInfo,ch=il,i=wv(i),Lc(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else t:{c=(c=i.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var m=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{c.nodeType,b.nodeType}catch{c=null;break t}var S=0,D=-1,z=-1,Q=0,st=0,ct=i,Z=null;e:for(;;){for(var J;ct!==c||m!==0&&ct.nodeType!==3||(D=S+m),ct!==b||d!==0&&ct.nodeType!==3||(z=S+d),ct.nodeType===3&&(S+=ct.nodeValue.length),(J=ct.firstChild)!==null;)Z=ct,ct=J;for(;;){if(ct===i)break e;if(Z===c&&++Q===m&&(D=S),Z===b&&++st===d&&(z=S),(J=ct.nextSibling)!==null)break;ct=Z,Z=ct.parentNode}ct=J}c=D===-1||z===-1?null:{start:D,end:z}}else c=null}c=c||{start:0,end:0}}else c=null;for(fh={focusedElem:i,selectionRange:c},il=!1,je=u;je!==null;)if(u=je,i=u.child,(u.subtreeFlags&1024)!==0&&i!==null)i.return=u,je=i;else for(;je!==null;){switch(u=je,b=u.alternate,i=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&b!==null){i=void 0,c=u,m=b.memoizedProps,b=b.memoizedState,d=c.stateNode;try{var Mt=ri(c.type,m,c.elementType===c.type);i=d.getSnapshotBeforeUpdate(Mt,b),d.__reactInternalSnapshotBeforeUpdate=i}catch(Dt){ce(c,c.return,Dt)}}break;case 3:if((i&1024)!==0){if(i=u.stateNode.containerInfo,c=i.nodeType,c===9)ph(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":ph(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(e(163))}if(i=u.sibling,i!==null){i.return=u.return,je=i;break}je=u.return}}function fg(i,u,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:ya(i,c),d&4&&su(5,c);break;case 1:if(ya(i,c),d&4)if(i=c.stateNode,u===null)try{i.componentDidMount()}catch(S){ce(c,c.return,S)}else{var m=ri(c.type,u.memoizedProps);u=u.memoizedState;try{i.componentDidUpdate(m,u,i.__reactInternalSnapshotBeforeUpdate)}catch(S){ce(c,c.return,S)}}d&64&&ig(c),d&512&&lu(c,c.return);break;case 3:if(ya(i,c),d&64&&(i=c.updateQueue,i!==null)){if(u=null,c.child!==null)switch(c.child.tag){case 27:case 5:u=c.child.stateNode;break;case 1:u=c.child.stateNode}try{jv(i,u)}catch(S){ce(c,c.return,S)}}break;case 27:u===null&&d&4&&lg(c);case 26:case 5:ya(i,c),u===null&&d&4&&ug(c),d&512&&lu(c,c.return);break;case 12:ya(i,c);break;case 13:ya(i,c),d&4&&pg(i,c),d&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=N2.bind(null,c),K2(i,c))));break;case 22:if(d=c.memoizedState!==null||Yr,!d){u=u!==null&&u.memoizedState!==null||Ae,m=Yr;var b=Ae;Yr=d,(Ae=u)&&!b?ba(i,c,(c.subtreeFlags&8772)!==0):ya(i,c),Yr=m,Ae=b}break;case 30:break;default:ya(i,c)}}function hg(i){var u=i.alternate;u!==null&&(i.alternate=null,hg(u)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(u=i.stateNode,u!==null&&yc(u)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ve=null,_n=!1;function Qr(i,u,c){for(c=c.child;c!==null;)dg(i,u,c),c=c.sibling}function dg(i,u,c){if(we&&typeof we.onCommitFiberUnmount=="function")try{we.onCommitFiberUnmount(Nn,c)}catch{}switch(c.tag){case 26:Ae||xr(c,u),Qr(i,u,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Ae||xr(c,u);var d=ve,m=_n;Sa(c.type)&&(ve=c.stateNode,_n=!1),Qr(i,u,c),yu(c.stateNode),ve=d,_n=m;break;case 5:Ae||xr(c,u);case 6:if(d=ve,m=_n,ve=null,Qr(i,u,c),ve=d,_n=m,ve!==null)if(_n)try{(ve.nodeType===9?ve.body:ve.nodeName==="HTML"?ve.ownerDocument.body:ve).removeChild(c.stateNode)}catch(b){ce(c,u,b)}else try{ve.removeChild(c.stateNode)}catch(b){ce(c,u,b)}break;case 18:ve!==null&&(_n?(i=ve,ey(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),Ru(i)):ey(ve,c.stateNode));break;case 4:d=ve,m=_n,ve=c.stateNode.containerInfo,_n=!0,Qr(i,u,c),ve=d,_n=m;break;case 0:case 11:case 14:case 15:Ae||ga(2,c,u),Ae||ga(4,c,u),Qr(i,u,c);break;case 1:Ae||(xr(c,u),d=c.stateNode,typeof d.componentWillUnmount=="function"&&og(c,u,d)),Qr(i,u,c);break;case 21:Qr(i,u,c);break;case 22:Ae=(d=Ae)||c.memoizedState!==null,Qr(i,u,c),Ae=d;break;default:Qr(i,u,c)}}function pg(i,u){if(u.memoizedState===null&&(i=u.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Ru(i)}catch(c){ce(u,u.return,c)}}function _2(i){switch(i.tag){case 13:case 19:var u=i.stateNode;return u===null&&(u=i.stateNode=new cg),u;case 22:return i=i.stateNode,u=i._retryCache,u===null&&(u=i._retryCache=new cg),u;default:throw Error(e(435,i.tag))}}function Hf(i,u){var c=_2(i);u.forEach(function(d){var m=M2.bind(null,i,d);c.has(d)||(c.add(d),d.then(m,m))})}function On(i,u){var c=u.deletions;if(c!==null)for(var d=0;d<c.length;d++){var m=c[d],b=i,S=u,D=S;t:for(;D!==null;){switch(D.tag){case 27:if(Sa(D.type)){ve=D.stateNode,_n=!1;break t}break;case 5:ve=D.stateNode,_n=!1;break t;case 3:case 4:ve=D.stateNode.containerInfo,_n=!0;break t}D=D.return}if(ve===null)throw Error(e(160));dg(b,S,m),ve=null,_n=!1,b=m.alternate,b!==null&&(b.return=null),m.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)vg(u,i),u=u.sibling}var sr=null;function vg(i,u){var c=i.alternate,d=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:On(u,i),In(i),d&4&&(ga(3,i,i.return),su(3,i),ga(5,i,i.return));break;case 1:On(u,i),In(i),d&512&&(Ae||c===null||xr(c,c.return)),d&64&&Yr&&(i=i.updateQueue,i!==null&&(d=i.callbacks,d!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var m=sr;if(On(u,i),In(i),d&512&&(Ae||c===null||xr(c,c.return)),d&4){var b=c!==null?c.memoizedState:null;if(d=i.memoizedState,c===null)if(d===null)if(i.stateNode===null){t:{d=i.type,c=i.memoizedProps,m=m.ownerDocument||m;e:switch(d){case"title":b=m.getElementsByTagName("title")[0],(!b||b[Oo]||b[rn]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=m.createElement(d),m.head.insertBefore(b,m.querySelector("head > title"))),$e(b,d,c),b[rn]=i,Ge(b),d=b;break t;case"link":var S=ly("link","href",m).get(d+(c.href||""));if(S){for(var D=0;D<S.length;D++)if(b=S[D],b.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&b.getAttribute("rel")===(c.rel==null?null:c.rel)&&b.getAttribute("title")===(c.title==null?null:c.title)&&b.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){S.splice(D,1);break e}}b=m.createElement(d),$e(b,d,c),m.head.appendChild(b);break;case"meta":if(S=ly("meta","content",m).get(d+(c.content||""))){for(D=0;D<S.length;D++)if(b=S[D],b.getAttribute("content")===(c.content==null?null:""+c.content)&&b.getAttribute("name")===(c.name==null?null:c.name)&&b.getAttribute("property")===(c.property==null?null:c.property)&&b.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&b.getAttribute("charset")===(c.charSet==null?null:c.charSet)){S.splice(D,1);break e}}b=m.createElement(d),$e(b,d,c),m.head.appendChild(b);break;default:throw Error(e(468,d))}b[rn]=i,Ge(b),d=b}i.stateNode=d}else cy(m,i.type,i.stateNode);else i.stateNode=sy(m,d,i.memoizedProps);else b!==d?(b===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):b.count--,d===null?cy(m,i.type,i.stateNode):sy(m,d,i.memoizedProps)):d===null&&i.stateNode!==null&&Lf(i,i.memoizedProps,c.memoizedProps)}break;case 27:On(u,i),In(i),d&512&&(Ae||c===null||xr(c,c.return)),c!==null&&d&4&&Lf(i,i.memoizedProps,c.memoizedProps);break;case 5:if(On(u,i),In(i),d&512&&(Ae||c===null||xr(c,c.return)),i.flags&32){m=i.stateNode;try{Di(m,"")}catch(J){ce(i,i.return,J)}}d&4&&i.stateNode!=null&&(m=i.memoizedProps,Lf(i,m,c!==null?c.memoizedProps:m)),d&1024&&(Uf=!0);break;case 6:if(On(u,i),In(i),d&4){if(i.stateNode===null)throw Error(e(162));d=i.memoizedProps,c=i.stateNode;try{c.nodeValue=d}catch(J){ce(i,i.return,J)}}break;case 3:if(nl=null,m=sr,sr=tl(u.containerInfo),On(u,i),sr=m,In(i),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Ru(u.containerInfo)}catch(J){ce(i,i.return,J)}Uf&&(Uf=!1,mg(i));break;case 4:d=sr,sr=tl(i.stateNode.containerInfo),On(u,i),In(i),sr=d;break;case 12:On(u,i),In(i);break;case 13:On(u,i),In(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Xf=me()),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,Hf(i,d)));break;case 22:m=i.memoizedState!==null;var z=c!==null&&c.memoizedState!==null,Q=Yr,st=Ae;if(Yr=Q||m,Ae=st||z,On(u,i),Ae=st,Yr=Q,In(i),d&8192)t:for(u=i.stateNode,u._visibility=m?u._visibility&-2:u._visibility|1,m&&(c===null||z||Yr||Ae||ai(i)),c=null,u=i;;){if(u.tag===5||u.tag===26){if(c===null){z=c=u;try{if(b=z.stateNode,m)S=b.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{D=z.stateNode;var ct=z.memoizedProps.style,Z=ct!=null&&ct.hasOwnProperty("display")?ct.display:null;D.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(J){ce(z,z.return,J)}}}else if(u.tag===6){if(c===null){z=u;try{z.stateNode.nodeValue=m?"":z.memoizedProps}catch(J){ce(z,z.return,J)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===i)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===i)break t;for(;u.sibling===null;){if(u.return===null||u.return===i)break t;c===u&&(c=null),u=u.return}c===u&&(c=null),u.sibling.return=u.return,u=u.sibling}d&4&&(d=i.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Hf(i,c))));break;case 19:On(u,i),In(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,Hf(i,d)));break;case 30:break;case 21:break;default:On(u,i),In(i)}}function In(i){var u=i.flags;if(u&2){try{for(var c,d=i.return;d!==null;){if(sg(d)){c=d;break}d=d.return}if(c==null)throw Error(e(160));switch(c.tag){case 27:var m=c.stateNode,b=zf(i);Hs(i,b,m);break;case 5:var S=c.stateNode;c.flags&32&&(Di(S,""),c.flags&=-33);var D=zf(i);Hs(i,D,S);break;case 3:case 4:var z=c.stateNode.containerInfo,Q=zf(i);Pf(i,Q,z);break;default:throw Error(e(161))}}catch(st){ce(i,i.return,st)}i.flags&=-3}u&4096&&(i.flags&=-4097)}function mg(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var u=i;mg(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),i=i.sibling}}function ya(i,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)fg(i,u.alternate,u),u=u.sibling}function ai(i){for(i=i.child;i!==null;){var u=i;switch(u.tag){case 0:case 11:case 14:case 15:ga(4,u,u.return),ai(u);break;case 1:xr(u,u.return);var c=u.stateNode;typeof c.componentWillUnmount=="function"&&og(u,u.return,c),ai(u);break;case 27:yu(u.stateNode);case 26:case 5:xr(u,u.return),ai(u);break;case 22:u.memoizedState===null&&ai(u);break;case 30:ai(u);break;default:ai(u)}i=i.sibling}}function ba(i,u,c){for(c=c&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var d=u.alternate,m=i,b=u,S=b.flags;switch(b.tag){case 0:case 11:case 15:ba(m,b,c),su(4,b);break;case 1:if(ba(m,b,c),d=b,m=d.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(Q){ce(d,d.return,Q)}if(d=b,m=d.updateQueue,m!==null){var D=d.stateNode;try{var z=m.shared.hiddenCallbacks;if(z!==null)for(m.shared.hiddenCallbacks=null,m=0;m<z.length;m++)qv(z[m],D)}catch(Q){ce(d,d.return,Q)}}c&&S&64&&ig(b),lu(b,b.return);break;case 27:lg(b);case 26:case 5:ba(m,b,c),c&&d===null&&S&4&&ug(b),lu(b,b.return);break;case 12:ba(m,b,c);break;case 13:ba(m,b,c),c&&S&4&&pg(m,b);break;case 22:b.memoizedState===null&&ba(m,b,c),lu(b,b.return);break;case 30:break;default:ba(m,b,c)}u=u.sibling}}function Vf(i,u){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(i=u.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Ko(c))}function Wf(i,u){i=null,u.alternate!==null&&(i=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==i&&(u.refCount++,i!=null&&Ko(i))}function wr(i,u,c,d){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)gg(i,u,c,d),u=u.sibling}function gg(i,u,c,d){var m=u.flags;switch(u.tag){case 0:case 11:case 15:wr(i,u,c,d),m&2048&&su(9,u);break;case 1:wr(i,u,c,d);break;case 3:wr(i,u,c,d),m&2048&&(i=null,u.alternate!==null&&(i=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==i&&(u.refCount++,i!=null&&Ko(i)));break;case 12:if(m&2048){wr(i,u,c,d),i=u.stateNode;try{var b=u.memoizedProps,S=b.id,D=b.onPostCommit;typeof D=="function"&&D(S,u.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(z){ce(u,u.return,z)}}else wr(i,u,c,d);break;case 13:wr(i,u,c,d);break;case 23:break;case 22:b=u.stateNode,S=u.alternate,u.memoizedState!==null?b._visibility&2?wr(i,u,c,d):cu(i,u):b._visibility&2?wr(i,u,c,d):(b._visibility|=2,Ki(i,u,c,d,(u.subtreeFlags&10256)!==0)),m&2048&&Vf(S,u);break;case 24:wr(i,u,c,d),m&2048&&Wf(u.alternate,u);break;default:wr(i,u,c,d)}}function Ki(i,u,c,d,m){for(m=m&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var b=i,S=u,D=c,z=d,Q=S.flags;switch(S.tag){case 0:case 11:case 15:Ki(b,S,D,z,m),su(8,S);break;case 23:break;case 22:var st=S.stateNode;S.memoizedState!==null?st._visibility&2?Ki(b,S,D,z,m):cu(b,S):(st._visibility|=2,Ki(b,S,D,z,m)),m&&Q&2048&&Vf(S.alternate,S);break;case 24:Ki(b,S,D,z,m),m&&Q&2048&&Wf(S.alternate,S);break;default:Ki(b,S,D,z,m)}u=u.sibling}}function cu(i,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var c=i,d=u,m=d.flags;switch(d.tag){case 22:cu(c,d),m&2048&&Vf(d.alternate,d);break;case 24:cu(c,d),m&2048&&Wf(d.alternate,d);break;default:cu(c,d)}u=u.sibling}}var fu=8192;function Yi(i){if(i.subtreeFlags&fu)for(i=i.child;i!==null;)yg(i),i=i.sibling}function yg(i){switch(i.tag){case 26:Yi(i),i.flags&fu&&i.memoizedState!==null&&uw(sr,i.memoizedState,i.memoizedProps);break;case 5:Yi(i);break;case 3:case 4:var u=sr;sr=tl(i.stateNode.containerInfo),Yi(i),sr=u;break;case 22:i.memoizedState===null&&(u=i.alternate,u!==null&&u.memoizedState!==null?(u=fu,fu=16777216,Yi(i),fu=u):Yi(i));break;default:Yi(i)}}function bg(i){var u=i.alternate;if(u!==null&&(i=u.child,i!==null)){u.child=null;do u=i.sibling,i.sibling=null,i=u;while(i!==null)}}function hu(i){var u=i.deletions;if((i.flags&16)!==0){if(u!==null)for(var c=0;c<u.length;c++){var d=u[c];je=d,wg(d,i)}bg(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)xg(i),i=i.sibling}function xg(i){switch(i.tag){case 0:case 11:case 15:hu(i),i.flags&2048&&ga(9,i,i.return);break;case 3:hu(i);break;case 12:hu(i);break;case 22:var u=i.stateNode;i.memoizedState!==null&&u._visibility&2&&(i.return===null||i.return.tag!==13)?(u._visibility&=-3,Vs(i)):hu(i);break;default:hu(i)}}function Vs(i){var u=i.deletions;if((i.flags&16)!==0){if(u!==null)for(var c=0;c<u.length;c++){var d=u[c];je=d,wg(d,i)}bg(i)}for(i=i.child;i!==null;){switch(u=i,u.tag){case 0:case 11:case 15:ga(8,u,u.return),Vs(u);break;case 22:c=u.stateNode,c._visibility&2&&(c._visibility&=-3,Vs(u));break;default:Vs(u)}i=i.sibling}}function wg(i,u){for(;je!==null;){var c=je;switch(c.tag){case 0:case 11:case 15:ga(8,c,u);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Ko(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,je=d;else t:for(c=i;je!==null;){d=je;var m=d.sibling,b=d.return;if(hg(d),d===c){je=null;break t}if(m!==null){m.return=b,je=m;break t}je=b}}}var E2={getCacheForType:function(i){var u=an(ke),c=u.data.get(i);return c===void 0&&(c=i(),u.data.set(i,c)),c}},C2=typeof WeakMap=="function"?WeakMap:Map,ee=0,fe=null,Wt=null,Kt=0,ne=0,Bn=null,xa=!1,Qi=!1,Gf=!1,Zr=0,Ee=0,wa=0,ii=0,qf=0,er=0,Zi=0,du=null,En=null,jf=!1,Xf=0,Ws=1/0,Gs=null,_a=null,Je=0,Ea=null,Ji=null,$i=0,Kf=0,Yf=null,_g=null,pu=0,Qf=null;function Fn(){if((ee&2)!==0&&Kt!==0)return Kt&-Kt;if(P.T!==null){var i=Ui;return i!==0?i:rh()}return zp()}function Eg(){er===0&&(er=(Kt&536870912)===0||Zt?Mo():536870912);var i=tr.current;return i!==null&&(i.flags|=32),er}function Ln(i,u,c){(i===fe&&(ne===2||ne===9)||i.cancelPendingCommit!==null)&&(to(i,0),Ca(i,Kt,er,!1)),Xn(i,c),((ee&2)===0||i!==fe)&&(i===fe&&((ee&2)===0&&(ii|=c),Ee===4&&Ca(i,Kt,er,!1)),_r(i))}function Cg(i,u,c){if((ee&6)!==0)throw Error(e(327));var d=!c&&(u&124)===0&&(u&i.expiredLanes)===0||gr(i,u),m=d?A2(i,u):$f(i,u,!0),b=d;do{if(m===0){Qi&&!d&&Ca(i,u,0,!1);break}else{if(c=i.current.alternate,b&&!S2(c)){m=$f(i,u,!1),b=!1;continue}if(m===2){if(b=u,i.errorRecoveryDisabledLanes&b)var S=0;else S=i.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){u=S;t:{var D=i;m=du;var z=D.current.memoizedState.isDehydrated;if(z&&(to(D,S).flags|=256),S=$f(D,S,!1),S!==2){if(Gf&&!z){D.errorRecoveryDisabledLanes|=b,ii|=b,m=4;break t}b=En,En=m,b!==null&&(En===null?En=b:En.push.apply(En,b))}m=S}if(b=!1,m!==2)continue}}if(m===1){to(i,0),Ca(i,u,0,!0);break}t:{switch(d=i,b=m,b){case 0:case 1:throw Error(e(345));case 4:if((u&4194048)!==u)break;case 6:Ca(d,u,er,!xa);break t;case 2:En=null;break;case 3:case 5:break;default:throw Error(e(329))}if((u&62914560)===u&&(m=Xf+300-me(),10<m)){if(Ca(d,u,er,!xa),yn(d,0,!0)!==0)break t;d.timeoutHandle=$g(Sg.bind(null,d,c,En,Gs,jf,u,er,ii,Zi,xa,b,2,-0,0),m);break t}Sg(d,c,En,Gs,jf,u,er,ii,Zi,xa,b,0,-0,0)}}break}while(!0);_r(i)}function Sg(i,u,c,d,m,b,S,D,z,Q,st,ct,Z,J){if(i.timeoutHandle=-1,ct=u.subtreeFlags,(ct&8192||(ct&16785408)===16785408)&&(wu={stylesheets:null,count:0,unsuspend:ow},yg(u),ct=sw(),ct!==null)){i.cancelPendingCommit=ct(kg.bind(null,i,u,b,c,d,m,S,D,z,st,1,Z,J)),Ca(i,b,S,!Q);return}kg(i,u,b,c,d,m,S,D,z)}function S2(i){for(var u=i;;){var c=u.tag;if((c===0||c===11||c===15)&&u.flags&16384&&(c=u.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var m=c[d],b=m.getSnapshot;m=m.value;try{if(!Mn(b(),m))return!1}catch{return!1}}if(c=u.child,u.subtreeFlags&16384&&c!==null)c.return=u,u=c;else{if(u===i)break;for(;u.sibling===null;){if(u.return===null||u.return===i)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function Ca(i,u,c,d){u&=~qf,u&=~ii,i.suspendedLanes|=u,i.pingedLanes&=~u,d&&(i.warmLanes|=u),d=i.expirationTimes;for(var m=u;0<m;){var b=31-ht(m),S=1<<b;d[b]=-1,m&=~S}c!==0&&Fp(i,c,u)}function qs(){return(ee&6)===0?(vu(0),!1):!0}function Zf(){if(Wt!==null){if(ne===0)var i=Wt.return;else i=Wt,Wr=$a=null,pf(i),ji=null,iu=0,i=Wt;for(;i!==null;)ag(i.alternate,i),i=i.return;Wt=null}}function to(i,u){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,W2(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),Zf(),fe=i,Wt=c=Ur(i.current,null),Kt=u,ne=0,Bn=null,xa=!1,Qi=gr(i,u),Gf=!1,Zi=er=qf=ii=wa=Ee=0,En=du=null,jf=!1,(u&8)!==0&&(u|=u&32);var d=i.entangledLanes;if(d!==0)for(i=i.entanglements,d&=u;0<d;){var m=31-ht(d),b=1<<m;u|=i[m],d&=~b}return Zr=u,ds(),c}function Rg(i,u){Pt=null,P.H=ks,u===Qo||u===_s?(u=Wv(),ne=3):u===Uv?(u=Wv(),ne=4):ne=u===Gm?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,Bn=u,Wt===null&&(Ee=1,Ls(i,Qn(u,i.current)))}function Ag(){var i=P.H;return P.H=ks,i===null?ks:i}function Tg(){var i=P.A;return P.A=E2,i}function Jf(){Ee=4,xa||(Kt&4194048)!==Kt&&tr.current!==null||(Qi=!0),(wa&134217727)===0&&(ii&134217727)===0||fe===null||Ca(fe,Kt,er,!1)}function $f(i,u,c){var d=ee;ee|=2;var m=Ag(),b=Tg();(fe!==i||Kt!==u)&&(Gs=null,to(i,u)),u=!1;var S=Ee;t:do try{if(ne!==0&&Wt!==null){var D=Wt,z=Bn;switch(ne){case 8:Zf(),S=6;break t;case 3:case 2:case 9:case 6:tr.current===null&&(u=!0);var Q=ne;if(ne=0,Bn=null,eo(i,D,z,Q),c&&Qi){S=0;break t}break;default:Q=ne,ne=0,Bn=null,eo(i,D,z,Q)}}R2(),S=Ee;break}catch(st){Rg(i,st)}while(!0);return u&&i.shellSuspendCounter++,Wr=$a=null,ee=d,P.H=m,P.A=b,Wt===null&&(fe=null,Kt=0,ds()),S}function R2(){for(;Wt!==null;)Dg(Wt)}function A2(i,u){var c=ee;ee|=2;var d=Ag(),m=Tg();fe!==i||Kt!==u?(Gs=null,Ws=me()+500,to(i,u)):Qi=gr(i,u);t:do try{if(ne!==0&&Wt!==null){u=Wt;var b=Bn;e:switch(ne){case 1:ne=0,Bn=null,eo(i,u,b,1);break;case 2:case 9:if(Hv(b)){ne=0,Bn=null,Ng(u);break}u=function(){ne!==2&&ne!==9||fe!==i||(ne=7),_r(i)},b.then(u,u);break t;case 3:ne=7;break t;case 4:ne=5;break t;case 7:Hv(b)?(ne=0,Bn=null,Ng(u)):(ne=0,Bn=null,eo(i,u,b,7));break;case 5:var S=null;switch(Wt.tag){case 26:S=Wt.memoizedState;case 5:case 27:var D=Wt;if(!S||fy(S)){ne=0,Bn=null;var z=D.sibling;if(z!==null)Wt=z;else{var Q=D.return;Q!==null?(Wt=Q,js(Q)):Wt=null}break e}}ne=0,Bn=null,eo(i,u,b,5);break;case 6:ne=0,Bn=null,eo(i,u,b,6);break;case 8:Zf(),Ee=6;break t;default:throw Error(e(462))}}T2();break}catch(st){Rg(i,st)}while(!0);return Wr=$a=null,P.H=d,P.A=m,ee=c,Wt!==null?0:(fe=null,Kt=0,ds(),Ee)}function T2(){for(;Wt!==null&&!se();)Dg(Wt)}function Dg(i){var u=ng(i.alternate,i,Zr);i.memoizedProps=i.pendingProps,u===null?js(i):Wt=u}function Ng(i){var u=i,c=u.alternate;switch(u.tag){case 15:case 0:u=Qm(c,u,u.pendingProps,u.type,void 0,Kt);break;case 11:u=Qm(c,u,u.pendingProps,u.type.render,u.ref,Kt);break;case 5:pf(u);default:ag(c,u),u=Wt=Mv(u,Zr),u=ng(c,u,Zr)}i.memoizedProps=i.pendingProps,u===null?js(i):Wt=u}function eo(i,u,c,d){Wr=$a=null,pf(u),ji=null,iu=0;var m=u.return;try{if(g2(i,m,u,c,Kt)){Ee=1,Ls(i,Qn(c,i.current)),Wt=null;return}}catch(b){if(m!==null)throw Wt=m,b;Ee=1,Ls(i,Qn(c,i.current)),Wt=null;return}u.flags&32768?(Zt||d===1?i=!0:Qi||(Kt&536870912)!==0?i=!1:(xa=i=!0,(d===2||d===9||d===3||d===6)&&(d=tr.current,d!==null&&d.tag===13&&(d.flags|=16384))),Mg(u,i)):js(u)}function js(i){var u=i;do{if((u.flags&32768)!==0){Mg(u,xa);return}i=u.return;var c=b2(u.alternate,u,Zr);if(c!==null){Wt=c;return}if(u=u.sibling,u!==null){Wt=u;return}Wt=u=i}while(u!==null);Ee===0&&(Ee=5)}function Mg(i,u){do{var c=x2(i.alternate,i);if(c!==null){c.flags&=32767,Wt=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!u&&(i=i.sibling,i!==null)){Wt=i;return}Wt=i=c}while(i!==null);Ee=6,Wt=null}function kg(i,u,c,d,m,b,S,D,z){i.cancelPendingCommit=null;do Xs();while(Je!==0);if((ee&6)!==0)throw Error(e(327));if(u!==null){if(u===i.current)throw Error(e(177));if(b=u.lanes|u.childLanes,b|=Vc,ox(i,c,b,S,D,z),i===fe&&(Wt=fe=null,Kt=0),Ji=u,Ea=i,$i=c,Kf=b,Yf=m,_g=d,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,k2(He,function(){return Lg(),null})):(i.callbackNode=null,i.callbackPriority=0),d=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||d){d=P.T,P.T=null,m=q.p,q.p=2,S=ee,ee|=4;try{w2(i,u,c)}finally{ee=S,q.p=m,P.T=d}}Je=1,Og(),Ig(),Bg()}}function Og(){if(Je===1){Je=0;var i=Ea,u=Ji,c=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||c){c=P.T,P.T=null;var d=q.p;q.p=2;var m=ee;ee|=4;try{vg(u,i);var b=fh,S=wv(i.containerInfo),D=b.focusedElem,z=b.selectionRange;if(S!==D&&D&&D.ownerDocument&&xv(D.ownerDocument.documentElement,D)){if(z!==null&&Lc(D)){var Q=z.start,st=z.end;if(st===void 0&&(st=Q),"selectionStart"in D)D.selectionStart=Q,D.selectionEnd=Math.min(st,D.value.length);else{var ct=D.ownerDocument||document,Z=ct&&ct.defaultView||window;if(Z.getSelection){var J=Z.getSelection(),Mt=D.textContent.length,Dt=Math.min(z.start,Mt),oe=z.end===void 0?Dt:Math.min(z.end,Mt);!J.extend&&Dt>oe&&(S=oe,oe=Dt,Dt=S);var j=bv(D,Dt),V=bv(D,oe);if(j&&V&&(J.rangeCount!==1||J.anchorNode!==j.node||J.anchorOffset!==j.offset||J.focusNode!==V.node||J.focusOffset!==V.offset)){var Y=ct.createRange();Y.setStart(j.node,j.offset),J.removeAllRanges(),Dt>oe?(J.addRange(Y),J.extend(V.node,V.offset)):(Y.setEnd(V.node,V.offset),J.addRange(Y))}}}}for(ct=[],J=D;J=J.parentNode;)J.nodeType===1&&ct.push({element:J,left:J.scrollLeft,top:J.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<ct.length;D++){var lt=ct[D];lt.element.scrollLeft=lt.left,lt.element.scrollTop=lt.top}}il=!!ch,fh=ch=null}finally{ee=m,q.p=d,P.T=c}}i.current=u,Je=2}}function Ig(){if(Je===2){Je=0;var i=Ea,u=Ji,c=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||c){c=P.T,P.T=null;var d=q.p;q.p=2;var m=ee;ee|=4;try{fg(i,u.alternate,u)}finally{ee=m,q.p=d,P.T=c}}Je=3}}function Bg(){if(Je===4||Je===3){Je=0,le();var i=Ea,u=Ji,c=$i,d=_g;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?Je=5:(Je=0,Ji=Ea=null,Fg(i,i.pendingLanes));var m=i.pendingLanes;if(m===0&&(_a=null),mc(c),u=u.stateNode,we&&typeof we.onCommitFiberRoot=="function")try{we.onCommitFiberRoot(Nn,u,void 0,(u.current.flags&128)===128)}catch{}if(d!==null){u=P.T,m=q.p,q.p=2,P.T=null;try{for(var b=i.onRecoverableError,S=0;S<d.length;S++){var D=d[S];b(D.value,{componentStack:D.stack})}}finally{P.T=u,q.p=m}}($i&3)!==0&&Xs(),_r(i),m=i.pendingLanes,(c&4194090)!==0&&(m&42)!==0?i===Qf?pu++:(pu=0,Qf=i):pu=0,vu(0)}}function Fg(i,u){(i.pooledCacheLanes&=u)===0&&(u=i.pooledCache,u!=null&&(i.pooledCache=null,Ko(u)))}function Xs(i){return Og(),Ig(),Bg(),Lg()}function Lg(){if(Je!==5)return!1;var i=Ea,u=Kf;Kf=0;var c=mc($i),d=P.T,m=q.p;try{q.p=32>c?32:c,P.T=null,c=Yf,Yf=null;var b=Ea,S=$i;if(Je=0,Ji=Ea=null,$i=0,(ee&6)!==0)throw Error(e(331));var D=ee;if(ee|=4,xg(b.current),gg(b,b.current,S,c),ee=D,vu(0,!1),we&&typeof we.onPostCommitFiberRoot=="function")try{we.onPostCommitFiberRoot(Nn,b)}catch{}return!0}finally{q.p=m,P.T=d,Fg(i,u)}}function zg(i,u,c){u=Qn(c,u),u=Tf(i.stateNode,u,2),i=da(i,u,2),i!==null&&(Xn(i,2),_r(i))}function ce(i,u,c){if(i.tag===3)zg(i,i,c);else for(;u!==null;){if(u.tag===3){zg(u,i,c);break}else if(u.tag===1){var d=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(_a===null||!_a.has(d))){i=Qn(c,i),c=Vm(2),d=da(u,c,2),d!==null&&(Wm(c,d,u,i),Xn(d,2),_r(d));break}}u=u.return}}function th(i,u,c){var d=i.pingCache;if(d===null){d=i.pingCache=new C2;var m=new Set;d.set(u,m)}else m=d.get(u),m===void 0&&(m=new Set,d.set(u,m));m.has(c)||(Gf=!0,m.add(c),i=D2.bind(null,i,u,c),u.then(i,i))}function D2(i,u,c){var d=i.pingCache;d!==null&&d.delete(u),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,fe===i&&(Kt&c)===c&&(Ee===4||Ee===3&&(Kt&62914560)===Kt&&300>me()-Xf?(ee&2)===0&&to(i,0):qf|=c,Zi===Kt&&(Zi=0)),_r(i)}function Pg(i,u){u===0&&(u=es()),i=Fi(i,u),i!==null&&(Xn(i,u),_r(i))}function N2(i){var u=i.memoizedState,c=0;u!==null&&(c=u.retryLane),Pg(i,c)}function M2(i,u){var c=0;switch(i.tag){case 13:var d=i.stateNode,m=i.memoizedState;m!==null&&(c=m.retryLane);break;case 19:d=i.stateNode;break;case 22:d=i.stateNode._retryCache;break;default:throw Error(e(314))}d!==null&&d.delete(u),Pg(i,c)}function k2(i,u){return Ut(i,u)}var Ks=null,no=null,eh=!1,Ys=!1,nh=!1,oi=0;function _r(i){i!==no&&i.next===null&&(no===null?Ks=no=i:no=no.next=i),Ys=!0,eh||(eh=!0,I2())}function vu(i,u){if(!nh&&Ys){nh=!0;do for(var c=!1,d=Ks;d!==null;){if(i!==0){var m=d.pendingLanes;if(m===0)var b=0;else{var S=d.suspendedLanes,D=d.pingedLanes;b=(1<<31-ht(42|i)+1)-1,b&=m&~(S&~D),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(c=!0,Wg(d,b))}else b=Kt,b=yn(d,d===fe?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(b&3)===0||gr(d,b)||(c=!0,Wg(d,b));d=d.next}while(c);nh=!1}}function O2(){Ug()}function Ug(){Ys=eh=!1;var i=0;oi!==0&&(V2()&&(i=oi),oi=0);for(var u=me(),c=null,d=Ks;d!==null;){var m=d.next,b=Hg(d,u);b===0?(d.next=null,c===null?Ks=m:c.next=m,m===null&&(no=c)):(c=d,(i!==0||(b&3)!==0)&&(Ys=!0)),d=m}vu(i)}function Hg(i,u){for(var c=i.suspendedLanes,d=i.pingedLanes,m=i.expirationTimes,b=i.pendingLanes&-62914561;0<b;){var S=31-ht(b),D=1<<S,z=m[S];z===-1?((D&c)===0||(D&d)!==0)&&(m[S]=No(D,u)):z<=u&&(i.expiredLanes|=D),b&=~D}if(u=fe,c=Kt,c=yn(i,i===u?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d=i.callbackNode,c===0||i===u&&(ne===2||ne===9)||i.cancelPendingCommit!==null)return d!==null&&d!==null&&re(d),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||gr(i,c)){if(u=c&-c,u===i.callbackPriority)return u;switch(d!==null&&re(d),mc(c)){case 2:case 8:c=qn;break;case 32:c=He;break;case 268435456:c=mn;break;default:c=He}return d=Vg.bind(null,i),c=Ut(c,d),i.callbackPriority=u,i.callbackNode=c,u}return d!==null&&d!==null&&re(d),i.callbackPriority=2,i.callbackNode=null,2}function Vg(i,u){if(Je!==0&&Je!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(Xs()&&i.callbackNode!==c)return null;var d=Kt;return d=yn(i,i===fe?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d===0?null:(Cg(i,d,u),Hg(i,me()),i.callbackNode!=null&&i.callbackNode===c?Vg.bind(null,i):null)}function Wg(i,u){if(Xs())return null;Cg(i,u,!0)}function I2(){G2(function(){(ee&6)!==0?Ut(Ue,O2):Ug()})}function rh(){return oi===0&&(oi=Mo()),oi}function Gg(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:os(""+i)}function qg(i,u){var c=u.ownerDocument.createElement("input");return c.name=u.name,c.value=u.value,i.id&&c.setAttribute("form",i.id),u.parentNode.insertBefore(c,u),i=new FormData(i),c.parentNode.removeChild(c),i}function B2(i,u,c,d,m){if(u==="submit"&&c&&c.stateNode===m){var b=Gg((m[bn]||null).action),S=d.submitter;S&&(u=(u=S[bn]||null)?Gg(u.formAction):S.getAttribute("formAction"),u!==null&&(b=u,S=null));var D=new cs("action","action",null,d,m);i.push({event:D,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(oi!==0){var z=S?qg(m,S):new FormData(m);Ef(c,{pending:!0,data:z,method:m.method,action:b},null,z)}}else typeof b=="function"&&(D.preventDefault(),z=S?qg(m,S):new FormData(m),Ef(c,{pending:!0,data:z,method:m.method,action:b},b,z))},currentTarget:m}]})}}for(var ah=0;ah<Hc.length;ah++){var ih=Hc[ah],F2=ih.toLowerCase(),L2=ih[0].toUpperCase()+ih.slice(1);ur(F2,"on"+L2)}ur(Cv,"onAnimationEnd"),ur(Sv,"onAnimationIteration"),ur(Rv,"onAnimationStart"),ur("dblclick","onDoubleClick"),ur("focusin","onFocus"),ur("focusout","onBlur"),ur(t2,"onTransitionRun"),ur(e2,"onTransitionStart"),ur(n2,"onTransitionCancel"),ur(Av,"onTransitionEnd"),Ri("onMouseEnter",["mouseout","mouseover"]),Ri("onMouseLeave",["mouseout","mouseover"]),Ri("onPointerEnter",["pointerout","pointerover"]),Ri("onPointerLeave",["pointerout","pointerover"]),Ga("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ga("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ga("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ga("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mu));function jg(i,u){u=(u&4)!==0;for(var c=0;c<i.length;c++){var d=i[c],m=d.event;d=d.listeners;t:{var b=void 0;if(u)for(var S=d.length-1;0<=S;S--){var D=d[S],z=D.instance,Q=D.currentTarget;if(D=D.listener,z!==b&&m.isPropagationStopped())break t;b=D,m.currentTarget=Q;try{b(m)}catch(st){Fs(st)}m.currentTarget=null,b=z}else for(S=0;S<d.length;S++){if(D=d[S],z=D.instance,Q=D.currentTarget,D=D.listener,z!==b&&m.isPropagationStopped())break t;b=D,m.currentTarget=Q;try{b(m)}catch(st){Fs(st)}m.currentTarget=null,b=z}}}}function Gt(i,u){var c=u[gc];c===void 0&&(c=u[gc]=new Set);var d=i+"__bubble";c.has(d)||(Xg(u,i,2,!1),c.add(d))}function oh(i,u,c){var d=0;u&&(d|=4),Xg(c,i,d,u)}var Qs="_reactListening"+Math.random().toString(36).slice(2);function uh(i){if(!i[Qs]){i[Qs]=!0,Up.forEach(function(c){c!=="selectionchange"&&(z2.has(c)||oh(c,!1,i),oh(c,!0,i))});var u=i.nodeType===9?i:i.ownerDocument;u===null||u[Qs]||(u[Qs]=!0,oh("selectionchange",!1,u))}}function Xg(i,u,c,d){switch(gy(u)){case 2:var m=fw;break;case 8:m=hw;break;default:m=wh}c=m.bind(null,u,c,i),m=void 0,!Tc||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(m=!0),d?m!==void 0?i.addEventListener(u,c,{capture:!0,passive:m}):i.addEventListener(u,c,!0):m!==void 0?i.addEventListener(u,c,{passive:m}):i.addEventListener(u,c,!1)}function sh(i,u,c,d,m){var b=d;if((u&1)===0&&(u&2)===0&&d!==null)t:for(;;){if(d===null)return;var S=d.tag;if(S===3||S===4){var D=d.stateNode.containerInfo;if(D===m)break;if(S===4)for(S=d.return;S!==null;){var z=S.tag;if((z===3||z===4)&&S.stateNode.containerInfo===m)return;S=S.return}for(;D!==null;){if(S=Ei(D),S===null)return;if(z=S.tag,z===5||z===6||z===26||z===27){d=b=S;continue t}D=D.parentNode}}d=d.return}tv(function(){var Q=b,st=Rc(c),ct=[];t:{var Z=Tv.get(i);if(Z!==void 0){var J=cs,Mt=i;switch(i){case"keypress":if(ss(c)===0)break t;case"keydown":case"keyup":J=kx;break;case"focusin":Mt="focus",J=kc;break;case"focusout":Mt="blur",J=kc;break;case"beforeblur":case"afterblur":J=kc;break;case"click":if(c.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=rv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=xx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=Bx;break;case Cv:case Sv:case Rv:J=Ex;break;case Av:J=Lx;break;case"scroll":case"scrollend":J=yx;break;case"wheel":J=Px;break;case"copy":case"cut":case"paste":J=Sx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=iv;break;case"toggle":case"beforetoggle":J=Hx}var Dt=(u&4)!==0,oe=!Dt&&(i==="scroll"||i==="scrollend"),j=Dt?Z!==null?Z+"Capture":null:Z;Dt=[];for(var V=Q,Y;V!==null;){var lt=V;if(Y=lt.stateNode,lt=lt.tag,lt!==5&&lt!==26&&lt!==27||Y===null||j===null||(lt=Bo(V,j),lt!=null&&Dt.push(gu(V,lt,Y))),oe)break;V=V.return}0<Dt.length&&(Z=new J(Z,Mt,null,c,st),ct.push({event:Z,listeners:Dt}))}}if((u&7)===0){t:{if(Z=i==="mouseover"||i==="pointerover",J=i==="mouseout"||i==="pointerout",Z&&c!==Sc&&(Mt=c.relatedTarget||c.fromElement)&&(Ei(Mt)||Mt[_i]))break t;if((J||Z)&&(Z=st.window===st?st:(Z=st.ownerDocument)?Z.defaultView||Z.parentWindow:window,J?(Mt=c.relatedTarget||c.toElement,J=Q,Mt=Mt?Ei(Mt):null,Mt!==null&&(oe=o(Mt),Dt=Mt.tag,Mt!==oe||Dt!==5&&Dt!==27&&Dt!==6)&&(Mt=null)):(J=null,Mt=Q),J!==Mt)){if(Dt=rv,lt="onMouseLeave",j="onMouseEnter",V="mouse",(i==="pointerout"||i==="pointerover")&&(Dt=iv,lt="onPointerLeave",j="onPointerEnter",V="pointer"),oe=J==null?Z:Io(J),Y=Mt==null?Z:Io(Mt),Z=new Dt(lt,V+"leave",J,c,st),Z.target=oe,Z.relatedTarget=Y,lt=null,Ei(st)===Q&&(Dt=new Dt(j,V+"enter",Mt,c,st),Dt.target=Y,Dt.relatedTarget=oe,lt=Dt),oe=lt,J&&Mt)e:{for(Dt=J,j=Mt,V=0,Y=Dt;Y;Y=ro(Y))V++;for(Y=0,lt=j;lt;lt=ro(lt))Y++;for(;0<V-Y;)Dt=ro(Dt),V--;for(;0<Y-V;)j=ro(j),Y--;for(;V--;){if(Dt===j||j!==null&&Dt===j.alternate)break e;Dt=ro(Dt),j=ro(j)}Dt=null}else Dt=null;J!==null&&Kg(ct,Z,J,Dt,!1),Mt!==null&&oe!==null&&Kg(ct,oe,Mt,Dt,!0)}}t:{if(Z=Q?Io(Q):window,J=Z.nodeName&&Z.nodeName.toLowerCase(),J==="select"||J==="input"&&Z.type==="file")var xt=dv;else if(fv(Z))if(pv)xt=Zx;else{xt=Yx;var Ht=Kx}else J=Z.nodeName,!J||J.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?Q&&Cc(Q.elementType)&&(xt=dv):xt=Qx;if(xt&&(xt=xt(i,Q))){hv(ct,xt,c,st);break t}Ht&&Ht(i,Z,Q),i==="focusout"&&Q&&Z.type==="number"&&Q.memoizedProps.value!=null&&Ec(Z,"number",Z.value)}switch(Ht=Q?Io(Q):window,i){case"focusin":(fv(Ht)||Ht.contentEditable==="true")&&(Oi=Ht,zc=Q,Wo=null);break;case"focusout":Wo=zc=Oi=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,_v(ct,c,st);break;case"selectionchange":if($x)break;case"keydown":case"keyup":_v(ct,c,st)}var At;if(Ic)t:{switch(i){case"compositionstart":var Nt="onCompositionStart";break t;case"compositionend":Nt="onCompositionEnd";break t;case"compositionupdate":Nt="onCompositionUpdate";break t}Nt=void 0}else ki?lv(i,c)&&(Nt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Nt="onCompositionStart");Nt&&(ov&&c.locale!=="ko"&&(ki||Nt!=="onCompositionStart"?Nt==="onCompositionEnd"&&ki&&(At=ev()):(la=st,Dc="value"in la?la.value:la.textContent,ki=!0)),Ht=Zs(Q,Nt),0<Ht.length&&(Nt=new av(Nt,i,null,c,st),ct.push({event:Nt,listeners:Ht}),At?Nt.data=At:(At=cv(c),At!==null&&(Nt.data=At)))),(At=Wx?Gx(i,c):qx(i,c))&&(Nt=Zs(Q,"onBeforeInput"),0<Nt.length&&(Ht=new av("onBeforeInput","beforeinput",null,c,st),ct.push({event:Ht,listeners:Nt}),Ht.data=At)),B2(ct,i,Q,c,st)}jg(ct,u)})}function gu(i,u,c){return{instance:i,listener:u,currentTarget:c}}function Zs(i,u){for(var c=u+"Capture",d=[];i!==null;){var m=i,b=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||b===null||(m=Bo(i,c),m!=null&&d.unshift(gu(i,m,b)),m=Bo(i,u),m!=null&&d.push(gu(i,m,b))),i.tag===3)return d;i=i.return}return[]}function ro(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Kg(i,u,c,d,m){for(var b=u._reactName,S=[];c!==null&&c!==d;){var D=c,z=D.alternate,Q=D.stateNode;if(D=D.tag,z!==null&&z===d)break;D!==5&&D!==26&&D!==27||Q===null||(z=Q,m?(Q=Bo(c,b),Q!=null&&S.unshift(gu(c,Q,z))):m||(Q=Bo(c,b),Q!=null&&S.push(gu(c,Q,z)))),c=c.return}S.length!==0&&i.push({event:u,listeners:S})}var P2=/\r\n?/g,U2=/\u0000|\uFFFD/g;function Yg(i){return(typeof i=="string"?i:""+i).replace(P2,`
`).replace(U2,"")}function Qg(i,u){return u=Yg(u),Yg(i)===u}function Js(){}function ie(i,u,c,d,m,b){switch(c){case"children":typeof d=="string"?u==="body"||u==="textarea"&&d===""||Di(i,d):(typeof d=="number"||typeof d=="bigint")&&u!=="body"&&Di(i,""+d);break;case"className":rs(i,"class",d);break;case"tabIndex":rs(i,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":rs(i,c,d);break;case"style":Jp(i,d,b);break;case"data":if(u!=="object"){rs(i,"data",d);break}case"src":case"href":if(d===""&&(u!=="a"||c!=="href")){i.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(c);break}d=os(""+d),i.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(c==="formAction"?(u!=="input"&&ie(i,u,"name",m.name,m,null),ie(i,u,"formEncType",m.formEncType,m,null),ie(i,u,"formMethod",m.formMethod,m,null),ie(i,u,"formTarget",m.formTarget,m,null)):(ie(i,u,"encType",m.encType,m,null),ie(i,u,"method",m.method,m,null),ie(i,u,"target",m.target,m,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(c);break}d=os(""+d),i.setAttribute(c,d);break;case"onClick":d!=null&&(i.onclick=Js);break;case"onScroll":d!=null&&Gt("scroll",i);break;case"onScrollEnd":d!=null&&Gt("scrollend",i);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(e(61));if(c=d.__html,c!=null){if(m.children!=null)throw Error(e(60));i.innerHTML=c}}break;case"multiple":i.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":i.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){i.removeAttribute("xlink:href");break}c=os(""+d),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,""+d):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":d===!0?i.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,d):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?i.setAttribute(c,d):i.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?i.removeAttribute(c):i.setAttribute(c,d);break;case"popover":Gt("beforetoggle",i),Gt("toggle",i),ns(i,"popover",d);break;case"xlinkActuate":zr(i,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":zr(i,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":zr(i,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":zr(i,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":zr(i,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":zr(i,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":zr(i,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":zr(i,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":zr(i,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ns(i,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=mx.get(c)||c,ns(i,c,d))}}function lh(i,u,c,d,m,b){switch(c){case"style":Jp(i,d,b);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(e(61));if(c=d.__html,c!=null){if(m.children!=null)throw Error(e(60));i.innerHTML=c}}break;case"children":typeof d=="string"?Di(i,d):(typeof d=="number"||typeof d=="bigint")&&Di(i,""+d);break;case"onScroll":d!=null&&Gt("scroll",i);break;case"onScrollEnd":d!=null&&Gt("scrollend",i);break;case"onClick":d!=null&&(i.onclick=Js);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hp.hasOwnProperty(c))t:{if(c[0]==="o"&&c[1]==="n"&&(m=c.endsWith("Capture"),u=c.slice(2,m?c.length-7:void 0),b=i[bn]||null,b=b!=null?b[c]:null,typeof b=="function"&&i.removeEventListener(u,b,m),typeof d=="function")){typeof b!="function"&&b!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(u,d,m);break t}c in i?i[c]=d:d===!0?i.setAttribute(c,""):ns(i,c,d)}}}function $e(i,u,c){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gt("error",i),Gt("load",i);var d=!1,m=!1,b;for(b in c)if(c.hasOwnProperty(b)){var S=c[b];if(S!=null)switch(b){case"src":d=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(e(137,u));default:ie(i,u,b,S,c,null)}}m&&ie(i,u,"srcSet",c.srcSet,c,null),d&&ie(i,u,"src",c.src,c,null);return;case"input":Gt("invalid",i);var D=b=S=m=null,z=null,Q=null;for(d in c)if(c.hasOwnProperty(d)){var st=c[d];if(st!=null)switch(d){case"name":m=st;break;case"type":S=st;break;case"checked":z=st;break;case"defaultChecked":Q=st;break;case"value":b=st;break;case"defaultValue":D=st;break;case"children":case"dangerouslySetInnerHTML":if(st!=null)throw Error(e(137,u));break;default:ie(i,u,d,st,c,null)}}Kp(i,b,D,z,Q,S,m,!1),as(i);return;case"select":Gt("invalid",i),d=S=b=null;for(m in c)if(c.hasOwnProperty(m)&&(D=c[m],D!=null))switch(m){case"value":b=D;break;case"defaultValue":S=D;break;case"multiple":d=D;default:ie(i,u,m,D,c,null)}u=b,c=S,i.multiple=!!d,u!=null?Ti(i,!!d,u,!1):c!=null&&Ti(i,!!d,c,!0);return;case"textarea":Gt("invalid",i),b=m=d=null;for(S in c)if(c.hasOwnProperty(S)&&(D=c[S],D!=null))switch(S){case"value":d=D;break;case"defaultValue":m=D;break;case"children":b=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(e(91));break;default:ie(i,u,S,D,c,null)}Qp(i,d,m,b),as(i);return;case"option":for(z in c)if(c.hasOwnProperty(z)&&(d=c[z],d!=null))switch(z){case"selected":i.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:ie(i,u,z,d,c,null)}return;case"dialog":Gt("beforetoggle",i),Gt("toggle",i),Gt("cancel",i),Gt("close",i);break;case"iframe":case"object":Gt("load",i);break;case"video":case"audio":for(d=0;d<mu.length;d++)Gt(mu[d],i);break;case"image":Gt("error",i),Gt("load",i);break;case"details":Gt("toggle",i);break;case"embed":case"source":case"link":Gt("error",i),Gt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in c)if(c.hasOwnProperty(Q)&&(d=c[Q],d!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(e(137,u));default:ie(i,u,Q,d,c,null)}return;default:if(Cc(u)){for(st in c)c.hasOwnProperty(st)&&(d=c[st],d!==void 0&&lh(i,u,st,d,c,void 0));return}}for(D in c)c.hasOwnProperty(D)&&(d=c[D],d!=null&&ie(i,u,D,d,c,null))}function H2(i,u,c,d){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,b=null,S=null,D=null,z=null,Q=null,st=null;for(J in c){var ct=c[J];if(c.hasOwnProperty(J)&&ct!=null)switch(J){case"checked":break;case"value":break;case"defaultValue":z=ct;default:d.hasOwnProperty(J)||ie(i,u,J,null,d,ct)}}for(var Z in d){var J=d[Z];if(ct=c[Z],d.hasOwnProperty(Z)&&(J!=null||ct!=null))switch(Z){case"type":b=J;break;case"name":m=J;break;case"checked":Q=J;break;case"defaultChecked":st=J;break;case"value":S=J;break;case"defaultValue":D=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(e(137,u));break;default:J!==ct&&ie(i,u,Z,J,d,ct)}}_c(i,S,D,z,Q,st,b,m);return;case"select":J=S=D=Z=null;for(b in c)if(z=c[b],c.hasOwnProperty(b)&&z!=null)switch(b){case"value":break;case"multiple":J=z;default:d.hasOwnProperty(b)||ie(i,u,b,null,d,z)}for(m in d)if(b=d[m],z=c[m],d.hasOwnProperty(m)&&(b!=null||z!=null))switch(m){case"value":Z=b;break;case"defaultValue":D=b;break;case"multiple":S=b;default:b!==z&&ie(i,u,m,b,d,z)}u=D,c=S,d=J,Z!=null?Ti(i,!!c,Z,!1):!!d!=!!c&&(u!=null?Ti(i,!!c,u,!0):Ti(i,!!c,c?[]:"",!1));return;case"textarea":J=Z=null;for(D in c)if(m=c[D],c.hasOwnProperty(D)&&m!=null&&!d.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:ie(i,u,D,null,d,m)}for(S in d)if(m=d[S],b=c[S],d.hasOwnProperty(S)&&(m!=null||b!=null))switch(S){case"value":Z=m;break;case"defaultValue":J=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(e(91));break;default:m!==b&&ie(i,u,S,m,d,b)}Yp(i,Z,J);return;case"option":for(var Mt in c)if(Z=c[Mt],c.hasOwnProperty(Mt)&&Z!=null&&!d.hasOwnProperty(Mt))switch(Mt){case"selected":i.selected=!1;break;default:ie(i,u,Mt,null,d,Z)}for(z in d)if(Z=d[z],J=c[z],d.hasOwnProperty(z)&&Z!==J&&(Z!=null||J!=null))switch(z){case"selected":i.selected=Z&&typeof Z!="function"&&typeof Z!="symbol";break;default:ie(i,u,z,Z,d,J)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Dt in c)Z=c[Dt],c.hasOwnProperty(Dt)&&Z!=null&&!d.hasOwnProperty(Dt)&&ie(i,u,Dt,null,d,Z);for(Q in d)if(Z=d[Q],J=c[Q],d.hasOwnProperty(Q)&&Z!==J&&(Z!=null||J!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(e(137,u));break;default:ie(i,u,Q,Z,d,J)}return;default:if(Cc(u)){for(var oe in c)Z=c[oe],c.hasOwnProperty(oe)&&Z!==void 0&&!d.hasOwnProperty(oe)&&lh(i,u,oe,void 0,d,Z);for(st in d)Z=d[st],J=c[st],!d.hasOwnProperty(st)||Z===J||Z===void 0&&J===void 0||lh(i,u,st,Z,d,J);return}}for(var j in c)Z=c[j],c.hasOwnProperty(j)&&Z!=null&&!d.hasOwnProperty(j)&&ie(i,u,j,null,d,Z);for(ct in d)Z=d[ct],J=c[ct],!d.hasOwnProperty(ct)||Z===J||Z==null&&J==null||ie(i,u,ct,Z,d,J)}var ch=null,fh=null;function $s(i){return i.nodeType===9?i:i.ownerDocument}function Zg(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Jg(i,u){if(i===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&u==="foreignObject"?0:i}function hh(i,u){return i==="textarea"||i==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var dh=null;function V2(){var i=window.event;return i&&i.type==="popstate"?i===dh?!1:(dh=i,!0):(dh=null,!1)}var $g=typeof setTimeout=="function"?setTimeout:void 0,W2=typeof clearTimeout=="function"?clearTimeout:void 0,ty=typeof Promise=="function"?Promise:void 0,G2=typeof queueMicrotask=="function"?queueMicrotask:typeof ty<"u"?function(i){return ty.resolve(null).then(i).catch(q2)}:$g;function q2(i){setTimeout(function(){throw i})}function Sa(i){return i==="head"}function ey(i,u){var c=u,d=0,m=0;do{var b=c.nextSibling;if(i.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"){if(0<d&&8>d){c=d;var S=i.ownerDocument;if(c&1&&yu(S.documentElement),c&2&&yu(S.body),c&4)for(c=S.head,yu(c),S=c.firstChild;S;){var D=S.nextSibling,z=S.nodeName;S[Oo]||z==="SCRIPT"||z==="STYLE"||z==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=D}}if(m===0){i.removeChild(b),Ru(u);return}m--}else c==="$"||c==="$?"||c==="$!"?m++:d=c.charCodeAt(0)-48;else d=0;c=b}while(c);Ru(u)}function ph(i){var u=i.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var c=u;switch(u=u.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ph(c),yc(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function j2(i,u,c,d){for(;i.nodeType===1;){var m=c;if(i.nodeName.toLowerCase()!==u.toLowerCase()){if(!d&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(d){if(!i[Oo])switch(u){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(b=i.getAttribute("rel"),b==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(b!==m.rel||i.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||i.getAttribute("title")!==(m.title==null?null:m.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(b=i.getAttribute("src"),(b!==(m.src==null?null:m.src)||i.getAttribute("type")!==(m.type==null?null:m.type)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&b&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(u==="input"&&i.type==="hidden"){var b=m.name==null?null:""+m.name;if(m.type==="hidden"&&i.getAttribute("name")===b)return i}else return i;if(i=lr(i.nextSibling),i===null)break}return null}function X2(i,u,c){if(u==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=lr(i.nextSibling),i===null))return null;return i}function vh(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function K2(i,u){var c=i.ownerDocument;if(i.data!=="$?"||c.readyState==="complete")u();else{var d=function(){u(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),i._reactRetry=d}}function lr(i){for(;i!=null;i=i.nextSibling){var u=i.nodeType;if(u===1||u===3)break;if(u===8){if(u=i.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return i}var mh=null;function ny(i){i=i.previousSibling;for(var u=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(u===0)return i;u--}else c==="/$"&&u++}i=i.previousSibling}return null}function ry(i,u,c){switch(u=$s(c),i){case"html":if(i=u.documentElement,!i)throw Error(e(452));return i;case"head":if(i=u.head,!i)throw Error(e(453));return i;case"body":if(i=u.body,!i)throw Error(e(454));return i;default:throw Error(e(451))}}function yu(i){for(var u=i.attributes;u.length;)i.removeAttributeNode(u[0]);yc(i)}var nr=new Map,ay=new Set;function tl(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Jr=q.d;q.d={f:Y2,r:Q2,D:Z2,C:J2,L:$2,m:tw,X:nw,S:ew,M:rw};function Y2(){var i=Jr.f(),u=qs();return i||u}function Q2(i){var u=Ci(i);u!==null&&u.tag===5&&u.type==="form"?Cm(u):Jr.r(i)}var ao=typeof document>"u"?null:document;function iy(i,u,c){var d=ao;if(d&&typeof u=="string"&&u){var m=Yn(u);m='link[rel="'+i+'"][href="'+m+'"]',typeof c=="string"&&(m+='[crossorigin="'+c+'"]'),ay.has(m)||(ay.add(m),i={rel:i,crossOrigin:c,href:u},d.querySelector(m)===null&&(u=d.createElement("link"),$e(u,"link",i),Ge(u),d.head.appendChild(u)))}}function Z2(i){Jr.D(i),iy("dns-prefetch",i,null)}function J2(i,u){Jr.C(i,u),iy("preconnect",i,u)}function $2(i,u,c){Jr.L(i,u,c);var d=ao;if(d&&i&&u){var m='link[rel="preload"][as="'+Yn(u)+'"]';u==="image"&&c&&c.imageSrcSet?(m+='[imagesrcset="'+Yn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(m+='[imagesizes="'+Yn(c.imageSizes)+'"]')):m+='[href="'+Yn(i)+'"]';var b=m;switch(u){case"style":b=io(i);break;case"script":b=oo(i)}nr.has(b)||(i=p({rel:"preload",href:u==="image"&&c&&c.imageSrcSet?void 0:i,as:u},c),nr.set(b,i),d.querySelector(m)!==null||u==="style"&&d.querySelector(bu(b))||u==="script"&&d.querySelector(xu(b))||(u=d.createElement("link"),$e(u,"link",i),Ge(u),d.head.appendChild(u)))}}function tw(i,u){Jr.m(i,u);var c=ao;if(c&&i){var d=u&&typeof u.as=="string"?u.as:"script",m='link[rel="modulepreload"][as="'+Yn(d)+'"][href="'+Yn(i)+'"]',b=m;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=oo(i)}if(!nr.has(b)&&(i=p({rel:"modulepreload",href:i},u),nr.set(b,i),c.querySelector(m)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(xu(b)))return}d=c.createElement("link"),$e(d,"link",i),Ge(d),c.head.appendChild(d)}}}function ew(i,u,c){Jr.S(i,u,c);var d=ao;if(d&&i){var m=Si(d).hoistableStyles,b=io(i);u=u||"default";var S=m.get(b);if(!S){var D={loading:0,preload:null};if(S=d.querySelector(bu(b)))D.loading=5;else{i=p({rel:"stylesheet",href:i,"data-precedence":u},c),(c=nr.get(b))&&gh(i,c);var z=S=d.createElement("link");Ge(z),$e(z,"link",i),z._p=new Promise(function(Q,st){z.onload=Q,z.onerror=st}),z.addEventListener("load",function(){D.loading|=1}),z.addEventListener("error",function(){D.loading|=2}),D.loading|=4,el(S,u,d)}S={type:"stylesheet",instance:S,count:1,state:D},m.set(b,S)}}}function nw(i,u){Jr.X(i,u);var c=ao;if(c&&i){var d=Si(c).hoistableScripts,m=oo(i),b=d.get(m);b||(b=c.querySelector(xu(m)),b||(i=p({src:i,async:!0},u),(u=nr.get(m))&&yh(i,u),b=c.createElement("script"),Ge(b),$e(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(m,b))}}function rw(i,u){Jr.M(i,u);var c=ao;if(c&&i){var d=Si(c).hoistableScripts,m=oo(i),b=d.get(m);b||(b=c.querySelector(xu(m)),b||(i=p({src:i,async:!0,type:"module"},u),(u=nr.get(m))&&yh(i,u),b=c.createElement("script"),Ge(b),$e(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(m,b))}}function oy(i,u,c,d){var m=(m=pt.current)?tl(m):null;if(!m)throw Error(e(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(u=io(c.href),c=Si(m).hoistableStyles,d=c.get(u),d||(d={type:"style",instance:null,count:0,state:null},c.set(u,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=io(c.href);var b=Si(m).hoistableStyles,S=b.get(i);if(S||(m=m.ownerDocument||m,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(i,S),(b=m.querySelector(bu(i)))&&!b._p&&(S.instance=b,S.state.loading=5),nr.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},nr.set(i,c),b||aw(m,i,c,S.state))),u&&d===null)throw Error(e(528,""));return S}if(u&&d!==null)throw Error(e(529,""));return null;case"script":return u=c.async,c=c.src,typeof c=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=oo(c),c=Si(m).hoistableScripts,d=c.get(u),d||(d={type:"script",instance:null,count:0,state:null},c.set(u,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(e(444,i))}}function io(i){return'href="'+Yn(i)+'"'}function bu(i){return'link[rel="stylesheet"]['+i+"]"}function uy(i){return p({},i,{"data-precedence":i.precedence,precedence:null})}function aw(i,u,c,d){i.querySelector('link[rel="preload"][as="style"]['+u+"]")?d.loading=1:(u=i.createElement("link"),d.preload=u,u.addEventListener("load",function(){return d.loading|=1}),u.addEventListener("error",function(){return d.loading|=2}),$e(u,"link",c),Ge(u),i.head.appendChild(u))}function oo(i){return'[src="'+Yn(i)+'"]'}function xu(i){return"script[async]"+i}function sy(i,u,c){if(u.count++,u.instance===null)switch(u.type){case"style":var d=i.querySelector('style[data-href~="'+Yn(c.href)+'"]');if(d)return u.instance=d,Ge(d),d;var m=p({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(i.ownerDocument||i).createElement("style"),Ge(d),$e(d,"style",m),el(d,c.precedence,i),u.instance=d;case"stylesheet":m=io(c.href);var b=i.querySelector(bu(m));if(b)return u.state.loading|=4,u.instance=b,Ge(b),b;d=uy(c),(m=nr.get(m))&&gh(d,m),b=(i.ownerDocument||i).createElement("link"),Ge(b);var S=b;return S._p=new Promise(function(D,z){S.onload=D,S.onerror=z}),$e(b,"link",d),u.state.loading|=4,el(b,c.precedence,i),u.instance=b;case"script":return b=oo(c.src),(m=i.querySelector(xu(b)))?(u.instance=m,Ge(m),m):(d=c,(m=nr.get(b))&&(d=p({},c),yh(d,m)),i=i.ownerDocument||i,m=i.createElement("script"),Ge(m),$e(m,"link",d),i.head.appendChild(m),u.instance=m);case"void":return null;default:throw Error(e(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(d=u.instance,u.state.loading|=4,el(d,c.precedence,i));return u.instance}function el(i,u,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=d.length?d[d.length-1]:null,b=m,S=0;S<d.length;S++){var D=d[S];if(D.dataset.precedence===u)b=D;else if(b!==m)break}b?b.parentNode.insertBefore(i,b.nextSibling):(u=c.nodeType===9?c.head:c,u.insertBefore(i,u.firstChild))}function gh(i,u){i.crossOrigin==null&&(i.crossOrigin=u.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=u.referrerPolicy),i.title==null&&(i.title=u.title)}function yh(i,u){i.crossOrigin==null&&(i.crossOrigin=u.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=u.referrerPolicy),i.integrity==null&&(i.integrity=u.integrity)}var nl=null;function ly(i,u,c){if(nl===null){var d=new Map,m=nl=new Map;m.set(c,d)}else m=nl,d=m.get(c),d||(d=new Map,m.set(c,d));if(d.has(i))return d;for(d.set(i,null),c=c.getElementsByTagName(i),m=0;m<c.length;m++){var b=c[m];if(!(b[Oo]||b[rn]||i==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var S=b.getAttribute(u)||"";S=i+S;var D=d.get(S);D?D.push(b):d.set(S,[b])}}return d}function cy(i,u,c){i=i.ownerDocument||i,i.head.insertBefore(c,u==="title"?i.querySelector("head > title"):null)}function iw(i,u,c){if(c===1||u.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return i=u.disabled,typeof u.precedence=="string"&&i==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function fy(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var wu=null;function ow(){}function uw(i,u,c){if(wu===null)throw Error(e(475));var d=wu;if(u.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var m=io(c.href),b=i.querySelector(bu(m));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(d.count++,d=rl.bind(d),i.then(d,d)),u.state.loading|=4,u.instance=b,Ge(b);return}b=i.ownerDocument||i,c=uy(c),(m=nr.get(m))&&gh(c,m),b=b.createElement("link"),Ge(b);var S=b;S._p=new Promise(function(D,z){S.onload=D,S.onerror=z}),$e(b,"link",c),u.instance=b}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(u,i),(i=u.state.preload)&&(u.state.loading&3)===0&&(d.count++,u=rl.bind(d),i.addEventListener("load",u),i.addEventListener("error",u))}}function sw(){if(wu===null)throw Error(e(475));var i=wu;return i.stylesheets&&i.count===0&&bh(i,i.stylesheets),0<i.count?function(u){var c=setTimeout(function(){if(i.stylesheets&&bh(i,i.stylesheets),i.unsuspend){var d=i.unsuspend;i.unsuspend=null,d()}},6e4);return i.unsuspend=u,function(){i.unsuspend=null,clearTimeout(c)}}:null}function rl(){if(this.count--,this.count===0){if(this.stylesheets)bh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var al=null;function bh(i,u){i.stylesheets=null,i.unsuspend!==null&&(i.count++,al=new Map,u.forEach(lw,i),al=null,rl.call(i))}function lw(i,u){if(!(u.state.loading&4)){var c=al.get(i);if(c)var d=c.get(null);else{c=new Map,al.set(i,c);for(var m=i.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<m.length;b++){var S=m[b];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(c.set(S.dataset.precedence,S),d=S)}d&&c.set(null,d)}m=u.instance,S=m.getAttribute("data-precedence"),b=c.get(S)||d,b===d&&c.set(null,m),c.set(S,m),this.count++,d=rl.bind(this),m.addEventListener("load",d),m.addEventListener("error",d),b?b.parentNode.insertBefore(m,b.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(m,i.firstChild)),u.state.loading|=4}}var _u={$$typeof:A,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function cw(i,u,c,d,m,b,S,D){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ko(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ko(0),this.hiddenUpdates=ko(null),this.identifierPrefix=d,this.onUncaughtError=m,this.onCaughtError=b,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function hy(i,u,c,d,m,b,S,D,z,Q,st,ct){return i=new cw(i,u,c,S,D,z,Q,ct),u=1,b===!0&&(u|=24),b=kn(3,null,null,u),i.current=b,b.stateNode=i,u=$c(),u.refCount++,i.pooledCache=u,u.refCount++,b.memoizedState={element:d,isDehydrated:c,cache:u},rf(b),i}function dy(i){return i?(i=Li,i):Li}function py(i,u,c,d,m,b){m=dy(m),d.context===null?d.context=m:d.pendingContext=m,d=ha(u),d.payload={element:c},b=b===void 0?null:b,b!==null&&(d.callback=b),c=da(i,d,u),c!==null&&(Ln(c,i,u),Jo(c,i,u))}function vy(i,u){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<u?c:u}}function xh(i,u){vy(i,u),(i=i.alternate)&&vy(i,u)}function my(i){if(i.tag===13){var u=Fi(i,67108864);u!==null&&Ln(u,i,67108864),xh(i,67108864)}}var il=!0;function fw(i,u,c,d){var m=P.T;P.T=null;var b=q.p;try{q.p=2,wh(i,u,c,d)}finally{q.p=b,P.T=m}}function hw(i,u,c,d){var m=P.T;P.T=null;var b=q.p;try{q.p=8,wh(i,u,c,d)}finally{q.p=b,P.T=m}}function wh(i,u,c,d){if(il){var m=_h(d);if(m===null)sh(i,u,d,ol,c),yy(i,d);else if(pw(m,i,u,c,d))d.stopPropagation();else if(yy(i,d),u&4&&-1<dw.indexOf(i)){for(;m!==null;){var b=Ci(m);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var S=We(b.pendingLanes);if(S!==0){var D=b;for(D.pendingLanes|=2,D.entangledLanes|=2;S;){var z=1<<31-ht(S);D.entanglements[1]|=z,S&=~z}_r(b),(ee&6)===0&&(Ws=me()+500,vu(0))}}break;case 13:D=Fi(b,2),D!==null&&Ln(D,b,2),qs(),xh(b,2)}if(b=_h(d),b===null&&sh(i,u,d,ol,c),b===m)break;m=b}m!==null&&d.stopPropagation()}else sh(i,u,d,null,c)}}function _h(i){return i=Rc(i),Eh(i)}var ol=null;function Eh(i){if(ol=null,i=Ei(i),i!==null){var u=o(i);if(u===null)i=null;else{var c=u.tag;if(c===13){if(i=l(u),i!==null)return i;i=null}else if(c===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;i=null}else u!==i&&(i=null)}}return ol=i,null}function gy(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(jt()){case Ue:return 2;case qn:return 8;case He:case jn:return 32;case mn:return 268435456;default:return 32}default:return 32}}var Ch=!1,Ra=null,Aa=null,Ta=null,Eu=new Map,Cu=new Map,Da=[],dw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yy(i,u){switch(i){case"focusin":case"focusout":Ra=null;break;case"dragenter":case"dragleave":Aa=null;break;case"mouseover":case"mouseout":Ta=null;break;case"pointerover":case"pointerout":Eu.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cu.delete(u.pointerId)}}function Su(i,u,c,d,m,b){return i===null||i.nativeEvent!==b?(i={blockedOn:u,domEventName:c,eventSystemFlags:d,nativeEvent:b,targetContainers:[m]},u!==null&&(u=Ci(u),u!==null&&my(u)),i):(i.eventSystemFlags|=d,u=i.targetContainers,m!==null&&u.indexOf(m)===-1&&u.push(m),i)}function pw(i,u,c,d,m){switch(u){case"focusin":return Ra=Su(Ra,i,u,c,d,m),!0;case"dragenter":return Aa=Su(Aa,i,u,c,d,m),!0;case"mouseover":return Ta=Su(Ta,i,u,c,d,m),!0;case"pointerover":var b=m.pointerId;return Eu.set(b,Su(Eu.get(b)||null,i,u,c,d,m)),!0;case"gotpointercapture":return b=m.pointerId,Cu.set(b,Su(Cu.get(b)||null,i,u,c,d,m)),!0}return!1}function by(i){var u=Ei(i.target);if(u!==null){var c=o(u);if(c!==null){if(u=c.tag,u===13){if(u=l(c),u!==null){i.blockedOn=u,ux(i.priority,function(){if(c.tag===13){var d=Fn();d=vc(d);var m=Fi(c,d);m!==null&&Ln(m,c,d),xh(c,d)}});return}}else if(u===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ul(i){if(i.blockedOn!==null)return!1;for(var u=i.targetContainers;0<u.length;){var c=_h(i.nativeEvent);if(c===null){c=i.nativeEvent;var d=new c.constructor(c.type,c);Sc=d,c.target.dispatchEvent(d),Sc=null}else return u=Ci(c),u!==null&&my(u),i.blockedOn=c,!1;u.shift()}return!0}function xy(i,u,c){ul(i)&&c.delete(u)}function vw(){Ch=!1,Ra!==null&&ul(Ra)&&(Ra=null),Aa!==null&&ul(Aa)&&(Aa=null),Ta!==null&&ul(Ta)&&(Ta=null),Eu.forEach(xy),Cu.forEach(xy)}function sl(i,u){i.blockedOn===u&&(i.blockedOn=null,Ch||(Ch=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,vw)))}var ll=null;function wy(i){ll!==i&&(ll=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ll===i&&(ll=null);for(var u=0;u<i.length;u+=3){var c=i[u],d=i[u+1],m=i[u+2];if(typeof d!="function"){if(Eh(d||c)===null)continue;break}var b=Ci(c);b!==null&&(i.splice(u,3),u-=3,Ef(b,{pending:!0,data:m,method:c.method,action:d},d,m))}}))}function Ru(i){function u(z){return sl(z,i)}Ra!==null&&sl(Ra,i),Aa!==null&&sl(Aa,i),Ta!==null&&sl(Ta,i),Eu.forEach(u),Cu.forEach(u);for(var c=0;c<Da.length;c++){var d=Da[c];d.blockedOn===i&&(d.blockedOn=null)}for(;0<Da.length&&(c=Da[0],c.blockedOn===null);)by(c),c.blockedOn===null&&Da.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var m=c[d],b=c[d+1],S=m[bn]||null;if(typeof b=="function")S||wy(c);else if(S){var D=null;if(b&&b.hasAttribute("formAction")){if(m=b,S=b[bn]||null)D=S.formAction;else if(Eh(m)!==null)continue}else D=S.action;typeof D=="function"?c[d+1]=D:(c.splice(d,3),d-=3),wy(c)}}}function Sh(i){this._internalRoot=i}cl.prototype.render=Sh.prototype.render=function(i){var u=this._internalRoot;if(u===null)throw Error(e(409));var c=u.current,d=Fn();py(c,d,i,u,null,null)},cl.prototype.unmount=Sh.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var u=i.containerInfo;py(i.current,2,null,i,null,null),qs(),u[_i]=null}};function cl(i){this._internalRoot=i}cl.prototype.unstable_scheduleHydration=function(i){if(i){var u=zp();i={blockedOn:null,target:i,priority:u};for(var c=0;c<Da.length&&u!==0&&u<Da[c].priority;c++);Da.splice(c,0,i),c===0&&by(i)}};var _y=n.version;if(_y!=="19.1.0")throw Error(e(527,_y,"19.1.0"));q.findDOMNode=function(i){var u=i._reactInternals;if(u===void 0)throw typeof i.render=="function"?Error(e(188)):(i=Object.keys(i).join(","),Error(e(268,i)));return i=f(u),i=i!==null?h(i):null,i=i===null?null:i.stateNode,i};var mw={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fl.isDisabled&&fl.supportsFiber)try{Nn=fl.inject(mw),we=fl}catch{}}return Tu.createRoot=function(i,u){if(!a(i))throw Error(e(299));var c=!1,d="",m=zm,b=Pm,S=Um,D=null;return u!=null&&(u.unstable_strictMode===!0&&(c=!0),u.identifierPrefix!==void 0&&(d=u.identifierPrefix),u.onUncaughtError!==void 0&&(m=u.onUncaughtError),u.onCaughtError!==void 0&&(b=u.onCaughtError),u.onRecoverableError!==void 0&&(S=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(D=u.unstable_transitionCallbacks)),u=hy(i,1,!1,null,null,c,d,m,b,S,D,null),i[_i]=u.current,uh(i),new Sh(u)},Tu.hydrateRoot=function(i,u,c){if(!a(i))throw Error(e(299));var d=!1,m="",b=zm,S=Pm,D=Um,z=null,Q=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(b=c.onUncaughtError),c.onCaughtError!==void 0&&(S=c.onCaughtError),c.onRecoverableError!==void 0&&(D=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(z=c.unstable_transitionCallbacks),c.formState!==void 0&&(Q=c.formState)),u=hy(i,1,!0,u,c??null,d,m,b,S,D,z,Q),u.context=dy(null),c=u.current,d=Fn(),d=vc(d),m=ha(d),m.callback=null,da(c,m,d),c=d,u.current.lanes=c,Xn(u,c),_r(u),i[_i]=u.current,uh(i),new cl(u)},Tu.version="19.1.0",Tu}var ky;function Aw(){if(ky)return Th.exports;ky=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(n){console.error(n)}}return r(),Th.exports=Rw(),Th.exports}var Tw=Aw();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var L0=function(r,n){return(L0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(r,n)};function dr(r,n){function t(){this.constructor=r}L0(r,n),r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function wt(r,n,t,e){return new(t||(t=Promise))(function(a,o){function l(h){try{f(e.next(h))}catch(p){o(p)}}function s(h){try{f(e.throw(h))}catch(p){o(p)}}function f(h){h.done?a(h.value):new t(function(p){p(h.value)}).then(l,s)}f((e=e.apply(r,[])).next())})}function _t(r,n){var t,e,a,o,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(f){return function(h){return function(p){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,e&&(a=2&p[0]?e.return:p[0]?e.throw||((a=e.return)&&a.call(e),0):e.next)&&!(a=a.call(e,p[1])).done)return a;switch(e=0,a&&(p=[2&p[0],a.value]),p[0]){case 0:case 1:a=p;break;case 4:return l.label++,{value:p[1],done:!1};case 5:l.label++,e=p[1],p=[0];continue;case 7:p=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){l=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){l.label=p[1];break}if(p[0]===6&&l.label<a[1]){l.label=a[1],a=p;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(p);break}a[2]&&l.ops.pop(),l.trys.pop();continue}p=n.call(r,l)}catch(v){p=[6,v],e=0}finally{t=a=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([f,h])}}}var Dw=function(){function r(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(n,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},r.prototype.registerFlag=function(n,t,e){if(this.flagRegistry[n]={evaluationFn:t,setHook:e},this.urlFlags[n]!=null){var a=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+a+"."),this.set(n,a)}},r.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},r.prototype.getNumber=function(n){return this.get(n)},r.prototype.getBool=function(n){return this.get(n)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(n,t){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(t)},r.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},r.prototype.setFlags=function(n){this.flags=Object.assign({},n)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,e,a=(t=this.global.location.search,e={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var l=[],s=1;s<arguments.length;s++)l[s-1]=arguments[s];return Nw(e,l[0],l[1]),l.join("=")}),e);"tfjsflags"in a&&a.tfjsflags.split(",").forEach(function(o){var l=o.split(":"),s=l[0],f=l[1];n.urlFlags[s]=function(h,p){if((p=p.toLowerCase())==="true"||p==="false")return p==="true";if(""+ +p===p)return+p;throw new Error("Could not parse value flag value "+p+" for flag "+h+".")}(s,f)})}},r}();function Nw(r,n,t){r[decodeURIComponent(n)]=decodeURIComponent(t||"")}function ut(){return z0}var z0=null,Al=new Map,od=new Map;function P0(r,n){var t=H0(r,n);return Al.get(t)}function Mw(r){return od.get(r)}function Oy(r){for(var n=Al.entries(),t=[];;){var e=n.next(),a=e.done,o=e.value;if(a)break;var l=o[0],s=o[1];l.split("_")[0]===r&&t.push(s)}return t}function U0(r){var n=r.kernelName,t=r.backendName,e=H0(n,t);if(Al.has(e))throw new Error("The kernel '"+n+"' for backend '"+t+"' is already registered");Al.set(e,r)}function kw(r){var n=r.kernelName;od.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),od.set(n,r)}function H0(r,n){return n+"_"+r}function ud(r,n,t){return Math.max(r,Math.min(n,t))}function V0(r){return r%2==0?r:r+1}function Ow(r){for(var n=0,t=0;t<r.length;t++)n+=r[t];return n}function O(r,n){if(!r)throw new Error(typeof n=="string"?n:n())}function te(r,n,t){t===void 0&&(t=""),O(Ye(r,n),function(){return t+" Shapes "+r+" and "+n+" must match"})}function To(r){O(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Eo(r,n,t){if(n===void 0&&(n=[]),t===void 0&&(t=!1),n==null&&(n=[]),Array.isArray(r)||Dr(r)&&!t)for(var e=0;e<r.length;++e)Eo(r[e],n,t);else n.push(r);return n}function Et(r){if(r.length===0)return 1;for(var n=r[0],t=1;t<r.length;t++)n*=r[t];return n}function Ye(r,n){if(r===n)return!0;if(r==null||n==null||r.length!==n.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==n[t])return!1;return!0}function Te(r){return r%1==0}function Iw(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var n=Math.exp(2*r);return(n-1)/(n+1)}function sd(r){var n=Math.ceil(Math.sqrt(r));return[n,Math.ceil(r/n)]}function mo(r,n){return n<=r.length?r:r+" ".repeat(n-r.length)}function Iy(r,n,t){return n===void 0&&(n=function(e){return 0}),new Promise(function(e,a){var o=0,l=function(){if(r())e();else{o++;var s=n(o);t!=null&&o>=t?a():setTimeout(l,s)}};l()})}function Bw(r,n){for(var t=1,e=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(e!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+e+" and dim "+a);e=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(e===-1){if(n>0&&n!==t)throw Error("Size("+n+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(n%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+t);var o=r.slice();return o[e]=n/t,o}function Pe(r,n){var t=n.length;return O((r=r==null?n.map(function(e,a){return a}):[].concat(r)).every(function(e){return e>=-t&&e<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),O(r.every(function(e){return Te(e)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(e){return e<0?t+e:e})}function fi(r,n){for(var t=[],e=[],a=n!=null&&Array.isArray(n)&&n.length===0,o=n==null||a?null:Pe(n,r).sort(),l=0,s=0;s<r.length;++s){if(o!=null){if(o[l]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(o[l]==null||o[l]>s)&&r[s]===1&&(t.push(r[s]),e.push(s)),o[l]<=s&&l++}r[s]!==1&&(t.push(r[s]),e.push(s))}return{newShape:t,keptDims:e}}function Lu(r,n){var t=null;if(r==null||r==="float32")t=new Float32Array(n);else if(r==="int32")t=new Int32Array(n);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(n)}return t}function Tl(r,n){var t=null;if(r==null||r==="float32")t=new Float32Array(n);else if(r==="int32")t=new Int32Array(n);else if(r==="bool")t=new Uint8Array(n);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(n)}return t}function Fw(r,n){for(var t=0;t<r.length;t++){var e=r[t];if(isNaN(e)||!isFinite(e))throw Error("A tensor of type "+n+" being uploaded contains "+e+".")}}function Lw(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function zw(r,n){return n!=="complex64"&&(n!=="float32"||r==="complex64")&&(n!=="int32"||r==="float32"||r==="complex64")&&(n!=="bool"||r!=="bool")}function Dr(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function W0(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Pw(r){if(r==null)return 0;var n=0;return r.forEach(function(t){return n+=t.length}),n}function Md(r){return typeof r=="string"||r instanceof String}function Uw(r){return typeof r=="boolean"}function Hw(r){return typeof r=="number"}function qu(r){return Array.isArray(r)?qu(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Hw(r)?"float32":Md(r)?"string":Uw(r)?"bool":"float32"}function ld(r){return!!(r&&r.constructor&&r.call&&r.apply)}function cd(r,n){for(var t=n;t<r;++t)if(r%t==0)return t;return r}function Nr(r){var n=r.length;if(n<2)return[];var t=new Array(n-1);t[n-2]=r[n-1];for(var e=n-3;e>=0;--e)t[e]=t[e+1]*r[e+1];return t}function G0(r,n,t){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Eo(r)),t&&Fw(r,n),function(o,l){return o instanceof Float32Array&&l==="float32"||o instanceof Int32Array&&l==="int32"||o instanceof Uint8Array&&l==="bool"}(r,n))return r;if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool"){for(var e=new Uint8Array(r.length),a=0;a<e.length;++a)Math.round(r[a])!==0&&(e[a]=1);return e}throw new Error("Unknown data type "+n)}function By(r,n){if(r.length===0)return n[0];var t=r.reduce(function(e,a){return e*a});if(t===0)return[];if(t!==n.length)throw new Error("["+r+"] does not match the input size.");return function e(a,o,l){var s=new Array;if(o.length===1)for(var f=o[0],h=0;h<f;h++)s[h]=l[a+h];else{f=o[0];var p=o.slice(1),v=p.reduce(function(g,y){return g*y});for(h=0;h<f;h++)s[h]=e(a+h*v,p,l)}return s}(0,r,n)}function q0(r,n){for(var t=ju(r,n),e=0;e<t.length;e++)t[e]=1;return t}function ju(r,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+n)}function Sr(){return ut().platform.now()}function j0(r){r.forEach(function(n){O(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function Vw(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",ut().platform.encode(r,n)}function Dl(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",ut().platform.decode(r,n)}function Fy(r,n,t){if(n===0)return 0;if(n===1)return r[0];for(var e=r[r.length-1],a=0;a<r.length-1;++a)e+=t[a]*r[a];return e}function Ww(r,n,t){if(n===0)return[];if(n===1)return[r];for(var e=new Array(n),a=0;a<e.length-1;++a)e[a]=Math.floor(r/t[a]),r-=e[a]*t[a];return e[e.length-1]=r,e}var Gw=function(){function r(n,t){this.backendTimer=n,this.logger=t,t==null&&(this.logger=new qw)}return r.prototype.profileKernel=function(n,t,e){var a,o=this,l=this.backendTimer.time(function(){a=e()});return a.forEach(function(s){s.data().then(function(f){(function(h,p,v){if(p!=="float32")return!1;for(var g=0;g<h.length;g++){var y=h[g];if(isNaN(y)||!isFinite(y))return console.warn("Found "+y+" in the result of '"+v+"'"),!0}})(f,s.dtype,n),l.then(function(h){var p="";h.getExtraProfileInfo!=null&&(p=h.getExtraProfileInfo()),o.logger.logKernelProfile(n,s,f,h.kernelMs,t,p)})})}),a},r}(),qw=function(){function r(){}return r.prototype.logKernelProfile=function(n,t,e,a,o,l){var s=typeof a=="number"?mo(a+"ms",9):a.error,f=mo(n,25),h=t.rank,p=t.size,v=mo(t.shape.toString(),14),g="";for(var y in o){var x=o[y].shape||t.shape,w=x.length;g+=y+": "+w+"D "+(w>0?x:"")+" "}console.log("%c"+f+"	%c"+s+"	%c"+h+"D "+v+"	%c"+p+"	%c"+g+"	%c"+l,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),Ly=20,Du=3,kh=7;function jw(r,n,t,e){var a=Nr(n),o=function(h,p,v,g){var y=Et(p),x=g[g.length-1],w=new Array(x).fill(0),_=p.length,E=v==="complex64"?Mu(h):h;if(_>1)for(var R=0;R<y/x;R++)for(var A=R*x,C=0;C<x;C++)w[C]=Math.max(w[C],Nu(E[A+C],0,v).length);return w}(r,n,t,a),l=n.length,s=function h(p,v,g,y,x,w){w===void 0&&(w=!0);var _=g==="complex64"?2:1,E=v[0],R=v.length;if(R===0)return g==="complex64"?[Nu(Mu(p)[0],0,g)]:g==="bool"?[X0(p[0])]:[p[0].toString()];if(R===1){if(E>Ly){var A=Du*_,C=Array.from(p.slice(0,A)),T=Array.from(p.slice((E-Du)*_,E*_));return g==="complex64"&&(C=Mu(C),T=Mu(T)),["["+C.map(function(tt,P){return Nu(tt,x[P],g)}).join(", ")+", ..., "+T.map(function(tt,P){return Nu(tt,x[E-Du+P],g)}).join(", ")+"]"]}return["["+(g==="complex64"?Mu(p):Array.from(p)).map(function(tt,P){return Nu(tt,x[P],g)}).join(", ")+"]"]}var N=v.slice(1),L=y.slice(1),B=y[0]*_,I=[];if(E>Ly){for(var F=0;F<Du;F++){var W=(U=F*B)+B;I.push.apply(I,h(p.slice(U,W),N,g,L,x,!1))}for(I.push("..."),F=E-Du;F<E;F++)W=(U=F*B)+B,I.push.apply(I,h(p.slice(U,W),N,g,L,x,F===E-1))}else for(F=0;F<E;F++){var U;W=(U=F*B)+B,I.push.apply(I,h(p.slice(U,W),N,g,L,x,F===E-1))}var at=R===2?",":"";for(I[0]="["+I[0]+at,F=1;F<I.length-1;F++)I[F]=" "+I[F]+at;var nt=`,
`;for(F=2;F<R;F++)nt+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(w?"":nt),I}(r,n,t,a,o),f=["Tensor"];return e&&(f.push("  dtype: "+t),f.push("  rank: "+l),f.push("  shape: ["+n+"]"),f.push("  values:")),f.push(s.map(function(h){return"    "+h}).join(`
`)),f.join(`
`)}function Nu(r,n,t){return mo(Array.isArray(r)?parseFloat(r[0].toFixed(kh))+" + "+parseFloat(r[1].toFixed(kh))+"j":Md(r)?"'"+r+"'":t==="bool"?X0(r):parseFloat(r.toFixed(kh)).toString(),n)}function X0(r){return r===0?"false":"true"}function Mu(r){for(var n=[],t=0;t<r.length;t+=2)n.push([r[t],r[t+1]]);return n}var zu=function(){function r(n,t,e){var a=this;if(this.dtype=t,this.shape=n.slice(),this.size=Et(n),e!=null){var o=e.length;O(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+a.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=e||Tl(t,this.size),this.strides=Nr(n)}return r.prototype.set=function(n){for(var t=this,e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];e.length===0&&(e=[0]),O(e.length===this.rank,function(){return"The number of provided coordinates ("+e.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(e);this.values[o]=n},r.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length===0&&(n=[0]);for(var e=0,a=0,o=n;a<o.length;a++){var l=o[a];if(l<0||l>=this.shape[e]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}e++}for(var f=n[n.length-1],h=0;h<n.length-1;++h)f+=this.strides[h]*n[h];return this.values[f]},r.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var t=n[n.length-1],e=0;e<n.length-1;++e)t+=this.strides[e]*n[e];return t},r.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var t=new Array(this.shape.length),e=0;e<t.length-1;++e)t[e]=Math.floor(n/this.strides[e]),n-=t[e]*this.strides[e];return t[t.length-1]=n,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return Rr().makeTensor(this.values,this.shape,this.dtype)},r}(),Rr=null,et=null,K0=null,ye=function(){function r(n,t,e,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=Et(n),this.strides=Nr(n),this.dataId=e,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},r.prototype.as3D=function(n,t,e){return this.throwIfDisposed(),this.reshape([n,t,e])},r.prototype.as4D=function(n,t,e,a){return this.throwIfDisposed(),this.reshape([n,t,e,a])},r.prototype.as5D=function(n,t,e,a,o){return this.throwIfDisposed(),this.reshape([n,t,e,a,o])},r.prototype.asType=function(n){return this.throwIfDisposed(),et.cast(this,n)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return wt(this,void 0,void 0,function(){var n;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,et.buffer(this.shape,this.dtype,n)]}})})},r.prototype.bufferSync=function(){return et.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return wt(this,void 0,void 0,function(){var n;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,By(this.shape,n)]}})})},r.prototype.arraySync=function(){return By(this.shape,this.dataSync())},r.prototype.data=function(){return wt(this,void 0,void 0,function(){var n,t;return _t(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),n=Rr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:t=e.sent();try{return[2,t.map(function(a){return Dl(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}e.label=2;case 2:return[2,n]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var n=Rr().readSync(this.dataId);if(this.dtype==="string")try{return n.map(function(t){return Dl(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},r.prototype.bytes=function(){return wt(this,void 0,void 0,function(){var n;return _t(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Rr().read(this.dataId)];case 1:return n=t.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(Rr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(n){return n===void 0&&(n=!1),et.print(this,n)},r.prototype.reshape=function(n){return this.throwIfDisposed(),et.reshape(this,n)},r.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},r.prototype.expandDims=function(n){return n===void 0&&(n=0),et.expandDims(this,n)},r.prototype.cumsum=function(n,t,e){return n===void 0&&(n=0),t===void 0&&(t=!1),e===void 0&&(e=!1),et.cumsum(this,n,t,e)},r.prototype.squeeze=function(n){return this.throwIfDisposed(),et.squeeze(this,n)},r.prototype.clone=function(){return this.throwIfDisposed(),et.clone(this)},r.prototype.oneHot=function(n,t,e){return this.throwIfDisposed(),et.oneHot(this,n,t,e)},r.prototype.toString=function(n){return n===void 0&&(n=!1),jw(this.dataSync(),this.shape,this.dtype,n)},r.prototype.tile=function(n){return this.throwIfDisposed(),et.tile(this,n)},r.prototype.gather=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),et.gather(this,n,t)},r.prototype.matMul=function(n,t,e){return t===void 0&&(t=!1),e===void 0&&(e=!1),this.throwIfDisposed(),et.matMul(this,n,t,e)},r.prototype.dot=function(n){return this.throwIfDisposed(),et.dot(this,n)},r.prototype.norm=function(n,t,e){return n===void 0&&(n="euclidean"),t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),et.norm(this,n,t,e)},r.prototype.slice=function(n,t){return this.throwIfDisposed(),et.slice(this,n,t)},r.prototype.reverse=function(n){return this.throwIfDisposed(),et.reverse(this,n)},r.prototype.concat=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),n instanceof r&&(n=[n]),et.concat([this].concat(n),t)},r.prototype.split=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),et.split(this,n,t)},r.prototype.stack=function(n,t){return t===void 0&&(t=0),et.stack([this,n],t)},r.prototype.unstack=function(n){return n===void 0&&(n=0),et.unstack(this,n)},r.prototype.pad=function(n,t){return t===void 0&&(t=0),et.pad(this,n,t)},r.prototype.batchNormalization=function(n,t,e,a,o){return e===void 0&&(e=.001),K0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,o,a,e)},r.prototype.batchNorm=function(n,t,e,a,o){return o===void 0&&(o=.001),this.throwIfDisposed(),et.batchNorm(this,n,t,e,a,o)},r.prototype.all=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.all(this,n,t)},r.prototype.any=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.any(this,n,t)},r.prototype.logSumExp=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.logSumExp(this,n,t)},r.prototype.sum=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.sum(this,n,t)},r.prototype.prod=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.prod(this,n,t)},r.prototype.mean=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.mean(this,n,t)},r.prototype.min=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.min(this,n,t)},r.prototype.max=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),et.max(this,n,t)},r.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),et.argMin(this,n)},r.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),et.argMax(this,n)},r.prototype.cast=function(n){return this.throwIfDisposed(),et.cast(this,n)},r.prototype.add=function(n){return this.throwIfDisposed(),et.add(this,n)},r.prototype.addStrict=function(n){return this.throwIfDisposed(),et.addStrict(this,n)},r.prototype.atan2=function(n){return this.throwIfDisposed(),et.atan2(this,n)},r.prototype.sub=function(n){return this.throwIfDisposed(),et.sub(this,n)},r.prototype.subStrict=function(n){return this.throwIfDisposed(),et.subStrict(this,n)},r.prototype.pow=function(n){return this.throwIfDisposed(),et.pow(this,n)},r.prototype.powStrict=function(n){return this.throwIfDisposed(),et.powStrict(this,n)},r.prototype.mul=function(n){return this.throwIfDisposed(),et.mul(this,n)},r.prototype.mulStrict=function(n){return this.throwIfDisposed(),et.mulStrict(this,n)},r.prototype.div=function(n){return this.throwIfDisposed(),et.div(this,n)},r.prototype.divNoNan=function(n){return this.throwIfDisposed(),et.divNoNan(this,n)},r.prototype.floorDiv=function(n){return this.throwIfDisposed(),et.floorDiv(this,n)},r.prototype.divStrict=function(n){return this.throwIfDisposed(),et.divStrict(this,n)},r.prototype.minimum=function(n){return this.throwIfDisposed(),et.minimum(this,n)},r.prototype.minimumStrict=function(n){return this.throwIfDisposed(),et.minimumStrict(this,n)},r.prototype.maximum=function(n){return this.throwIfDisposed(),et.maximum(this,n)},r.prototype.maximumStrict=function(n){return this.throwIfDisposed(),et.maximumStrict(this,n)},r.prototype.mod=function(n){return this.throwIfDisposed(),et.mod(this,n)},r.prototype.modStrict=function(n){return this.throwIfDisposed(),et.modStrict(this,n)},r.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),et.squaredDifferenceStrict(this,n)},r.prototype.transpose=function(n){return this.throwIfDisposed(),et.transpose(this,n)},r.prototype.notEqual=function(n){return this.throwIfDisposed(),et.notEqual(this,n)},r.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),et.notEqualStrict(this,n)},r.prototype.less=function(n){return this.throwIfDisposed(),et.less(this,n)},r.prototype.lessStrict=function(n){return this.throwIfDisposed(),et.lessStrict(this,n)},r.prototype.equal=function(n){return this.throwIfDisposed(),et.equal(this,n)},r.prototype.equalStrict=function(n){return this.throwIfDisposed(),et.equalStrict(this,n)},r.prototype.lessEqual=function(n){return this.throwIfDisposed(),et.lessEqual(this,n)},r.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),et.lessEqualStrict(this,n)},r.prototype.greater=function(n){return this.throwIfDisposed(),et.greater(this,n)},r.prototype.greaterStrict=function(n){return this.throwIfDisposed(),et.greaterStrict(this,n)},r.prototype.greaterEqual=function(n){return this.throwIfDisposed(),et.greaterEqual(this,n)},r.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),et.greaterEqualStrict(this,n)},r.prototype.logicalAnd=function(n){return this.throwIfDisposed(),et.logicalAnd(this,n)},r.prototype.logicalOr=function(n){return this.throwIfDisposed(),et.logicalOr(this,n)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),et.logicalNot(this)},r.prototype.logicalXor=function(n){return this.throwIfDisposed(),et.logicalXor(this,n)},r.prototype.where=function(n,t){return this.throwIfDisposed(),et.where(n,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),et.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),et.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),et.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),et.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),et.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),et.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),et.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),et.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),et.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),et.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),et.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),et.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),et.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),et.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),et.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),et.abs(this)},r.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),et.clipByValue(this,n,t)},r.prototype.relu=function(){return this.throwIfDisposed(),et.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),et.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),et.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),et.selu(this)},r.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),et.leakyRelu(this,n)},r.prototype.prelu=function(n){return this.throwIfDisposed(),et.prelu(this,n)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),et.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),et.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),et.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),et.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),et.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),et.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),et.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),et.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),et.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),et.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),et.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),et.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),et.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),et.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),et.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),et.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),et.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),et.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),et.round(this)},r.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),et.step(this,n)},r.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),et.softmax(this,n)},r.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),et.logSoftmax(this,n)},r.prototype.resizeBilinear=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),et.image.resizeBilinear(this,n,t)},r.prototype.resizeNearestNeighbor=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),et.image.resizeNearestNeighbor(this,n,t)},r.prototype.conv1d=function(n,t,e,a,o,l){return a===void 0&&(a="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),et.conv1d(this,n,t,e,a,o,l)},r.prototype.conv2d=function(n,t,e,a,o,l){return a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),et.conv2d(this,n,t,e,a,o,l)},r.prototype.conv2dTranspose=function(n,t,e,a,o){return this.throwIfDisposed(),et.conv2dTranspose(this,n,t,e,a,o)},r.prototype.depthwiseConv2D=function(n,t,e,a,o,l){return a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),et.depthwiseConv2d(this,n,t,e,a,o,l)},r.prototype.separableConv2d=function(n,t,e,a,o,l){return o===void 0&&(o=[1,1]),l===void 0&&(l="NHWC"),this.throwIfDisposed(),et.separableConv2d(this,n,t,e,a,o,l)},r.prototype.avgPool=function(n,t,e,a){return this.throwIfDisposed(),et.avgPool(this,n,t,e,a)},r.prototype.maxPool=function(n,t,e,a){return this.throwIfDisposed(),et.maxPool(this,n,t,e,a)},r.prototype.localResponseNormalization=function(n,t,e,a){return n===void 0&&(n=5),t===void 0&&(t=1),e===void 0&&(e=1),a===void 0&&(a=.5),et.localResponseNormalization(this,n,t,e,a)},r.prototype.pool=function(n,t,e,a,o){return this.throwIfDisposed(),et.pool(this,n,t,e,a,o)},r.prototype.variable=function(n,t,e){return n===void 0&&(n=!0),this.throwIfDisposed(),Rr().makeVariable(this,n,t,e)},r.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),et.unsortedSegmentSum(this,n,t)},r.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),et.batchToSpaceND(this,n,t)},r.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),et.spaceToBatchND(this,n,t)},r.prototype.topk=function(n,t){return n===void 0&&(n=1),t===void 0&&(t=!0),this.throwIfDisposed(),et.topk(this,n,t)},r.prototype.stridedSlice=function(n,t,e,a,o,l,s,f){return a===void 0&&(a=0),o===void 0&&(o=0),l===void 0&&(l=0),s===void 0&&(s=0),f===void 0&&(f=0),this.throwIfDisposed(),et.stridedSlice(this,n,t,e,a,o,l,s,f)},r.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),et.depthToSpace(this,n,t)},r.prototype.fft=function(){return this.throwIfDisposed(),et.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),et.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),et.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),et.spectral.irfft(this)},r}();Object.defineProperty(ye,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var zy,fd,hd,dd,pd,Co=function(r){function n(t,e,a,o){var l=r.call(this,t.shape,t.dtype,t.dataId,o)||this;return l.trainable=e,l.name=a,l}return dr(n,r),n.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Ye(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Rr().disposeTensor(this),this.dataId=t.dataId,Rr().incRef(this,null)},n.prototype.dispose=function(){Rr().disposeVariable(this),this.isDisposedInternal=!0},n}(ye);Object.defineProperty(Co,Symbol.hasInstance,{value:function(r){return r instanceof ye&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(zy||(zy={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(fd||(fd={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(hd||(hd={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(dd||(dd={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(pd||(pd={}));var Xw={float32:dd,int32:fd,bool:hd,complex64:pd};function en(r,n){if(r==="string"||n==="string"){if(r==="string"&&n==="string")return"string";throw new Error("Can not upcast "+r+" with "+n)}return Xw[r][n]}function Oh(r){return en(r,"int32")}function xe(r,n){if(r.dtype===n.dtype)return[r,n];var t=en(r.dtype,n.dtype);return[r.cast(t),n.cast(t)]}function Kw(r,n){O(r.dtype===n.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+n.dtype+") input must match"})}function Y0(r){var n=[];return function t(e,a,o){if(e!=null){if(e instanceof ye)return void a.push(e);if(l=e,!(!Array.isArray(l)&&typeof l!="object")){var l,s=e;for(var f in s){var h=s[f];o.has(h)||(o.add(h),t(h,a,o))}}}}(r,n,new Set),n}var Ih,Py=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},r}(),Yw=function(){function r(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Py}return r.prototype.ready=function(){return wt(this,void 0,void 0,function(){var n,t,e;return _t(this,function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),t=0,a.label=1;case 1:return t<n.length?(e=n[t],[4,this.initializeBackend(e).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(e)]:[3,4];case 3:return a.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},r.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},r.prototype.registerBackend=function(n,t,e){return e===void 0&&(e=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:e},!0)},r.prototype.setBackend=function(n){return wt(this,void 0,void 0,function(){var t,e,a;return _t(this,function(o){switch(o.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),e=t.success,t.asyncInit?[4,e]:[3,2]);case 1:return a=o.sent(),[3,3];case 2:a=e,o.label=3;case 3:if(!a)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new Gw(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var n=this;Oy(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(n.backendInstance)})},r.prototype.disposeRegisteredKernels=function(n){var t=this;Oy(n).forEach(function(e){e.disposeFunc!=null&&e.disposeFunc(t.registry[n])})},r.prototype.initializeBackend=function(n){var t=this,e=this.registryFactory[n];if(e==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var a=e.factory();if(Promise.resolve(a)===a){var o=++this.pendingBackendInitId,l=a.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[n]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=l,{success:l,asyncInit:!0}}return this.registry[n]=a,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,e){return n.registryFactory[e].priority-n.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var e=n[t],a=this.initializeBackend(e),o=a.success,l=a.asyncInit;if(l||o)return{name:e,asyncInit:l}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(n,t){var e=this.state.tensorInfo.get(t),a=e.backend,o=this.readSync(t);a.disposeData(t),e.backend=n,n.move(t,o,e.shape,e.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(n,t){var e,a=this,o=null;if(t==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");t=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=n}return this.scopedRun(function(){return a.startScope(o)},function(){return a.endScope(e)},function(){return(e=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),e})},r.prototype.scopedRun=function(n,t,e){n();try{var a=e();return t(),a}catch(o){throw t(),o}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),e={x:n};return this.addTapeNode(this.state.activeScope.name,e,[t],function(a){return{x:function(){return a.toFloat()}}},[]),t},r.prototype.runKernel=function(n,t,e,a,o){return this.runKernelFunc(null,t,null,n,e,a,o)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(n,t,e){var a=this.backend.numDataIds(),o=0;e.forEach(function(f){o+=f.dtype==="complex64"?3:1});var l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-o-l;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},r.prototype.runKernelFunc=function(n,t,e,a,o,l,s){var f,h=this;l===void 0&&(l=[]),s===void 0&&(s=[]);var p=[],v=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var g,y=function(R){v&&(p=R.map(function(A){return h.keep(h.clone(A))}))},x=this.state.numBytes,w=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var _,E=P0(a,this.backendName);return g=E!=null?function(){var R=h.backend.numDataIds();_=E.kernelFunc({inputs:t,attrs:o,backend:h.backend});var A=Array.isArray(_)?_:[_];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,A);var C=A.map(function(N){var L=N.dataId,B=N.shape,I=N.dtype;return h.makeTensorFromDataId(L,B,I)}),T=C.filter(function(N,L){return s[L]});return y((l||[]).slice().concat(T)),C}:function(){var R=h.backend.numDataIds();_=h.tidy(function(){return n(h.backend,y)});var A=Array.isArray(_)?_:[_];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,A),A},this.scopedRun(function(){return h.state.kernelDepth++},function(){return h.state.kernelDepth--},function(){f=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(a,t,function(){return g()}):g()}),v&&this.addTapeNode(a,t,f,e,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-x,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-w,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(R){return t[R].shape}),outputShapes:f.map(function(R){return R.shape})}),Array.isArray(_)?f:f[0]},r.prototype.makeTensor=function(n,t,e,a){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");e=e||"float32",a=a||this.backend;var o=n;e==="string"&&Md(n[0])&&(o=n.map(function(p){return Vw(p)}));var l=a.write(o,t,e),s=new ye(t,e,l,this.nextTensorId());if(this.incRef(s,a),e==="string"){var f=this.state.tensorInfo.get(l),h=Pw(o);this.state.numBytes+=h-f.bytes,f.bytes=h}return s},r.prototype.makeTensorFromDataId=function(n,t,e,a){var o=new ye(t,e=e||"float32",n,this.nextTensorId());return this.incRef(o,a),o},r.prototype.makeVariable=function(n,t,e,a){t===void 0&&(t=!0),e=e||this.nextVariableId().toString(),a!=null&&a!==n.dtype&&(n=n.asType(a));var o=new Co(n,t,e,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},r.prototype.incRef=function(n,t){var e=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,e===0){this.state.numDataBuffers++;var a=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(a=n.size*W0(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Co||this.track(n)},r.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var t=this.state.registeredVariables[n];this.disposeVariable(t)}},r.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},r.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},r.prototype.profile=function(n){return wt(this,void 0,void 0,function(){var t,e;return _t(this,function(a){return this.state.profiling=!0,t=this.state.numBytes,e=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-e,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(n,t,e,a,o){var l=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:e,saved:o},f=Mw(n);f!=null&&(a=f.gradFunc),a!=null&&(s.gradient=function(h){return h=h.map(function(p,v){if(p==null){var g=e[v],y=ju(g.size,g.dtype);return l.makeTensor(y,g.shape,g.dtype)}return p}),a(h.length>1?h:h[0],o)}),this.state.activeTape.push(s)},r.prototype.keep=function(n){return n.kept=!0,n},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(n){for(var t=this,e=Y0(n),a=new Set(e.map(function(f){return f.id})),o=0;o<this.state.activeScope.track.length;o++){var l=this.state.activeScope.track[o];l.kept||a.has(l.id)||l.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(function(f){f.kept||f.scopeId!==s.id||t.track(f)})},r.prototype.gradients=function(n,t,e,a){var o=this;if(a===void 0&&(a=!1),O(t.length>0,function(){return"gradients() received an empty list of xs."}),e!=null&&e.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+e.dtype+"'");var l=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",n)});O(l instanceof ye,function(){return"The result y returned by f() must be a tensor."});var s=function(f,h,p){for(var v={},g={},y=0;y<h.length;y++)v[h[y].id]=!0;for(y=0;y<f.length;y++){var x=(N=f[y]).inputs;for(var w in x){for(var _=x[w],E=!1,R=0;R<h.length;R++)if(v[_.id]){N.outputs.forEach(function(F){return v[F.id]=!0}),E=!0,g[N.id]=!0;break}if(E)break}}var A={};A[p.id]=!0;var C={};for(y=f.length-1;y>=0;y--)for(x=(N=f[y]).inputs,R=0;R<N.outputs.length;R++)if(A[N.outputs[R].id]){for(var w in x)A[x[w].id]=!0,C[N.id]=!0;break}var T=[];for(y=0;y<f.length;y++){var N;if(g[(N=f[y]).id]&&C[N.id]){var L={};for(var w in N.inputs){var B=N.inputs[w];v[B.id]&&(L[w]=B)}var I=Object.assign({},N);I.inputs=L,I.outputs=N.outputs,T.push(I)}}return T}(this.state.activeTape,t,l);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var f,h,p={};p[l.id]=e??(f=l.shape,h=q0(Et(f),"float32"),G.makeTensor(h,f,"float32")),function(g,y,x){for(var w=function(E){var R=y[E],A=[];if(R.outputs.forEach(function(L){var B=g[L.id];B!=null?A.push(B):A.push(null)}),R.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+R.kernelName+".");var C=R.gradient(A),T=function(L){if(!(L in C))throw new Error("Cannot backprop through input "+L+". Available gradients found: "+Object.keys(C)+".");var B=x(function(){return C[L]()});if(B.dtype!=="float32")throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input "+L+" must have 'float32' dtype, but has '"+B.dtype+"'");var I=R.inputs[L];if(!Ye(B.shape,I.shape))throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input '"+L+"' has shape '"+B.shape+"', which does not match the shape of the input '"+I.shape+"'");if(g[I.id]==null)g[I.id]=B;else{var F=g[I.id];g[I.id]=F.add(B),F.dispose()}};for(var N in R.inputs)T(N)},_=y.length-1;_>=0;_--)w(_)}(p,s,function(g){return o.tidy(g)});var v=t.map(function(g){return p[g.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(g){for(var y=0,x=g.saved;y<x.length;y++)x[y].dispose()}),o.state.activeTape=null),{value:l,grads:v}})},r.prototype.customGrad=function(n){var t=this;return O(ld(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var e,a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];O(a.every(function(s){return s instanceof ye}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var l={};return a.forEach(function(s,f){l[f]=s}),t.runKernelFunc(function(s,f){return O((e=n.apply(void 0,a.concat([f]))).value instanceof ye,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),O(ld(e.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),e.value},l,function(s,f){var h=e.gradFunc(s,f),p=Array.isArray(h)?h:[h];O(p.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),O(p.every(function(g){return g instanceof ye}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var v={};return p.forEach(function(g,y){v[y]=function(){return g}}),v})}},r.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},r.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},r.prototype.time=function(n){return wt(this,void 0,void 0,function(){var t,e;return _t(this,function(a){switch(a.label){case 0:return t=Sr(),[4,this.backend.time(n)];case 1:return(e=a.sent()).wallMs=Sr()-t,[2,e]}})})},r.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Py,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),G=function(){var r=function(){if(Ih==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Ih=t}return Ih}();if(r._tfengine==null){var n=new Dw(r);r._tfengine=new Yw(n)}return function(t){z0=t}(r._tfengine.ENV),Rr=function(){return r._tfengine},r._tfengine}();function Q0(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var $r=ut();$r.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$r.registerFlag("IS_BROWSER",function(){return Q0()}),$r.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),$r.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$r.registerFlag("PROD",function(){return!1}),$r.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $r.getBool("DEBUG")}),$r.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$r.registerFlag("IS_TEST",function(){return!1});var Pu,Un,Pn,li={},Bh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Qw(r,n){li[r]=n}function Br(r){r in li||(li[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",function(a){a.preventDefault(),delete li[t]},!1),t===1?e.getContext("webgl",Bh)||e.getContext("experimental-webgl",Bh):e.getContext("webgl2",Bh)}(r));var n=li[r];return n.isContextLost()?(delete li[r],Br(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),li[r])}function Ql(r,n){return[n,r]}function Iu(r){var n=Et(r);return sd(Math.ceil(n/4))}function Xu(r,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(r/2))]}function kd(r,n){var t,e,a,o,l,s,f,h,p,v=r;return ut().getNumber("WEBGL_VERSION")===2?(t=v.R32F,e=v.R16F,a=v.RGBA16F,o=v.RGBA32F,l=v.RED,s=4,f=1,h=v.HALF_FLOAT,p=v.FLOAT):(t=r.RGBA,e=r.RGBA,a=r.RGBA,o=v.RGBA,l=r.RGBA,s=4,f=4,h=n!=null?n.HALF_FLOAT_OES:null,p=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:e,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:l,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:f,textureTypeHalfFloat:h,textureTypeFloat:p}}function Ct(r,n,t){var e=t();return n&&function(a){var o=a.getError();if(o!==a.NO_ERROR)throw new Error("WebGL Error: "+t_(a,o))}(r),e}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Pu||(Pu={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(Un||(Un={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Pn||(Pn={}));var Zw=596e-10,Jw=65504;function $w(r){return!!(ut().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||Zw<Math.abs(r)&&Math.abs(r)<Jw)}function t_(r,n){switch(n){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function hl(r,n,t){return na(r,n,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function e_(r,n,t){var e=na(r,n,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ct(r,n,function(){return r.shaderSource(e,t)}),Ct(r,n,function(){return r.compileShader(e)}),r.getShaderParameter(e,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function n_(r,n,t){var e=na(r,n,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ct(r,n,function(){return r.shaderSource(e,t)}),Ct(r,n,function(){return r.compileShader(e)}),r.getShaderParameter(e,r.COMPILE_STATUS)===!1)throw function(a,o){var l=r_.exec(o);if(l==null)return console.log("Couldn't parse line number in error: "+o),void console.log(a);for(var s=+l[1],f=a.split(`
`),h=f.length.toString().length+2,p=f.map(function(_,E){return mo((E+1).toString(),h)+_}),v=0,g=0;g<p.length;g++)v=Math.max(p[g].length,v);var y=p.slice(0,s-1),x=p.slice(s-1,s),w=p.slice(s);console.log(y.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+mo(x[0],v),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))}(t,r.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Fh,Lh,r_=/ERROR: [0-9]+:([0-9]+):/g;function a_(r,n){return na(r,n,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function i_(r,n,t){if(Ct(r,n,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function zh(r,n,t){if(Ct(r,n,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function o_(r,n,t){var e=na(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Ct(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,e)}),Ct(r,n,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),e}function u_(r,n,t){var e=na(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Ct(r,n,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e)}),Ct(r,n,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),e}function s_(r,n){return na(r,n,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function l_(r,n){var t=ut().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||n<=0){var e="["+r+"x"+n+"]";throw new Error("Requested texture size "+e+" is invalid.")}if(r>t||n>t)throw e="["+r+"x"+n+"]",new Error("Requested texture size "+e+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function c_(r,n){return na(r,n,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Uy(r,n,t,e,a,o,l,s){var f=r.getAttribLocation(t,e);return f!==-1&&(Ct(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,a)}),Ct(r,n,function(){return r.vertexAttribPointer(f,o,r.FLOAT,!1,l,s)}),Ct(r,n,function(){return r.enableVertexAttribArray(f)}),!0)}function f_(r,n,t,e){m_(r,e),Ct(r,n,function(){return r.activeTexture(r.TEXTURE0+e)}),Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function h_(r,n,t,e){return na(r,n,function(){return r.getUniformLocation(t,e)},'uniform "'+e+'" not present in program.')}function d_(r,n,t){return r.getUniformLocation(n,t)}function p_(r,n,t,e,a,o){Ct(r,n,function(){return f_(r,n,e,o)}),Ct(r,n,function(){return r.uniform1i(a,o)})}function Ph(r,n,t,e){Ct(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Ct(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function Hy(r,n,t){Ct(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Ct(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function dl(r){var n=r.checkFramebufferStatus(r.FRAMEBUFFER);if(n!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+v_(r,n))}function v_(r,n){switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function na(r,n,t,e){var a=Ct(r,n,function(){return t()});if(a==null)throw new Error(e);return a}function m_(r,n){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,e=n+r.TEXTURE0;if(e<r.TEXTURE0||e>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Nl(r,n){return n===void 0&&(n=2),Et(r.slice(0,r.length-n))}function Ml(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Uh(r){var n=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(n=[Nl(r)].concat(Ml(r))),n}function g_(r,n){var t;n===void 0&&(n=!1);var e=ut().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(e*=2,(r=r.map(function(h,p){return p>=r.length-2?V0(r[p]):r[p]})).length===1&&(r=[2,r[0]])),r.length!==2){var a=fi(r);r=a.newShape}var o=Et(r);if(r.length<=1&&o<=e)return[1,o];if(r.length===2&&r[0]<=e&&r[1]<=e)return r;if(r.length===3&&r[0]*r[1]<=e&&r[2]<=e)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=e&&r[1]*r[2]<=e)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=e&&r[3]<=e)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=e&&r[1]*r[2]*r[3]<=e)return[r[0],r[1]*r[2]*r[3]];if(n){var l=Nl(r),s=2,f=2;return r.length&&(s=(t=Ml(r))[0],f=t[1]),sd(o=l*(s/2)*(f/2)).map(function(h){return 2*h})}return sd(o)}function pl(r){return r%2==0}function vl(r,n){if(Ye(r=r.slice(-2),n=n.slice(-2))||!r.length||!n.length||r[0]===0||r[1]===0||n[0]===0||n[1]===0)return!0;if(r.length!==n.length){var t=r.slice(-1)[0],e=n.slice(-1)[0];if(t===e||pl(t)&&pl(e)&&(r[0]===1||n[0]===1))return!0}return r[1]===n[1]&&pl(r[0])&&pl(n[0])}function y_(r){if(Fh==null){var n=Br(r);Fh=n.getParameter(n.MAX_TEXTURE_SIZE)}return Fh}function b_(r){if(Lh==null){var n=Br(r);Lh=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Lh)}function x_(r){if(r===0)return 0;var n=Br(r);return ir(n,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ir(n,"EXT_disjoint_timer_query")?1:0}function ir(r,n){return r.getExtension(n)!=null}function Vy(r){try{if(Br(r)!=null)return!0}catch{return!1}return!1}function w_(r){if(r===0)return!1;var n=Br(r);if(r===1){if(!ir(n,"OES_texture_float"))return!1}else if(!ir(n,"EXT_color_buffer_float"))return!1;return vd(n)}function __(r){if(r===0)return!1;var n=Br(r);if(r!==1){if(ir(n,"EXT_color_buffer_float"))return vd(n);if(ir(n,"EXT_color_buffer_half_float")){var t=n.getExtension("EXT_color_buffer_half_float");return function(e,a){var o=kd(e,a),l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(l),e.deleteFramebuffer(s),f}(n,t)}return!1}return!!ir(n,"OES_texture_float")&&!!ir(n,"WEBGL_color_buffer_float")&&vd(n)}function vd(r){var n=kd(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var e=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var a=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(e),a}function E_(r){return r===2&&Br(r).fenceSync!=null}var kt=ut();function Z0(r){ut().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function yt(r,n){return G.tidy(r,n)}function Rn(r){Y0(r).forEach(function(n){return n.dispose()})}function C_(r){return G.keep(r)}function kl(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];ut().getBool("IS_TEST")||console.warn.apply(console,r)}function Ha(r,n){var t=r;if(Dr(r))return n==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var e=[];Array.isArray(t)||Dr(t)&&n!=="string";)e.push(t.length),t=t[0];return Array.isArray(r)&&ut().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(o,l,s){if(s=s||[],!Array.isArray(o)&&!Dr(o))return void O(l.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+l[0]+" elements"});O(l.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),O(o.length===l[0],function(){return"Element arr["+s.join("][")+"] should have "+l[0]+" elements, but has "+o.length+" elements"});for(var f=l.slice(1),h=0;h<o.length;++h)a(o[h],f,s.concat(h))}(r,e,[]),e}function Wy(r,n,t,e){if(r!=null&&(r!=="numeric"&&r!==n||r==="numeric"&&n==="string"))throw new Error("Argument '"+t+"' passed to '"+e+"' must be "+r+" tensor, but got "+n+" tensor")}function M(r,n,t,e){if(e===void 0&&(e="numeric"),r instanceof ye)return Wy(e,r.dtype,n,t),r;var a=qu(r);if(a!=="string"&&["bool","int32","float32"].indexOf(e)>=0&&(a=e),Wy(e,a,n,t),r==null||!Dr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var o=r==null?"null":r.constructor.name;throw new Error("Argument '"+n+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var l=Ha(r,a);Dr(r)||Array.isArray(r)||(r=[r]);var s=a!=="string"?G0(r,a,ut().getBool("DEBUG")):Eo(r,[],!0);return G.makeTensor(s,l,a)}function Ol(r,n,t,e){if(e===void 0&&(e="numeric"),!Array.isArray(r))throw new Error("Argument "+n+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(a,o){return M(a,n+"["+o+"]",t)},e)}function J0(r,n){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==n-1-t)return!1;return!0}function S_(r,n,t){for(var e=r.length+n.length,a=[],o=0,l=0,s=0;s<e;s++)t.indexOf(s)===-1?a.push(r[o++]):a.push(n[l++]);return a}function un(r,n){for(var t=[],e=r.length,a=0;a<e;a++)n.indexOf(a)===-1&&t.push(r[a]);return[t,n.map(function(o){return r[o]})]}function An(r,n){return S_(r,n.map(function(t){return 1}),n)}function zn(r,n,t){O(J0(n,t),function(){return r+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."})}function Fr(r,n){if(J0(r,n))return null;for(var t=[],e=0;e<n;++e)r.indexOf(e)===-1&&t.push(e);return r.forEach(function(a){return t.push(a)}),t}function Od(r){return r.map(function(n,t){return[t,n]}).sort(function(n,t){return n[1]-t[1]}).map(function(n){return n[0]})}function Lr(r,n){for(var t=[],e=n-r;e<n;++e)t.push(e);return t}function R_(r,n){var t=r[0].length;r.forEach(function(a,o){O(a.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),O(n>=0&&n<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var e=r[0];r.forEach(function(a,o){for(var l=0;l<t;l++)O(l===n||a[l]===e[l],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+a+") does not match the shape of the rest ("+e+") along the non-concatenated axis "+o+"."})})}function So(r,n){for(var t=r[0].slice(),e=1;e<r.length;e++)t[n]+=r[e][n];return t}function H(r){var n=Object.keys(r);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var t=n[0],e=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var a=function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];G.startScope(t);try{var s=e.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),G.endScope(s),s}catch(f){throw G.endScope(null),f}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}kt.registerFlag("HAS_WEBGL",function(){return kt.getNumber("WEBGL_VERSION")>0}),kt.registerFlag("WEBGL_VERSION",function(){return Vy(2)?2:Vy(1)?1:0}),kt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return kt.get("WEBGL_VERSION")===2}),kt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),kt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),kt.registerFlag("WEBGL_PACK",function(){return kt.getBool("HAS_WEBGL")}),kt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_CLIP",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),kt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_PACK_REDUCE",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_CONV_IM2COL",function(){return kt.getBool("WEBGL_PACK")}),kt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return y_(kt.getNumber("WEBGL_VERSION"))}),kt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return b_(kt.getNumber("WEBGL_VERSION"))}),kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=kt.getNumber("WEBGL_VERSION");return r===0?0:x_(r)}),kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return kt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),kt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return w_(kt.getNumber("WEBGL_VERSION"))}),kt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!kt.getBool("WEBGL_FORCE_F16_TEXTURES")&&kt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),kt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return __(kt.getNumber("WEBGL_VERSION"))}),kt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return E_(kt.getNumber("WEBGL_VERSION"))}),kt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return kt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),K0=Z0;var tn=H({complex_:function(r,n){var t=M(r,"real","complex"),e=M(n,"imag","complex");return te(t.shape,e.shape,"real and imag shapes, "+t.shape+" and "+e.shape+", must match in call to tf.complex()."),G.runKernelFunc(function(a){return a.complex(t,e)},{$real:t,$imag:e})}}),ar=H({real_:function(r){var n=M(r,"input","real");return G.runKernelFunc(function(t){return t.real(n)},{$input:n})}}),Ar=H({imag_:function(r){var n=M(r,"input","imag");return G.runKernelFunc(function(t){return t.imag(n)},{$input:n})}});function nn(r,n,t){return Va(r,n,Ha(r,t),t)}function Va(r,n,t,e){if(e==null&&(e=qu(r)),e==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Dr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){j0(n);var a=Et(n),o=Et(t);O(a===o,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+a+" values but has "+o});for(var l=0;l<t.length;++l){var s=t[l],f=l!==t.length-1||s!==Et(n.slice(l));O(t[l]===n[l]||!f,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+n+"). "})}}return Dr(r)||Array.isArray(r)||(r=[r]),n=n||t,r=e!=="string"?G0(r,e,ut().getBool("DEBUG")):Eo(r,[],!0),G.makeTensor(r,n,e)}function vt(r,n){if((Dr(r)&&n!=="string"||Array.isArray(r))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Dr(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Va(r,[],[],n)}function Me(r,n){To(r);var t=Ha(r,n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Va(r,null,t,n)}function Fa(r,n,t){if(To(r),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var e=Ha(r,t);if(e.length!==2&&e.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Va(r,n,e,t)}function Id(r,n,t){if(To(r),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var e=Ha(r,t);if(e.length!==3&&e.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Va(r,n,e,t)}function Cn(r,n,t){if(To(r),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var e=Ha(r,t);if(e.length!==4&&e.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Va(r,n,e,t)}function A_(r,n,t){if(To(r),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var e=Ha(r,t);if(e.length!==5&&e.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Va(r,n,e,t)}function T_(r,n,t){if(To(r),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var e=Ha(r,t);if(e.length!==6&&e.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Va(r,n=n||e,e,t)}function D_(r,n,t,e){return n===void 0&&(n=!0),G.makeVariable(r,n,t,e)}function Do(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=Do(r,"float32"),e=pe(r,"float32");return tn(t,e)}var a=q0(Et(r),n);return G.makeTensor(a,r,n)}function pe(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=pe(r,"float32"),e=pe(r,"float32");return tn(t,e)}var a=ju(Et(r),n);return G.makeTensor(a,r,n)}function Mr(r,n,t){return G.runKernelFunc(function(e){return e.fill(r,n,t)},{})}function N_(r,n,t){if(t<=0)throw new Error("The number of values should be positive.");return G.runKernelFunc(function(e){return e.linspace(r,n,t)},{})}function Il(r,n,t,e){if(t===void 0&&(t=1),e===void 0&&(e="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===n||r<n&&t<0||n<r&&t>1)return pe([0],e);var a=ju(Math.abs(Math.ceil((n-r)/t)),e);n<r&&t===1&&(t=-1),a[0]=r;for(var o=1;o<a.length;o++)a[o]=a[o-1]+t;return Me(a,e)}var $0=H({onesLike_:function(r){var n=M(r,"x","onesLike");if(n.dtype==="complex64"){var t=$0(ar(n)),e=Yt(Ar(n));return tn(t,e)}return G.runKernelFunc(function(a){return a.onesLike(n)},{$x:n},function(a,o){return{$x:function(){return Yt(a)}}})}}),Yt=H({zerosLike_:function(r){var n=M(r,"x","zerosLike");return G.runKernelFunc(function(t){return t.zerosLike(n)},{$x:n},function(t,e){return{$x:function(){return Yt(t)}}})}}),Be=H({concat_:function(r,n){n===void 0&&(n=0),O(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Ol(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),n=Pe(n,t[0].shape)[0];var e=So(t.map(function(s){return s.shape}),n);if(Et(e)===0)return nn([],e);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var a=t.map(function(s){return s.shape});R_(a,n);var o=t,l={axis:n};return G.runKernelFunc(function(s){return s.concat(t,n)},o,function(s){var f=a.map(function(h){return h[n]});return Bd(s,f,n).map(function(h){return function(){return h}})},"Concat",l)}}),M_=H({concat1d_:function(r){return Be(r,0)}}),k_=H({concat2d_:function(r,n){return Be(r,n)}}),O_=H({concat3d_:function(r,n){return Be(r,n)}}),I_=H({concat4d_:function(r,n){return Be(r,n)}}),Bd=H({split_:function(r,n,t){t===void 0&&(t=0);var e,a=M(r,"x","split");return t=Pe(t,a.shape)[0],typeof n=="number"?(O(a.shape[t]%n==0,function(){return"Number of splits must evenly divide the axis."}),e=new Array(n).fill(a.shape[t]/n)):(O(a.shape[t]===n.reduce(function(o,l){return o+l}),function(){return"The sum of sizes must match the size of the axis dimension."}),e=n),G.runKernelFunc(function(o){return o.split(a,e,t)},{$x:a},function(o){return{$x:function(){return Be(o,t)}}})}});function gi(r,n){return r(n={exports:{}},n.exports),n.exports}var B_=gi(function(r){(function(n,t,e){function a(s){var f,h=this,p=(f=4022871197,function(v){v=v.toString();for(var g=0;g<v.length;g++){var y=.02519603282416938*(f+=v.charCodeAt(g));y-=f=y>>>0,f=(y*=f)>>>0,f+=4294967296*(y-=f)}return 23283064365386963e-26*(f>>>0)});h.next=function(){var v=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=v-(h.c=0|v)},h.c=1,h.s0=p(" "),h.s1=p(" "),h.s2=p(" "),h.s0-=p(s),h.s0<0&&(h.s0+=1),h.s1-=p(s),h.s1<0&&(h.s1+=1),h.s2-=p(s),h.s2<0&&(h.s2+=1),p=null}function o(s,f){return f.c=s.c,f.s0=s.s0,f.s1=s.s1,f.s2=s.s2,f}function l(s,f){var h=new a(s),p=f&&f.state,v=h.next;return v.int32=function(){return 4294967296*h.next()|0},v.double=function(){return v()+11102230246251565e-32*(2097152*v()|0)},v.quick=v,p&&(typeof p=="object"&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.alea=l})(0,r)}),F_=gi(function(r){(function(n,t,e){function a(s){var f=this,h="";f.x=0,f.y=0,f.z=0,f.w=0,f.next=function(){var v=f.x^f.x<<11;return f.x=f.y,f.y=f.z,f.z=f.w,f.w^=f.w>>>19^v^v>>>8},s===(0|s)?f.x=s:h+=s;for(var p=0;p<h.length+64;p++)f.x^=0|h.charCodeAt(p),f.next()}function o(s,f){return f.x=s.x,f.y=s.y,f.z=s.z,f.w=s.w,f}function l(s,f){var h=new a(s),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.xor128=l})(0,r)}),L_=gi(function(r){(function(n,t,e){function a(s){var f=this,h="";f.next=function(){var v=f.x^f.x>>>2;return f.x=f.y,f.y=f.z,f.z=f.w,f.w=f.v,(f.d=f.d+362437|0)+(f.v=f.v^f.v<<4^v^v<<1)|0},f.x=0,f.y=0,f.z=0,f.w=0,f.v=0,s===(0|s)?f.x=s:h+=s;for(var p=0;p<h.length+64;p++)f.x^=0|h.charCodeAt(p),p==h.length&&(f.d=f.x<<10^f.x>>>4),f.next()}function o(s,f){return f.x=s.x,f.y=s.y,f.z=s.z,f.w=s.w,f.v=s.v,f.d=s.d,f}function l(s,f){var h=new a(s),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.xorwow=l})(0,r)}),z_=gi(function(r){(function(n,t,e){function a(s){var f=this;f.next=function(){var h,p,v=f.x,g=f.i;return h=v[g],p=(h^=h>>>7)^h<<24,p^=(h=v[g+1&7])^h>>>10,p^=(h=v[g+3&7])^h>>>3,p^=(h=v[g+4&7])^h<<7,h=v[g+7&7],p^=(h^=h<<13)^h<<9,v[g]=p,f.i=g+1&7,p},function(h,p){var v,g=[];if(p===(0|p))g[0]=p;else for(p=""+p,v=0;v<p.length;++v)g[7&v]=g[7&v]<<15^p.charCodeAt(v)+g[v+1&7]<<13;for(;g.length<8;)g.push(0);for(v=0;v<8&&g[v]===0;++v);for(v==8?g[7]=-1:g[v],h.x=g,h.i=0,v=256;v>0;--v)h.next()}(f,s)}function o(s,f){return f.x=s.x.slice(),f.i=s.i,f}function l(s,f){s==null&&(s=+new Date);var h=new a(s),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},v.int32=h.next,v.quick=v,p&&(p.x&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.xorshift7=l})(0,r)}),P_=gi(function(r){(function(n,t,e){function a(s){var f=this;f.next=function(){var h,p,v=f.w,g=f.X,y=f.i;return f.w=v=v+1640531527|0,p=g[y+34&127],h=g[y=y+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=g[y]=p^h,f.i=y,p+(v^v>>>16)|0},function(h,p){var v,g,y,x,w,_=[],E=128;for(p===(0|p)?(g=p,p=null):(p+="\0",g=0,E=Math.max(E,p.length)),y=0,x=-32;x<E;++x)p&&(g^=p.charCodeAt((x+32)%p.length)),x===0&&(w=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,x>=0&&(w=w+1640531527|0,y=(v=_[127&x]^=g+w)==0?y+1:0);for(y>=128&&(_[127&(p&&p.length||0)]=-1),y=127,x=512;x>0;--x)g=_[y+34&127],v=_[y=y+1&127],g^=g<<13,v^=v<<17,g^=g>>>15,v^=v>>>12,_[y]=g^v;h.w=w,h.X=_,h.i=y}(f,s)}function o(s,f){return f.i=s.i,f.w=s.w,f.X=s.X.slice(),f}function l(s,f){s==null&&(s=+new Date);var h=new a(s),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},v.int32=h.next,v.quick=v,p&&(p.X&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.xor4096=l})(0,r)}),U_=gi(function(r){(function(n,t,e){function a(s){var f=this,h="";f.next=function(){var v=f.b,g=f.c,y=f.d,x=f.a;return v=v<<25^v>>>7^g,g=g-y|0,y=y<<24^y>>>8^x,x=x-v|0,f.b=v=v<<20^v>>>12^g,f.c=g=g-y|0,f.d=y<<16^g>>>16^x,f.a=x-v|0},f.a=0,f.b=0,f.c=-1640531527,f.d=1367130551,s===Math.floor(s)?(f.a=s/4294967296|0,f.b=0|s):h+=s;for(var p=0;p<h.length+20;p++)f.b^=0|h.charCodeAt(p),f.next()}function o(s,f){return f.a=s.a,f.b=s.b,f.c=s.c,f.d=s.d,f}function l(s,f){var h=new a(s),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&o(p,h),v.state=function(){return o(h,{})}),v}t&&t.exports?t.exports=l:this.tychei=l})(0,r)}),ci=gi(function(r){(function(n,t){var e,a=this,o=256,l=6,s="random",f=t.pow(o,l),h=t.pow(2,52),p=2*h,v=o-1;function g(E,R,A){var C=[],T=w(function B(I,F){var W,U=[],at=typeof I;if(F&&at=="object")for(W in I)try{U.push(B(I[W],F-1))}catch{}return U.length?U:at=="string"?I:I+"\0"}((R=R==1?{entropy:!0}:R||{}).entropy?[E,_(n)]:E??function(){try{var B;return e&&(B=e.randomBytes)?B=B(o):(B=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(B)),_(B)}catch{var I=a.navigator,F=I&&I.plugins;return[+new Date,a,F,a.screen,_(n)]}}(),3),C),N=new y(C),L=function(){for(var B=N.g(l),I=f,F=0;B<h;)B=(B+F)*o,I*=o,F=N.g(1);for(;B>=p;)B/=2,I/=2,F>>>=1;return(B+F)/I};return L.int32=function(){return 0|N.g(4)},L.quick=function(){return N.g(4)/4294967296},L.double=L,w(_(N.S),n),(R.pass||A||function(B,I,F,W){return W&&(W.S&&x(W,N),B.state=function(){return x(N,{})}),F?(t[s]=B,I):B})(L,T,"global"in R?R.global:this==t,R.state)}function y(E){var R,A=E.length,C=this,T=0,N=C.i=C.j=0,L=C.S=[];for(A||(E=[A++]);T<o;)L[T]=T++;for(T=0;T<o;T++)L[T]=L[N=v&N+E[T%A]+(R=L[T])],L[N]=R;(C.g=function(B){for(var I,F=0,W=C.i,U=C.j,at=C.S;B--;)I=at[W=v&W+1],F=F*o+at[v&(at[W]=at[U=v&U+I])+(at[U]=I)];return C.i=W,C.j=U,F})(o)}function x(E,R){return R.i=E.i,R.j=E.j,R.S=E.S.slice(),R}function w(E,R){for(var A,C=E+"",T=0;T<C.length;)R[v&T]=v&(A^=19*R[v&T])+C.charCodeAt(T++);return _(R)}function _(E){return String.fromCharCode.apply(0,E)}if(t["seed"+s]=g,w(t.random(),n),r.exports){r.exports=g;try{e=require("crypto")}catch{}}})([],Math)});ci.alea=B_,ci.xor128=F_,ci.xorwow=L_,ci.xorshift7=z_,ci.xor4096=P_,ci.tychei=U_;var Zl=ci.alea,Fd=function(){function r(n,t,e,a,o){this.mean=n,this.stdDev=t,this.dtype=e,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var l=o||Math.random();this.random=Zl(l.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,e,a=!1;!a;){var o=void 0,l=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(l=2*this.random()-1)*l;while(s>=1||s===0);var f=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*f,e=this.mean+this.stdDev*l*f,this.truncated&&!this.isValidTruncated(t)||(a=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)},r.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},r.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},r}(),H_=function(){function r(n,t,e,a){this.alpha=n,this.beta=1/t,this.dtype=e;var o=a||Math.random();this.randu=Zl(o.toString()),this.randn=new Fd(0,1,e,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var n,t,e,a,o,l;;){do a=this.randn.nextValue(),l=1+this.c*a;while(l<=0);if(l*=l*l,t=1-.331*(n=a*a)*n,e=.5*n+this.d*(1-l+Math.log(l)),(o=this.randu())<t||Math.log(o)<e)break}return l=1/this.beta*this.d*l,this.alpha<1&&(l*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(l)},r.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},r}(),V_=function(){function r(n,t,e,a){var o=this;if(n===void 0&&(n=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=n,this.range=t-n,this.dtype=e,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=Zl(a)}return r.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function Bt(r,n,t){return n===void 0&&(n="float32"),n=n||"float32",j0(r),new zu(r,n,t)}function W_(r,n){n===void 0&&(n=!1),console.log(r.toString(n))}var t1=H({batchToSpaceND_:function(r,n,t){var e=M(r,"x","batchToSpaceND"),a=n.reduce(function(o,l){return o*l});return O(e.rank>=1+n.length,function(){return"input rank is "+e.rank+" but should be > than blockShape.length "+n.length}),O(t.length===n.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length}),O(e.shape[0]%a==0,function(){return"input tensor batch is "+e.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+a}),G.runKernelFunc(function(o){return o.batchToSpaceND(e,n,t)},{$x:e},function(o){return{$x:function(){return o.spaceToBatchND(n,t)}}})}}),G_=H({broadcastTo_:function(r,n){var t=M(r,"broadcastTo","x"),e=t.shape;if(n.some(function(f){return!(f>0)||f%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<t.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+t.rank+".");if(n.length>t.rank){for(var a=t.shape.slice();a.length<n.length;)a.unshift(1);t=t.reshape(a)}for(var o=Array.from(n),l=n.length-1;l>=0;l--)if(t.shape[l]===n[l])o[l]=1;else if(t.shape[l]!==1)throw new Error("broadcastTo(): ["+e+"] cannot be broadcast to ["+n+"].");var s=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});return s.length===0?t.clone():G.runKernelFunc(function(f){return f.tile(t,o)},{input:t},function(f){return{input:function(){return f.sum(s,!0)}}})}}),q_=H({cast_:function(r,n){var t=M(r,"x","cast");if(!Lw(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&t.dtype!=="string"||n!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var e={dtype:n};return G.runKernelFunc(function(a){return a.cast(t,n)},{x:t},function(a){return{x:function(){return a.clone()}}},"Cast",e)}}),j_=H({clone_:function(r){var n=M(r,"x","clone",null);return G.runKernelFunc(function(){return G.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(t){return{$x:function(){return t.toFloat()}}})}}),X_=H({cumsum_:function(r,n,t,e){n===void 0&&(n=0),t===void 0&&(t=!1),e===void 0&&(e=!1);var a=M(r,"x","cumsum"),o=Fr([n|=0],a.rank),l=a;o!=null&&(l=a.transpose(o));var s=Lr(1,a.rank)[0],f=G.runKernelFunc(function(h){return h.cumsum(l,s,t,e)},{permutedX:l},function(h){return{permutedX:function(){return h.cumsum(n,t,!e)}}});return o!=null&&(f=f.transpose(o)),f}}),K_=H({depthToSpace_:function(r,n,t){t===void 0&&(t="NHWC");var e=M(r,"x","depthToSpace"),a=t==="NHWC"?e.shape[1]:e.shape[2],o=t==="NHWC"?e.shape[2]:e.shape[3],l=t==="NHWC"?e.shape[3]:e.shape[1];return O(a*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+n+`  for depthToSpace with input shape
      `+e.shape}),O(o*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+n+` for depthToSpace with input shape
          `+e.shape}),O(l%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+l+" for depthToSpace with input shape "+e.shape}),G.runKernelFunc(function(s){return s.depthToSpace(e,n,t)},{$x:e})}}),rr=H({expandDims_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","expandDims",null);O(n<=t.rank,function(){return"Axis must be <= rank of the tensor"});var e=t.shape.slice();return n<0&&(O(-(t.rank+1)<=n,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),n=t.rank+n+1),e.splice(n,0,1),fr(t,e)}}),e1=H({eye_:function(r,n,t,e){e===void 0&&(e="float32"),n==null&&(n=r);for(var a=Bt([r,n],e),o=r<=n?r:n,l=0;l<o;++l)a.set(1,l,l);var s=a.toTensor().as2D(r,n);if(t==null)return s;if(t.length===1)return go(rr(s,0),[t[0],1,1]);if(t.length===2)return go(rr(rr(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return go(rr(rr(rr(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Y_=H({multinomial_:function(r,n,t,e){e===void 0&&(e=!1);var a=M(r,"logits","multinomial"),o=a.size,l=a.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(l>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+l);t=t||Math.random();var s=l===1?a.as2D(1,-1):a,f=G.runKernelFunc(function(h){return h.multinomial(s,e,n,t)},{logits2D:s});return l===1?f.as1D():f}}),md=H({oneHot_:function(r,n,t,e){if(t===void 0&&(t=1),e===void 0&&(e=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var a=M(r,"indices","oneHot","int32"),o=a.shape.concat([n]);return a=a.flatten(),G.runKernelFunc(function(l){return l.oneHot(a,n,t,e)},{$indices:a},function(l){return{$indices:function(){return pe(a.shape,"float32")}}}).reshape(o)}}),yi=H({pad_:function(r,n,t){t===void 0&&(t=0);var e=M(r,"x","pad");if(e.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:n,constantValue:t};return G.runKernelFunc(function(o){return o.pad(e,n,t)},{x:e},function(o){var l=n.map(function(s){return s[0]});return{x:function(){return o.slice(l,e.shape)}}},"PadV2",a)}}),Q_=H({pad1d_:function(r,n,t){return t===void 0&&(t=0),O(n.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),yi(r,[n],t)}}),Z_=H({pad2d_:function(r,n,t){return t===void 0&&(t=0),O(n.length===2&&n[0].length===2&&n[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),yi(r,n,t)}}),J_=H({pad3d_:function(r,n,t){return t===void 0&&(t=0),O(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),yi(r,n,t)}}),$_=H({pad4d_:function(r,n,t){return t===void 0&&(t=0),O(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),yi(r,n,t)}}),tE=H({rand_:function(r,n,t){var e=Et(r),a=null;if(t==null||t==="float32")a=new Float32Array(e);else if(t==="int32")a=new Int32Array(e);else{if(t!=="bool")throw new Error("Unknown data type "+t);a=new Uint8Array(e)}for(var o=0;o<e;o++)a[o]=n();return G.makeTensor(a,r,t)}}),eE=H({randomNormal_:function(r,n,t,e,a){if(n===void 0&&(n=0),t===void 0&&(t=1),e!=null&&e==="bool")throw new Error("Unsupported data type "+e);for(var o=new Fd(n,t,e,!1,a),l=Bt(r,e),s=0;s<l.values.length;s++)l.values[s]=o.nextValue();return l.toTensor()}}),nE=H({randomGamma_:function(r,n,t,e,a){if(t===void 0&&(t=1),e===void 0&&(e="float32"),t==null&&(t=1),e==null&&(e="float32"),e!=="float32"&&e!=="int32")throw new Error("Unsupported data type "+e);for(var o=new H_(n,t,e,a),l=Bt(r,e),s=0;s<l.values.length;s++)l.values[s]=o.nextValue();return l.toTensor()}}),n1=H({randomUniform_:function(r,n,t,e,a){n===void 0&&(n=0),t===void 0&&(t=1),e===void 0&&(e="float32");for(var o=Bt(r,e),l=new V_(n,t,null,a),s=0;s<o.values.length;s++)o.values[s]=l.nextValue();return o.toTensor()}}),fr=H({reshape_:function(r,n){var t=M(r,"x","reshape",null);n=Bw(n,t.size),O(t.size===Et(n),function(){return"new shape and old shape must have the same number of elements."});var e={shape:n};return G.runKernelFunc(function(a){return a.reshape(t,n)},{x:t},function(a){return{x:function(){return a.reshape(t.shape)}}},"Reshape",e)}}),r1=H({spaceToBatchND_:function(r,n,t){var e=M(r,"x","spaceToBatchND");return O(e.rank>=1+n.length,function(){return"input rank "+e.rank+" should be > than [blockShape] "+n.length}),O(t.length===n.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length}),O(e.shape.reduce(function(a,o,l){return l>0&&l<=n.length?a&&(o+t[l-1][0]+t[l-1][1])%n[l-1]==0:a},!0),function(){return"input spatial dimensions "+e.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()}),G.runKernelFunc(function(a){return a.spaceToBatchND(e,n,t)},{$x:e},function(a){return{$x:function(){return a.batchToSpaceND(n,t)}}})}}),a1=H({squeeze_:function(r,n){var t=M(r,"x","squeeze");return fr(t,fi(t.shape,n).newShape)}}),Wn=H({stack_:function(r,n){n===void 0&&(n=0);var t=Ol(r,"tensors","stack");if(O(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(n);var e=t[0].rank,a=t[0].shape,o=t[0].dtype;O(n<=e,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){te(a,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){O(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var l=t.map(function(s){return s.expandDims(n)});return Be(l,n)}}),go=H({tile_:function(r,n){var t=M(r,"x","tile",null);O(t.rank===n.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+n+"."});var e=[t],a={reps:n};return G.runKernelFunc(function(o,l){var s=o.tile(t,n);return l([t]),s},{x:t},function(o,l){var s=l[0];return{x:function(){var f=Yt(s);if(s.rank===1)for(var h=0;h<n[0];++h)f=f.add(o.slice([h*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(h=0;h<n[0];++h)for(var p=0;p<n[1];++p)f=f.add(o.slice([h*s.shape[0],p*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(h=0;h<n[0];++h)for(p=0;p<n[1];++p)for(var v=0;v<n[2];++v)f=f.add(o.slice([h*s.shape[0],p*s.shape[1],v*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(h=0;h<n[0];++h)for(p=0;p<n[1];++p)for(v=0;v<n[2];++v)for(var g=0;g<n[3];++g)f=f.add(o.slice([h*s.shape[0],p*s.shape[1],v*s.shape[2],g*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return f}}},"Tile",a,e)}}),rE=H({truncatedNormal_:function(r,n,t,e,a){if(n===void 0&&(n=0),t===void 0&&(t=1),e!=null&&e==="bool")throw new Error("Unsupported data type "+e);for(var o=new Fd(n,t,e,!0,a),l=Bt(r,e),s=0;s<l.values.length;s++)l.values[s]=o.nextValue();return l.toTensor()}}),Fe=H({unstack_:function(r,n){n===void 0&&(n=0),n=n||0;var t=M(r,"x","unstack");O(n>=-t.shape.length&&n<t.shape.length,function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),n<0&&(n+=t.shape.length);var e={axis:n};return G.runKernelFunc(function(a){return a.unstack(t,n)},{x:t},function(a){return{x:function(){return Wn(a,n)}}},"Unpack",e)}}),aE=function(r,n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s,f,h,p,v;return _t(this,function(g){switch(g.label){case 0:return t=M(r,"x","setdiff1d"),e=M(n,"y","setdiff1d"),O(t.dtype===e.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+e.dtype+")."}),O(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),O(e.rank===1,function(){return"y should be 1D tensor, but got y ("+e.shape+")."}),[4,t.data()];case 1:return a=g.sent(),[4,e.data()];case 2:for(o=g.sent(),l=new Set(o),s=0,p=0;p<a.length;p++)l.has(a[p])||s++;for(f=new zu([s],t.dtype),h=new zu([s],"int32"),p=0,v=0;p<a.length;p++)l.has(a[p])||(f.values[v]=a[p],h.values[v]=p,v++);return[2,[f.toTensor(),h.toTensor()]]}})})};function Bl(r,n,t,e){e===void 0&&(e=!0);var a=[];if(e)(a=a.concat(n.slice(0))).push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var o=n.length,l=0;l<o;++l)a=a.concat([r[l+1]/n[l],n[l]]);a=a.concat(r.slice(o+1))}return a}function Fl(r,n,t){t===void 0&&(t=!0);var e=[];if(t){e.push(n);for(var a=n+1;a<r;++a)a<=2*n?(e.push(a),e.push(a-(n+1))):e.push(a)}else{var o=[],l=[];for(a=1;a<r;++a)a>=2*n+1||a%2==1?l.push(a):o.push(a);e.push.apply(e,o),e.push(0),e.push.apply(e,l)}return e}function Ll(r,n,t,e){e===void 0&&(e=!0);var a=[];e?a.push(r[0]/t):a.push(r[0]*t);for(var o=1;o<r.length;++o)o<=n.length?e?a.push(n[o-1]*r[o]):a.push(r[o]/n[o-1]):a.push(r[o]);return a}function i1(r,n){for(var t=[0],e=0;e<n;++e)t.push(r[e][0]);return t}function o1(r,n,t){for(var e=r.slice(0,1),a=0;a<t;++a)e.push(r[a+1]-n[a][0]-n[a][1]);return e}function u1(r,n){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=n.shape,e=t[t.length-1],a=1,o=0;o<t.length-1;++o)a*=t[o];var l=r.shape,s=t.slice();s.pop();var f=1;for(o=e;o<r.rank;++o)f*=l[o],s.push(l[o]);var h=Nr(r.shape).map(function(p){return p/f}).concat([1]).slice(0,e);return[s,a,f,h]}var s1=30;function Hh(r){return r<=s1?r:cd(r,Math.floor(Math.sqrt(r)))}function iE(r,n,t){var e=n.rank>1?n.shape[n.rank-1]:1,a=n.rank>1?n.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+n.shape+", shape: "+r+", sliceDim: "+e+", and batchDim: "+a+".";if(t.rank<a)throw new Error(o+" update.rank < "+a+". ");if(r.length<e+(t.rank-a))throw new Error(o+" Output shape length < "+(e+(t.rank-a)));if(t.rank!==a+r.length-e)throw new Error(o+" update.rank != "+(a+r.length-e));for(var l=0;l<a;++l)if(t.shape[l]!==n.shape[l])throw new Error(o+" updates.shape["+l+"] ("+t.shape[l]+") != indices.shape["+l+"] ("+n.shape[l]+").");for(l=0;l<t.rank-a;++l)if(t.shape[l+a]!==r[l+e])throw new Error(o+" updates.shape["+(l+a)+"] ("+t.shape[l+a]+") != shape["+(l+a)+"] ("+r[l+a]+")")}function oE(r,n,t){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}iE(t,n,r)}function zl(r,n,t){for(var e=n.shape.length,a=e>1?n.shape[e-1]:1,o=t.length,l=1,s=a;s<o;++s)l*=t[s];var f=a<1?1:a;return{sliceRank:a,numUpdates:Et(n.shape)/f,sliceSize:l,strides:Nr(t.slice(0,a)).concat([1]),outputSize:Et(t)}}function uE(r,n,t){O(r.rank===n.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+n+" must match the rank of the array ("+r.rank+")."}),O(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var e=function(o){O(n[o]+t[o]<=r.shape[o],function(){return"Error in slice"+r.rank+"D: begin["+o+"] + size["+o+"] ("+(n[o]+t[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")"})},a=0;a<r.rank;++a)e(a)}function Gy(r){for(var n=[],t=0;r>0;)1&r&&n.push(t),r/=2,t++;return n}function Ld(r,n,t){for(var e=[],a=0;a<r.length;a++)e[a]=Math.ceil((n[a]-r[a])/t[a]);return e}function sE(r,n,t,e,a){var o=n[a],l=t[a]||1;(r&1<<a||o==null)&&(o=l>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=e[a];return o<0&&(o+=s),o=ud(0,o,s-1)}function lE(r,n,t,e,a){var o=n[a],l=t[a]||1;(r&1<<a||o==null)&&(o=l>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=e[a];return o<0&&(o+=s),o=l>0?ud(0,o,s):ud(-1,o,s-1)}function l1(r,n,t){for(var e=t.length,a=0;a<t.length;a++)if(t[a]>1){e=a;break}for(a=e+1;a<t.length;a++)if(n[a]>0||t[a]!==r[a])return!1;return!0}function c1(r,n){for(var t=r.length>0?r[r.length-1]:1,e=0;e<r.length-1;e++)t+=r[e]*n[e];return t}function cE(r,n){O(ld(r),function(){return"The f passed in variableGrads(f) must be a function"}),O(n==null||Array.isArray(n)&&n.every(function(p){return p instanceof Co}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=n!=null;if(!t)for(var e in n=[],G.registeredVariables)n.push(G.registeredVariables[e]);var a=t?n.filter(function(p){return!p.trainable}):null,o=n.length;O((n=n.filter(function(p){return p.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var l=G.gradients(r,n,null,!0),s=l.value,f=l.grads;O(f.some(function(p){return p!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),O(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var h={};return n.forEach(function(p,v){f[v]!=null&&(h[p.name]=f[v])}),a?.forEach(function(p){return h[p.name]=null}),{value:s,grads:h}}function Jl(r){return G.customGrad(r)}var ra=H({softmax_:function(r,n){n===void 0&&(n=-1);var t=M(r,"logits","softmax","float32");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+n);return G.runKernelFunc(function(e,a){var o=e.softmax(t,n);return a([o]),o},{logits:t},function(e,a){var o=a[0],l=e.mul(o);return{logits:function(){return l.sub(l.sum([n],!0).mul(o))}}},"Softmax",{dim:n},[],[!0])}}),fE=H({logSoftmax_:function(r,n){n===void 0&&(n=-1);var t=M(r,"logits","logSoftmax");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+n);return Jl(function(e,a){var o=e.max(n,!0),l=e.sub(o),s=l.toFloat().sub(l.exp().sum(n,!0).log());return a([s]),{value:s,gradFunc:function(f,h){var p=h[0].exp();return f.sub(f.sum(n,!0).mul(p))}}})(t)}}),f1=function(){function r(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},r.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},r.prototype.has=function(n){return this.data.has(n)},r.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),h1=function(){function r(){}return r.prototype.time=function(n){return $("time")},r.prototype.read=function(n){return $("read")},r.prototype.readSync=function(n){return $("readSync")},r.prototype.numDataIds=function(){return $("numDataIds")},r.prototype.disposeData=function(n){return $("disposeData")},r.prototype.write=function(n,t,e){return $("write")},r.prototype.move=function(n,t,e,a){return $("move")},r.prototype.memory=function(){return $("memory")},r.prototype.floatPrecision=function(){return $("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(n,t,e,a){return $("batchMatMul")},r.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,$("fusedBatchMatMul")},r.prototype.slice=function(n,t,e){return $("slice")},r.prototype.stridedSlice=function(n,t,e,a){return $("stridedSlice")},r.prototype.unstack=function(n,t){return $("unstack")},r.prototype.reverse=function(n,t){return $("reverse")},r.prototype.concat=function(n,t){return $("concat")},r.prototype.neg=function(n){return $("neg")},r.prototype.add=function(n,t){return $("add")},r.prototype.addN=function(n){return $("addN")},r.prototype.subtract=function(n,t){return $("subtract")},r.prototype.multiply=function(n,t){return $("multiply")},r.prototype.realDivide=function(n,t){return $("realDivide")},r.prototype.floorDiv=function(n,t){return $("floorDiv")},r.prototype.sum=function(n,t){return $("sum")},r.prototype.prod=function(n,t){return $("prod")},r.prototype.unsortedSegmentSum=function(n,t,e){return $("unsortedSegmentSum")},r.prototype.argMin=function(n,t){return $("argMin")},r.prototype.argMax=function(n,t){return $("argMax")},r.prototype.equal=function(n,t){return $("equal")},r.prototype.notEqual=function(n,t){return $("notEqual")},r.prototype.less=function(n,t){return $("less")},r.prototype.lessEqual=function(n,t){return $("lessEqual")},r.prototype.greater=function(n,t){return $("greater")},r.prototype.greaterEqual=function(n,t){return $("greaterEqual")},r.prototype.logicalNot=function(n){return $("logicalNot")},r.prototype.logicalAnd=function(n,t){return $("logicalAnd")},r.prototype.logicalOr=function(n,t){return $("logicalOr")},r.prototype.where=function(n){return $("where")},r.prototype.select=function(n,t,e){return $("select")},r.prototype.topk=function(n,t,e){return $("topk")},r.prototype.min=function(n,t){return $("min")},r.prototype.minimum=function(n,t){return $("minimum")},r.prototype.mod=function(n,t){return $("mod")},r.prototype.max=function(n,t){return $("max")},r.prototype.maximum=function(n,t){return $("maximum")},r.prototype.all=function(n,t){return $("all")},r.prototype.any=function(n,t){return $("any")},r.prototype.squaredDifference=function(n,t){return $("squaredDifference")},r.prototype.ceil=function(n){return $("ceil")},r.prototype.floor=function(n){return $("floor")},r.prototype.round=function(n){return $("round")},r.prototype.sign=function(n){return $("sign")},r.prototype.isNaN=function(n){return $("isNaN")},r.prototype.isInf=function(n){return $("isInf")},r.prototype.isFinite=function(n){return $("isFinite")},r.prototype.pow=function(n,t){return $("pow")},r.prototype.exp=function(n){return $("exp")},r.prototype.expm1=function(n){return $("expm1")},r.prototype.softmax=function(n,t){return $("softmax")},r.prototype.log=function(n){return $("log")},r.prototype.log1p=function(n){return $("log1p")},r.prototype.sqrt=function(n){return $("sqrt")},r.prototype.rsqrt=function(n){return $("rsqrt")},r.prototype.square=function(n){return $("square")},r.prototype.reciprocal=function(n){return $("reciprocal")},r.prototype.relu=function(n){return $("relu")},r.prototype.relu6=function(n){return $("relu6")},r.prototype.prelu=function(n,t){return $("prelu")},r.prototype.elu=function(n){return $("elu")},r.prototype.eluDer=function(n,t){return $("eluDer")},r.prototype.selu=function(n){return $("selu")},r.prototype.int=function(n){return $("int")},r.prototype.clip=function(n,t,e){return $("clip")},r.prototype.abs=function(n){return $("abs")},r.prototype.complexAbs=function(n){return $("complexAbs")},r.prototype.sigmoid=function(n){return $("sigmoid")},r.prototype.softplus=function(n){return $("softplus")},r.prototype.sin=function(n){return $("sin")},r.prototype.cos=function(n){return $("cos")},r.prototype.tan=function(n){return $("tan")},r.prototype.asin=function(n){return $("asin")},r.prototype.acos=function(n){return $("acos")},r.prototype.atan=function(n){return $("atan")},r.prototype.atan2=function(n,t){return $("atan2")},r.prototype.sinh=function(n){return $("sinh")},r.prototype.cosh=function(n){return $("cosh")},r.prototype.tanh=function(n){return $("tanh")},r.prototype.asinh=function(n){return $("asinh")},r.prototype.acosh=function(n){return $("acosh")},r.prototype.atanh=function(n){return $("atanh")},r.prototype.erf=function(n){return $("erf")},r.prototype.step=function(n,t){return $("step")},r.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,$("fusedConv2d")},r.prototype.conv2d=function(n,t,e){return $("conv2d")},r.prototype.conv2dDerInput=function(n,t,e){return $("conv2dDerInput")},r.prototype.conv2dDerFilter=function(n,t,e){return $("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,$("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(n,t,e){return $("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(n,t,e){return $("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(n,t,e){return $("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(n,t,e){return $("conv3d")},r.prototype.conv3dDerInput=function(n,t,e){return $("conv3dDerInput")},r.prototype.conv3dDerFilter=function(n,t,e){return $("conv3dDerFilter")},r.prototype.maxPool=function(n,t){return $("maxPool")},r.prototype.maxPoolBackprop=function(n,t,e,a){return $("maxPoolBackprop")},r.prototype.avgPool=function(n,t){return $("avgPool")},r.prototype.avgPoolBackprop=function(n,t,e){return $("avgPoolBackprop")},r.prototype.avgPool3d=function(n,t){return $("avgPool3d")},r.prototype.avgPool3dBackprop=function(n,t,e){return $("avgPool3dBackprop")},r.prototype.maxPool3d=function(n,t){return $("maxPool3d")},r.prototype.maxPool3dBackprop=function(n,t,e,a){return $("maxPool3dBackprop")},r.prototype.reshape=function(n,t){return $("reshape")},r.prototype.cast=function(n,t){return $("cast")},r.prototype.tile=function(n,t){return $("tile")},r.prototype.pad=function(n,t,e){return $("pad")},r.prototype.transpose=function(n,t){return $("transpose")},r.prototype.gather=function(n,t,e){return $("gather")},r.prototype.gatherND=function(n,t){return $("gatherND")},r.prototype.scatterND=function(n,t,e){return $("scatterND")},r.prototype.batchToSpaceND=function(n,t,e){return $("batchToSpaceND")},r.prototype.spaceToBatchND=function(n,t,e){return $("spaceToBatchND")},r.prototype.resizeBilinear=function(n,t,e,a){return $("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(n,t,e){return $("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(n,t,e,a){return $("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(n,t,e){return $("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(n,t,e,a,o,l){return $("batchNormalization")},r.prototype.localResponseNormalization4D=function(n,t,e,a,o){return $("localResponseNormalization4D")},r.prototype.LRNGrad=function(n,t,e,a,o,l,s){return $("LRNGrad")},r.prototype.multinomial=function(n,t,e,a){return $("multinomial")},r.prototype.oneHot=function(n,t,e,a){return $("oneHot")},r.prototype.cumsum=function(n,t,e,a){return $("cumsum")},r.prototype.nonMaxSuppression=function(n,t,e,a,o){return $("nonMaxSuppression")},r.prototype.fft=function(n){return $("fft")},r.prototype.ifft=function(n){return $("ifft")},r.prototype.complex=function(n,t){return $("complex")},r.prototype.real=function(n){return $("real")},r.prototype.imag=function(n){return $("imag")},r.prototype.cropAndResize=function(n,t,e,a,o,l){return $("cropAndResize")},r.prototype.depthToSpace=function(n,t,e){return $("depthToSpace")},r.prototype.split=function(n,t,e){return $("split")},r.prototype.sparseToDense=function(n,t,e,a){return $("sparseToDense")},r.prototype.diag=function(n){return $("diag")},r.prototype.fill=function(n,t,e){return $("fill")},r.prototype.onesLike=function(n){return $("onesLike")},r.prototype.zerosLike=function(n){return $("zerosLike")},r.prototype.linspace=function(n,t,e){return $("linspace")},r.prototype.dispose=function(){return $("dispose")},r}();function $(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Oa(r,n){for(var t=r.length,e=[],a=0;a<t;a++){var o=t-1-a,l=r[o]||1;(n[n.length-1-a]||1)>1&&l===1&&e.unshift(o)}return e}function Le(r,n){for(var t=[],e=0;e<n.length;e++){var a=r[r.length-e-1],o=n.length-e-1,l=n[o];(a==null||a===1&&l>1)&&t.unshift(o)}return t}function qt(r,n){for(var t=[],e=Math.max(r.length,n.length),a=0;a<e;a++){var o=r[r.length-a-1];o==null&&(o=1);var l=n[n.length-a-1];if(l==null&&(l=1),o===1)t.unshift(l);else if(l===1)t.unshift(o);else{if(o!==l)throw Error("Operands could not be broadcast together with shapes "+r+" and "+n+".");t.unshift(o)}}return t}function Uu(r,n,t,e,a,o,l){l===void 0&&(l="channelsLast");var s,f=Hl(n),h=f[0],p=f[1];if(l==="channelsLast")s=[h,p,r[3],r[3]];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);s=[h,p,r[1],r[1]]}return bi(r,s,t,e,a,o,!1,l)}function Pl(r,n,t,e,a,o,l){l===void 0&&(l="NDHWC");var s,f,h=gd(n),p=h[0],v=h[1],g=h[2];if(l==="NDHWC")f="channelsLast",s=[p,v,g,r[4],r[4]];else{if(l!=="NCDHW")throw new Error("Unknown dataFormat "+l);f="channelsFirst",s=[p,v,g,r[1],r[1]]}return Ul(r,s,t,e,a,!1,f,o)}function bi(r,n,t,e,a,o,l,s){l===void 0&&(l=!1),s===void 0&&(s="channelsLast");var f=[-1,-1,-1,-1],h=f[0],p=f[1],v=f[2],g=f[3];if(s==="channelsLast")h=r[0],p=r[1],v=r[2],g=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);h=r[0],g=r[1],p=r[2],v=r[3]}var y,x=n[0],w=n[1],_=n[3],E=Hl(t),R=E[0],A=E[1],C=Hl(e),T=C[0],N=C[1],L=yo(x,T),B=yo(w,N),I=function(nt,tt,P,q,K,rt,k,X){var it,ot,dt;if(typeof nt=="number"){it={top:nt,bottom:nt,left:nt,right:nt,type:nt===0?"VALID":"NUMBER"};var mt=function(Ft,Xt,Ut,re,se){re==null&&(re=d1(Ft,Xt,Ut));var le=Ft[0],me=Ft[1],jt=Bu((le-Xt+2*re)/Ut+1,se);O(Te(jt),function(){return"The output # of rows ("+jt+") must be an integer. Change the stride and/or zero pad parameters"});var Ue=Bu((me-Xt+2*re)/Ut+1,se);return O(Te(Ue),function(){return"The output # of columns ("+Ue+") must be an integer. Change the stride and/or zero pad parameters"}),[jt,Ue]}([tt,P],rt,q,nt,X);ot=mt[0],dt=mt[1]}else if(nt==="same"){ot=Math.ceil(tt/q),dt=Math.ceil(P/K);var pt=Math.max(0,(ot-1)*q+rt-tt),Tt=Math.max(0,(dt-1)*K+k-P),bt=Math.floor(pt/2),Ot=pt-bt,$t=Math.floor(Tt/2);it={top:bt,bottom:Ot,left:$t,right:Tt-$t,type:"SAME"}}else{if(nt!=="valid")throw Error("Unknown padding parameter: "+nt);it={top:0,bottom:0,left:0,right:0,type:"VALID"},ot=Math.ceil((tt-rt+1)/q),dt=Math.ceil((P-k+1)/K)}return{padInfo:it,outHeight:ot,outWidth:dt}}(a,p,v,R,A,L,B,o),F=I.padInfo,W=I.outHeight,U=I.outWidth,at=l?_*g:_;return s==="channelsFirst"?y=[h,at,W,U]:s==="channelsLast"&&(y=[h,W,U,at]),{batchSize:h,dataFormat:s,inHeight:p,inWidth:v,inChannels:g,outHeight:W,outWidth:U,outChannels:at,padInfo:F,strideHeight:R,strideWidth:A,filterHeight:x,filterWidth:w,effectiveFilterHeight:L,effectiveFilterWidth:B,dilationHeight:T,dilationWidth:N,inShape:r,outShape:y,filterShape:n}}function Ul(r,n,t,e,a,o,l,s){o===void 0&&(o=!1),l===void 0&&(l="channelsLast");var f=[-1,-1,-1,-1,-1],h=f[0],p=f[1],v=f[2],g=f[3],y=f[4];if(l==="channelsLast")h=r[0],p=r[1],v=r[2],g=r[3],y=r[4];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);h=r[0],y=r[1],p=r[2],v=r[3],g=r[4]}var x,w=n[0],_=n[1],E=n[2],R=n[4],A=gd(t),C=A[0],T=A[1],N=A[2],L=gd(e),B=L[0],I=L[1],F=L[2],W=yo(w,B),U=yo(_,I),at=yo(E,F),nt=function(k,X,it,ot,dt,mt,pt,Tt,bt,Ot,$t){var Ft,Xt,Ut,re;if(typeof k=="number"){Ft={top:k,bottom:k,left:k,right:k,front:k,back:k,type:k===0?"VALID":"NUMBER"};var se=function(vr,Dn,Nn,we,Se,ht){Se==null&&(Se=d1(vr,Dn,we));var de=vr[0],Ve=vr[1],mr=vr[2],pn=Bu((de-Dn+2*Se)/we+1,ht);O(Te(pn),function(){return"The output # of depths ("+pn+") must be an integer. Change the stride and/or zero pad parameters"});var gn=Bu((Ve-Dn+2*Se)/we+1,ht);O(Te(gn),function(){return"The output # of rows ("+gn+") must be an integer. Change the stride and/or zero pad parameters"});var We=Bu((mr-Dn+2*Se)/we+1,ht);return O(Te(We),function(){return"The output # of columns ("+We+") must be an integer. Change the stride and/or zero pad parameters"}),[pn,gn,We,Nn]}([X,it,ot,1],Tt,1,dt,k,$t);Xt=se[0],Ut=se[1],re=se[2]}else if(k==="same"){Xt=Math.ceil(X/dt),Ut=Math.ceil(it/mt),re=Math.ceil(ot/pt);var le=(Xt-1)*dt+Tt-X,me=(Ut-1)*mt+bt-it,jt=(re-1)*pt+Ot-ot,Ue=Math.floor(le/2),qn=le-Ue,He=Math.floor(me/2),jn=me-He,mn=Math.floor(jt/2);Ft={top:He,bottom:jn,left:mn,right:jt-mn,front:Ue,back:qn,type:"SAME"}}else{if(k!=="valid")throw Error("Unknown padding parameter: "+k);Ft={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Xt=Math.ceil((X-Tt+1)/dt),Ut=Math.ceil((it-bt+1)/mt),re=Math.ceil((ot-Ot+1)/pt)}return{padInfo:Ft,outDepth:Xt,outHeight:Ut,outWidth:re}}(a,p,v,g,C,T,N,W,U,at,s),tt=nt.padInfo,P=nt.outDepth,q=nt.outHeight,K=nt.outWidth,rt=o?R*y:R;return l==="channelsFirst"?x=[h,rt,P,q,K]:l==="channelsLast"&&(x=[h,P,q,K,rt]),{batchSize:h,dataFormat:l,inDepth:p,inHeight:v,inWidth:g,inChannels:y,outDepth:P,outHeight:q,outWidth:K,outChannels:rt,padInfo:tt,strideDepth:C,strideHeight:T,strideWidth:N,filterDepth:w,filterHeight:_,filterWidth:E,effectiveFilterDepth:W,effectiveFilterHeight:U,effectiveFilterWidth:at,dilationDepth:B,dilationHeight:I,dilationWidth:F,inShape:r,outShape:x,filterShape:n}}function d1(r,n,t,e){e===void 0&&(e=1);var a=yo(n,e);return Math.floor((r[0]*(t-1)-t+a)/2)}function Hl(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function gd(r){return typeof r=="number"?[r,r,r]:r}function yo(r,n){return n<=1?r:r+(r-1)*(n-1)}function Bu(r,n){if(!n)return r;switch(n){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+n)}}function Ro(r){var n=Hl(r),t=n[0],e=n[1],a=n[2];return t===1&&e===1&&a===1}function Tn(r,n){return Ro(r)||Ro(n)}function zd(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function p1(r,n,t){if(n==="complex64"){if(r.dtype==="complex64")return r.clone();var e=pe(r.shape),a=r.toFloat(),o=t.complex(a,e);return e.dispose(),a.dispose(),o}if(!zw(r.dtype,n))return G.makeTensorFromDataId(r.dataId,r.shape,n);if(r.dtype==="complex64"){var l=t.real(r);return o=l.cast(n),l.dispose(),o}if(n==="int32")return t.int(r);if(n==="bool"){var s=vt(0,r.dtype);return o=t.notEqual(r,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+n)}function yd(r,n){return G.makeTensorFromDataId(r.dataId,n,r.dtype)}function v1(r,n,t){var e=(n-r)/(t-1),a=ju(t,"float32");a[0]=r;for(var o=1;o<a.length;o++)a[o]=a[o-1]+e;return Me(a,"float32")}function bd(r,n){if(r.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+n.length+".");for(var t=new Float32Array(2*r.length),e=0;e<t.length;e+=2)t[e]=r[e/2],t[e+1]=n[e/2];return t}function qy(r,n){return{real:r[2*n],imag:r[2*n+1]}}function hE(r,n,t,e){r[2*e]=n,r[2*e+1]=t}function dE(r,n,t){var e=(t?2:-2)*Math.PI*(r/n);return{real:Math.cos(e),imag:Math.sin(e)}}function pE(r,n,t){var e=function(o,l,s){return function(f,h,p){for(var v=0,g=f.length,y=0,x=!1;v<g;){var w=p(h,f[y=v+(g-v>>>1)]);w>0?v=y+1:(g=y,x=!w)}return x?v:-v-1}(o,l,s||vE)}(r,n,t),a=e<0?-(e+1):e;r.splice(a,0,n)}function vE(r,n){return r>n?1:r<n?-1:0}function Pd(r,n,t,e,a){return m1(r,n,t,e,a,0).selectedIndices}function Ud(r,n,t,e,a,o){var l=m1(r,n,t,e,a,o);return l.numValidOutputs.dispose(),{selectedIndices:l.selectedIndices,selectedScores:l.selectedScores}}function m1(r,n,t,e,a,o,l,s){s===void 0&&(s=!1);for(var f=Array.from(n).map(function(C,T){return{score:C,boxIndex:T,suppressBeginIndex:0}}).filter(function(C){return C.score>a}).sort(jy),h=o>0?-.5/o:0,p=[],v=[];p.length<t&&f.length>0;){var g=f.pop(),y=g.score,x=g.boxIndex,w=g.suppressBeginIndex;if(y<a)break;for(var _=!1,E=p.length-1;E>=w;--E){var R=mE(r,x,p[E]);if(R>=e){_=!0;break}if(g.score=g.score*gE(e,h,R),g.score<=a)break}g.suppressBeginIndex=p.length,_||(g.score===y?(p.push(x),v.push(g.score)):g.score>a&&pE(f,g,jy))}var A=p.length;return s&&(p.fill(0,A),v.fill(0,A)),{selectedIndices:Me(p,"int32"),selectedScores:Me(v,"float32"),numValidOutputs:vt(A,"int32")}}function mE(r,n,t){var e=r.subarray(4*n,4*n+4),a=r.subarray(4*t,4*t+4),o=Math.min(e[0],e[2]),l=Math.min(e[1],e[3]),s=Math.max(e[0],e[2]),f=Math.max(e[1],e[3]),h=Math.min(a[0],a[2]),p=Math.min(a[1],a[3]),v=Math.max(a[0],a[2]),g=Math.max(a[1],a[3]),y=(s-o)*(f-l),x=(v-h)*(g-p);if(y<=0||x<=0)return 0;var w=Math.max(o,h),_=Math.max(l,p),E=Math.min(s,v),R=Math.min(f,g),A=Math.max(E-w,0)*Math.max(R-_,0);return A/(y+x-A)}function gE(r,n,t){var e=Math.exp(n*t*t);return t<=r?e:0}function jy(r,n){return r.score-n.score||r.score===n.score&&n.boxIndex-r.boxIndex}function g1(r,n,t){var e=new Array(r.rank).fill(0),a=r.shape.slice();return n.map(function(o){a[t]=o;var l=r.slice(e,a);return e[t]+=o,l})}function y1(r,n){for(var t=new Array(r.rank),e=0;e<t.length;e++)t[e]=r.shape[e]*n[e];var a=Bt(t,r.dtype);for(e=0;e<a.values.length;++e){for(var o=a.indexToLoc(e),l=new Array(r.rank),s=0;s<l.length;s++)l[s]=o[s]%r.shape[s];var f=r.locToIndex(l);a.values[e]=r.values[f]}return a.toTensor()}function b1(r,n,t,e,a){for(var o=n[n.length-1],l=[r.length/o,o],s=l[0],f=l[1],h=Lu(t,s*e),p=Lu("int32",s*e),v=0;v<s;v++){for(var g=v*f,y=r.subarray(g,g+f),x=[],w=0;w<y.length;w++)x.push({value:y[w],index:w});x.sort(function(C,T){return T.value-C.value});var _=v*e,E=h.subarray(_,_+e),R=p.subarray(_,_+e);for(w=0;w<e;w++)E[w]=x[w].value,R[w]=x[w].index}var A=n.slice();return A[A.length-1]=e,[nn(h,A,t),nn(p,A,"int32")]}function Hd(r,n){for(var t=[],e=0;e<n.length;e++)n[e]&&t.push(e);var a=Bt(r,"int32"),o=Bt([t.length,r.length],"int32");for(e=0;e<t.length;e++){var l=a.indexToLoc(t[e]),s=e*r.length;o.values.set(l,s)}return o.toTensor()}var yE=function(r,n){this.outputShape=[],this.outputShape=r,this.variableNames=n.map(function(a,o){return"T"+o});var t=[];this.variableNames.forEach(function(a){t.push("float v"+a+" = get"+a+"AtOutCoords();")});var e=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+e+`;
        setOutput(result);
      }
    `},bE=function(r,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=n.map(function(a,o){return"T"+o});var t=[];this.variableNames.forEach(function(a){t.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var e=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+e+`;
        setOutput(result);
      }
    `},xE=function(r,n,t){this.variableNames=["A"];var e=r.windowSize,a=r.batchSize,o=r.inSize,l=Math.ceil(o/e);t||this.variableNames.push("bestIndicesA"),this.outputShape=[a,l];var s=n==="max"?">":"<",f=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+e+`; i++) {
          int inIdx = `+f+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function x1(r,n){return["x","y","z","w","u","v"].slice(0,n).map(function(t){return r+"."+t})}function Sn(r,n){return n===1?[r]:x1(r,n)}function ln(){var r,n,t,e,a,o,l,s,f,h;return ut().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",n="in",t="out",e="in",a="texture",o="outputColor",l="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,f="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",n="attribute",t="varying",e="varying",a="texture2D",o="gl_FragColor",l="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,f=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:n,varyingVs:t,varyingFs:e,texture2D:a,output:o,defineOutput:l,defineSpecialNaN:s,defineSpecialInf:f,defineRound:h}}function hi(r,n,t){t===void 0&&(t="index");var e=Nr(n);return e.map(function(a,o){return"int "+r[o]+" = "+t+" / "+a+"; "+(o===e.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+a:"index -= "+r[o]+" * "+a)+";"}).join("")}function Vd(r){var n=Nr(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var w1=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function wE(r,n,t,e){var a=[];r.forEach(function(y){var x=Et(y.shapeInfo.logicalShape);y.shapeInfo.isUniform?a.push("uniform float "+y.name+(x>1?"["+x+"]":"")+";"):(a.push("uniform sampler2D "+y.name+";"),a.push("uniform int offset"+y.name+";"))});var o,l,s=a.join(`
`),f=r.map(function(y){return function(x,w,_){_===void 0&&(_=!1);var E="";E+=_?_1(x):fo(x);var R=x.shapeInfo.logicalShape,A=w.logicalShape;return R.length<=A.length&&(E+=_?function(C,T){var N,L=C.name,B=L.charAt(0).toUpperCase()+L.slice(1),I="get"+B+"AtOutCoords",F=C.shapeInfo.logicalShape.length,W=T.logicalShape.length,U=Oa(C.shapeInfo.logicalShape,T.logicalShape),at=he(W),nt=W-F,tt=["x","y","z","w","u","v"];N=F===0?"":W<2&&U.length>=1?"coords = 0;":U.map(function(it){return"coords."+tt[it+nt]+" = 0;"}).join(`
`);var P="";P=W<2&&F>0?"coords":C.shapeInfo.logicalShape.map(function(it,ot){return"coords."+tt[ot+nt]}).join(", ");var q="return outputValue;",K=Et(C.shapeInfo.logicalShape)===1,rt=Et(T.logicalShape)===1;if(F!==1||K||rt){if(K&&!rt)q=W===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(U.length){var k=F-2,X=F-1;U.indexOf(k)>-1&&U.indexOf(X)>-1?q="return vec4(outputValue.x);":U.indexOf(k)>-1?q="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":U.indexOf(X)>-1&&(q="return vec4(outputValue.xx, outputValue.zz);")}}else q=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+at+` coords = getOutputCoords();
      `+N+`
      vec4 outputValue = get`+B+"("+P+`);
      `+q+`
    }
  `}(x,w):function(C,T){var N=C.name,L=N.charAt(0).toUpperCase()+N.slice(1),B="get"+L+"AtOutCoords",I=T.texShape,F=C.shapeInfo.texShape,W=C.shapeInfo.logicalShape.length,U=T.logicalShape.length;if(!C.shapeInfo.isUniform&&W===U&&C.shapeInfo.flatOffset==null&&Ye(F,I))return`
      float `+B+`() {
        return sampleTexture(`+N+`, resultUV);
      }
    `;var at,nt=he(U),tt=Oa(C.shapeInfo.logicalShape,T.logicalShape),P=U-W,q=["x","y","z","w","u","v"];at=W===0?"":U<2&&tt.length>=1?"coords = 0;":tt.map(function(rt){return"coords."+q[rt+P]+" = 0;"}).join(`
`);var K="";return K=U<2&&W>0?"coords":C.shapeInfo.logicalShape.map(function(rt,k){return"coords."+q[k+P]}).join(", "),`
    float `+B+`() {
      `+nt+` coords = getOutputCoords();
      `+at+`
      return get`+L+"("+K+`);
    }
  `}(x,w)),E}(y,n,e)}).join(`
`),h=n.texShape,p=ln(),v=function(y){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+y.texture2D+`(textureSampler, uv).r;
    }
  `}(p),g=function(y){return y.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+y.varyingFs+` vec2 resultUV;
    `+y.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+y.defineSpecialNaN+`
    `+y.defineSpecialInf+`
    `+y.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+_E+`
    `+EE+`
    `+CE+`
  `}(p);return n.isPacked?(o=function(y,x){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(C,T){var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];return N[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+N[1]+`.0);
      }
    `:N[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+N[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      return 2 * (resTexRC.x * `+N[1]+` + resTexRC.y);
    }
  `}(0,x);case 2:return function(C,T){var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];if(Ye(C,T))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+N[0]+", "+N[1]+`));
      }
    `;var L=Math.ceil(C[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));

      int index = resTexRC.x * `+N[1]+` + resTexRC.y;
      int r = 2 * (index / `+L+`);
      int c = imod(index, `+L+`) * 2;

      return ivec2(r, c);
    }
  `}(y,x);case 3:return w=y,_=x,E=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],R=Math.ceil(w[2]/2),A=R*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      int b = index / `+A+`;
      index -= b * `+A+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(C,T){for(var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)],L=Math.ceil(C[C.length-1]/2),B=L*Math.ceil(C[C.length-2]/2),I=B,F="",W="b, r, c",U=2;U<C.length-1;U++)I*=C[C.length-U-1],F=`
      int b`+U+" = index / "+I+`;
      index -= b`+U+" * "+I+`;
    `+F,W="b"+U+", "+W;return`
    ivec`+C.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      int index = resTexRC.x * `+N[1]+` + resTexRC.y;

      `+F+`

      int b = index / `+B+`;
      index -= b * `+B+`;

      int r = 2 * (index / `+L+`);
      int c = imod(index, `+L+`) * 2;

      return ivec`+C.length+"("+W+`);
    }
  `}(y,x)}var w,_,E,R,A}(n.logicalShape,h),l=function(y){return`
    void setOutput(vec4 val) {
      `+y.output+` = val;
    }
  `}(p)):(o=function(y,x){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(E,R){return R[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+R[1]+`.0);
      }
    `:R[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+R[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      return resTexRC.x * `+R[1]+` + resTexRC.y;
    }
  `}(0,x);case 2:return function(E,R){return Ye(E,R)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+R[0]+", "+R[1]+`));
      }
    `:E[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:E[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      int r = index / `+E[1]+`;
      int c = index - r * `+E[1]+`;
      return ivec2(r, c);
    }
  `}(y,x);case 3:return w=x,_=hi(["r","c","d"],y),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+_+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(E,R){var A=hi(["r","c","d","d2"],E);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      `+A+`
      return ivec4(r, c, d, d2);
    }
  `}(y,x);case 5:return function(E,R){var A=hi(["r","c","d","d2","d3"],E);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+R[0]+`,
                             `+R[1]+`));

      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+A+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(y,x);case 6:return function(E,R){var A=hi(["r","c","d","d2","d3","d4"],E);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+A+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(y,x);default:throw new Error(y.length+"-D output sampling is not yet supported")}var w,_}(n.logicalShape,h),l=function(y){return`
    void setOutput(float val) {
      `+y.output+` = vec4(val, 0, 0, 0);
    }
  `}(p)),e&&(g+=SE),[g,v,l,s,o,f,t].join(`
`)}function fo(r){var n=r.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,a="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+a+"() {return "+e+";}";var o=t.shapeInfo.texShape,l=o[0],s=o[1];if(l===1&&s===1)return`
      float `+a+`() {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var f=t.shapeInfo.texShape,h=f[0],p=f[1],v=ui(e);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+h+", "+p+", "+v+`);
      return sampleTexture(`+e+`, uv);
    }
  `}(r);case 1:return function(t){var e=t.name,a="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+uo(t)+`
      }
    `;var o=t.shapeInfo.texShape,l=o[0],s=o[1];if(s===1&&l===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var f=ui(e);return s===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+f+") + 0.5) / "+l+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:l===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+f+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+l+", "+s+", index + "+f+`);
      return sampleTexture(`+e+`, uv);
    }
  `}(r);case 2:return function(t){var e=t.shapeInfo.logicalShape,a=t.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),l=t.shapeInfo.texShape;if(l!=null&&Ye(e,l)){var s=l[0],f=l[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+f+".0, "+s+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var h=fi(e),p=h.newShape,v=h.keptDims,g=p;if(g.length<e.length){var y=ho(t,g);return`
      `+fo(y)+`
      float `+o+`(int row, int col) {
        return `+o+"("+po(["row","col"],v)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+e[1]+`, 1)));
        `+uo(t)+`
      }
    `;var x=l[0],w=l[1],_=ui(a);return w===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+_+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:x===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+_+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+e[1]+" + col + "+_+`;
    vec2 uv = uvFromFlat(`+x+", "+w+`, index);
    return sampleTexture(`+a+`, uv);
  }
`}(r);case 3:return function(t){var e=t.shapeInfo.logicalShape,a=t.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),l=e[1]*e[2],s=e[2],f=fi(e),h=f.newShape,p=f.keptDims,v=h;if(v.length<e.length){var g=ho(t,v);return`
        `+fo(g)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+po(["row","col","depth"],p)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+l+", "+s+`, 1)));
        `+uo(t)+`
      }
    `;var y=t.shapeInfo.texShape,x=y[0],w=y[1],_=t.shapeInfo.flatOffset;if(w===l&&_==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+x+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(w===s&&_==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+e[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var E=ui(a);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+l+" + col * "+s+" + depth + "+E+`;
        vec2 uv = uvFromFlat(`+x+", "+w+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `}(r);case 4:return function(t){var e=t.shapeInfo.logicalShape,a=t.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),l=e[3],s=e[2]*l,f=e[1]*s,h=fi(e),p=h.newShape,v=h.keptDims;if(p.length<e.length){var g=ho(t,p);return`
      `+fo(g)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+po(["row","col","depth","depth2"],v)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+f+", "+s+", "+l+`, 1)));
        `+uo(t)+`
      }
    `;var y=t.shapeInfo.flatOffset,x=t.shapeInfo.texShape,w=x[0],_=x[1];if(_===f&&y==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+l+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+w+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(_===l&&y==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+e[1]*e[2]+", "+e[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+w+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var E=ui(a);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+f+" + col * "+s+` +
          depth * `+l+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+_+", index + "+E+`);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);case 5:return function(t){var e=t.shapeInfo.logicalShape,a=t.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),l=e[4],s=e[3]*l,f=e[2]*s,h=e[1]*f,p=fi(e),v=p.newShape,g=p.keptDims;if(v.length<e.length){var y=ho(t,v);return`
      `+fo(y)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+po(["row","col","depth","depth2","depth3"],g)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+f+", "+s+", "+l+`)) +
          depth3;
        `+uo(t)+`
      }
    `;var x=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,_=w[0],E=w[1];if(E===h&&x==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+f+", "+s+", "+l+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+E+".0, "+_+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(E===l&&x==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]+`,
               `+e[2]*e[3]+", "+e[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+E+".0, "+_+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var R=ui(a);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+f+" + depth * "+s+` +
          depth2 * `+l+" + depth3 + "+R+`;
      vec2 uv = uvFromFlat(`+_+", "+E+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);case 6:return function(t){var e=t.shapeInfo.logicalShape,a=t.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),l=fi(e),s=l.newShape,f=l.keptDims;if(s.length<e.length){var h=ho(t,s);return`
      `+fo(h)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+po(["row","col","depth","depth2","depth3","depth4"],f)+`);
      }
    `}var p=e[5],v=e[4]*p,g=e[3]*v,y=e[2]*g,x=e[1]*y;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+x+", "+y+", "+g+", "+v+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+p+`, 1)));
        `+uo(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,E=_[0],R=_[1];if(R===x&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+y+", "+g+", "+v+", "+p+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+R+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(R===p&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]*e[4]+`,
               `+e[2]*e[3]*e[4]+`,
               `+e[3]*e[4]+`,
               `+e[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+R+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var A=ui(a);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+x+" + col * "+y+" + depth * "+g+` +
          depth2 * `+v+" + depth3 * "+p+" + depth4 + "+A+`;
      vec2 uv = uvFromFlat(`+E+", "+R+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function _1(r){var n,t,e;switch(r.shapeInfo.logicalShape.length){case 0:return n=r.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),e=ln(),`
    vec4 `+t+`() {
      return `+e.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return function(a){var o=a.name,l="get"+o.charAt(0).toUpperCase()+o.slice(1),s=a.shapeInfo.texShape,f=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],h=ln();return`
    vec4 `+l+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+f[0]+", "+f[1]+`, index);
      return `+h.texture2D+"("+o+`, uv);
    }
  `}(r);case 2:return function(a){var o=a.shapeInfo.logicalShape,l=a.name,s="get"+l.charAt(0).toUpperCase()+l.slice(1),f=a.shapeInfo.texShape,h=f[0],p=f[1],v=ln();if(f!=null&&Ye(o,f))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+p+".0, "+h+`.0);

        return `+v.texture2D+"("+l+`, uv);
      }
    `;var g=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],y=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+y+", "+g[0]+", "+g[1]+`, row, col);
      return `+v.texture2D+"("+l+`, uv);
    }
  `}(r);case 3:return function(a){var o=a.shapeInfo.logicalShape,l=a.name,s="get"+l.charAt(0).toUpperCase()+l.slice(1),f=a.shapeInfo.texShape,h=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];if(o[0]===1){var p=o.slice(1),v=ho(a,p);return`
        `+_1(v)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+po(["b","row","col"],[1,2])+`);
        }
      `}var g=h[0],y=h[1],x=Math.ceil(o[2]/2),w=x*Math.ceil(o[1]/2),_=ln();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+g+", "+y+", "+w+", "+x+`, b, row, col);
      return `+_.texture2D+"("+l+`, uv);
    }
  `}(r);default:return function(a){for(var o=a.shapeInfo.logicalShape,l=o.length,s=a.name,f="get"+s.charAt(0).toUpperCase()+s.slice(1),h=a.shapeInfo.texShape,p=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],v=p[0],g=p[1],y=Math.ceil(o[l-1]/2),x=y*Math.ceil(o[l-2]/2),w="int b, int row, int col",_="b * "+x+" + (row / 2) * "+y+" + (col / 2)",E=2;E<l-1;E++)w="int b"+E+", "+w,x*=o[l-E-1],_="b"+E+" * "+x+" + "+_;var R=ln();return`
    vec4 `+f+"("+w+`) {
      int index = `+_+`;
      int texR = index / `+g+`;
      int texC = index - texR * `+g+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+", "+v+`);
      return `+R.texture2D+"("+s+`, uv);
    }
  `}(r)}}var _E=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,EE=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CE=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SE=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ui(r){return"offset"+r}function uo(r){var n=r.name,t=Et(r.shapeInfo.logicalShape);return t<2?"return "+n+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function he(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function ho(r,n){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=n,t}function po(r,n){return n.map(function(t){return r[t]}).join(", ")}var RE=function(r,n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var a=r[r.length-1],o=Math.ceil(a/n);this.outputShape=r.slice(0,-1),o>1&&this.outputShape.push(o),e||this.variableNames.push("bestIndicesA");var l,s,f=this.outputShape,h=f.length,p=he(h),v=Sn("coords",h);if(o===1){var g=he(s=h+1);l=`
        `+g+" sourceLocR = "+g+"("+v.join()+`, 0);
        ++`+v[h-1]+`;
        `+g+" sourceLocG = "+g+"("+v.join()+`, 0);
        ++`+v[h-2]+`;
        `+g+" sourceLocA = "+g+"("+v.join()+`, 0);
        --`+v[h-1]+`;
        `+g+" sourceLocB = "+g+"("+v.join()+`, 0);
        --`+v[h-2]+";"}else s=h,l=`
        `+p+` sourceLocR = coords;
        ++`+v[h-1]+`;
        `+p+` sourceLocG = coords;
        ++`+v[h-2]+`;
        `+p+` sourceLocA = coords;
        --`+v[h-1]+`;
        `+p+` sourceLocB = coords;
        --`+v[h-2]+";";var y=["x","y","z","w","u","v"].slice(0,s),x="."+y[s-1],w=y.map(function(B){return"int "+B}),_=Sn("sourceLocR",s-1).concat("inIdx.r"),E=Sn("sourceLocG",s-1).concat("inIdx.g"),R=Sn("sourceLocB",s-1).concat("inIdx.b"),A=Sn("sourceLocA",s-1).concat("inIdx.a"),C=t==="max"?"greaterThan":"lessThan",T=e?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+R.join()+`),
                             getBestIndicesAChannel(`+A.join()+")));",N=`vec4(
            getAChannel(`+_.join()+`),
            hasNextCol ? getAChannel(`+E.join()+`) : 0.,
            hasNextRow ? getAChannel(`+R.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+A.join()+") : 0.)",L=e?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+y.join()+`),
                                          vec2(`+y.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+y.join()+`),
                               vec2(`+y.slice(-2).join()+`));
      }
      `+L+`
      void main() {
        `+p+` coords = getOutputCoords();
        bool hasNextCol = `+v[h-1]+" < "+(f[h-1]-1)+`;
        bool hasNextRow = `+v[h-2]+" < "+(f[h-2]-1)+`;
        `+l+`
        ivec4 srcIdx = ivec4(sourceLocR`+x+", sourceLocG"+x+`,
          sourceLocB`+x+", sourceLocA"+x+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+N+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+T+`
          vec4 candidate = `+N+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+C+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},AE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,o=r.dilationHeight,l=r.dilationWidth,s=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=s-1-r.padInfo.top,p=f-1-r.padInfo.left,v=1/(n*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+p+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+f+`;
            wC+= `+l+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},TE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterDepth,t=r.filterHeight,e=r.filterWidth,a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,s=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,g=r.effectiveFilterWidth,y=p-1-r.padInfo.front,x=v-1-r.padInfo.top,w=g-1-r.padInfo.left,_=1/(n*t*e);this.userCode=`
      const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);
      const float avgMultiplier = float(`+_+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+v+`;
              wR += `+f+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+g+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+l+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},DE=function(r,n,t,e,a,o){this.outputShape=[],this.variableNames=["x","mean","variance"],qt(r,n),qt(r,t);var l="0.0";e!=null&&(qt(r,e),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var s="1.0";a!=null&&(qt(r,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+l+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},NE=function(r,n,t,e,a,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qt(r,n),qt(r,t);var l="vec4(0.0)";e!=null&&(qt(r,e),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var s="vec4(1.0)";a!=null&&(qt(r,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+l+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},ME="return areal * breal - aimag * bimag;",kE="return areal * bimag + aimag * breal;",Xy=function(r,n,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qt(n,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Vh="return a + b;",Wh="return a - b;",Ky="return a * b;",E1="return (a < 0.) ? b * a : a;",Ce=function(r,n,t){this.variableNames=["A","B"],this.outputShape=qt(n,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},C1=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,ta=function(r,n,t,e){e===void 0&&(e=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qt(n,t);var a=this.outputShape.length,o="";if(e)if(a===0||Et(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+he(a)+` coords = getOutputCoords();
        `,a===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var l=Sn("coords",a);o+=`
            bool nextRowOutOfBounds =
              (`+l[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+l[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},OE=function(){function r(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,t){var e=this;return function(a,o){e.minLoc==null&&(e.minLoc=a.getUniformLocationNoThrow(o,"minVal"),e.maxLoc=a.getUniformLocationNoThrow(o,"maxVal")),a.gl.uniform1f(e.minLoc,n),a.gl.uniform1f(e.maxLoc,t)}},r}(),IE=function(){function r(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,t){var e=this;return function(a,o){e.minLoc==null&&(e.minLoc=a.getUniformLocationNoThrow(o,"minVal"),e.maxLoc=a.getUniformLocationNoThrow(o,"maxVal")),a.gl.uniform1f(e.minLoc,n),a.gl.uniform1f(e.maxLoc,t)}},r}(),BE=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},FE=function(r){this.outputShape=[],this.outputShape=So(r,1),this.variableNames=r.map(function(s,f){return"T"+f});var n=new Array(r.length-1);n[0]=r[0][1];for(var t=1;t<n.length;t++)n[t]=n[t-1]+r[t][1];var e=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<n.length;t++){var a=n[t-1];e.push("else if (yC < "+n[t]+") setOutput(getT"+t+"(yR, yC-"+a+"));")}var o=n.length,l=n[n.length-1];e.push("else setOutput(getT"+o+"(yR, yC-"+l+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+e.join(`
        `)+`
      }
    `},LE=function(r,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=So(r,n);var t=this.outputShape,e=t.length,a=he(e),o=Sn("coords",e),l=["x","y","z","w","u","v"].slice(0,e);this.variableNames=r.map(function(_,E){return"T"+E});var s=new Array(r.length-1);s[0]=r[0][n];for(var f=1;f<s.length;f++)s[f]=s[f-1]+r[f][n];var h=l[n],p=l.slice(-2),v=l.join(),g="if ("+h+" < "+s[0]+`) {
        return getChannel(
            getT0(`+v+"), vec2("+p.join()+`));
        }`;for(f=1;f<s.length;f++){var y=s[f-1];g+=`
        if (`+h+" < "+s[f]+"  && "+h+" >= "+s[f-1]+`) {
          return getChannel(
            getT`+f+"("+ml(l,h,y)+`),
            vec2(`+ml(p,h,y)+`));
        }`}var x=s.length,w=s[s.length-1];g+=`
        return getChannel(
          getT`+x+"("+ml(l,h,w)+`),
          vec2(`+ml(p,h,w)+"));",this.userCode=`
      float getValue(`+l.map(function(_){return"int "+_})+`) {
        `+g+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[e-1]+" = "+o[e-1]+` + 1;
        if (`+o[e-1]+" < "+t[e-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[e-2]+" = "+o[e-2]+` + 1;
        if (`+o[e-2]+" < "+t[e-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[e-1]+" = "+o[e-1]+` - 1;
        if (`+o[e-2]+" < "+t[e-2]+` &&
            `+o[e-1]+" < "+t[e-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function ml(r,n,t){var e=r.indexOf(n);return r.map(function(a,o){return o===e?a+" - "+t:a}).join()}var zE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,t=r.strideWidth,e=r.padInfo.top,a=r.padInfo.left,o=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+e+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},PE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,o=r.dataFormat==="channelsLast",l=n-1-r.padInfo.top,s=t-1-r.padInfo.left,f=o?1:2,h=o?2:3,p=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+p+`];

        ivec2 dyCorner = ivec2(coords[`+f+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},UE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideDepth,t=r.strideHeight,e=r.strideWidth,a=r.padInfo.front,o=r.padInfo.top,l=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+a+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+e+" - "+l+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},HE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterDepth,t=r.filterHeight,e=r.filterWidth,a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,s=n-1-r.padInfo.front,f=t-1-r.padInfo.top,h=e-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+f+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+e+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+l+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+e+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},VE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,t=r.strideWidth,e=r.padInfo.top,a=r.padInfo.left,o=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+e+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},WE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,o=n-1-r.padInfo.top,l=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Yy=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.padInfo.top,o=r.padInfo.left,l=r.strideHeight,s=r.strideWidth,f=r.dilationHeight,h=r.dilationWidth,p=r.filterHeight,v=r.filterWidth,g=4*Math.floor(r.inChannels/4),y=r.inChannels%4,x=r.dataFormat==="channelsLast",w=x?1:2,_=x?2:3,E=x?3:1,R="",A="";t&&(R=e?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,A="result = activation(result);");var C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+R+`

      const ivec2 strides = ivec2(`+l+", "+s+`);
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+E+`];

        ivec2 xRCCorner =
            ivec2(coords[`+w+"], coords["+_+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+p+`; wR++) {
          int xR = xRCorner + wR * `+f+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+g+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+x+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(y===1)+`) {

              if (`+x+`) {
                dotProd +=
                    getX(batch, xR, xC, `+g+`) *
                    getW(wR, wC, `+g+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+g+`, xR, xC) *
                    getW(wR, wC, `+g+`, d2);
              }

            } else if (`+(y===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2)
              );

              if (`+x+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(y===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2),
                getW(wR, wC, `+g+` + 2, d2)
              );

              if (`+x+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1),
                  getX(batch, xR, xC, `+g+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC),
                  getX(batch, `+g+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+C+`
        `+A+`
        setOutput(result);
      }
    `},GE=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var n=r.padInfo.front,t=r.padInfo.top,e=r.padInfo.left,a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,s=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.filterDepth,v=r.filterHeight,g=r.filterWidth,y=4*Math.floor(r.inChannels/4),x=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+o+", "+l+`);
      const ivec3 pads = ivec3(`+n+", "+t+", "+e+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+p+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+v+`; wR++) {
            int xR = xRCorner + wR * `+f+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+g+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+y+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(x===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+y+`) *
                  getW(wF, wR, wC, `+y+`, d2);
              } else if (`+(x===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(x===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1),
                  getX(batch, xF, xR, xC, `+y+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2),
                  getW(wF, wR, wC, `+y+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Qy=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.inHeight,o=r.inWidth,l=r.padInfo.top,s=r.padInfo.left,f=r.strideHeight,h=r.strideWidth,p=r.dilationHeight,v=r.dilationWidth,g=r.filterHeight,y=r.filterWidth,x=r.outChannels/r.inChannels,w="",_="";t&&(w=e?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var E=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+f+", "+h+`);
      const ivec2 pads = ivec2(`+l+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+x+`;
        int q = d2 - d1 * `+x+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+g+`; wR++) {
          int xR = xRCorner + wR * `+p+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+y+`; wC++) {
            int xC = xCCorner + wC * `+v+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+E+`
        `+_+`
        setOutput(result);
      }
    `},Zy=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var a=r.inHeight,o=r.inWidth,l=r.padInfo.top,s=r.padInfo.left,f=r.strideHeight,h=r.strideWidth,p=r.dilationHeight,v=r.dilationWidth,g=r.filterHeight,y=r.filterWidth,x=y,w="int xR; int xC; int xCOffset;",_=0;_<g;_++)for(var E=0;E<y;E++)w+=`
          vec4 xTexelR`+_+"C"+2*E+` = vec4(0.);
          vec4 wR`+_+"C"+E+` = vec4(0.);
          vec4 xR`+_+"C"+E+" = vec4(0.);";for(_=0;_<g;_++)for(var R=0;R<x;R++){if(w+=`
          xR = xRCorner + `+_*p+`;
          xC = xCCorner + `+(E=2*R)*v+`;
        `,h===1){if(E<y&&(w+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+_+"C"+E+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+_+"C"+E+" = vec4(previous.zw, xTexelR"+_+"C"+E+`.xy);
                } else {
                  xR`+_+"C"+E+" = vec4(0, 0, xTexelR"+_+"C"+E+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xR`+_+"C"+E+" = xTexelR"+_+"C"+E+`;
              `,E+1<y)){var A=s%2==0?V0(v):v;v%2==0&&s%2==1||v%2!=0&&s%2!=1?(w+=`
                  xCOffset = xC + `+s%2+" + "+A+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,v>1&&(w+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+_+"C"+E+` = vec4(0.);
                    }
                  `),w+=`
                  xR`+_+"C"+(E+1)+` = vec4(
                    xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.xy);
                `):w+=`
                  xCOffset = xC + `+A+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+_+"C"+(E+1)+" = xTexelR"+_+"C"+(E+2)+`;
                `}}else E<y&&(w+=`
              if(xR >= 0 && xR < `+a+`) {
            `,s%2==1?(w+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+_+"C"+(E+2)+` = vec4(0.);
                }

                xR`+_+"C"+E+` = vec4(
                  xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.zw);
              `,E+1<y&&(w+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+_+"C"+(E+1)+" = vec4(xTexelR"+_+"C"+(E+2)+`.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+_+"C"+(E+2)+` = vec4(0.);
                }

                xR`+_+"C"+E+` = vec4(
                  xTexelR`+_+"C"+E+".xy, xTexelR"+_+"C"+(E+2)+`.xy);
              `,E+1<y&&(w+=`
                  xR`+_+"C"+(E+1)+` = vec4(
                    xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.zw);
                `)),w+="}");E<y&&(w+=`
            vec4 wTexelR`+_+"C"+E+" = getW("+_+", "+E+`, d1, q);
            wR`+_+"C"+E+" = vec4(wTexelR"+_+"C"+E+".xz, wTexelR"+_+"C"+E+`.xz);
          `,E+1<y&&(w+=`
              vec4 wTexelR`+_+"C"+(E+1)+" = getW("+_+", "+(E+1)+`, d1, q);
              wR`+_+"C"+(E+1)+` =
                vec4(wTexelR`+_+"C"+(E+1)+".xz, wTexelR"+_+"C"+(E+1)+".xz);"))}for(_=0;_<g;_++)for(E=0;E<y;E++)w+="dotProd += xR"+_+"C"+E+" * wR"+_+"C"+E+";";var C="",T="";t&&(C=e?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,T="result = activation(result);");var N=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+f+", "+h+`);
      const ivec2 pads = ivec2(`+l+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+w+`

        vec4 result = dotProd;
        `+N+`
        `+T+`
        setOutput(result);
      }
    `},qE=function(r,n,t,e,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=r[0],l=r[1],s=r[2],f=r[3],h=n[0],p=t[0],v=t[1];this.outputShape=[h,p,v,f];var g=e==="bilinear"?1:0,y=[l-1+".0",s-1+".0"],x=y[0],w=y[1],_=p>1?[""+(l-1)/(p-1),"(y2-y1) * height_ratio","y1*"+x+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+x],E=_[0],R=_[1],A=_[2],C=v>1?[""+(s-1)/(v-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],T=C[0],N=C[1],L=C[2];this.userCode=`
      const float height_ratio = float(`+E+`);
      const float width_ratio = float(`+T+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+R+`;
        float width_scale = `+N+`;

        float in_y = `+A+`;
        if( in_y < 0.0 || in_y > `+x+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+L+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+g+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},jE=function(r,n,t){this.variableNames=["x"],this.outputShape=r;var e=r.length,a=r[r.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+he(e)+` coords = getOutputCoords();
        int end = `+Jy(e,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+Jy(e,"coords")+` = idx;
          val += getX(`+function(l,s){if(l===1)return""+s;if(l===2)return s+".x, "+s+".y";if(l===3)return s+".x, "+s+".y, "+s+".z";if(l===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+l+" is not yet supported")}(e,"coords")+`);
        }
        setOutput(val);
      }
    `};function Jy(r,n){if(r===1)return""+n;if(r===2)return n+".y";if(r===3)return n+".z";if(r===4)return n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var XE=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Pu.DENSE;var n=Iu(r),t=ln();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+hi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},KE=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Pu.DENSE;var n=Iu(r),t=ln();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+hi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},YE=function(){function r(n,t,e){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=e,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),QE=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},ZE=function(r){this.variableNames=["A"],this.outTexUsage=Un.DOWNLOAD;var n=ln();this.outputShape=r,this.userCode=`
      `+w1+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},JE=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Un.DOWNLOAD;var n=ln();this.outputShape=r,this.userCode=`
      `+w1+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},$E=function(r,n,t){t===void 0&&(t=!1),this.variableNames=["A"];var e=ln(),a=n[0],o=n[1];this.outputShape=r;var l="result";t&&(l="floor(result * 255. + 0.5)"),this.userCode=`
      `+Vd(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+a+`.0);
        vec4 values = `+e.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+e.output+" = vec4("+l+`, 0., 0., 0.);
      }
    `},tC=function(r,n,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=ln(),a=n[0],o=n[1];this.outputShape=r;var l="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var f=0;f<=1;f++)for(var h=0;h<=1;h++){var p=2*f+h;l+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+r[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+f+" < "+r[1]+`) {
              localCoords[1] += `+f+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+a+`.0);
              values = `+e.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+p+`] = values[0];
              } else if(offset == 1) {
                result[`+p+`] = values[1];
              } else if(offset == 2) {
                result[`+p+`] = values[2];
              } else {
                result[`+p+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Vd(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+l+`

        `+e.output+" = "+s+`;
      }
    `},eC="return real * expR - imag * expI;",nC="return real * expI + imag * expR;",$y=function(r,n,t){this.variableNames=["real","imag"];var e=n[1];this.outputShape=n;var a=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?e+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+e+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+e+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},rC=function(){function r(n,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,a){t.valueLoc==null&&(t.valueLoc=e.getUniformLocationNoThrow(a,"value")),e.gl.uniform1f(t.valueLoc,n)}},r}(),aC=function(r,n,t){this.variableNames=["A","indices"];var e=r.slice();e[t]=n,this.outputShape=e,this.rank=e.length;var a=he(this.rank),o=function(l,s){var f=l.length;if(f>4)throw Error("Gather for rank "+f+" is not yet supported");if(f===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],p=[],v=0;v<l.length;v++)v===s?p.push("int(getIndices("+h[v]+"))"):p.push(""+h[v]);return p.join()}(r,t);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},iC=function(r,n,t){this.sliceDim=r,this.strides=n,this.variableNames=["x","indices"],this.outputShape=t;var e=he(n.length),a=he(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+e+" strides = "+e+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function oC(r,n){var t=ln();return e_(r,n,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function uC(r,n){return o_(r,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function sC(r,n){return u_(r,n,new Uint16Array([0,1,2,2,1,3]))}function Ku(r,n,t,e,a,o,l){l_(t,e);var s=s_(r,n),f=r.TEXTURE_2D;return Ct(r,n,function(){return r.bindTexture(f,s)}),Ct(r,n,function(){return r.texParameteri(f,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Ct(r,n,function(){return r.texParameteri(f,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Ct(r,n,function(){return r.texParameteri(f,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Ct(r,n,function(){return r.texParameteri(f,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Ct(r,n,function(){return r.texImage2D(f,0,a,t,e,0,o,l,null)}),Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function lC(r,n,t,e,a){var o=Ql(t,e);return Ku(r,n,o[0],o[1],a.internalFormatFloat,a.textureFormatFloat,r.FLOAT)}function cC(r,n,t,e,a){var o=Ql(t,e);return Ku(r,n,o[0],o[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function fC(r,n,t,e,a){var o=Ql(t,e);return Ku(r,n,o[0],o[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function hC(r,n,t,e,a){var o=Xu(t,e);return Ku(r,n,o[0],o[1],a.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function dC(r,n,t,e,a){var o=Xu(t,e);return Ku(r,n,o[0],o[1],a.internalFormatPackedHalfFloat,r.RGBA,a.textureTypeHalfFloat)}function pC(r,n,t,e){return Ct(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,e)}),Uy(r,n,t,"clipSpacePos",e,3,20,0)&&Uy(r,n,t,"uv",e,2,20,12)}function vC(r,n,t,e,a,o,l){var s,f,h;Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(e*a*4),f=r.UNSIGNED_BYTE,h=r.RGBA):(s=new Float32Array(e*a*4),f=r.FLOAT,h=l.internalFormatPackedFloat),s.set(o),Ct(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,h,e,a,0,r.RGBA,f,s)}),Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function mC(r,n,t,e){Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,t)}),e.data instanceof Uint8Array?Ct(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width,e.height,0,r.RGBA,r.UNSIGNED_BYTE,e.data)}):Ct(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}),Ct(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function gC(r,n,t,e,a){var o=r.createBuffer();Ct(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,o)});var l=16*t*e;return Ct(r,n,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,l,r.STREAM_READ)}),Ct(r,n,function(){return r.readPixels(0,0,e,t,r.RGBA,r.FLOAT,0)}),Ct(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),o}function yC(r,n,t){var e=r,a=new Float32Array(t);return e.bindBuffer(e.PIXEL_PACK_BUFFER,n),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,a),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),a}function bC(r,n,t,e,a){var o=Ql(t,e),l=o[0],s=o[1],f=new Uint8Array(t*e*4);return Ct(r,n,function(){return r.readPixels(0,0,l,s,a.downloadTextureFormat,r.UNSIGNED_BYTE,f)}),new Float32Array(f.buffer)}function xC(r,n,t,e,a,o,l,s){var f=r,h=new Float32Array(function(p,v){var g=Xu(p,v);return g[0]*g[1]*4}(o,l));return f.bindBuffer(f.PIXEL_PACK_BUFFER,n),f.getBufferSubData(f.PIXEL_PACK_BUFFER,0,h),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),h}function wC(r,n,t,e){var a=new Float32Array(t*e*4);return Ct(r,n,function(){return r.readPixels(0,0,e,t,r.RGBA,r.FLOAT,a)}),a}var _C=function(){function r(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=ut().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,Qw(t,n)):this.gl=Br(t);var e="WEBGL_color_buffer_float";if(ut().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=hl(this.gl,this.debug,"OES_texture_float"),ir(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=hl(this.gl,this.debug,"OES_texture_half_float");else if(ut().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(e),ir(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=hl(this.gl,this.debug,"EXT_color_buffer_half_float");else if(ut().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(e="EXT_color_buffer_float",ir(this.gl,e))this.colorBufferFloatExtension=this.gl.getExtension(e);else{if(!ir(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=uC(this.gl,this.debug),this.indexBuffer=sC(this.gl,this.debug),this.framebuffer=c_(this.gl,this.debug),this.textureConfig=kd(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return ut().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ct(t,this.debug,function(){return t.finish()}),Ct(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ct(t,this.debug,function(){return t.deleteFramebuffer(n.framebuffer)}),Ct(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Ct(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Ct(t,this.debug,function(){return t.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),lC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),cC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),fC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),mC(this.gl,this.debug,n,t)},r.prototype.uploadDenseMatrixToTexture=function(n,t,e,a){this.throwIfDisposed(),vC(this.gl,this.debug,n,t,e,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),dC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),hC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(Hy(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ct(this.gl,this.debug,function(){return t.gl.deleteTexture(n)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,e){var a=this;return this.downloadMatrixDriver(n,function(){return bC(a.gl,a.debug,t,e,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(n,t,e,a,o,l){return xC(this.gl,n,0,0,0,o,l,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return yC(this.gl,n,t)},r.prototype.createBufferFromTexture=function(n,t,e){this.bindTextureToFrameBuffer(n);var a=gC(this.gl,this.debug,t,e,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},r.prototype.createFence=function(n){var t,e,a=this;if(ut().getBool("WEBGL_FENCE_API_ENABLED")){var o=n,l=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),e=function(){var s=o.clientWaitSync(l,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=l}else ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),e=function(){return a.isQueryAvailable(t,ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):e=function(){return!0};return{query:t,isFencePassed:e}},r.prototype.downloadMatrixFromPackedTexture=function(n,t,e){var a=this;return this.downloadMatrixDriver(n,function(){return wC(a.gl,a.debug,t,e)})},r.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,e=n_(t,this.debug,n),a=oC(t,this.debug),o=a_(t,this.debug);return Ct(t,this.debug,function(){return t.attachShader(o,a)}),Ct(t,this.debug,function(){return t.attachShader(o,e)}),i_(t,this.debug,o),this.debug&&zh(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=pC(t,this.debug,this.program,this.vertexBuffer)),o},r.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&Ct(this.gl,this.debug,function(){return t.gl.deleteProgram(n)})},r.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&zh(this.gl,this.debug,this.program),Ct(this.gl,this.debug,function(){return t.gl.useProgram(n)})},r.prototype.getUniformLocation=function(n,t,e){return e===void 0&&(e=!0),this.throwIfDisposed(),e?h_(this.gl,this.debug,n,t):d_(this.gl,n,t)},r.prototype.getAttributeLocation=function(n,t){var e=this;return this.throwIfDisposed(),Ct(this.gl,this.debug,function(){return e.gl.getAttribLocation(n,t)})},r.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},r.prototype.setInputMatrixTexture=function(n,t,e){this.throwIfDisposed(),this.throwIfNoProgram(),p_(this.gl,this.debug,this.program,n,t,e)},r.prototype.setOutputMatrixTexture=function(n,t,e){this.setOutputMatrixTextureDriver(n,e,t)},r.prototype.setOutputPackedMatrixTexture=function(n,t,e){this.throwIfDisposed();var a=Xu(t,e),o=a[0],l=a[1];this.setOutputMatrixTextureDriver(n,o,l)},r.prototype.setOutputMatrixWriteRegion=function(n,t,e,a){this.setOutputMatrixWriteRegionDriver(e,n,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(n,t,e,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&zh(this.gl,this.debug,this.program),dl(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Ct(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Ct(this.gl,this.debug,function(){return n.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=hl(this.gl,this.debug,ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),e=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,e),e}var a=this.getQueryTimerExtensionWebGL1(),o=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,o),o},r.prototype.endQuery=function(){if(ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,e=this.getQueryTimerExtensionWebGL2();t.endQuery(e.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(n){return wt(this,void 0,void 0,function(){var t=this;return _t(this,function(e){switch(e.label){case 0:return[4,Iy(function(){return t.disposed||t.isQueryAvailable(n,ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return e.sent(),[2,this.getQueryTime(n,ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(n,t){if(t===0)return null;if(t===2){var e=this.gl;return e.getQueryParameter(n,e.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(n,t){if(t===0)return!0;if(t===2){var e=this.gl,a=this.getQueryTimerExtensionWebGL2(),o=e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),o&&!this.disjoint},r.prototype.pollFence=function(n){var t=this;return new Promise(function(e){t.addItemToPoll(function(){return n.isFencePassed()},function(){return e()})})},r.prototype.pollItems=function(){for(var n=function(e){for(var a=0;a<e.length&&e[a]();++a);return a-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},r.prototype.addItemToPoll=function(n,t){var e=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||Iy(function(){return e.pollItems(),e.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Ph(this.gl,this.debug,n,this.framebuffer),this.debug&&dl(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Ph(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&dl(this.gl)):Hy(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var e=t();return this.unbindTextureToFrameBuffer(),e},r.prototype.setOutputMatrixTextureDriver=function(n,t,e){this.throwIfDisposed();var a=this.gl;Ph(a,this.debug,n,this.framebuffer),this.debug&&dl(a),this.outputTexture=n,Ct(a,this.debug,function(){return a.viewport(0,0,t,e)}),Ct(a,this.debug,function(){return a.scissor(0,0,t,e)})},r.prototype.setOutputMatrixWriteRegionDriver=function(n,t,e,a){var o=this;this.throwIfDisposed(),Ct(this.gl,this.debug,function(){return o.gl.scissor(n,t,e,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function t0(r,n){if(r.length!==n.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+n.length+" inputs");r.forEach(function(t,e){var a=t.logicalShape,o=n[e],l=o.shape;if(!Ye(a,l))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+l+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,f=o.isUniform?null:o.texData.texShape;if(!Ye(s,f))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+f+" must match")}})}var EC=function(r,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e=t.filterWidth,a=t.inChannels,o=t.strideWidth,l=t.strideHeight,s=t.padInfo,f=t.outWidth,h=t.dilationWidth,p=t.dilationHeight,v=t.dataFormat,g=s.left,y=s.top,x=a*e,w=ln(),_=v==="channelsLast",E=_?0:1,R=_?1:2,A="",C=0;C<=1;C++)for(var T=0;T<=1;T++)A+=`
          blockIndex = rc.y + `+T+`;
          pos = rc.x + `+C+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+f+")) * "+l+" - "+y+`;
            d0 = offsetY + `+p+" * (pos / "+x+`);

            if(d0 < `+n[E]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+f+".) * "+o+". - "+g+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+x+".) / "+a+`.));

              if(d1 < `+n[R]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+_+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*C+T)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*C+T)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+A+`

        `+w.output+` = result;
      }
    `},CC=function(r,n,t,e,a){this.variableNames=["x"],this.outputShape=[];var o,l=n,s=r[3]-1;this.outputShape=r;var f="float("+t+") + float("+e+") * sum";o=a===.5?"inversesqrt("+f+")":a===1?"1.0/("+f+")":"exp(log("+f+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+l+"; j <= "+l+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},SC=function(r,n,t,e,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=n,this.bias=t,this.alpha=e,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+e+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+e+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},RC=function(r,n,t,e,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,l=n,s=r[3]-1;this.outputShape=r;var f="float("+t+") + float("+e+") * sum";o=a===.5?"inversesqrt("+f+")":a===1?"1.0/("+f+")":"exp(log("+f+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+l+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+l+"; j <= "+l+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},AC=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideHeight,t=r.strideWidth,e=r.dilationHeight,a=r.effectiveFilterHeight,o=r.effectiveFilterWidth,l=a-1-r.padInfo.top,s=o-1-r.padInfo.left,f=a*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+e+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+f+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},TC=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideDepth,t=r.strideHeight,e=r.strideWidth,a=r.dilationDepth,o=r.dilationHeight,l=r.dilationWidth,s=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=s-1-r.padInfo.front,v=f-1-r.padInfo.top,g=h-1-r.padInfo.left,y=s*f*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+v+", "+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+f+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+e+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+y+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+f+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Gh=function(r,n,t,e,a,o,l){t===void 0&&(t=!1),e===void 0&&(e=!1),a===void 0&&(a=!1),o===void 0&&(o=null),l===void 0&&(l=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=t?r[1]:r[2],f=Math.ceil(s/2),h=t?"i * 2, rc.y":"rc.y, i * 2",p=e?"rc.z, i * 2":"i * 2, rc.z",v=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=e?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],y="",x="";o&&(y=l?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,x="result = activation(result);");var w=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const float sharedDimension = `+f+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+f+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+p+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+v[0]+" * "+g[0]+`);
          result += (`+v[1]+" * "+g[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+w+`

        `+x+`

        setOutput(result);
      }
    `},DC=function(){function r(n,t,e){this.variableNames=["probs"],this.outputShape=[n,e],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,a){t.seedLoc==null&&(t.seedLoc=e.getUniformLocation(a,"seed")),e.gl.uniform1f(t.seedLoc,n)}},r}(),NC=function(r,n,t,e){this.variableNames=["indices"],this.outputShape=[r,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+e+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},MC=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var n=r.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Sn("rc",n),e=he(n),a=function(s,f,h){if(s===1)return"rc > "+f[0];for(var p="",v=s-2;v<s;v++)p+=h[v]+" >= "+f[v],v<s-1&&(p+="||");return p}(n,r,t),o=function(s,f,h,p){if(s===1)return"";var v=p.slice(-2);return`
    int r = `+v[0]+`;
    int c = `+v[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+f+`;
    bool rEdge = rp1 >= `+h+`;
  `}(n,r[r.length-1],r[r.length-2],t),l=function(s,f){var h=s.length,p=function(v,g){for(var y=[],x=0;x<=1;x++)for(var w=0;w<=1;w++){for(var _=(x===0?"r":"rp1")+", "+(w===0?"c":"cp1"),E=2;E<v;E++)_=g[g.length-1-E]+","+_;y.push(_)}return y}(h,f);return h===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+p[0]+`),
          cEdge ? 0. : getA(`+p[1]+`),
          rEdge ? 0. : getA(`+p[2]+`),
          rEdge || cEdge ? 0. : getA(`+p[3]+")"}(r,t);this.userCode=`
        void main() {
          `+e+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+l+`));
          }
        }
      `}},kC=function(r,n,t){this.variableNames=["x"],this.outputShape=n.map(function(f,h){return f[0]+r[h]+f[1]});var e=r.length,a=he(e),o=n.map(function(f){return f[0]}).join(","),l=n.map(function(f,h){return f[0]+r[h]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e);this.userCode=e!==1?`
      `+a+" start = "+a+"("+o+`);
      `+a+" end = "+a+"("+l+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+l+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},OC=function(r,n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(_,E){return _[0]+r[E]+_[1]});for(var e=r.length,a=he(e),o=n.map(function(_){return _[0]}).join(","),l=n.map(function(_,E){return _[0]+r[E]}).join(","),s=Sn("rc",e),f=Sn("source",e),h=s[e-1]+" < "+this.outputShape[e-1],p=e===1?"source":"vec2("+f.slice(-2).join()+")",v=[a+" rc = outputLoc;",s[e-1]+` += 1;
       if(`+h+`) {
      `,e===1?"":`}
       rc = outputLoc;
       `+s[e-2]+` += 1;
       if(`+s[e-2]+" < "+this.outputShape[e-2]+") {",e===1?"":"  "+s[e-1]+` += 1;
         if(`+h+") {"],g=e===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",y="",x=0,w=e===1?2:4;x<w;x++)y+=`
        `+v[x]+`
        if (`+g+`) {
          result[`+x+"] = float("+t+`);
        } else {
          `+a+` source = rc - start;
          result[`+x+"] = getChannel(getX("+f.join()+"), "+p+`);
        }
      `;y+=e===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+o+`);
      const `+a+" end = "+a+"("+l+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+y+`
        setOutput(result);
      }
    `},qh=function(r,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var e=r.filterWidth,a=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,s=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,v=r.padInfo.left;this.outputShape=r.outShape;var g=n==="avg",y="0.0";if(g||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+o+`);
        const ivec2 pads = ivec2(`+p+", "+v+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+f+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(x="avgValue / count");var w=4*Math.floor(e/4),_=e%4,E=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+o+`);
      const ivec2 pads = ivec2(`+p+", "+v+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+f+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+E+`
          }

          int xC = xCCorner + `+w+`;
          if (`+(_===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(_===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(_===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+E+`
          }
        }
        setOutput(`+x+`);
      }
    `}},jh=function(r,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var e=r.filterWidth,a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,s=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,g=r.effectiveFilterWidth,y=r.padInfo.front,x=r.padInfo.top,w=r.padInfo.left;this.outputShape=r.outShape;var _=n==="avg",E="0.0";if(_||(E="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+o+", "+l+`);
        const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+p+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+v+`;
                wR += `+f+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+v+" * "+g+` +
                      wR * `+g+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var R=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(R="avgValue / count");var A=4*Math.floor(e/4),C=e%4,T=`
      if (`+_+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+o+", "+l+`);
      const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+v+`;
            wR += `+f+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+A+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+T+`
            }

            int xC = xCCorner + `+A+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+T+`
            }
          }
          setOutput(`+R+`);
        }
      }
    `}},IC=function(r,n){this.variableNames=["x"];var t=r.windowSize,e=r.batchSize,a=r.inSize,o=Math.ceil(a/t);this.outputShape=[e,o];var l="0.0",s="";n==="prod"?l="1.0":n==="min"?(l="1.0 / 1e-20",s="min"):n==="max"&&(l="-1.0 / 1e-20",s="max");var f=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?f="sumValue":n==="prod"?f="prodValue":n==="all"?f="allValue":n==="any"&&(f="anyValue");var h=4*Math.floor(t/4),p=t%4,v=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,g="vec4";n==="all"?(l="1.0",v=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):n==="any"&&(l="0.0",v=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");var y="";a%t>0&&(y=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+l+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+y+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+l+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+v+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(p===1)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+v+`
        } else if (`+(p===2)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+v+`
        } else if (`+(p===3)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+v+`
        }
        setOutput(`+f+`);
      }
    `},BC=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",e=0;e<4;e++){var a="thisRC = rc;";e%2==1&&(a+="thisRC.z += 1;"),e>1&&(a+="thisRC.y += 1;"),t+=`
        `+a+`
        `+(e>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+e+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(e>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+hi(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+Vd(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},FC=function(r,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var e=n.shape,a=e[1],o=e[2],l=r.shape,s=l[1],f=l[2],h=[t&&s>1?a-1:a,t&&f>1?o-1:o],p=[t&&s>1?s-1:s,t&&f>1?f-1:f],v=h[0]/p[0],g=h[1]/p[1],y=1/v,x=1/g,w=2*Math.ceil(y)+2,_=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+v+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+_+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+f+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},LC=function(r,n,t,e){this.variableNames=["A"],this.outputShape=[];var a=r[0],o=r[1],l=r[2],s=r[3];this.outputShape=[a,n,t,s];var f=[e&&n>1?o-1:o,e&&t>1?l-1:l],h=[e&&n>1?n-1:n,e&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},zC=function(r,n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=r[0],o=r[1],l=r[2],s=r[3];this.outputShape=[a,n,t,s];var f=[e&&n>1?o-1:o,e&&t>1?l-1:l],h=[e&&n>1?n-1:n,e&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+l+`.0,
                                     `+l+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},PC=function(r,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var e=n.shape,a=e[1],o=e[2],l=r.shape,s=l[1],f=l[2],h=[t&&s>1?a-1:a,t&&f>1?o-1:o],p=[t&&s>1?s-1:s,t&&f>1?f-1:f],v=h[0]/p[0],g=h[1]/p[1],y=1/v,x=1/g,w=2*Math.ceil(y)+2,_=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+v+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+_+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+f+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+p[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+p[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},UC=function(r,n,t,e){this.variableNames=["A"],this.outputShape=[];var a=r[0],o=r[1],l=r[2],s=r[3];this.outputShape=[a,n,t,s];var f=[e&&n>1?o-1:o,e&&t>1?l-1:l],h=[e&&n>1?n-1:n,e&&t>1?t-1:t],p=e?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},HC=function(r,n){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var e=r.map(function(o,l){return function(s){return n.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(l)}).join(","),a=he(t);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+e+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},VC=function(r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var e=Sn("rc",t),a=e[t-1]+" + 1 < "+this.outputShape[t-1],o=e[t-2]+" + 1 < "+this.outputShape[t-2],l=he(t);function s(f){var h=r.map(function(p,v){return function(g,y){return n.indexOf(g)!==-1&&r[g]!==1?r[g]+" - "+y[g]+" - 1":""+y[g]}(v,f)});return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+l+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(f){return s(f)}(e.slice())+`;
          if(`+a+`){
            result.g = `+function(f){return f[t-1]="("+f[t-1]+" + 1)",s(f)}(e.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(f){return f[t-2]="("+f[t-2]+" + 1)",s(f)}(e.slice())+`;
            if(`+a+`) {
              result.a = `+function(f){return f[t-1]="("+f[t-1]+" + 1)",f[t-2]="("+f[t-2]+" + 1)",s(f)}(e.slice())+`;
            }
          }
          setOutput(result);
        }
    `},e0=function(r,n,t,e,a,o,l){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=he(a.length),f=he(o.length),h="";t===1?h="i":t===2&&(h="i, j");var p="getIndices("+h+")",v="";e===1?v="i":e===2&&(v="i, coords[1]");var g="getUpdates("+v+")",y=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+a+`);

        void main() {
          `+f+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+p+`);
              flattenedIndex += index * `+y+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+g+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},WC=function(r,n){this.variableNames=["x","segmentIds"];var t=r.windowSize,e=r.batchSize,a=r.inSize,o=r.numSegments,l=o*Math.ceil(a/t);this.outputShape=[e,l];var s=4*Math.floor(t/4),f=t%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";a%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var v="";a%t>0&&(v=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+v+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(f===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(f===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(f===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},GC=function(r,n,t){var e,a;if(this.variableNames=["c","a","b"],this.outputShape=n,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)a="resRC",e="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],s=[],f=0;f<n.length;f++)s.push(""+o[f]),f<r&&l.push(""+o[f]);e=l.join(),a=s.join()}var h=he(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+e+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},qC=function(){function r(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,e=he(this.rank),a="uniform int start["+this.rank+"];",o=function(l){if(l===1)return"sourceLoc";if(l<=6)return Xh.slice(0,l).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+l+" is not yet supported")}(this.rank);t=`
        `+e+` sourceLoc;
        `+e+` coords = getOutputCoords();
        `+n.map(function(l,s){return"sourceLoc."+Xh[s]+" = start["+s+"] + coords."+Xh[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(e,a){t.startLoc==null&&(t.startLoc=e.getUniformLocationNoThrow(a,"start"),t.startLoc==null)||e.gl.uniform1iv(t.startLoc,n)}},r}(),Xh=["x","y","z","w","u","v"],jC=function(){function r(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=he(this.rank),e=Sn("coords",this.rank),a=Sn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",l="getChannel(getSource("+a.join()+"), "+o+")",s=`
      result.x = `+l+`;
      if (++`+e[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+l+`;
        --`+a[this.rank-1]+`;
      }
    `,f=this.rank===1?"":`
      --`+e[this.rank-1]+`;
      if (++`+e[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+l+`;
        if (++`+e[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+l+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+n.map(function(p,v){return"start["+v+"]"}).join()+");":n.map(function(p,v){return a[v]+" = "+e[v]+" + start["+v+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+s+`
        `+f+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(e,a){t.startLoc==null&&(t.startLoc=e.getUniformLocationNoThrow(a,"start"),t.startLoc==null)||e.gl.uniform1iv(t.startLoc,n)}},r}(),XC=function(r,n,t){this.variableNames=["x"],this.outputShape=t;var e=t.length,a=he(t.length),o=he(t.length),l="";if(e===1)l="coords * strides + begin";else{var s=0;l=t.map(function(f,h){return s++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(s-1)+"] * strides["+h+"] + begin["+h+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+r+`);
      `+a+" strides = "+a+"("+n+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+l+`));
      }
    `},KC=function(){function r(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(n,t,e){var a,o=n0(t,e),l=r0(n,o,e);if(l in this.freeTextures||(this.freeTextures[l]=[]),l in this.usedTextures||(this.usedTextures[l]=[]),this.freeTextures[l].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[l].shift();return this.usedTextures[l].push(s),s}return this.numUsedTextures++,this.log(),o===Pn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===Pn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===Pn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===Pn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===Pn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[l].push(a),a},r.prototype.releaseTexture=function(n,t,e,a){if(this.freeTextures!=null){var o=r0(t,n0(e,a),a);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(n),this.numFreeTextures++,this.numUsedTextures--;var l=this.usedTextures[o],s=l.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(e){n.gpgpu.deleteMatrixTexture(e)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){n.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function n0(r,n){if(r===Un.UPLOAD)return Pn.PACKED_2X2_FLOAT32;if(r===Un.RENDER||r==null)return function(t){return ut().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Pn.PACKED_2X2_FLOAT32:Pn.UNPACKED_FLOAT32:t?Pn.PACKED_2X2_FLOAT16:Pn.UNPACKED_FLOAT16}(n);if(r===Un.DOWNLOAD||r===Un.PIXELS)return Pn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function r0(r,n,t){return r[0]+"_"+r[1]+"_"+n+"_"+t}var YC=function(r,n){this.variableNames=["A"];for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[e]*n[e];this.outputShape=t,this.rank=t.length;var a=he(this.rank),o=function(l){var s=l.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+l[0]+")";for(var f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],p=0;p<l.length;p++)h.push("imod("+f[p]+", "+l[p]+")");return h.join()}(r);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},QC=function(r,n){this.variableNames=["A"];for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[n[e]];this.outputShape=t,this.rank=t.length;var a=he(this.rank),o=function(l){var s=l.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(s),p=0;p<l.length;p++)h[l[p]]=f[p];return h.join()}(n);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},ZC=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[n[e]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=he(this.rank),o=x1("rc",this.rank),l=new Array(this.rank);for(e=0;e<n.length;e++)l[n[e]]=o[e];var s="vec2("+l.slice(-2).join()+")",f="++"+o[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+l.join()+"), "+s+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+f+`) {
        result[1] = `+h+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+f+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `},Wd=1.7580993408473768,Gd=1.0507009873554805,zt=function(r,n){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},pr="if (isnan(x)) return x;",JC="return x;",a0="return abs(x);",S1=pr+`
  return (x < 0.0) ? 0.0 : x;
`,R1=pr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,A1="return (x >= 0.0) ? x : (exp(x) - 1.0);",$C=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Wd+`;
  float scale = `+Gd+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,i0="return -x;",o0="return ceil(x);",u0="return floor(x);",s0="return exp(x);",l0="return exp(x) - 1.0;",tS=pr+`
  return sin(x);
`,eS=pr+`
  return cos(x);
`,nS=pr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,rS=pr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,aS=pr+`
  return atan(x);
`,iS=pr+"return log(x + sqrt(x * x + 1.0));",oS=pr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,uS=pr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,gl="return x;",sS="return x;",T1=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,D1=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,N1=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ku=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},lS=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var n=r.length,t=Sn("rc",n),e=he(n),a=function(s,f){if(s===1)return"rc";for(var h="",p=0;p<s;p++)h+=f[p],p<s-1&&(h+=",");return h}(n,t),o=t.slice(-2),l=n<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+e+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+l+`));
      }
    `},yl={};function bl(r,n){if(n===void 0&&(n=!1),r==="linear")return n?sS:JC;if(r==="relu")return n?T1:S1;if(r==="elu")return n?N1:A1;if(r==="relu6")return n?D1:R1;if(r==="prelu")return n?C1:E1;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var cS=600,fS=function(r){function n(t){var e,a=r.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!ut().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=Br(ut().getNumber("WEBGL_VERSION"));a.binaryCache=((e=ut().getNumber("WEBGL_VERSION"))in yl||(yl[e]={}),yl[e]),a.gpgpu=new _C(o),a.canvas=o.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=t,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=t.gl.canvas;return a.textureManager=new KC(a.gpgpu),a.numMBBeforeWarning=ut().global.screen==null?1024:ut().global.screen.height*ut().global.screen.width*window.devicePixelRatio*cS/1024/1024,a.texData=new f1(a,G),a}return dr(n,r),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(t,e,a){if(ut().getBool("DEBUG")&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:e,dtype:a,values:t,usage:Un.UPLOAD}),o},n.prototype.move=function(t,e,a,o){if(ut().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:o,values:e,usage:Un.UPLOAD})},n.prototype.readSync=function(t){var e=this.texData.get(t),a=e.values,o=e.dtype,l=e.complexTensors,s=e.slice,f=e.shape,h=e.isPacked;if(s!=null){var p=void 0;p=h?new ku(f,gl):new zt(f,gl);var v=this.runWebGLProgram(p,[{dataId:t,shape:f,dtype:o}],o),g=this.readSync(v.dataId);return this.disposeData(v.dataId),g}if(a!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return a;var y,x,w=this.activeTimers!=null;return w&&(y=Sr()),o==="complex64"?x=bd(l.real.dataSync(),l.imag.dataSync()):x=this.getValuesFromTexture(t),w&&(this.downloadWaitMs+=Sr()-y),this.convertAndCacheOnCPU(t,x)},n.prototype.read=function(t){return wt(this,void 0,void 0,function(){var e,a,o,l,s,f,h,p,v,g,y,x,w,_,E,R,A,C,T,N,L,B;return _t(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(F){return e.push(F)})];if(a=this.texData.get(t),o=a.values,l=a.shape,s=a.slice,f=a.dtype,h=a.complexTensors,p=a.isPacked,s!=null)return v=void 0,v=p?new ku(l,gl):new zt(l,gl),g=this.runWebGLProgram(v,[{dataId:t,shape:l,dtype:f}],f),y=this.read(g.dataId),this.disposeData(g.dataId),[2,y];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!ut().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ut().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return x=null,f!=="complex64"&&ut().get("WEBGL_BUFFER_SUPPORTED")&&(w=this.decode(t),_=this.texData.get(w.dataId),x=(B=this.gpgpu).createBufferFromTexture.apply(B,[_.texture].concat(Iu(l)))),this.pendingRead.set(t,[]),f==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return f!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return R=I.sent(),A=R[0],C=R[1],E=bd(A,C),[3,5];case 4:x==null?E=this.getValuesFromTexture(t):(T=Et(l),E=this.gpgpu.downloadFloat32MatrixFromBuffer(x,T)),I.label=5;case 5:return w!=null&&this.disposeData(w.dataId),N=this.convertAndCacheOnCPU(t,E),L=this.pendingRead.get(t),this.pendingRead.delete(t),L.forEach(function(F){return F(N)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,N]}})})},n.prototype.checkNumericalProblems=function(t){if(t!=null)for(var e=0;e<t.length;e++){var a=t[e];if(!$w(a))throw ut().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(t){var e,a=this.texData.get(t),o=a.shape,l=a.dtype,s=a.isPacked,f=Et(o);if(ut().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),p=this.texData.get(h.dataId),v=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[p.texture].concat(Iu(o))).subarray(0,f);return this.disposeData(h.dataId),v}var g=ut().getBool("WEBGL_PACK")&&s===!0,y=g?Uh(o):o,x=g?new JE(y):new ZE(y),w=this.runWebGLProgram(x,[{shape:y,dtype:l,dataId:t}],"float32"),_=this.texData.get(w.dataId),E=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(_.texture,_.texShape[0],_.texShape[1]).subarray(0,f);return this.disposeData(w.dataId),E},n.prototype.time=function(t){return wt(this,void 0,void 0,function(){var e,a,o,l,s,f,h;return _t(this,function(p){switch(p.label){case 0:return e=this.activeTimers,a=[],o=!1,this.programTimersStack==null?(this.programTimersStack=a,o=!0):this.activeTimers.push(a),this.activeTimers=a,t(),l=Eo(this.activeTimers.map(function(v){return v.query})).filter(function(v){return v!=null}),s=Eo(this.activeTimers.map(function(v){return v.name})).filter(function(v){return v!=null}),this.activeTimers=e,o&&(this.programTimersStack=null),f={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(l)]:[3,2];case 1:return h=p.sent(),f.kernelMs=Ow(h),f.getExtraProfileInfo=function(){return h.map(function(v,g){return{name:s[g],ms:v}}).map(function(v){return v.name+": "+v.ms}).join(", ")},[3,3];case 2:f.kernelMs={error:"WebGL query timers are not supported in this environment."},p.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,f]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Sr(),endMs:null}},n.prototype.endTimer=function(t){return ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Sr(),t)},n.prototype.getQueryTime=function(t){return wt(this,void 0,void 0,function(){var e;return _t(this,function(a){return ut().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},n.prototype.releaseGPUData=function(t){var e=this.texData.get(t),a=e.texture,o=e.dtype,l=e.texShape,s=e.usage,f=e.isPacked,h=e.slice,p=h&&h.origDataId||t,v=this.dataRefCount.get(p);v>1?this.dataRefCount.set(p,v-1):(this.dataRefCount.delete(p),a!=null&&(this.numBytesInGPU-=this.computeBytes(l,o),this.textureManager.releaseTexture(a,l,s,f)));var g=this.texData.get(t);g.texture=null,g.texShape=null,g.isPacked=!1,g.slice=null},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getDataInfo=function(t){return this.texData.get(t)},n.prototype.getCPUBackend=function(){return ut().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=G.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,e){var a=this;return e===void 0&&(e=128),this.getCPUBackend()!=null&&t.every(function(o){return a.texData.get(o.dataId).texture==null&&o.size<e})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(t,e){var a=this.makeOutput(t.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:G.keep(t.clone()),imag:G.keep(e.clone())},a},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,e,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,a);if(Et(a)===0)return nn([],a,t.dtype);var o=this.texData.get(t.dataId).isPacked,l=l1(t.shape,e,a);if(o||!l){var s=ut().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jC(a):new qC(a),f=s.getCustomSetupFunc(e);return this.compileAndRun(s,[t],null,f)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,a)},n.prototype.shallowSlice=function(t,e,a){var o=this.texData.get(t.dataId),l=this.makeOutput(a,t.dtype),s=this.texData.get(l.dataId);Object.assign(s,o),s.shape=a,s.dtype=t.dtype;var f=c1(e,t.strides);o.slice&&(f+=o.slice.flatOffset),s.slice={flatOffset:f,origDataId:o.slice&&o.slice.origDataId||t.dataId};var h=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,h+1),l},n.prototype.stridedSlice=function(t,e,a,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,a,o);var l=Ld(e,a,o);if(l.some(function(f){return f===0}))return nn([],l);var s=new XC(e,o,l);return this.compileAndRun(s,[t])},n.prototype.reverse=function(t,e){var a=ut().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VC(t.shape,e):new HC(t.shape,e);return this.compileAndRun(a,[t])},n.prototype.concat=function(t,e){if(t[0].dtype==="complex64"){var a=t.map(function(y){return ar(y)}),o=t.map(function(y){return Ar(y)});return tn(this.concat(a,e),this.concat(o,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(t.length===1)return t[0];if(t.length>ut().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var l=Math.floor(t.length/2),s=this.concat(t.slice(0,l),e),f=this.concat(t.slice(l),e);return this.concat([s,f],e)}if(ut().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new LE(t.map(function(y){return y.shape}),e);return this.compileAndRun(h,t)}var p=So(t.map(function(y){return y.shape}),e),v=t.map(function(y){return y.as2D(-1,Et(y.shape.slice(e)))}),g=new FE(v.map(function(y){return y.shape}));return this.compileAndRun(g,v).reshape(p)},n.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,i0,t.dtype);var e=new zt(t.shape,i0);return this.compileAndRun(e,[t])},n.prototype.batchMatMul=function(t,e,a,o){var l=a?t.shape[2]:t.shape[1],s=o?e.shape[1]:e.shape[2],f=a?t.shape[1]:t.shape[2],h=t.shape[0];if((l===1||s===1)&&f>1e3){a&&(t=t.transpose([0,2,1])),o&&(e=e.transpose([0,2,1]));var p=s===1?t:t.as3D(h,f,1),v=s===1?2:1,g=s===1?e.as3D(h,1,f):e;return this.multiply(p,g).sum(v,!0)}var y=en(t.dtype,e.dtype),x=new Gh(t.shape,[h,l,s],a,o);return this.compileAndRun(x,[t,e],y)},n.prototype.fusedBatchMatMul=function(t){var e=t.a,a=t.b,o=t.transposeA,l=t.transposeB,s=t.bias,f=t.activation,h=t.preluActivationWeights,p=o?e.shape[2]:e.shape[1],v=l?a.shape[1]:a.shape[2],g=e.shape[0],y=en(e.dtype,a.dtype),x=s!=null,w=h!=null,_=f?bl(f,!0):null,E=new Gh(e.shape,[g,p,v],o,l,x,_,w),R=[e,a];return s&&R.push(s),h&&R.push(h),this.compileAndRun(E,R,y)},n.prototype.multiply=function(t,e){if(t.dtype==="complex64"){var a=this.texData.get(t.dataId),o=this.texData.get(e.dataId),l=new Xy(ME,t.shape,e.shape),s=new Xy(kE,t.shape,e.shape),f=[this.makeComplexComponentTensorInfo(t,a.complexTensors.real),this.makeComplexComponentTensorInfo(t,a.complexTensors.imag),this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],h=this.compileAndRun(l,f),p=this.compileAndRun(s,f),v=this.complex(h,p);return h.dispose(),p.dispose(),v}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Ky,t.dtype);var g=new Ce(Ky,t.shape,e.shape);return this.compileAndRun(g,[t,e],t.dtype)},n.prototype.batchNormalization=function(t,e,a,o,l,s){var f=[t,e,a],h=null;s!=null&&(h=s.shape,f.push(s));var p=null;if(l!=null&&(p=l.shape,f.push(l)),ut().getBool("WEBGL_PACK_NORMALIZATION")){var v=new NE(t.shape,e.shape,a.shape,h,p,o);return this.compileAndRun(v,f)}var g=new DE(t.shape,e.shape,a.shape,h,p,o);return this.compileAndRun(g,f)},n.prototype.localResponseNormalization4D=function(t,e,a,o,l){var s=ut().getBool("WEBGL_PACK_NORMALIZATION")?new RC(t.shape,e,a,o,l):new CC(t.shape,e,a,o,l);return this.compileAndRun(s,[t])},n.prototype.LRNGrad=function(t,e,a,o,l,s,f){var h=new SC(e.shape,o,l,s,f);return this.compileAndRun(h,[e,a,t])},n.prototype.tile=function(t,e){if(t.dtype==="string"){var a=this.readSync(t.dataId).map(function(l){return Dl(l)});return y1(Bt(t.shape,t.dtype,a),e)}var o=new YC(t.shape,e);return this.compileAndRun(o,[t])},n.prototype.pad=function(t,e,a){var o=ut().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OC(t.shape,e,a):new kC(t.shape,e,a);return this.compileAndRun(o,[t])},n.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var a=ut().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZC(t.shape,e):new QC(t.shape,e);return this.compileAndRun(a,[t])},n.prototype.gather=function(t,e,a){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,a);var o=new aC(t.shape,e.size,a);return this.compileAndRun(o,[t,e])},n.prototype.batchToSpaceND=function(t,e,a){O(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=e.reduce(function(v,g){return v*g}),l=Bl(t.shape,e,o),s=Fl(l.length,e.length),f=Ll(t.shape,e,o),h=i1(a,e.length),p=o1(f,a,e.length);return t.reshape(l).transpose(s).reshape(f).slice(h,p)},n.prototype.spaceToBatchND=function(t,e,a){O(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=e.reduce(function(g,y){return g*y}),l=[[0,0]];l.push.apply(l,a);for(var s=1+e.length;s<t.shape.length;++s)l.push([0,0]);var f=t.pad(l),h=Bl(f.shape,e,o,!1),p=Fl(h.length,e.length,!1),v=Ll(f.shape,e,o,!1);return f.reshape(h).transpose(p).reshape(v)},n.prototype.reduce=function(t,e,a){var o=t.shape[0],l=t.shape[1],s=Hh(l),f=new IC({windowSize:s,inSize:l,batchSize:o},e),h=this.compileAndRun(f,[t],a);return h.shape[1]===1?h:this.reduce(h,e,a)},n.prototype.argReduce=function(t,e,a){a===void 0&&(a=null);var o=t.shape[0],l=t.shape[1];a!=null&&(o=a.shape[0],l=a.shape[1]);var s=Hh(l),f=new xE({windowSize:s,inSize:l,batchSize:o},e,a==null),h=[t];a!=null&&h.push(a);var p=this.compileAndRun(f,h,"int32");return p.shape[1]===1?p:this.argReduce(t,e,p)},n.prototype.argReducePacked=function(t,e,a){a===void 0&&(a=null);var o=a!=null?a.shape:t.shape,l=Hh(o[o.length-1]),s=new RE(o,l,e,a==null),f=a==null?[t]:[t,a],h=this.compileAndRun(s,f,"int32");return h.rank===t.rank?this.argReducePacked(t,e,h):h},n.prototype.sum=function(t,e){zn("sum",e,t.rank);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l),f=Oh(t.dtype);return this.reduce(s,"sum",f).reshape(o)},n.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l),f=Oh(t.dtype);return this.reduce(s,"prod",f).reshape(o)},n.prototype.unsortedSegmentSum=function(t,e,a){var o=0,l=Fr([o],t.rank),s=t;l!=null&&(s=t.transpose(l),o=Lr(1,t.rank)[0]);var f=function(y,x,w){for(var _=[],E=y.length,R=0;R<E;R++)R!==x?_.push(y[R]):_.push(w);return _}(s.shape,o,a),h=Et([s.shape[o]]),p=s.as2D(-1,h),v=Oh(t.dtype),g=this.segOpCompute(p,"unsortedSegmentSum",e,v,a).reshape(f);return l!=null&&(g=g.transpose(Od(l))),g},n.prototype.segOpCompute=function(t,e,a,o,l){var s=t.shape[0],f=t.shape[1],h=function(g,y){var x,w=!1;for(g<=s1?(x=g,w=!0):x=cd(g,Math.floor(Math.sqrt(g)));!w;)x>y||x===g?w=!0:x=cd(g,x+1);return x}(f,l),p=new WC({windowSize:h,inSize:f,batchSize:s,numSegments:l}),v=this.compileAndRun(p,[t,a],o);return v.shape[1]===l?v:(a=Il(0,l).tile([f/h]),this.segOpCompute(v,e,a,o,l))},n.prototype.argMinMaxReduce=function(t,e,a){var o=[e];if(zn("arg"+a.charAt(0).toUpperCase()+a.slice(1),o,t.rank),!ut().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var l=un(t.shape,o),s=l[0],f=Et(l[1]),h=t.as2D(-1,f);return this.argReduce(h,a).reshape(s)}return this.argReducePacked(t,a)},n.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},n.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},n.prototype.cumsum=function(t,e,a,o){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var l=new jE(t.shape,a,o);return this.compileAndRun(l,[t])},n.prototype.equal=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(equal(a, b));
`,"bool");var a=new Ce("return float(a == b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.notEqual=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(notEqual(a, b));
`,"bool");var a=new Ce("return float(a != b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(lessThan(a, b));
`,"bool");var a=new Ce("return float(a < b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.lessEqual=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new Ce("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new Ce("return float(a > b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.greaterEqual=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new Ce("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.logicalNot=function(t){var e=new zt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},n.prototype.logicalAnd=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new Ce("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.logicalOr=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new Ce("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.select=function(t,e,a){var o=new GC(t.rank,e.shape,e.rank);return this.compileAndRun(o,[t,e,a],en(e.dtype,a.dtype))},n.prototype.where=function(t){kl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return Hd(t.shape,e)},n.prototype.topk=function(t,e,a){return b1(t.dataSync(),t.shape,t.dtype,e)},n.prototype.min=function(t,e){zn("min",e,t.rank);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l);return this.reduce(s,"min",s.dtype).reshape(o)},n.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new Ce(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.mod=function(t,e){var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new Ce(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);zn("max",e,t.rank);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l);return this.reduce(s,"max",s.dtype).reshape(o)},n.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new Ce(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.all=function(t,e){zn("all",e,t.rank);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l);return this.reduce(s,"all",s.dtype).reshape(o)},n.prototype.any=function(t,e){zn("any",e,t.rank);var a=un(t.shape,e),o=a[0],l=Et(a[1]),s=t.as2D(-1,l);return this.reduce(s,"any",s.dtype).reshape(o)},n.prototype.realDivide=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var a=new Ce(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,e.shape);return this.compileAndRun(a,[t,e],"float32")},n.prototype.floorDiv=function(t,e){if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new Ce(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,e.shape);return this.compileAndRun(a,[t,e],"int32")},n.prototype.add=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,Vh);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var a=en(t.dtype,e.dtype);if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Vh,a);var o=new Ce(Vh,t.shape,e.shape);return this.compileAndRun(o,[t,e],a)},n.prototype.packedUnaryOp=function(t,e,a){var o=new ku(t.shape,e);return this.compileAndRun(o,[t],a)},n.prototype.packedBinaryOp=function(t,e,a,o,l){l===void 0&&(l=!1);var s=new ta(a,t.shape,e.shape,l);return this.compileAndRun(s,[t,e],o)},n.prototype.complexSeparableBinaryOp=function(t,e,a){var o=this,l=this.texData.get(t.dataId),s=this.texData.get(e.dataId),f=[[l.complexTensors.real,s.complexTensors.real],[l.complexTensors.imag,s.complexTensors.imag]].map(function(g){var y=g[0],x=g[1],w=o.makeComplexComponentTensorInfo(t,y),_=o.makeComplexComponentTensorInfo(e,x),E=new Ce(a,t.shape,e.shape);return o.compileAndRun(E,[w,_],en(y.dtype,x.dtype))}),h=f[0],p=f[1],v=this.complex(h,p);return h.dispose(),p.dispose(),v},n.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},n.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>ut().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),a=this.addN(t.slice(0,e)),o=this.addN(t.slice(e));return this.addN([a,o])}var l=t.map(function(h){return h.dtype}).reduce(function(h,p){return en(h,p)}),s=t.map(function(h){return h.shape}),f=ut().getBool("WEBGL_PACK")?new bE(t[0].shape,s):new yE(t[0].shape,s);return this.compileAndRun(f,t,l)},n.prototype.subtract=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,Wh);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var a=en(t.dtype,e.dtype);if(ut().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Wh,t.dtype);var o=new Ce(Wh,t.shape,e.shape);return this.compileAndRun(o,[t,e],a)},n.prototype.pow=function(t,e){var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new Ce(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,e.shape),o=en(t.dtype,e.dtype);return this.compileAndRun(a,[t,e],o)},n.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,o0,t.dtype);var e=new zt(t.shape,o0);return this.compileAndRun(e,[t])},n.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,u0,t.dtype);var e=new zt(t.shape,u0);return this.compileAndRun(e,[t])},n.prototype.sign=function(t){var e=new zt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(e,[t])},n.prototype.isNaN=function(t){var e=new zt(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.isInf=function(t){var e=new zt(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.isFinite=function(t){var e=new zt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.round=function(t){var e=new zt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(e,[t])},n.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,s0,t.dtype);var e=new zt(t.shape,s0);return this.compileAndRun(e,[t])},n.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,l0,t.dtype);var e=new zt(t.shape,l0);return this.compileAndRun(e,[t])},n.prototype.softmax=function(t,e){var a=Pe([e],t.shape),o=this.max(t,a),l=An(o.shape,a),s=this.subtract(t,o.reshape(l)),f=this.exp(s),h=this.sum(f,a).reshape(l);return this.realDivide(f,h)},n.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var e=new zt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(e,[t])},n.prototype.log1p=function(t){var e=new zt(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},n.prototype.sqrt=function(t){var e=new zt(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new zt(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},n.prototype.reciprocal=function(t){var e=new zt(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},n.prototype.relu=function(t){var e;return e=ut().getBool("WEBGL_PACK")?new ku(t.shape,T1):new zt(t.shape,S1),this.compileAndRun(e,[t])},n.prototype.relu6=function(t){var e;return e=ut().getBool("WEBGL_PACK")?new ku(t.shape,D1):new zt(t.shape,R1),this.compileAndRun(e,[t])},n.prototype.prelu=function(t,e){var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(C1,t.shape,e.shape):new Ce(E1,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.elu=function(t){if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,N1,t.dtype);var e=new zt(t.shape,A1);return this.compileAndRun(e,[t])},n.prototype.eluDer=function(t,e){var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,e.shape):new Ce("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.selu=function(t){var e=new zt(t.shape,$C);return this.compileAndRun(e,[t])},n.prototype.int=function(t){var e=new zt(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},n.prototype.clip=function(t,e,a){var o,l=(o=ut().getBool("WEBGL_PACK_CLIP")?new IE(t.shape):new OE(t.shape)).getCustomSetupFunc(e,a);return this.compileAndRun(o,[t],null,l)},n.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(ut().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,a0,t.dtype);var e=new zt(t.shape,a0);return this.compileAndRun(e,[t])},n.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),a=new BE(t.shape),o=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(a,o)},n.prototype.sigmoid=function(t){var e=new zt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},n.prototype.softplus=function(t){var e=new zt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(e,[t])},n.prototype.sin=function(t){var e=new zt(t.shape,tS);return this.compileAndRun(e,[t])},n.prototype.cos=function(t){var e=new zt(t.shape,eS);return this.compileAndRun(e,[t])},n.prototype.tan=function(t){var e=new zt(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},n.prototype.asin=function(t){var e=new zt(t.shape,nS);return this.compileAndRun(e,[t])},n.prototype.acos=function(t){var e=new zt(t.shape,rS);return this.compileAndRun(e,[t])},n.prototype.atan=function(t){var e=new zt(t.shape,aS);return this.compileAndRun(e,[t])},n.prototype.atan2=function(t,e){var a=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new Ce(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.sinh=function(t){var e=new zt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(e,[t])},n.prototype.cosh=function(t){var e=new zt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(e,[t])},n.prototype.tanh=function(t){var e=new zt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(e,[t])},n.prototype.asinh=function(t){var e=new zt(t.shape,iS);return this.compileAndRun(e,[t])},n.prototype.acosh=function(t){var e=new zt(t.shape,oS);return this.compileAndRun(e,[t])},n.prototype.atanh=function(t){var e=new zt(t.shape,uS);return this.compileAndRun(e,[t])},n.prototype.erf=function(t){var e=new zt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(e,[t])},n.prototype.step=function(t,e){var a=new zt(t.shape,function(o){return o===void 0&&(o=0),pr+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(e));return this.compileAndRun(a,[t])},n.prototype.conv2dByMatMul=function(t,e,a,o,l,s){var f=t.shape,h=this.texData.get(t.dataId),p=a.inChannels,v=f[0]*f[1]*f[2],g=a.outChannels,y=a.dataFormat==="channelsLast",x=(v===1||g===1)&&p>1e3,w=f[2]%2!=0&&!!h.isPacked;if(x||!ut().getBool("WEBGL_LAZILY_UNPACK")||!ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){var _=y?f[0]*f[1]*f[2]:f[0]*f[2]*f[3],E=this.reshape(t,[1,_,a.inChannels]),R=this.reshape(e,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:E,b:R,transposeA:!1,transposeB:!1,bias:o,activation:l,preluActivationWeights:s}),a.outShape)}var A=y?f[0]*f[1]*(f[2]+1):f[0]*f[2]*(f[3]+1),C={dataId:t.dataId,shape:[1,A,a.inChannels],dtype:t.dtype},T=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,O(vl(h.shape,C.shape),function(){return"packed reshape "+h.shape+" to "+C.shape+" isn't free"});var N=this.reshape(e,[1,a.inChannels,a.outChannels]),L=this.fusedBatchMatMul({a:C,b:N,transposeA:!1,transposeB:!1,bias:o,activation:l,preluActivationWeights:s}),B=this.texData.get(L.dataId);return O(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),h.shape=T,B.shape=a.outShape,G.makeTensorFromDataId(L.dataId,a.outShape,L.dtype)},n.prototype.conv2dWithIm2Row=function(t,e,a,o,l,s){var f=a.filterWidth,h=a.filterHeight,p=a.inChannels,v=a.outWidth,g=a.outHeight,y=a.dataFormat==="channelsLast",x=f*h*p,w=g*v,_=[x,w],E=t.squeeze([0]),R=e.reshape([1,x,-1]),A=new EC(_,E.shape,a),C=this.compileAndRun(A,[E]).reshape([1,_[0],_[1]]),T=o!=null,N=s!=null,L=l?bl(l,!0):null,B=new Gh(C.shape,[1,w,a.outChannels],!0,!1,T,L,N),I=[C,R];o&&I.push(o),N&&I.push(s);var F=this.compileAndRun(B,I);return y?F.reshape([1,g,v,a.outChannels]):F.reshape([1,a.outChannels,g,v])},n.prototype.fusedConv2d=function(t){var e=t.input,a=t.filter,o=t.convInfo,l=t.bias,s=t.activation,f=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(e,a,o,l,s,f);if(ut().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,a,o,l,s,f);var h=l!=null,p=f!=null,v=s?bl(s,!1):null,g=new Yy(o,h,v,p),y=[e,a];return l&&y.push(l),f&&y.push(f),this.compileAndRun(g,y)},n.prototype.conv2d=function(t,e,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(t,e,a);if(ut().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,e,a);var o=new Yy(a);return this.compileAndRun(o,[t,e])},n.prototype.conv2dDerInput=function(t,e,a){var o=new PE(a);return this.compileAndRun(o,[t,e])},n.prototype.conv2dDerFilter=function(t,e,a){var o=new zE(a);return this.compileAndRun(o,[t,e])},n.prototype.fusedDepthwiseConv2D=function(t){var e,a=t.input,o=t.filter,l=t.convInfo,s=t.bias,f=t.activation,h=t.preluActivationWeights,p=ut().getBool("WEBGL_PACK_DEPTHWISECONV")&&l.strideWidth<=2&&l.outChannels/l.inChannels==1,v=f?bl(f,p):null,g=[a,o],y=s!=null,x=h!=null;return y&&g.push(s),x&&g.push(h),p?(e=new Zy(l,y,v,x),this.compileAndRun(e,g)):(e=new Qy(l,y,v,x),this.compileAndRun(e,g))},n.prototype.depthwiseConv2D=function(t,e,a){var o;return ut().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(o=new Zy(a),this.compileAndRun(o,[t,e])):(o=new Qy(a),this.compileAndRun(o,[t,e]))},n.prototype.depthwiseConv2DDerInput=function(t,e,a){var o=new WE(a);return this.compileAndRun(o,[t,e])},n.prototype.depthwiseConv2DDerFilter=function(t,e,a){var o=new VE(a);return this.compileAndRun(o,[t,e])},n.prototype.conv3d=function(t,e,a){var o=new GE(a);return this.compileAndRun(o,[t,e])},n.prototype.conv3dDerInput=function(t,e,a){var o=new HE(a);return this.compileAndRun(o,[t,e])},n.prototype.conv3dDerFilter=function(t,e,a){var o=new UE(a);return this.compileAndRun(o,[t,e])},n.prototype.maxPool=function(t,e){var a=new qh(e,"max",!1);return this.compileAndRun(a,[t])},n.prototype.avgPool=function(t,e){var a=new qh(e,"avg",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.maxPoolBackprop=function(t,e,a,o){var l=new qh(o,"max",!0),s=this.compileAndRun(l,[e]),f=new AC(o),h=this.compileAndRun(f,[t,s],e.dtype);return s.dispose(),h},n.prototype.avgPoolBackprop=function(t,e,a){var o=new AE(a);return this.compileAndRun(o,[t],e.dtype)},n.prototype.cast=function(t,e){return p1(t,e,this)},n.prototype.unstack=function(t,e){for(var a=t.shape[e],o=new Array(t.rank-1),l=0,s=0;s<t.rank;s++)s!==e&&(o[l++]=t.shape[s]);var f=new Array(t.rank).fill(0),h=t.shape.slice();h[e]=1;var p=new Array(a);for(s=0;s<p.length;s++)f[e]=s,p[s]=this.slice(t,f,h).reshape(o);return p},n.prototype.avgPool3d=function(t,e){var a=new jh(e,"avg",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.avgPool3dBackprop=function(t,e,a){var o=new TE(a);return this.compileAndRun(o,[t],e.dtype)},n.prototype.maxPool3d=function(t,e){var a=new jh(e,"max",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.maxPool3dBackprop=function(t,e,a,o){var l=new jh(o,"max",!0),s=this.compileAndRun(l,[e]),f=new TC(o),h=this.compileAndRun(f,[t,s],e.dtype);return s.dispose(),h},n.prototype.reshape=function(t,e){var a=this.texData.get(t.dataId);if(a.isPacked&&!vl(t.shape,e)&&(a.texture===null||!vl(a.shape,e))){var o=this.packedReshape(t,e);return G.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return yd(t,e)},n.prototype.resizeBilinear=function(t,e,a,o){var l=ut().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zC(t.shape,e,a,o):new LC(t.shape,e,a,o);return this.compileAndRun(l,[t],"float32")},n.prototype.resizeBilinearBackprop=function(t,e,a){var o=new FC(t,e,a);return this.compileAndRun(o,[t])},n.prototype.resizeNearestNeighbor=function(t,e,a,o){var l=new UC(t.shape,e,a,o);return this.compileAndRun(l,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,e,a){var o=new PC(t,e,a);return this.compileAndRun(o,[t])},n.prototype.multinomial=function(t,e,a,o){var l=e?t:ra(t),s=l.shape[0],f=l.shape[1],h=new DC(s,f,a),p=h.getCustomSetupFunc(o);return this.compileAndRun(h,[l],"int32",p)},n.prototype.oneHot=function(t,e,a,o){var l=new NC(t.size,e,a,o);return this.compileAndRun(l,[t])},n.prototype.diag=function(t){var e=new QE(t.size);return this.compileAndRun(e,[t])},n.prototype.nonMaxSuppression=function(t,e,a,o,l){return kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Pd(t.dataSync(),e.dataSync(),a,o,l)},n.prototype.cropAndResize=function(t,e,a,o,l,s){var f=new qE(t.shape,e.shape,o,l,s);return this.compileAndRun(f,[t,e,a],"float32")},n.prototype.depthToSpace=function(t,e,a){O(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var o=t.shape[0],l=a==="NHWC"?t.shape[1]:t.shape[2],s=a==="NHWC"?t.shape[2]:t.shape[3],f=a==="NHWC"?t.shape[3]:t.shape[1],h=l*e,p=s*e,v=f/(e*e),g=new YE(a==="NHWC"?[o,h,p,v]:[o,v,h,p],e,a);return this.compileAndRun(g,[t])},n.prototype.split=function(t,e,a){return g1(t,e,a)},n.prototype.scatterND=function(t,e,a){var o=zl(0,t,a),l=o.sliceRank,s=o.numUpdates,f=o.sliceSize,h=o.strides,p=o.outputSize,v=[p/f,f],g=t.reshape([s,l]),y=e.reshape([s,f]);if(p===0)return yd(nn([]),a);var x=vt(0),w=new e0(s,l,g.rank,y.rank,h,v);return this.compileAndRun(w,[y,g,x]).reshape(a)},n.prototype.sparseToDense=function(t,e,a,o){var l=zl(0,t,a),s=l.sliceRank,f=l.numUpdates,h=l.strides,p=l.outputSize,v=new e0(f,s,t.rank,e.rank,h,[p,1]);return this.compileAndRun(v,[e,t,o]).reshape(a)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,e){var a=this.texData.get(t.dataId),o=new $y(eC,t.shape,e),l=new $y(nC,t.shape,e),s=[this.makeComplexComponentTensorInfo(t,a.complexTensors.real),this.makeComplexComponentTensorInfo(t,a.complexTensors.imag)],f=this.compileAndRun(o,s),h=this.compileAndRun(l,s),p=this.complex(f,h).as2D(t.shape[0],t.shape[1]);return f.dispose(),h.dispose(),p},n.prototype.gatherND=function(t,e){var a=e.shape,o=a[a.length-1],l=u1(t,e),s=l[0],f=l[1],h=l[2],p=l[3],v=e.reshape([f,o]),g=t.reshape([t.size/h,h]),y=new iC(o,p,[f,h]);return this.compileAndRun(y,[g,v]).reshape(s)},n.prototype.fill=function(t,e,a){if((a=a||qu(e))==="string"){var o=Tl(a,Et(t));return o.fill(e),G.makeTensor(o,t,a,this)}var l=new rC(t,e),s=l.getCustomSetupFunc(e);return this.compileAndRun(l,[],a,s)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.linspace=function(t,e,a){return v1(t,e,a)},n.prototype.makeTensorInfo=function(t,e){var a=this.write(null,t,e);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:e}},n.prototype.makeOutput=function(t,e){var a=this.makeTensorInfo(t,e).dataId;return G.makeTensorFromDataId(a,t,e,this)},n.prototype.unpackTensor=function(t){var e=new lS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},n.prototype.packTensor=function(t){var e=new MC(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},n.prototype.packedReshape=function(t,e){var a=[Nl(t.shape)].concat(Ml(t.shape)),o={dtype:t.dtype,shape:a,dataId:t.dataId},l=[Nl(e)].concat(Ml(e)),s=new BC(l,a),f=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:f.dataId,shape:e,dtype:f.dtype}},n.prototype.decode=function(t){var e,a=this.texData.get(t),o=a.isPacked,l=a.shape,s=a.dtype,f=Uh(l);return e=o?new KE(f):new XE(f),{dtype:s,shape:l,dataId:this.runWebGLProgram(e,[{shape:f,dtype:s,dataId:t}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(t,e,a,o,l){var s=this;l===void 0&&(l=!1);var f=this.makeTensorInfo(t.outputShape,a),h=this.texData.get(f.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===Pu.DENSE){var p=Iu(t.outputShape);h.texShape=p.map(function(A){return 2*A})}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),Et(f.shape)===0)return h.values=Lu(f.dtype,0),f;var v=[],g=e.map(function(A){if(A.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var C=s.texData.get(A.dataId);if(C.texture==null){if(!t.packedInputs&&Et(A.shape)<=ut().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:A.shape,texData:null,isUniform:!0,uniformValues:C.values};t.packedInputs&&(C.isPacked=!0,C.shape=A.shape)}else if(!!C.isPacked!=!!t.packedInputs)A=C.isPacked?s.unpackTensor(A):s.packTensor(A),v.push(A),C=s.texData.get(A.dataId);else if(C.isPacked&&!vl(C.shape,A.shape)){var T=A,N=A.shape;A.shape=C.shape,A=s.packedReshape(A,N),v.push(A),C=s.texData.get(A.dataId),T.shape=N}return s.uploadToGPU(A.dataId),{shape:A.shape,texData:C,isUniform:!1}});this.uploadToGPU(f.dataId);var y,x={shape:f.shape,texData:h,isUniform:!1},w=function(A,C,T){var N="";C.concat(T).forEach(function(I){var F=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,W=I.isUniform?"uniform":I.texData.texShape;N+=I.shape+"_"+W+"_"+F});var L=A.userCode,B=A.constructor.name;return B+="_"+N+"_"+L}(t,g,x),_=this.getAndSaveBinary(w,function(){return function(A,C,T,N){var L=C.userCode,B=T.map(function(K,rt){var k={logicalShape:K.shape,texShape:K.isUniform?null:K.texData.texShape,isUniform:K.isUniform,isPacked:!K.isUniform&&K.texData.isPacked,flatOffset:null};return K.texData!=null&&K.texData.slice!=null&&K.texData.slice.flatOffset>0&&(k.flatOffset=K.texData.slice.flatOffset),{name:C.variableNames[rt],shapeInfo:k}}),I=B.map(function(K){return K.shapeInfo}),F={logicalShape:N.shape,texShape:N.texData.texShape,isUniform:!1,isPacked:N.texData.isPacked,flatOffset:null},W=wE(B,F,L,C.packedInputs),U=A.createProgram(W),at=null,nt=A.getUniformLocation(U,"NAN",!1);ut().getNumber("WEBGL_VERSION")===1&&(at=A.getUniformLocation(U,"INFINITY",!1));for(var tt={},P=0;P<C.variableNames.length;P++){var q=C.variableNames[P];tt[q]=A.getUniformLocation(U,q,!1),tt["offset"+q]=A.getUniformLocation(U,"offset"+q,!1)}return{program:C,source:W,webGLProgram:U,uniformLocations:tt,inShapeInfos:I,outShapeInfo:F,infLoc:at,nanLoc:nt}}(s.gpgpu,t,g,x)}),E=this.activeTimers!=null;if(E&&(y=this.startTimer()),function(A,C,T,N,L){t0(C.inShapeInfos,T),t0([C.outShapeInfo],[N]);var B=N.texData.texture,I=N.texData.texShape;N.texData.isPacked?A.setOutputPackedMatrixTexture(B,I[0],I[1]):A.setOutputMatrixTexture(B,I[0],I[1]),A.setProgram(C.webGLProgram),ut().getNumber("WEBGL_VERSION")===1&&C.infLoc!==null&&A.gl.uniform1f(C.infLoc,1/0),C.nanLoc!==null&&A.gl.uniform1f(C.nanLoc,NaN),T.forEach(function(F,W){var U=C.program.variableNames[W],at=C.uniformLocations[U],nt=C.uniformLocations["offset"+U];if(at!=null)if(F.isUniform)if(Et(F.shape)<2)A.gl.uniform1f(at,F.uniformValues[0]);else{var tt=F.uniformValues;tt instanceof Float32Array||(tt=new Float32Array(tt)),A.gl.uniform1fv(at,tt)}else F.texData.slice!=null&&nt!=null&&A.gl.uniform1i(nt,F.texData.slice.flatOffset),A.setInputMatrixTexture(F.texData.texture,at,W)}),L?.(A,C.webGLProgram),A.executeProgram()}(this.gpgpu,_,g,x,o),v.forEach(function(A){return s.disposeData(A.dataId)}),E&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)})),!ut().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&l===!1){var R=this.unpackTensor(f);return this.disposeData(f.dataId),R}return f},n.prototype.compileAndRun=function(t,e,a,o,l){l===void 0&&(l=!1),a=a||e[0].dtype;var s=this.runWebGLProgram(t,e,a,o,l);return G.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var t=this;this.disposed||(ut().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=yt(function(){if(!ut().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=ut().getBool("DEBUG");ut().set("DEBUG",!1);var a=t.abs(vt(1e-8)).dataSync()[0];if(ut().set("DEBUG",e),a>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(t){var e,a=this.texData.get(t),o=a.shape,l=a.dtype,s=a.values,f=a.texture,h=a.usage,p=a.isPacked;if(f==null){var v,g=this.activeTimers!=null;g&&(v=Sr());var y=a.texShape;if(y==null&&(y=g_(o,p),a.texShape=y),s!=null){var x=Uh(o),w=void 0,_=y[1],E=y[0],R=s instanceof Uint8Array;p?(_=(e=Xu(y[0],y[1]))[0],E=e[1],w=new tC(x,[E,_],R)):w=new $E(x,[E,_],R);var A=this.makeTensorInfo([E,_],l);this.texData.get(A.dataId).usage=R?Un.PIXELS:Un.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(A.dataId),_,E,s);var C=this.runWebGLProgram(w,[A],l,null,!0),T=this.texData.get(C.dataId);a.texture=T.texture,a.texShape=T.texShape,a.isPacked=T.isPacked,a.usage=T.usage,this.disposeData(A.dataId),this.texData.delete(C.dataId),a.values=null,g&&(this.uploadWaitMs+=Sr()-v)}else{var N=this.acquireTexture(y,h,l,p);a.texture=N}}},n.prototype.convertAndCacheOnCPU=function(t,e){var a=this.texData.get(t),o=a.dtype;return this.releaseGPUData(t),e!=null&&(a.values=function(l,s){if(s==="float32"||s==="complex64")return l;if(s==="int32"||s==="bool"){for(var f=s==="int32"?new Int32Array(l.length):new Uint8Array(l.length),h=0;h<f.length;++h)f[h]=Math.round(l[h]);return f}throw new Error("Unknown dtype "+s)}(e,o)),a.values},n.prototype.acquireTexture=function(t,e,a,o){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var l=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+l+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,o)},n.prototype.computeBytes=function(t,e){return t[0]*t[1]*W0(e)},n}(h1);Q0()&&G.registerBackend("webgl",function(){return new fS},2);var hS=H({square_:function(r){var n=M(r,"x","square"),t=[n];return G.runKernelFunc(function(e,a){return a([n]),e.square(n)},{x:n},null,"Square",{},t,[])}}),Hu="SquaredDifference",M1=H({squaredDifference_:function(r,n){var t,e=M(r,"a","squaredDifference"),a=M(n,"b","squaredDifference");t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape);var o={a:e,b:a},l=[e,a];return G.runKernelFunc(function(s,f){var h=s.squaredDifference(e,a);return f([e,a]),h},o,function(s,f){var h=f[0],p=f[1],v=vt(2);return{a:function(){return s.mul(h.sub(p).mul(v))},b:function(){return s.mul(p.sub(h).mul(v))}}},Hu,{},l,[])}}),dS=H({abs_:function(r){var n=M(r,"x","abs");return n.dtype==="complex64"?G.runKernelFunc(function(t){return t.complexAbs(n)},{$x:n}):G.runKernelFunc(function(t,e){var a=t.abs(n);return e([n]),a},{x:n},function(t,e){var a=e[0];return{x:function(){return t.mul(a.toFloat().step(-1))}}},"Abs")}}),pS=H({acos_:function(r){var n=M(r,"x","acos");return G.runKernelFunc(function(t,e){var a=t.acos(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.divStrict(vt(1).sub(a.toFloat().square()).sqrt()).neg()}}})}}),vS=H({acosh_:function(r){var n=M(r,"x","acosh");return G.runKernelFunc(function(t,e){var a=t.acosh(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.divStrict(a.toFloat().square().sub(1).sqrt())}}})}}),mS=H({asin_:function(r){var n=M(r,"x","asin");return G.runKernelFunc(function(t,e){var a=t.asin(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.divStrict(vt(1).sub(a.toFloat().square()).sqrt())}}})}}),gS=H({asinh_:function(r){var n=M(r,"x","asinh");return G.runKernelFunc(function(t,e){var a=t.asinh(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.divStrict(vt(1).add(a.toFloat().square()).sqrt())}}})}}),yS=H({atan_:function(r){var n=M(r,"x","atan");return G.runKernelFunc(function(t,e){var a=t.atan(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(a.toFloat().square().add(1))}}})}}),bS=H({atanh_:function(r){var n=M(r,"x","atanh");return G.runKernelFunc(function(t,e){var a=t.atanh(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(vt(1).sub(a.toFloat().square()))}}})}}),xS=H({ceil_:function(r){var n=M(r,"x","ceil");return G.runKernelFunc(function(t){return t.ceil(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),qd=H({clipByValue_:function(r,n,t){var e=M(r,"x","clipByValue");O(n<=t,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+t+")."});var a=[e],o={min:n,max:t};return G.runKernelFunc(function(l,s){var f=l.clip(e,n,t);return s([e]),f},{x:e},function(l,s){var f=s[0];return{x:function(){return l.where(f.greaterEqual(n).logicalAnd(f.lessEqual(t)),Yt(l))}}},"ClipByValue",o,a)}}),wS=H({cos_:function(r){var n=M(r,"x","cos"),t=[n];return G.runKernelFunc(function(e,a){var o=e.cos(n);return a([n]),o},{x:n},function(e,a){var o=a[0];return{x:function(){return o.toFloat().sin().neg().mul(e)}}},"Cos",{},t)}}),_S=H({cosh_:function(r){var n=M(r,"x","cosh");return G.runKernelFunc(function(t,e){var a=t.cosh(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return a.toFloat().sinh().mulStrict(t)}}})}}),ES=H({erf_:function(r){var n=M(r,"x","erf");return O(n.dtype==="int32"||n.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),n.dtype==="int32"&&(n=n.toFloat()),G.runKernelFunc(function(t,e){var a=t.erf(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),xd=H({exp_:function(r){var n=M(r,"x","exp");return G.runKernelFunc(function(t,e){var a=t.exp(n);return e([a]),a},{x:n},function(t,e){return{x:function(){return t.mulStrict(e[0])}}},"Exp",{},[],[!0])}}),CS=H({expm1_:function(r){var n=M(r,"x","expm1");return G.runKernelFunc(function(t,e){var a=t.expm1(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.mul(a.exp())}}})}}),SS=H({floor_:function(r){var n=M(r,"x","floor");return G.runKernelFunc(function(t){return t.floor(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),RS=H({log_:function(r){var n=M(r,"x","log"),t=[n];return G.runKernelFunc(function(e,a){var o=e.log(n);return a([n]),o},{x:n},function(e,a){var o=a[0];return{x:function(){return e.div(o.toFloat())}}},"Log",{},t)}}),AS=H({log1p_:function(r){var n=M(r,"x","log1p");return G.runKernelFunc(function(t,e){var a=t.log1p(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(a.add(1))}}})}}),TS=H({logSigmoid_:function(r){var n=M(r,"x","logSigmoid");return G.runKernelFunc(function(t,e){var a=t.softplus(n.neg()).neg();return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.mul(a.neg().sigmoid())}}})}}),Vl=H({neg_:function(r){var n=M(r,"x","neg"),t=[n];return G.runKernelFunc(function(e){return e.neg(n)},{x:n},function(e){return{x:function(){return e.neg()}}},"Neg",{},t)}}),DS=H({reciprocal_:function(r){var n=M(r,"x","reciprocal");return G.runKernelFunc(function(t,e){var a=t.reciprocal(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(a.square().neg())}}})}}),NS=H({round_:function(r){var n=M(r,"x","round");return G.runKernelFunc(function(t){return t.round(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),k1=H({rsqrt_:function(r){var n=M(r,"x","rsqrt"),t=[n];return G.runKernelFunc(function(e,a){var o=e.rsqrt(n);return a([n]),o},{x:n},function(e,a){var o=a[0];return{x:function(){return e.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),O1=H({sigmoid_:function(r){var n=M(r,"x","sigmoid");return G.runKernelFunc(function(t,e){var a=t.sigmoid(n);return e([a]),a},{x:n},function(t,e){var a=e[0];return{x:function(){return t.mul(a.mul(vt(1).sub(a)))}}},"Sigmoid")}}),MS=H({sign_:function(r){var n=M(r,"x","sign");return G.runKernelFunc(function(t){return t.sign(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),kS=H({isNaN_:function(r){var n=M(r,"x","isNaN");return G.runKernelFunc(function(t){return t.isNaN(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),OS=H({isInf_:function(r){var n=M(r,"x","isInf");return G.runKernelFunc(function(t){return t.isInf(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),IS=H({isFinite_:function(r){var n=M(r,"x","isFinite");return G.runKernelFunc(function(t){return t.isFinite(n)},{$x:n},function(t){return{$x:function(){return Yt(t)}}})}}),BS=H({sin_:function(r){var n=M(r,"x","sin"),t=[n];return G.runKernelFunc(function(e,a){var o=e.sin(n);return a([n]),o},{x:n},function(e,a){var o=a[0];return{x:function(){return o.toFloat().cos().mul(e)}}},"Sin",{},t)}}),FS=H({sinh_:function(r){var n=M(r,"x","sinh");return G.runKernelFunc(function(t,e){var a=t.sinh(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return a.toFloat().cosh().mulStrict(t)}}})}}),LS=H({softplus_:function(r){var n=M(r,"x","softplus");return G.runKernelFunc(function(t,e){var a=t.softplus(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.mul(a.sigmoid())}}})}}),zS=H({sqrt_:function(r){var n=M(r,"x","sqrt");return G.runKernelFunc(function(t,e){var a=t.sqrt(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(a.toFloat().sqrt().mul(2))}}})}}),PS=H({step_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","step");return G.runKernelFunc(function(e){return e.step(t,n)},{$x:t},function(e){return{$x:function(){return Yt(e)}}})}}),US=H({tan_:function(r){var n=M(r,"x","tan");return G.runKernelFunc(function(t,e){var a=t.tan(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return t.div(a.cos().square())}}})}}),HS=H({tanh_:function(r){var n=M(r,"x","tanh");return G.runKernelFunc(function(t,e){var a=t.tanh(n);return e([a]),a},{x:n},function(t,e){var a=e[0];return{x:function(){return vt(1).sub(a.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function I1(r,n,t,e,a,o){var l,s,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(l=M(a,"scale","batchNorm")),e!=null&&(s=M(e,"offset","batchNorm")),O(f.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+f.rank+"."}),O(h.rank===2||h.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."}),O(p.rank===2||p.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+p.rank+"."}),l!=null&&O(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."}),s!=null&&O(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Yu(f,h,p,s,l,o)}function B1(r,n,t,e,a,o){var l,s,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(l=M(a,"scale","batchNorm")),e!=null&&(s=M(e,"offset","batchNorm")),O(f.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+f.rank+"."}),O(h.rank===3||h.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."}),O(p.rank===3||p.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+p.rank+"."}),l!=null&&O(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."}),s!=null&&O(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Yu(f,h,p,s,l,o)}function F1(r,n,t,e,a,o){var l,s,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(l=M(a,"scale","batchNorm")),e!=null&&(s=M(e,"offset","batchNorm")),O(f.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+f.rank+"."}),O(h.rank===4||h.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."}),O(p.rank===4||p.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+p.rank+"."}),l!=null&&O(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."}),s!=null&&O(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Yu(f,h,p,s,l,o)}function Yu(r,n,t,e,a,o){o==null&&(o=.001);var l,s,f,h=M(r,"x","batchNorm"),p=M(n,"mean","batchNorm"),v=M(t,"variance","batchNorm");a!=null&&(l=M(a,"scale","batchNorm")),e!=null&&(s=M(e,"offset","batchNorm")),O(p.rank===v.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),O(s==null||p.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),O(l==null||p.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),f=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var g=[h,p,v,l];return G.runKernelFunc(function(y,x){var w=y.batchNormalization(f,xl(p),xl(v),o,xl(l),xl(s));return x([h,p,v,l]),w},{x:h,mean:p,variance:v,scale:l,offset:s},function(y,x){var w=x,_=w[0],E=w[1],R=w[2],A=w[3],C=A??vt(1),T=Le(E.shape,f.shape),N=[];if(E.rank===1){for(var L=0;L<f.shape.length-1;++L)N.push(f.shape[L]);N.push(1)}var B=_.sub(E),I=y.mul(C),F=k1(R.add(vt(o))),W=F.mul(F).mul(F).mul(vt(-.5));return{x:function(){return E.rank===1?y.mul(go(F.as4D(1,1,1,E.shape[0]),N)).mul(C).reshape(_.shape):y.mul(F).mul(C).reshape(_.shape)},mean:function(){var U=F.mul(vt(-1)).mul(I);return E.rank===1&&(U=U.sum(T)),U.reshape(E.shape)},variance:function(){var U=W.mul(B).mul(I);return E.rank===1&&(U=U.sum(T)),U.reshape(E.shape)},scale:function(){var U=B.mul(F),at=y.mul(U);return E.rank===1&&(at=at.sum(T)),at.reshape(E.shape)},offset:function(){var U=y;return E.rank===1&&(U=U.sum(T)),U.reshape(E.shape)}}},"BatchNormalization",{varianceEpsilon:o},g).reshape(h.shape)}function xl(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function $l(){Z0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var VS=H({batchNormalization2d_:function(r,n,t,e,a,o){return e===void 0&&(e=.001),$l(),I1(r,n,t,o,a,e)}}),WS=H({batchNormalization3d_:function(r,n,t,e,a,o){return e===void 0&&(e=.001),$l(),B1(r,n,t,o,a,e)}}),GS=H({batchNormalization4d_:function(r,n,t,e,a,o){return e===void 0&&(e=.001),$l(),F1(r,n,t,o,a,e)}}),qS=H({batchNormalization_:function(r,n,t,e,a,o){return e===void 0&&(e=.001),$l(),Yu(r,n,t,o,a,e)}}),L1=H({batchNorm_:Yu}),jS=H({batchNorm2d_:I1}),XS=H({batchNorm3d_:B1}),KS=H({batchNorm4d_:F1}),tc=H({logicalAnd_:function(r,n){var t=M(r,"a","logicalAnd","bool"),e=M(n,"b","logicalAnd","bool");return qt(t.shape,e.shape),G.runKernelFunc(function(a){return a.logicalAnd(t,e)},{a:t,b:e},null,"LogicalAnd")}}),YS=H({logicalNot_:function(r){var n=M(r,"x","logicalNot","bool");return G.runKernelFunc(function(t){return t.logicalNot(n)},{$x:n})}}),z1=H({logicalOr_:function(r,n){var t=M(r,"a","logicalOr","bool"),e=M(n,"b","logicalOr","bool");return qt(t.shape,e.shape),G.runKernelFunc(function(a){return a.logicalOr(t,e)},{$a:t,$b:e})}}),QS=H({logicalXor_:function(r,n){var t=M(r,"a","logicalXor","bool"),e=M(n,"b","logicalXor","bool");return qt(t.shape,e.shape),z1(r,n).logicalAnd(tc(r,n).logicalNot())}}),mi=H({where_:function(r,n,t){var e=M(n,"a","where"),a=M(t,"b","where"),o=M(r,"condition","where","bool");return te(e.shape,a.shape,"Error in where: "),o.rank===1?O(o.shape[0]===e.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):te(o.shape,a.shape,"Error in where: "),G.runKernelFunc(function(l,s){var f=l.select(o,e,a);return s([o]),f},{$condition:o,$a:e,$b:a},function(l,s){var f=s[0];return{$condition:function(){return Yt(f).toFloat()},$a:function(){return l.mul(f.cast(l.dtype))},$b:function(){return l.mul(f.logicalNot().cast(l.dtype))}}})}}),P1=function(r){return wt(this,void 0,void 0,function(){var n,t,e;return _t(this,function(a){switch(a.label){case 0:return[4,(n=M(r,"condition","whereAsync","bool")).data()];case 1:return t=a.sent(),e=Hd(n.shape,t),r!==n&&n.dispose(),[2,e]}})})},Vt=H({add_:function(r,n){var t,e=M(r,"a","add"),a=M(n,"b","add");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l){return l.add(e,a)},{a:e,b:a},function(l){return{a:function(){var s=l,f=Le(e.shape,o);return f.length>0&&(s=s.sum(f)),s.reshape(e.shape)},b:function(){var s=l,f=Le(a.shape,o);return f.length>0&&(s=s.sum(f)),s.reshape(a.shape)}}},"Add")}}),ZS=H({addN_:function(r){O(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),O(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var n=r.map(function(a,o){return M(a,"tensors"+o,"addN")}),t=n[0];n.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(a){if(!Ye(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var e=n;return G.runKernelFunc(function(a){return a.addN(n)},e,function(a){var o={};return n.forEach(function(l,s){o[s]=function(){return a.clone()}}),o},"AddN")}}),JS=H({addStrict_:function(r,n){var t=M(r,"a","addStrict"),e=M(n,"b","addStrict");return te(t.shape,e.shape,"Error in addStrict: "),t.add(e)}}),$S=H({atan2_:function(r,n){var t,e=M(r,"a","atan2"),a=M(n,"b","atan2");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l,s){var f=l.atan2(e,a);return s([e,a]),f},{$a:e,$b:a},function(l,s){var f=s[0],h=s[1];return{$a:function(){var p=Vt(f.square(),h.square()),v=l.mul(h.div(p)),g=Le(f.shape,o);return g.length>0&&(v=v.sum(g)),v.reshape(f.shape)},$b:function(){var p=Vt(f.square(),h.square()),v=Vl(l.mul(f.div(p))),g=Le(h.shape,o);return g.length>0&&(v=v.sum(g)),v.reshape(h.shape)}}})}}),cr=H({div_:function(r,n){var t,e=M(r,"a","div"),a=M(n,"b","div");if(t=xe(e,a),e=t[0],a=t[1],e.dtype==="int32"&&a.dtype==="int32")return U1(e,a);var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l,s){var f=l.realDivide(e,a);return s([e,a]),f},{a:e,b:a},function(l,s){var f=s[0],h=s[1];return{a:function(){var p=l.div(h.toFloat()),v=Le(f.shape,o);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=l.mul(f.toFloat()),v=Le(h.shape,o);v.length>0&&(p=p.sum(v).reshape(h.shape));var g=h.square();return p.div(g.toFloat()).neg()}}},"Div")}}),tR=H({divNoNan_:function(r,n){var t,e=M(r,"a","div"),a=M(n,"b","div");e=(t=xe(e,a))[0],a=t[1];var o=cr(e,a),l=Yt(o),s=a.equal(l);return mi(s,l,o)}}),eR=H({divStrict_:function(r,n){var t=M(r,"a","div"),e=M(n,"b","div");return te(t.shape,e.shape,"Error in divideStrict: "),t.div(e)}}),U1=H({floorDiv_:function(r,n){var t,e=M(r,"a","floorDiv"),a=M(n,"b","floorDiv");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l,s){var f=l.floorDiv(e,a);return s([e,a]),f},{a:e,b:a},function(l,s){var f=s[0],h=s[1];return{a:function(){var p=l.div(h.toFloat()),v=Le(f.shape,o);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=l.mul(f.toFloat()),v=Le(h.shape,o);v.length>0&&(p=p.sum(v).reshape(h.shape));var g=h.square();return p.div(g.toFloat()).neg()}}},"FloorDiv")}}),jd=H({maximum_:function(r,n){var t,e=M(r,"a","maximum"),a=M(n,"b","maximum");return t=xe(e,a),e=t[0],a=t[1],e.dtype==="bool"&&(e=e.toInt(),a=a.toInt()),qt(e.shape,a.shape),G.runKernelFunc(function(o,l){var s=o.maximum(e,a);return l([e,a]),s},{a:e,b:a},function(o,l){var s=l[0],f=l[1];return{a:function(){return o.mul(s.greaterEqual(f).toFloat())},b:function(){return o.mul(s.less(f).toFloat())}}},"Maximum")}}),nR=H({maximumStrict_:function(r,n){var t=M(r,"a","maximumStrict"),e=M(n,"b","maximumStrict");return te(t.shape,e.shape,"Error in maximumStrict: "),t.maximum(e)}}),H1=H({minimum_:function(r,n){var t,e=M(r,"a","minimum"),a=M(n,"b","minimum");return t=xe(e,a),e=t[0],a=t[1],e.dtype==="bool"&&(e=e.toInt(),a=a.toInt()),qt(e.shape,a.shape),G.runKernelFunc(function(o,l){var s=o.minimum(e,a);return l([e,a]),s},{a:e,b:a},function(o,l){var s=l[0],f=l[1];return{a:function(){return o.mul(s.lessEqual(f).toFloat())},b:function(){return o.mul(s.greater(f).toFloat())}}},"Minimum")}}),rR=H({minimumStrict_:function(r,n){var t=M(r,"a","minimumStrict"),e=M(n,"b","minimumStrict");return te(t.shape,e.shape,"Error in minimumStrict: "),t.minimum(e)}}),aR=H({mod_:function(r,n){var t,e=M(r,"a","mod"),a=M(n,"b","mod");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l,s){var f=l.mod(e,a);return s([e,a]),f},{$a:e,$b:a},function(l,s){var f=s[0],h=s[1];return{$a:function(){var p=Le(f.shape,o);return p.length>0?l.sum(p).reshape(f.shape):l},$b:function(){var p=l.mul(f.div(h).floor().neg()),v=Le(h.shape,o);return v.length>0?p.sum(v).reshape(h.shape):p}}})}}),iR=H({modStrict_:function(r,n){var t=M(r,"a","modStrict"),e=M(n,"b","modStrict");return te(t.shape,e.shape,"Error in modStrict: "),t.mod(e)}}),fn=H({mul_:function(r,n){var t,e=M(r,"a","mul"),a=M(n,"b","mul");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l,s){var f=l.multiply(e,a);return s([e,a]),f},{a:e,b:a},function(l,s){var f=s[0],h=s[1];return{a:function(){var p=l.mul(h.toFloat()),v=Le(f.shape,o);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=l.mul(f.toFloat()),v=Le(h.shape,o);return v.length>0?p.sum(v).reshape(h.shape):p}}},"Mul")}}),oR=H({mulStrict_:function(r,n){var t=M(r,"a","mul"),e=M(n,"b","mul");return te(t.shape,e.shape,"Error in multiplyStrict: "),t.mul(e)}}),Wl=H({pow_:function(r,n){var t,e=M(r,"base","pow"),a=M(n,"exp","pow");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape),l=[e,a];return G.runKernelFunc(function(s,f){var h=s.pow(e,a);return f([e,a,h]),h},{a:e,b:a},function(s,f){var h=f[0],p=f[1],v=f[2];return{a:function(){var g=p.toFloat(),y=s.mul(g.mul(h.pow(g.sub(vt(1))))),x=Le(h.shape,o);return x.length>0&&(y=y.sum(x)),y.reshape(h.shape)},b:function(){var g=h.greater(0),y=h.log().where(g,Yt(h)),x=s.mul(v.mul(y)),w=Le(p.shape,o);return w.length>0&&(x=x.sum(w)),x.reshape(p.shape)}}},"Pow",{},l,[!0])}}),uR=H({powStrict_:function(r,n){return te(r.shape,n.shape,"Error in powStrict: "),r.pow(n)}}),sR=H({squaredDifferenceStrict_:function(r,n){var t=M(r,"a","squaredDifferenceStrict"),e=M(n,"b","squaredDifferenceStrict");return te(t.shape,e.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(e)}}),ze=H({sub_:function(r,n){var t,e=M(r,"a","sub"),a=M(n,"b","sub");t=xe(e,a),e=t[0],a=t[1];var o=qt(e.shape,a.shape);return G.runKernelFunc(function(l){return l.subtract(e,a)},{a:e,b:a},function(l){return{a:function(){var s=l,f=Le(e.shape,o);return f.length>0&&(s=s.sum(f)),s.reshape(e.shape)},b:function(){var s=l,f=Le(a.shape,o);return f.length>0&&(s=s.sum(f)),s.neg().reshape(a.shape)}}},"Sub")}}),lR=H({subStrict_:function(r,n){var t=M(r,"a","subStrict"),e=M(n,"b","subStrict");return te(t.shape,e.shape,"Error in subStrict: "),t.sub(e)}}),V1=H({equal_:function(r,n){var t,e=M(r,"a","equal"),a=M(n,"b","equal");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o){return o.equal(e,a)},{$a:e,$b:a})}}),cR=H({equalStrict_:function(r,n){var t=M(r,"a","equalStrict"),e=M(n,"b","equalStrict");return te(t.shape,e.shape,"Error in equalStrict: "),t.equal(e)}}),fR=H({greater_:function(r,n){var t,e=M(r,"a","greater"),a=M(n,"b","greater");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o){return o.greater(e,a)},{a:e,b:a},null,"Greater")}}),W1=H({greaterEqual_:function(r,n){var t,e=M(r,"a","greaterEqual"),a=M(n,"b","greaterEqual");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o,l){var s=o.greaterEqual(e,a);return l([e,a]),s},{a:e,b:a},function(o,l){var s=l[0],f=l[1];return{a:function(){return Yt(s)},b:function(){return Yt(f)}}},"GreaterEqual")}}),hR=H({greaterEqualStrict_:function(r,n){var t=M(r,"a","greaterEqualStrict"),e=M(n,"b","greaterEqualStrict");return te(t.shape,e.shape,"Error in greaterEqualStrict: "),t.greaterEqual(e)}}),dR=H({greaterStrict_:function(r,n){var t=M(r,"a","greaterStrict"),e=M(n,"b","greaterStrict");return te(t.shape,e.shape,"Error in greaterStrict: "),t.greater(e)}}),pR=H({less_:function(r,n){var t,e=M(r,"a","less"),a=M(n,"b","less");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o){return o.less(e,a)},{a:e,b:a},null,"Less")}}),vR=H({lessEqual_:function(r,n){var t,e=M(r,"a","lessEqual"),a=M(n,"b","lessEqual");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o,l){var s=o.lessEqual(e,a);return l([e,a]),s},{a:e,b:a},null,"LessEqual")}}),mR=H({lessEqualStrict_:function(r,n){var t=M(r,"a","lessEqualStrict"),e=M(n,"b","lessEqualStrict");return te(t.shape,e.shape,"Error in lessEqualStrict: "),t.lessEqual(e)}}),gR=H({lessStrict_:function(r,n){var t=M(r,"a","lessStrict"),e=M(n,"b","lessStrict");return te(t.shape,e.shape,"Error in lessStrict: "),t.less(e)}}),yR=H({notEqual_:function(r,n){var t,e=M(r,"a","notEqual"),a=M(n,"b","notEqual");return t=xe(e,a),e=t[0],a=t[1],qt(e.shape,a.shape),G.runKernelFunc(function(o){return o.notEqual(e,a)},{a:e,b:a},null,"NotEqual")}}),bR=H({notEqualStrict_:function(r,n){var t=M(r,"a","notEqualStrict"),e=M(n,"b","notEqualStrict");return te(t.shape,e.shape,"Error in notEqualStrict: "),t.notEqual(e)}});function c0(r,n){for(var t=[],e=r;e<n;++e)t.push(e);return t}function f0(r){for(var n=[],t=0;t<r.length;++t)for(var e=0;e<r[t].length;++e)n.push(r[t][e]);return n}var Xd=H({gather_:function(r,n,t){t===void 0&&(t=0);var e=M(r,"x","gather"),a=M(n,"indices","gather","int32");t=Pe(t,e.shape)[0];var o=function(l,s,f){for(var h=l.shape[f],p=[],v=1,g=1,y=0;y<f;y++)p.push(l.shape[y]),v*=l.shape[y];for(y=0;y<s.rank;y++)p.push(s.shape[y]);for(y=f+1;y<l.rank;y++)p.push(l.shape[y]),g*=l.shape[y];return{batchSize:v,sliceSize:g,dimSize:h,outputShape:p}}(e,a,t);return G.runKernelFunc(function(l,s){var f=l.gather(e,a.flatten(),t);return s([a]),f},{x:e,indices:a},function(l,s){var f=s[0];return{x:function(){var h=e.shape,p=f.size,v=h.slice(0,t),g=v.length,y=h.slice(t,h.length).slice(1),x=y.length,w=c0(0,g),_=c0(g+1,g+1+x),E=f0([v,[p],y]),R=l.reshape(E),A=f.reshape([p]),C=f0([[g],w,_]),T=R.transpose(C),N=G1(T,A,e.shape[t]),L=Od(C);return N=N.transpose(L)},indices:function(){return f}}},"Gather",{axis:t}).reshape(o.outputShape)}}),G1=H({unsortedSegmentSum_:function(r,n,t){var e=M(r,"x","unsortedSegmentSum"),a=M(n,"segmentIds","unsortedSegmentSum","int32");return O(Te(t),function(){return"numSegments must be of dtype int"}),G.runKernelFunc(function(o,l){var s=o.unsortedSegmentSum(e,a,t);return l([a]),s},{$x:e},function(o,l){var s=l[0];return{$x:function(){return function(f,h){for(var p=jd(h,Yt(h)),v=Xd(f,p),g=W1(h,vt(0,"int32")),y=v.rank-g.rank,x=0;x<y;++x)g=rr(g,x+1);g=tc(g,Do(v.shape,"bool"));var w=Yt(v);return mi(g,v,w)}(o,s)}}})}}),xR=function(r,n,t){return wt(this,void 0,void 0,function(){var e,a,o,l,s,f,h,p,v,g,y,x,w;return _t(this,function(_){switch(_.label){case 0:for(e=M(r,"tensor","boolMask"),a=M(n,"mask","boolMask","bool"),o=t??0,l=a.rank,s=e.shape,O(l>0,function(){return"mask cannot be scalar"}),te(s.slice(o,o+l),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),f=1,h=o;h<o+l;h++)f*=s[h];return p=s.slice(0,o).concat([f],s.slice(o+l)),v=e.reshape(p),g=a.reshape([-1]),[4,P1(g)];case 1:return y=_.sent(),x=y.squeeze([1]),w=Xd(v,x,o),r!==e&&e.dispose(),n!==a&&a.dispose(),x.dispose(),v.dispose(),g.dispose(),y.dispose(),[2,w]}})})};function q1(r,n,t,e,a,o,l){o===void 0&&(o="NHWC"),O(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var s=r,f=n,h=!1;n.rank===3&&(h=!0,f=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,r[0],r[1],r[2]]),O(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),O(f.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+f.rank}),O(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var p=o==="NHWC"?s[3]:s[1],v=o==="NHWC"?f.shape[3]:f.shape[1];O(p===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+t.shape[2]+"."}),O(v===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+v+") must match output depth for filter "+t.shape[3]+"."}),l!=null&&O(Te(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+a+"."});var g=zd(o),y=bi(s,t.shape,e,1,a,l,!1,g),x=G.runKernelFunc(function(w,_){var E=w.conv2dDerInput(f,t,y);return _([t,f]),E},{dy4D:f,filter:t},function(w,_){var E=_[0],R=_[1];return{dy4D:function(){return or(w,E,e,a,o,1,l)},filter:function(){return Kd(w,R,E.shape,e,a,o,l)}}});return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Kh(r){var n=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(r),t=n[0],e=n[1],a=n[2];return t===1&&e===1&&a===1}function j1(r,n,t,e,a){O(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var o=r,l=n,s=!1;n.rank===4&&(s=!0,l=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),o=[1,r[0],r[1],r[2],r[3]]);var f=o[4],h=l.shape[4];O(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),O(l.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+l.rank}),O(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),O(f===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+f+") must match input depth for filter "+t.shape[3]+"."}),O(h===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."});var p=Ul(o,t.shape,e,1,a),v=G.runKernelFunc(function(g){return g.conv3dDerInput(l,t,p)},{dy5D:l});return s?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}var wR=H({conv1d_:function(r,n,t,e,a,o,l){a===void 0&&(a="NWC"),o===void 0&&(o=1);var s=M(r,"x","conv1d"),f=M(n,"filter","conv1d"),h=s,p=!1;s.rank===2&&(p=!0,h=s.as3D(1,s.shape[0],s.shape[1])),O(h.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."}),O(f.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+f.rank+"."}),l!=null&&O(Te(e),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+e+"."}),O(h.shape[2]===f.shape[1],function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+f.shape[1]+"."}),O(Tn(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),O(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var v=f.as4D(1,f.shape[0],f.shape[1],f.shape[2]),g=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),y=or(g,v,[1,t],e,"NHWC",[1,o],l);return p?y.as2D(y.shape[2],y.shape[3]):y.as3D(y.shape[0],y.shape[2],y.shape[3])}}),or=H({conv2d_:function(r,n,t,e,a,o,l){a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]);var s=M(r,"x","conv2d"),f=M(n,"filter","conv2d"),h=s,p=!1;s.rank===3&&(p=!0,h=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(h.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."}),O(f.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+f.rank+"."}),l!=null&&O(Te(e),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+e+"."});var v=a==="NHWC"?h.shape[3]:h.shape[1];O(v===f.shape[2],function(){return"Error in conv2d: depth of input ("+v+") must match input depth for filter "+f.shape[2]+"."}),O(Tn(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var g=zd(a),y=bi(h.shape,f.shape,t,o,e,l,!1,g),x=[f,h],w=G.runKernelFunc(function(_,E){var R=_.conv2d(h,f,y);return E([f,h]),R},{x:h,filter:f},function(_,E){var R=E,A=R[0],C=R[1];return O(Ro(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return X1(C.shape,_,A,t,e,a)},filter:function(){return Kd(C,_,A.shape,t,e,a)}}},"Conv2D",y,x);return p?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),_R=H({conv3d_:function(r,n,t,e,a,o){a===void 0&&(a="NDHWC"),o===void 0&&(o=[1,1,1]);var l=M(r,"x","conv3d"),s=M(n,"filter","conv3d"),f=l,h=!1;l.rank===4&&(h=!0,f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),O(f.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+f.rank+"."}),O(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),O(f.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+f.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),O(function(g,y){return Kh(g)||Kh(y)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),O(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var p=Ul(f.shape,s.shape,t,o,e),v=G.runKernelFunc(function(g,y){var x=g.conv3d(f,s,p);return y([f,s]),x},{x:f,$filter:s},function(g,y){O(Kh(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var x=y[0],w=y[1];return{x:function(){return j1(x.shape,g,w,t,e)},$filter:function(){return function(_,E,R,A,C){var T=_;_.rank===4&&(T=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]));var N=E;N.rank===4&&(N=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),O(T.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+T.shape+"."}),O(N.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+N.shape+"."}),O(R.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+R+"."}),O(T.shape[4]===R[3],function(){return"Error in conv3dDerFilter: depth of input "+T.shape[4]+") must match input depth in filter ("+R[3]+"."}),O(N.shape[4]===R[4],function(){return"Error in conv3dDerFilter: depth of dy ("+N.shape[4]+") must match output depth for filter ("+R[4]+")."});var L=Ul(T.shape,R,A,1,C);return G.runKernelFunc(function(B){return B.conv3dDerFilter(T,N,L)},{x5D:T,dy5D:N})}(x,g,w.shape,t,e)}}});return h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),Kd=H({conv2dDerFilter_:function(r,n,t,e,a,o,l){o===void 0&&(o="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var f=n;f.rank===3&&(f=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),O(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),O(f.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+f.shape+"."}),O(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var h=o==="NHWC"?s.shape[3]:s.shape[1],p=o==="NHWC"?f.shape[3]:f.shape[1];O(h===t[2],function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."}),O(p===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+p+") must match output depth for filter ("+t[3]+")."}),l!=null&&O(Te(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+a+"."});var v=zd(o),g=bi(s.shape,t,e,1,a,l,!1,v);return G.runKernelFunc(function(y){return y.conv2dDerFilter(s,f,g)},{x4D:s,dy4D:f})}}),X1=H({conv2dDerInput_:q1}),ec=H({depthwiseConv2d_:function(r,n,t,e,a,o,l){o===void 0&&(o=[1,1]);var s=M(r,"x","depthwiseConv2d"),f=M(n,"filter","depthwiseConv2d"),h=s,p=!1;s.rank===3&&(p=!0,h=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(h.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."}),O(f.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+f.rank+"."}),O(h.shape[3]===f.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+f.shape[2]+"."}),o==null&&(o=[1,1]),O(Tn(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),l!=null&&O(Te(e),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+e+"."});var v=bi(h.shape,f.shape,t,o,e,l,!0),g=[h,f],y=G.runKernelFunc(function(x,w){var _=x.depthwiseConv2D(h,f,v);return w([h,f]),_},{x:h,filter:f},function(x,w){O(Ro(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var _=w[0],E=w[1];return{x:function(){return K1(_.shape,x,E,v)},filter:function(){return Y1(_,x,E.shape,v)}}},"DepthwiseConv2dNative",v,g);return p?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),K1=H({depthwiseConv2dDerInput_:function(r,n,t,e){var a=n,o=!1;n.rank===3&&(o=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var l=G.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(a,t,e)},{dy4D:a});return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Y1=H({depthwiseConv2dDerFilter_:function(r,n,t,e){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=n;return o.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),G.runKernelFunc(function(l){return l.depthwiseConv2DDerFilter(a,o,e)},{x4D:a,dy4D:o})}}),Yd=H({separableConv2d_:function(r,n,t,e,a,o,l){o===void 0&&(o=[1,1]),l===void 0&&(l="NHWC");var s=M(r,"x","separableConv2d"),f=M(n,"depthwiseFilter","separableConv2d"),h=M(t,"pointwiseFilter","separableConv2d"),p=s,v=!1;if(s.rank===3&&(v=!0,p=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(p.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+p.rank+"."}),O(f.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+f.rank+"."}),O(h.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+f.rank+"."}),O(h.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."}),O(h.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."});var g=f.shape[2],y=f.shape[3];O(h.shape[2]===g*y,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+g*y+", but got "+h.shape[2]+"."});var x=ec(p,f,e,a,l,o),w=or(x,h,1,"valid",l);return v?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),ER=H({conv2dTranspose_:function(r,n,t,e,a,o){return q1(t,M(r,"x","conv2dTranspose"),M(n,"filter","conv2dTranspose"),e,a,"NHWC",o)}}),CR=H({conv3dTranspose_:function(r,n,t,e,a){return j1(t,M(r,"x","conv3dTranspose"),M(n,"filter","conv3dTranspose"),e,a)}}),nc=H({matMul_:function(r,n,t,e){var a;t===void 0&&(t=!1),e===void 0&&(e=!1);var o=M(r,"a","matMul"),l=M(n,"b","matMul");a=xe(o,l),o=a[0],l=a[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],f=e?l.shape[l.rank-1]:l.shape[l.rank-2],h=t?o.shape[o.rank-1]:o.shape[o.rank-2],p=e?l.shape[l.rank-2]:l.shape[l.rank-1],v=o.shape.slice(0,-2),g=l.shape.slice(0,-2),y=Et(v),x=Et(g);O(o.rank>=2&&l.rank>=2&&o.rank===l.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+l.rank+"."}),O(Ye(v,g),function(){return"Error in matMul: outer dimensions ("+v+") and ("+g+") of Tensors with shapes "+o.shape+" and "+l.shape+" must match."}),O(s===f,function(){return"Error in matMul: inner shapes ("+s+") and ("+f+") of Tensors with shapes "+o.shape+" and "+l.shape+" and transposeA="+t+" and transposeB="+e+" must match."});var w=o.shape.slice(0,-2).concat([h,p]),_=t?o.as3D(y,s,h):o.as3D(y,h,s),E=e?l.as3D(x,p,f):l.as3D(x,f,p),R={transposeA:t,transposeB:e};return G.runKernelFunc(function(A,C){var T=A.batchMatMul(_,E,t,e);return C([_,E]),T},{a:_,b:E},function(A,C){var T=C,N=T[0],L=T[1];return t||e?!t&&e?{a:function(){return A.matMul(L,!1,!1)},b:function(){return A.matMul(N,!0,!1)}}:t&&!e?{a:function(){return L.matMul(A,!1,!0)},b:function(){return N.matMul(A,!1,!1)}}:{a:function(){return L.matMul(A,!0,!0)},b:function(){return A.matMul(N,!0,!0)}}:{a:function(){return A.matMul(L,!1,!0)},b:function(){return N.matMul(A,!0,!1)}}},"BatchMatMul",R).reshape(w)}}),SR=H({dot_:function(r,n){var t=M(r,"t1","dot"),e=M(n,"t2","dot");O(!(t.rank!==1&&t.rank!==2||e.rank!==1&&e.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+e.rank+"."});var a=t.rank===1?t.size:t.shape[1],o=e.rank===1?e.size:e.shape[0];return O(a===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+o+"."}),t.rank===1&&e.rank===1?t.as2D(1,-1).matMul(e.as2D(-1,1)).asScalar():t.rank===1&&e.rank===2?t.as2D(1,-1).matMul(e.as2D(e.shape[0],e.shape[1])).as1D():t.rank===2&&e.rank===1?t.matMul(e.as2D(-1,1)).as1D():t.matMul(e.as2D(e.shape[0],e.shape[1]))}}),RR=H({outerProduct_:function(r,n){var t=M(r,"v1","outerProduct"),e=M(n,"v2","outerProduct");return O(t.rank===1&&e.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."}),t.as2D(-1,1).matMul(e.as2D(1,-1))}}),Qu=H({reverse_:function(r,n){var t=M(r,"x","reverse");if(t.rank===0)return t.clone();var e=Pe(n,t.shape);return G.runKernelFunc(function(a){return a.reverse(t,e)},{$x:t},function(a){return{$x:function(){return a.reverse(e)}}}).reshapeAs(t)}}),AR=H({reverse1d_:function(r){var n=M(r,"x","reverse");return O(n.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),Qu(n,0)}}),TR=H({reverse2d_:function(r,n){var t=M(r,"x","reverse");return O(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Qu(t,n)}}),DR=H({reverse3d_:function(r,n){var t=M(r,"x","reverse");return O(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Qu(t,n)}}),NR=H({reverse4d_:function(r,n){var t=M(r,"x","reverse");return O(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Qu(t,n)}});function Q1(r,n,t,e,a,o){var l=M(r,"x","maxPool"),s=l,f=!1;l.rank===3&&(f=!0,s=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),O(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),O(Tn(t,e),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"}),o!=null&&O(Te(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=Uu(s.shape,n,t,e,a,o);if(h.filterWidth===1&&h.filterHeight===1&&Ye(h.inShape,h.outShape))return l.clone();var p=[s],v=G.runKernelFunc(function(g,y){var x=g.maxPool(s,h);return y([s,x]),x},{x:s},function(g,y){var x=y[0],w=y[1];return{x:function(){return function(_,E,R,A,C,T,N,L){var B=M(_,"dy","maxPoolBackprop"),I=M(E,"input","maxPoolBackprop"),F=M(R,"output","maxPoolBackprop");O(I.rank===B.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+B.rank+")"}),O(Tn(C,T),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+T+"'"}),O(B.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+B.rank+"."}),O(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var W=Uu(I.shape,A,C,T,N,L);return G.runKernelFunc(function(U){return U.maxPoolBackprop(B,I,F,W)},{$dy:B,$input:I})}(g,x,w,n,t,e,a)}}},"MaxPool",h,p);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function Z1(r,n,t,e,a,o){var l=M(r,"x","avgPool","float32");O(Tn(t,e),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"});var s=l,f=!1;l.rank===3&&(f=!0,s=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),O(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&O(Te(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=Uu(s.shape,n,t,e,a,o);if(h.filterWidth===1&&h.filterHeight===1&&Ye(h.inShape,h.outShape))return l.clone();var p=G.runKernelFunc(function(v){return v.avgPool(s,h)},{x:s},function(v){return{x:function(){return function(g,y,x,w,_,E){var R=M(g,"dy","avgPoolBackprop"),A=M(y,"input","avgPoolBackprop");O(A.rank===R.rank,function(){return"Rank of input ("+A.rank+") does not match rank of dy ("+R.rank+")"}),O(Tn(w,_),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+_+"'"});var C=A,T=R,N=!1;A.rank===3&&(N=!0,C=A.as4D(1,A.shape[0],A.shape[1],A.shape[2]),T=R.as4D(1,R.shape[0],R.shape[1],R.shape[2])),O(T.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."}),O(C.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+C.rank+"."});var L=Uu(C.shape,x,w,_,E),B=G.runKernelFunc(function(I){return I.avgPoolBackprop(T,C,L)},{dy4D:T,input4D:C});return N?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B}(v,s,n,t,e,a)}}},"AvgPool",h);return p=p.cast(l.dtype),f?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}var Ke=H({maxPool_:function(r,n,t,e,a){return Q1(r,n,t,1,e,a)}}),Zu=H({avgPool_:function(r,n,t,e,a){return Z1(r,n,t,1,e,a)}}),MR=H({pool_:function(r,n,t,e,a,o){a==null&&(a=[1,1]),o==null&&(o=1),e===0&&(e="valid");var l=M(r,"x","maxPool"),s=l,f=!1;l.rank===3&&(f=!0,s=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),O(Tn(o,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"});var h,p=Uu(s.shape,n,o,a,e),v=[p.dilationHeight,p.dilationWidth];h=e==="same"?function(C,T){var N=C.map(function(I,F){return I+(I-1)*(T[F]-1)}).map(function(I){return I-1}),L=N.map(function(I){return Math.floor(I/2)}),B=N.map(function(I,F){return I-L[F]});return N.map(function(I,F){return[L[F],B[F]]})}([p.filterHeight,p.filterWidth],v):[[0,0],[0,0]];var g=v[0]===1&&v[1]===1,y=function(C,T,N){var L=N.map(function(nt){return nt[0]}),B=N.map(function(nt){return nt[1]}),I=C.concat(L,B),F=T.map(function(nt,tt){return(nt-I[tt]%nt)%nt}),W=B.map(function(nt,tt){return nt+F[tt]}),U=T.map(function(nt,tt){return[L[tt],W[tt]]}),at=T.map(function(nt,tt){return[0,F[tt]]});return[U,at]}([p.inHeight,p.inWidth],v,h),x=y[0],w=y[1],_=g?e:"valid",E=g?s:r1(s,v,x),R=(t==="avg"?function(){return Z1(E,n,o,1,_)}:function(){return Q1(E,n,o,1,_)})(),A=g?R:t1(R,v,w);return f?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),kR=H({maxPool3d_:function(r,n,t,e,a,o,l){o===void 0&&(o="NDHWC");var s=M(r,"x","maxPool3d"),f=s,h=!1;s.rank===4&&(h=!0,f=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),l==null&&(l=[1,1,1]),O(f.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+f.rank+"."}),O(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),O(Tn(t,l),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+l+"'"}),a!=null&&O(Te(e),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."});var p=Pl(f.shape,n,t,l,e,a,o),v=G.runKernelFunc(function(g,y){var x=g.maxPool3d(f,p);return y([f,x]),x},{x:f},function(g,y){var x=y[0],w=y[1];return{x:function(){return function(_,E,R,A,C,T,N,L){var B=M(_,"dy","maxPool3dBackprop"),I=M(E,"input","maxPool3dBackprop"),F=M(R,"output","maxPool3dBackprop"),W=B,U=I,at=F,nt=!1;I.rank===4&&(nt=!0,W=B.as5D(1,B.shape[0],B.shape[1],B.shape[2],B.shape[3]),U=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),at=F.as5D(1,F.shape[0],F.shape[1],F.shape[2],F.shape[3])),O(W.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+W.rank+"."}),O(U.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+U.rank+"."}),O(at.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+at.rank+"."}),T==null&&(T=[1,1,1]),O(Tn(C,T),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+T+"'"}),L!=null&&O(Te(N),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+L+" but got pad "+N+"."});var tt=Pl(U.shape,A,C,T,N,L),P=G.runKernelFunc(function(q){return q.maxPool3dBackprop(W,U,at,tt)},{dy5D:W,input5D:U});return nt?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(g,x,w,n,t,l,e,a)}}});return h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),OR=H({avgPool3d_:function(r,n,t,e,a,o,l){o===void 0&&(o="NDHWC");var s=M(r,"x","avgPool3d","float32"),f=s,h=!1;s.rank===4&&(h=!0,f=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),l==null&&(l=[1,1,1]),O(f.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+f.rank+"."}),O(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),O(Tn(t,l),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+l+"'"}),a!=null&&O(Te(e),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."});var p=Pl(f.shape,n,t,l,e,a,o),v=G.runKernelFunc(function(g){return g.avgPool3d(f,p)},{x:f},function(g){return{x:function(){return function(y,x,w,_,E,R,A){var C=M(y,"dy","avgPool3dBackprop"),T=M(x,"input","avgPool3dBackprop"),N=C,L=T,B=!1;T.rank===4&&(B=!0,N=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),L=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),O(N.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),O(L.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+L.rank+"."}),E==null&&(E=[1,1,1]),O(Tn(_,E),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+E+"'"}),A!=null&&O(Te(R),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+R+"."});var I=Pl(L.shape,w,_,E,R,A),F=G.runKernelFunc(function(W){return W.avgPool3dBackprop(N,L,I)},{dy5D:N,input5D:L});return B?F.as4D(F.shape[1],F.shape[2],F.shape[3],F.shape[4]):F}(g,f,n,t,l,e,a)}}});return v=v.cast(f.dtype),h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),kr=H({slice_:function(r,n,t){var e,a,o=M(r,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(e=typeof n=="number"?[n].concat(new Array(o.rank-1).fill(0)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(0)):n.slice()).forEach(function(f){O(f!==-1,function(){return"slice() does not support negative begin indexing."})}),a=(a=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(f,h){return f>=0?f:(O(f===-1,function(){return"Negative size values should be exactly -1 but got "+f+" for the slice() size at index "+h+"."}),o.shape[h]-e[h])}),uE(o,e,a);var l=o.shape,s={begin:e,size:a};return G.runKernelFunc(function(f){return f.slice(o,e,a)},{x:o},function(f){for(var h=[],p=0;p<f.rank;p++)h.push([e[p],l[p]-e[p]-a[p]]);return{x:function(){return f.pad(h)}}},"Slice",s)}}),IR=H({slice1d_:function(r,n,t){var e=M(r,"x","slice1d");return O(e.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+e.rank+" tensor"}),kr(e,[n],[t])}}),BR=H({slice2d_:function(r,n,t){var e=M(r,"x","slice2d");return O(e.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+e.rank+" tensor"}),kr(e,n,t)}}),J1=H({slice3d_:function(r,n,t){var e=M(r,"x","slice3d");return O(e.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+e.rank+" tensor"}),kr(e,n,t)}}),FR=H({slice4d_:function(r,n,t){var e=M(r,"x","slice4d");return O(e.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+e.rank+" tensor"}),kr(e,n,t)}});function $1(r,n,t,e,a){return n.rank<t.rank&&(n=n.reshape(An(n.shape,e))),r.rank<t.rank&&(r=r.reshape(An(r.shape,e))),{x:function(){var o=r.mul(t.equal(n).cast(r.dtype));return a==null?o:o.transpose(a)}}}var LR=H({all_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","all","bool"),a=Pe(n,e.shape),o=a,l=Fr(o,e.rank);l!=null&&(e=e.transpose(l),o=Lr(o.length,e.rank));var s=G.runKernelFunc(function(h){return h.all(e,o)},{$x:e});if(t){var f=An(s.shape,a);return s.reshape(f)}return s}}),zR=H({any_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","any","bool"),a=Pe(n,e.shape),o=a,l=Fr(o,e.rank);l!=null&&(e=e.transpose(l),o=Lr(o.length,e.rank));var s=G.runKernelFunc(function(h){return h.any(e,o)},{$x:e});if(t){var f=An(s.shape,a);return s.reshape(f)}return s}}),PR=H({argMax_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","argMax");n==null&&(n=0);var e=Pe(n,t.shape),a=Fr(e,t.rank);a!=null&&(t=t.transpose(a),e=Lr(e.length,t.rank));var o={axis:e[0]},l=[t];return G.runKernelFunc(function(s,f){var h=s.argMax(t,e[0]);return f([t]),h},{x:t},function(s,f){var h=f[0];return{x:function(){return Yt(h)}}},"ArgMax",o,l)}}),UR=H({argMin_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","argMin");n==null&&(n=0);var e=Pe(n,t.shape),a=Fr(e,t.rank);return a!=null&&(t=t.transpose(a),e=Lr(e.length,t.rank)),G.runKernelFunc(function(o,l){var s=o.argMin(t,e[0]);return l([t]),s},{$x:t},function(o,l){var s=l[0];return{$x:function(){return Yt(s)}}})}}),HR=H({logSumExp_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","logSumExp"),a=Pe(n,e.shape),o=e.max(a,!0),l=e.sub(o).exp().sum(a).log(),s=o.reshape(l.shape).add(l);if(t){var f=An(s.shape,a);return s.reshape(f)}return s}}),rc=H({max_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","max"),a=e,o=Pe(n,e.shape),l=o,s=Fr(l,e.rank);s!=null&&(e=e.transpose(s),l=Lr(l.length,e.rank));var f=[e],h=G.runKernelFunc(function(v,g){var y=v.max(e,l);return g([a,y]),y},{x:e},function(v,g){return $1(v,g[1],g[0],o,s)},"Max",{axes:l},f,[!0]);if(t){var p=An(h.shape,o);h=h.reshape(p)}return h}}),VR=H({mean_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","mean"),a=Pe(n,e.shape),o=Et(un(e.shape,a)[1]);return Jl(function(l){var s=vt(o);return{value:(s.dtype===l.dtype?l:l.cast(s.dtype)).div(s).sum(n,t),gradFunc:function(f){var h=l.shape.slice();return a.forEach(function(p){h[p]=1}),f.reshape(h).mul(Do(l.shape,"float32")).div(o)}}})(e)}}),WR=H({min_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","min"),a=e,o=Pe(n,e.shape),l=o,s=Fr(l,e.rank);s!=null&&(e=e.transpose(s),l=Lr(l.length,e.rank));var f=[e],h=G.runKernelFunc(function(v,g){var y=v.min(e,l);return g([a,y]),y},{x:e},function(v,g){return $1(v,g[1],g[0],o,s)},"Min",{axes:l},f,[!0]);if(t){var p=An(h.shape,o);h=h.reshape(p)}return h}}),GR=H({moments_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=Pe(n,(r=M(r,"x","moments")).shape),a=r.mean(e,t),o=a.shape;t||(o=An(a.shape,e));var l=r.toFloat().sub(a.reshape(o)).square();return{mean:a,variance:l.mean(e,t)}}}),tb=H({sum_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","sum");e.dtype==="bool"&&(e=e.toInt());var a=Pe(n,e.shape);return Jl(function(o){var l=Fr(a,o.rank),s=a,f=o;l!=null&&(f=o.transpose(l),s=Lr(s.length,o.rank));var h=function(y){var x=o.shape.slice();return a.forEach(function(w){x[w]=1}),y.reshape(x).mul(Do(o.shape,"float32"))},p={axes:s},v=G.runKernelFunc(function(y){return y.sum(f,s)},{x:f},function(y){return{x:function(){return h(y)}}},"Sum",p);if(t){var g=An(v.shape,a);v=v.reshape(g)}return{value:v,gradFunc:h}})(e)}}),qR=H({prod_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","prod");e.dtype==="bool"&&(e=e.toInt());var a=Pe(n,e.shape),o=Fr(a,e.rank),l=a,s=e;o!=null&&(s=e.transpose(o),l=Lr(l.length,e.rank));var f=G.runKernelFunc(function(p){return p.prod(s,l)},{permutedX:s});if(t){var h=An(f.shape,a);f=f.reshape(h)}return f}}),eb=H({elu_:function(r){var n=M(r,"x","elu");return G.runKernelFunc(function(t,e){var a=t.elu(n);return e([a]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){return G.runKernelFunc(function(o){return o.eluDer(t,a)},{dy:t,y:a})}}})}}),jR=H({leakyRelu_:function(r,n){n===void 0&&(n=.2);var t=M(r,"x","leakyRelu");return jd(vt(n).mul(t),t)}}),nb=H({prelu_:function(r,n){var t=M(r,"x","prelu"),e=M(n,"alpha","prelu");return G.runKernelFunc(function(a,o){var l=a.prelu(t,e);return o([t,e]),l},{x:t,alpha:e},function(a,o){var l=o[0],s=o[1],f=l.greater(0);return{x:function(){return mi(f,a,a.mul(s))},alpha:function(){var h=mi(f,Yt(a),a.mul(l)),p=Le(s.shape,a.shape);return p.length>0&&(h=h.sum(p)),h.reshape(s.shape)}}},"Prelu")}}),be=H({relu_:function(r){var n=M(r,"x","relu");return n.dtype==="bool"?n.toInt():G.runKernelFunc(function(t,e){var a=t.relu(n);return e([n]),a},{x:n},function(t,e){var a=e[0];return{x:function(){return t.mulStrict(a.step().toFloat())}}},"Relu")}}),rb=H({relu6_:function(r){var n=M(r,"x","relu6");return n.dtype==="bool"?n.toInt():G.runKernelFunc(function(t,e){var a=t.relu6(n);return e([n]),a},{x:n},function(t,e){var a=e[0],o=a.lessEqual(6).mul(a.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),XR=H({selu_:function(r){var n=M(r,"x","selu");return G.runKernelFunc(function(t,e){var a=t.selu(n);return e([n]),a},{$x:n},function(t,e){var a=e[0];return{$x:function(){var o=a.greater(vt(0)),l=vt(Wd),s=vt(Gd),f=t.mul(s),h=t.mul(l).mul(a.toFloat().exp());return mi(o,f,h)}}})}}),Ua=H({transpose_:function(r,n){var t=M(r,"x","transpose");if(n==null&&(n=t.shape.map(function(a,o){return o}).reverse()),O(t.rank===n.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."}),n.forEach(function(a){O(a>=0&&a<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n})}),t.rank<=1)return t.clone();var e={perm:n};return G.runKernelFunc(function(a){return a.transpose(t,n)},{x:t},function(a){var o=Od(n);return{x:function(){return a.transpose(o)}}},"Transpose",e)}}),KR=H({localResponseNormalization_:function(r,n,t,e,a){n===void 0&&(n=5),t===void 0&&(t=1),e===void 0&&(e=1),a===void 0&&(a=.5);var o=M(r,"x","localResponseNormalization");O(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),O(Te(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var l=o,s=!1;o.rank===3&&(s=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var f=G.runKernelFunc(function(h,p){var v=h.localResponseNormalization4D(l,n,t,e,a);return p([l,v]),v},{x4D:l},function(h,p){var v=p[0],g=p[1];return{x4D:function(){return G.runKernelFunc(function(y){return y.LRNGrad(h,v,g,n,t,e,a)},{})}}});return s?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),ab=H({norm_:function(r,n,t,e){n===void 0&&(n="euclidean"),t===void 0&&(t=null),e===void 0&&(e=!1);var a=function s(f,h,p){if(p===void 0&&(p=null),f.rank===0)return f.abs();if(f.rank!==1&&p===null)return s(f.reshape([-1]),h,p);if(f.rank===1||typeof p=="number"||Array.isArray(p)&&p.length===1){if(h===1)return f.abs().sum(p);if(h===1/0)return f.abs().max(p);if(h===-1/0)return f.abs().min(p);if(h==="euclidean"||h===2)return f.abs().pow(vt(2,"int32")).sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(p)&&p.length===2){if(h===1)return f.abs().sum(p[0]).max(p[1]-1);if(h===1/0)return f.abs().sum(p[1]).max(p[0]);if(h===-1/0)return f.abs().sum(p[1]).min(p[0]);if(h==="fro"||h==="euclidean")return f.square().sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+p)}(r=M(r,"x","norm"),n,t),o=a.shape;if(e){var l=Pe(t,r.shape);o=An(a.shape,l)}return a.reshape(o)}}),YR=H({basicLSTMCell_:function(r,n,t,e,a,o){var l=M(r,"forgetBias","basicLSTMCell"),s=M(n,"lstmKernel","basicLSTMCell"),f=M(t,"lstmBias","basicLSTMCell"),h=M(e,"data","basicLSTMCell"),p=M(a,"c","basicLSTMCell"),v=M(o,"h","basicLSTMCell"),g=h.concat(v,1).matMul(s).add(f),y=g.shape[0],x=g.shape[1]/4,w=[y,x],_=g.slice([0,0],w),E=g.slice([0,x],w),R=g.slice([0,2*x],w),A=g.slice([0,3*x],w),C=_.sigmoid().mulStrict(E.tanh()).addStrict(p.mulStrict(l.add(R).sigmoid())),T=C.tanh().mulStrict(A.sigmoid());return[C,T]}}),QR=H({multiRNNCell_:function(r,n,t,e){for(var a=M(n,"data","multiRNNCell"),o=Ol(t,"c","multiRNNCell"),l=Ol(e,"h","multiRNNCell"),s=a,f=[],h=0;h<r.length;h++){var p=r[h](s,o[h],l[h]);f.push(p[0]),f.push(p[1]),s=p[1]}var v=[],g=[];for(h=0;h<f.length;h+=2)v.push(f[h]),g.push(f[h+1]);return[v,g]}}),ZR=H({movingAverage_:function(r,n,t,e,a){a===void 0&&(a=!0);var o=M(r,"v","movingAverage"),l=M(n,"x","movingAverage"),s=M(t,"decay","movingAverage");Kw(o,l),O(Ye(o.shape,l.shape),function(){return"Shape mismatch in v and x"});var f=vt(1),h=f.sub(s),p=l.sub(o).mul(h);if(a){O(e!=null,function(){return"When using zeroDebias: true, step is required."});var v=M(e,"step","movingAverage");p=p.div(f.sub(Wl(s,v)))}return o.add(p)}}),JR=H({stridedSlice_:function(r,n,t,e,a,o,l,s,f){if(a===void 0&&(a=0),o===void 0&&(o=0),l===void 0&&(l=0),s===void 0&&(s=0),f===void 0&&(f=0),e==null&&(e=new Array(n.length)),l!==0)throw new Error("ellipsis mask is not yet supported");var h=M(r,"x","stridedSlice"),p=Gy(s),v=h.shape.slice();p.forEach(function(_){n[_]=0,t[_]=1,v.splice(_,0,1)}),h=h.reshape(v);for(var g=0;g<h.rank;g++)n[g]=sE(a,n,e,h.shape,g),t[g]=lE(o,t,e,h.shape,g),e[g]=e[g]||1;var y=Gy(f);y.forEach(function(_){t[_]=n[_]+1,e[_]=1});var x=Ld(n,t,e),w=x.filter(function(_,E){return y.indexOf(E)===-1});return e.every(function(_){return _===1})?kr(h,n,x).reshape(w):G.runKernelFunc(function(_){return _.stridedSlice(h,n,t,e)},{$x:h}).reshape(w)}}),$R=H({topk_:function(r,n,t){n===void 0&&(n=1),t===void 0&&(t=!0);var e=M(r,"x","topk");if(e.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=e.shape[e.shape.length-1];if(n>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+n);var o=G.runKernelFunc(function(l){return l.topk(e,n,t)},{$x:e});return{values:o[0],indices:o[1]}}}),tA=H({scatterND_:function(r,n,t){var e=M(r,"indices","scatterND","int32"),a=M(n,"updates","scatterND");return oE(a,e,t),G.runKernelFunc(function(o){return o.scatterND(e,a,t)},{indices:e,updates:a},null,"ScatterNd",{shape:t})}}),Qd=H({fft_:function(r){O(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],t=r.size/n,e=r.as2D(t,n);return G.runKernelFunc(function(a){return a.fft(e)},{input:r}).reshape(r.shape)}}),Gl=H({ifft_:function(r){O(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],t=r.size/n,e=r.as2D(t,n);return G.runKernelFunc(function(a){return a.ifft(e)},{input:r}).reshape(r.shape)}}),Zd=H({rfft_:function(r,n){O(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,e=r.shape[r.shape.length-1],a=r.size/e;if(n!=null&&n<e){var o=r.shape.map(function(E){return 0}),l=r.shape.map(function(E){return E});l[r.shape.length-1]=n,t=r.slice(o,l),e=n}else if(n!=null&&n>e){var s=r.shape.map(function(E){return E});s[r.shape.length-1]=n-e,t=r.concat(pe(s),r.shape.length-1),e=n}else t=r;var f=t.zerosLike(),h=tn(t,f).as2D(a,e),p=Qd(h),v=Math.floor(e/2)+1,g=ar(p),y=Ar(p),x=g.split([v,e-v],g.shape.length-1),w=y.split([v,e-v],y.shape.length-1),_=t.shape.slice();return _[t.shape.length-1]=v,tn(x[0],w[0]).reshape(_)}}),ib=H({irfft_:function(r){var n=r.shape[r.shape.length-1],t=r.size/n;if(n<=2){var e=r.as2D(t,n),a=Gl(e);return ar(a)}var o=[t,2*(n-1)],l=ar(r).as2D(t,n),s=Ar(r).as2D(t,n),f=l.slice([0,1],[t,n-2]).reverse(1),h=s.slice([0,1],[t,n-2]).reverse(1).mul(vt(-1)),p=l.concat(f,1),v=s.concat(h,1);return e=tn(p,v).as2D(o[0],o[1]),a=Gl(e),ar(a)}}),eA=Object.freeze({fft:Qd,ifft:Gl,rfft:Zd,irfft:ib}),nA=H({sparseToDense_:function(r,n,t,e){e===void 0&&(e=0);var a=M(r,"sparseIndices","sparseToDense","int32"),o=M(n,"sparseValues","sparseToDense"),l=M(e,"defaultValue","sparseToDense",o.dtype);return function(s,f,h,p){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var v=s.rank>0?s.shape[0]:1,g=s.rank>1?s.shape[1]:1;if(h.length!==g)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+g+".");var y=f.size;if(f.rank!==0&&(f.rank!==1||y!==v))throw new Error("sparseValues has incorrect shape "+f.shape+", should be [] or ["+v+"]");if(f.dtype!==p.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,o,t,l),G.runKernelFunc(function(s){return s.sparseToDense(a,o,t,l)},{$sparseIndices:a,$sparseValues:o,$defaultValue:l})}}),rA=H({gatherND_:function(r,n){var t=M(n,"indices","gatherND","int32"),e=M(r,"x","gatherND");return G.runKernelFunc(function(a){return a.gatherND(e,t)},{x:e,indices:t},null,"GatherNd")}}),aA=H({diag_:function(r){var n=M(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return G.runKernelFunc(function(e){return e.diag(n)},{$x:n}).reshape(t)}}),iA=H({dropout_:function(r,n,t,e){var a=M(r,"x","dropout");if(O(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),O(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),n===0)return r instanceof ye?a.clone():a;var o=function(f,h){if(h==null)return f.shape.slice();if(Ye(f.shape,h))return h;if(f.shape.length===h.length){for(var p=[],v=0;v<f.shape.length;v++)h[v]==null&&f.shape[v]!=null?p.push(f.shape[v]):p.push(h[v]);return p}return h}(a,t),l=1-n,s=n1(o,0,1,"float32",e).add(l).floor().div(l);return a.mul(s)}});function ob(r,n,t){for(var e=1-r%2,a=new Float32Array(r),o=0;o<r;++o){var l=2*Math.PI*o/(r+e-1);a[o]=n-t*Math.cos(l)}return Me(a,"float32")}var Jd=H({hannWindow_:function(r){return ob(r,.5,.5)}}),ub=H({hammingWindow_:function(r){return ob(r,.54,.46)}}),$d=H({frame_:function(r,n,t,e,a){e===void 0&&(e=!1),a===void 0&&(a=0);for(var o=0,l=[];o+n<=r.size;)l.push(kr(r,o,n)),o+=t;if(e)for(;o<r.size;){var s=o+n-r.size,f=Be([kr(r,o,n-s),Mr([s],a)]);l.push(f),o+=t}return l.length===0?Fa([],[0,n]):Be(l).as2D(l.length,n)}}),sb=H({stft_:function(r,n,t,e,a){var o;a===void 0&&(a=Jd),e==null&&(o=n,e=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var l=$d(r,n,t),s=fn(l,a(n)),f=[],h=0;h<l.shape[0];h++)f.push(Zd(s.slice([h,0],[1,n]),e));return Be(f)}}),oA=Object.freeze({hannWindow:Jd,hammingWindow:ub,frame:$d,stft:sb}),cn,uA=function(r,n,t){return t===void 0&&(t=1),wt(this,void 0,void 0,function(){var e,a,o,l,s,f,h,p,v,g,y,x,w,_;return _t(this,function(E){switch(E.label){case 0:return e=M(r,"predictions","inTopK"),a=M(n,"targets","inTopK"),O(e.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+e.rank}),O(e.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+e.rank+" and targets rank "+a.rank}),te(e.shape.slice(0,e.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=e.shape[e.shape.length-1],O(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,e.data()];case 1:return l=E.sent(),[4,a.data()];case 2:for(s=E.sent(),f=[l.length/o,o],p=f[1],v=Lu("bool",h=f[0]),g=0;g<h;g++){for(y=g*p,x=l.subarray(y,y+p),w=[],_=0;_<x.length;_++)w.push({value:x[_],index:_});for(w.sort(function(R,A){return A.value-R.value}),v[g]=0,_=0;_<t;_++)if(w[_].index===s[g]){v[g]=1;break}}return r!==e&&e.dispose(),n!==a&&a.dispose(),[2,nn(v,a.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(cn||(cn={}));var sA=H({absoluteDifference_:function(r,n,t,e){e===void 0&&(e=cn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","absoluteDifference"),o=M(n,"predictions","absoluteDifference"),l=null;t!=null&&(l=M(t,"weights","absoluteDifference")),te(a.shape,o.shape,"Error in absoluteDifference: ");var s=a.sub(o).abs();return aa(s,l,e)}}),aa=H({computeWeightedLoss_:function(r,n,t){t===void 0&&(t=cn.SUM_BY_NONZERO_WEIGHTS);var e=M(r,"losses","computeWeightedLoss"),a=null;n!=null&&(a=M(n,"weights","computeWeightedLoss"));var o=a==null?e:e.mul(a);if(t===cn.NONE)return o;if(t===cn.SUM)return o.sum();if(t===cn.MEAN){if(a==null)return o.mean();var l=e.size/a.size,s=o.sum().div(a.sum());return l>1?s.div(vt(l)):s}if(t===cn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return o.sum().div(vt(e.size));var f=a.mul(Do(e.shape)).notEqual(vt(0)).sum().toFloat();return o.sum().div(f)}throw Error("Unknown reduction: "+t)}}),lA=H({cosineDistance_:function(r,n,t,e,a){a===void 0&&(a=cn.SUM_BY_NONZERO_WEIGHTS);var o=M(r,"labels","cosineDistance"),l=M(n,"predictions","cosineDistance"),s=null;e!=null&&(s=M(e,"weights","cosineDistance")),te(o.shape,l.shape,"Error in cosineDistance: ");var f=vt(1).sub(o.mul(l).sum(t,!0));return aa(f,s,a)}}),cA=H({hingeLoss_:function(r,n,t,e){e===void 0&&(e=cn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","hingeLoss"),o=M(n,"predictions","hingeLoss"),l=null;t!=null&&(l=M(t,"weights","hingeLoss")),te(a.shape,o.shape,"Error in hingeLoss: ");var s=vt(1);a=vt(2).mul(a).sub(s);var f=s.sub(a.mul(o)).relu();return aa(f,l,e)}}),fA=H({huberLoss_:function(r,n,t,e,a){e===void 0&&(e=1),a===void 0&&(a=cn.SUM_BY_NONZERO_WEIGHTS);var o=M(r,"labels","huberLoss"),l=M(n,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),te(o.shape,l.shape,"Error in huberLoss: ");var f=vt(e),h=l.sub(o).abs(),p=H1(h,f),v=h.sub(p),g=vt(.5).mul(p.square()).add(f.mul(v));return aa(g,s,a)}}),hA=H({logLoss_:function(r,n,t,e,a){e===void 0&&(e=1e-7),a===void 0&&(a=cn.SUM_BY_NONZERO_WEIGHTS);var o=M(r,"labels","logLoss"),l=M(n,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),te(o.shape,l.shape,"Error in logLoss: ");var f=vt(1),h=vt(e),p=o.mul(l.add(h).log()).neg().sub(f.sub(o).mul(f.sub(l).add(h).log()));return aa(p,s,a)}}),dA=H({meanSquaredError_:function(r,n,t,e){e===void 0&&(e=cn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","meanSquaredError"),o=M(n,"predictions","meanSquaredError"),l=null;t!=null&&(l=M(t,"weights","meanSquaredError")),te(a.shape,o.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(o);return aa(s,l,e)}}),pA=H({sigmoidCrossEntropy_:function(r,n,t,e,a){e===void 0&&(e=0),a===void 0&&(a=cn.SUM_BY_NONZERO_WEIGHTS);var o=M(r,"multiClassLabels","sigmoidCrossEntropy"),l=M(n,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),te(o.shape,l.shape,"Error in sigmoidCrossEntropy: "),e>0){var f=vt(e),h=vt(1),p=vt(.5);o=o.mul(h.sub(f)).add(p.mul(f))}var v=function(g,y){var x=M(g,"labels","sigmoidCrossEntropyWithLogits"),w=M(y,"logits","sigmoidCrossEntropyWithLogits");te(x.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var _=w.relu(),E=w.mul(x),R=w.abs().neg().exp().log1p();return _.sub(E).add(R)}(o,l);return aa(v,s,a)}}),vA=H({softmaxCrossEntropy_:function(r,n,t,e,a){e===void 0&&(e=0),a===void 0&&(a=cn.SUM_BY_NONZERO_WEIGHTS);var o=M(r,"onehotLabels","softmaxCrossEntropy"),l=M(n,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),te(o.shape,l.shape,"Error in softmaxCrossEntropy: "),e>0){var f=vt(e),h=vt(1),p=vt(o.shape[1]);o=o.mul(h.sub(f)).add(f.div(p))}var v=function(g,y,x){if(x===void 0&&(x=-1),x===-1&&(x=y.rank-1),x!==y.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+y.rank+" and dim was "+x);return Jl(function(w,_,E){var R=_.logSumExp([x],!0),A=_.toFloat().sub(R);return E([w,A]),{value:A.mul(w).neg().sum([x]),gradFunc:function(C,T){var N=T[0],L=T[1],B=An(C.shape,[x]);return[C.reshape(B).mul(N.toFloat().sub(L.exp())),C.reshape(B).mul(L.exp().sub(N.toFloat()))]}}})(g,y)}(o,l);return aa(v,s,a)}}),mA=Object.freeze({get Reduction(){return cn},absoluteDifference:sA,computeWeightedLoss:aa,cosineDistance:lA,hingeLoss:cA,huberLoss:fA,logLoss:hA,meanSquaredError:dA,sigmoidCrossEntropy:pA,softmaxCrossEntropy:vA});function h0(r,n){return n===void 0&&(n=!1),G.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],e=r.shape[1],a=e1(t),o=r.clone(),l=Fa([[1]],[1,1]),s=l.clone(),f=t>=e?e:t,h=function(v){var g,y=o,x=s,w=a;g=G.tidy(function(){var _=o.slice([v,v],[t-v,1]),E=_.norm(),R=o.slice([v,v],[1,1]),A=Fa([[-1]]).where(R.greater(0),Fa([[1]])),C=R.sub(A.mul(E)),T=_.div(C);s=T.shape[0]===1?l.clone():l.concat(T.slice([1,0],[T.shape[0]-1,T.shape[1]]),0);var N=A.matMul(C).div(E).neg(),L=o.slice([v,0],[t-v,e]),B=N.mul(s);if(v===0)o=L.sub(B.matMul(s.transpose().matMul(L)));else{var I=L.sub(B.matMul(s.transpose().matMul(L)));o=o.slice([0,0],[v,e]).concat(I,0)}var F=a.slice([0,v],[t,a.shape[1]-v]);if(v===0)a=F.sub(F.matMul(s).matMul(B.transpose()));else{var W=F.sub(F.matMul(s).matMul(B.transpose()));a=a.slice([0,0],[t,v]).concat(W,1)}return[s,o,a]}),s=g[0],o=g[1],a=g[2],Rn([y,x,w])},p=0;p<f;++p)h(p);return!n&&t>e&&(a=a.slice([0,0],[t,e]),o=o.slice([0,0],[e,e])),[a,o]})}var gA=H({bandPart_:function(r,n,t){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var e=M(r,"a","bandPart");if(e.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+e.rank+".");var a=e.shape,o=e.shape.slice(-2),l=o[0],s=o[1];if(!(n<=l))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+l+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");n<0&&(n=l),t<0&&(t=s);var f=Il(0,l,1,"int32").reshape([-1,1]),h=Il(0,s,1,"int32"),p=ze(f,h),v=tc(p.lessEqual(vt(+n,"int32")),p.greaterEqual(vt(-t,"int32"))),g=pe([l,s],e.dtype);return Wn(Fe(e.reshape([-1,l,s])).map(function(y){return mi(v,y,g)})).reshape(a)}}),yA=H({gramSchmidt_:function(r){var n;if(Array.isArray(r)){n=!1,O(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],e=function(f){O(r[f].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[f].shape[0]+" vs. "+t+")"})},a=1;a<r.length;++a)e(a)}else n=!0,r=Bd(r,r.shape[0],0).map(function(f){return a1(f,[0])});O(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var o=[],l=r,s=function(f){o.push(G.tidy(function(){var h=l[f];if(f>0)for(var p=0;p<f;++p){var v=tb(o[p].mulStrict(h)).mul(o[p]);h=h.sub(v)}return h.div(ab(h,"euclidean"))}))};for(a=0;a<r.length;++a)s(a);return n?Wn(o,0):o}}),bA=H({qr_:function(r,n){if(n===void 0&&(n=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return h0(r,n);var t=r.shape.slice(0,r.shape.length-2).reduce(function(l,s){return l*s}),e=Fe(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],o=[];return e.forEach(function(l){var s=h0(l,n),f=s[0],h=s[1];a.push(f),o.push(h)}),[Wn(a,0).reshape(r.shape),Wn(o,0).reshape(r.shape)]}}),xA=Object.freeze({bandPart:gA,gramSchmidt:yA,qr:bA});function ac(r,n,t,e,a,o){e==null&&(e=.5),a==null&&(a=Number.NEGATIVE_INFINITY),o==null&&(o=0);var l=r.shape[0];return t=Math.min(t,l),O(0<=e&&e<=1,function(){return"iouThreshold must be in [0, 1], but was '"+e+"'"}),O(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),O(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),O(n.rank===1,function(){return"scores must be a 1D tensor"}),O(n.shape[0]===l,function(){return"scores has incompatible shape with boxes. Expected "+l+", but was "+n.shape[0]}),O(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:e,scoreThreshold:a,softNmsSigma:o}}var wA=H({resizeBilinear_:function(r,n,t){t===void 0&&(t=!1);var e=M(r,"images","resizeBilinear");O(e.rank===3||e.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+e.rank+"."}),O(n.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var a=e,o=!1;e.rank===3&&(o=!0,a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var l=n[0],s=n[1],f=G.runKernelFunc(function(h,p){return p([a]),h.resizeBilinear(a,l,s,t)},{x:a},function(h,p){return{x:function(){return G.runKernelFunc(function(v){return v.resizeBilinearBackprop(h,p[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:l,newWidth:s});return o?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),_A=H({resizeNearestNeighbor_:function(r,n,t){t===void 0&&(t=!1);var e=M(r,"images","resizeNearestNeighbor");O(e.rank===3||e.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+e.rank+"."}),O(n.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),O(e.dtype==="float32"||e.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=e,o=!1;e.rank===3&&(o=!0,a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var l=n[0],s=n[1],f=G.runKernelFunc(function(h,p){return p([a]),h.resizeNearestNeighbor(a,l,s,t)},{batchImages:a},function(h,p){return{batchImages:function(){return G.runKernelFunc(function(v){return v.resizeNearestNeighborBackprop(h,p[0],t)},{})}}});return o?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),EA=H({nonMaxSuppression_:function(r,n,t,e,a){e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var o=M(r,"boxes","nonMaxSuppression"),l=M(n,"scores","nonMaxSuppression"),s=ac(o,l,t,e,a);t=s.maxOutputSize,e=s.iouThreshold,a=s.scoreThreshold;var f={maxOutputSize:t,iouThreshold:e,scoreThreshold:a};return G.runKernelFunc(function(h){return h.nonMaxSuppression(o,l,t,e,a)},{boxes:o,scores:l},null,"NonMaxSuppressionV3",f)}}),CA=function(r,n,t,e,a){return e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),wt(this,void 0,void 0,function(){var o,l,s,f,h,p,v;return _t(this,function(g){switch(g.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),l=M(n,"scores","nonMaxSuppressionAsync"),s=ac(o,l,t,e,a),t=s.maxOutputSize,e=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([o.data(),l.data()])];case 1:return f=g.sent(),h=f[0],p=f[1],v=Pd(h,p,t,e,a),o!==r&&o.dispose(),l!==n&&l.dispose(),[2,v]}})})},SA=H({nonMaxSuppressionWithScore_:function(r,n,t,e,a,o){e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var l=M(r,"boxes","nonMaxSuppression"),s=M(n,"scores","nonMaxSuppression"),f=ac(l,s,t,e,a,o),h={maxOutputSize:t=f.maxOutputSize,iouThreshold:e=f.iouThreshold,scoreThreshold:a=f.scoreThreshold,softNmsSigma:o=f.softNmsSigma},p=G.runKernel("NonMaxSuppressionV5",{boxes:l,scores:s},h);return{selectedIndices:p[0],selectedScores:p[1]}}}),RA=function(r,n,t,e,a,o){return e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),wt(this,void 0,void 0,function(){var l,s,f,h,p,v,g;return _t(this,function(y){switch(y.label){case 0:return l=M(r,"boxes","nonMaxSuppressionAsync"),s=M(n,"scores","nonMaxSuppressionAsync"),f=ac(l,s,t,e,a,o),t=f.maxOutputSize,e=f.iouThreshold,a=f.scoreThreshold,o=f.softNmsSigma,[4,Promise.all([l.data(),s.data()])];case 1:return h=y.sent(),p=h[0],v=h[1],g=Ud(p,v,t,e,a,o),l!==r&&l.dispose(),s!==n&&s.dispose(),[2,g]}})})},AA=H({cropAndResize_:function(r,n,t,e,a,o){var l=M(r,"image","cropAndResize"),s=M(n,"boxes","cropAndResize","float32"),f=M(t,"boxInd","cropAndResize","int32");a=a||"bilinear",o=o||0;var h=s.shape[0];return O(l.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+l.rank+"."}),O(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+s.shape+"."}),O(f.rank===1&&f.shape[0]===h,function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+s.shape+"."}),O(e.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+e.length+"."}),O(e[0]>=1&&e[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+e}),O(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),G.runKernelFunc(function(p,v){return p.cropAndResize(l,s,f,e,a,o)},{images:l,boxes:s,boxInd:f},null,"CropAndResize",{method:a,extrapolationValue:o,cropSize:e})}}),tp=Object.freeze({resizeBilinear:wA,resizeNearestNeighbor:_A,nonMaxSuppression:EA,nonMaxSuppressionAsync:CA,nonMaxSuppressionWithScore:SA,nonMaxSuppressionWithScoreAsync:RA,cropAndResize:AA}),ep=function(r,n){return!(r>0)||n==="linear"},np=function(r,n,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(n.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},rp=function(r,n){var t=n,e=Le(r.shape,n.shape);return e.length>0&&(t=t.sum(e)),t.reshape(r.shape)},ap=function(r,n,t){if(n==="linear")return r;if(n==="relu")return be(r);if(n==="elu")return eb(r);if(n==="relu6")return rb(r);if(n==="prelu")return nb(r,t);throw new Error("Unknown fused activation "+n+".")},TA=H({fusedMatMul_:function(r){var n,t=r.a,e=r.b,a=r.transposeA,o=a!==void 0&&a,l=r.transposeB,s=l!==void 0&&l,f=r.bias,h=r.activation,p=h===void 0?"linear":h,v=r.preluActivationWeights;if(ep(G.state.gradientDepth,p)===!1){var g=nc(t,e,o,s);return f!=null&&(g=Vt(g,f)),ap(g,p,v)}var y=M(t,"a","fused matMul"),x=M(e,"b","fused matMul");n=xe(y,x),y=n[0],x=n[1];var w=o?y.shape[y.rank-2]:y.shape[y.rank-1],_=s?x.shape[x.rank-1]:x.shape[x.rank-2],E=o?y.shape[y.rank-1]:y.shape[y.rank-2],R=s?x.shape[x.rank-2]:x.shape[x.rank-1],A=y.shape.slice(0,-2),C=x.shape.slice(0,-2),T=Et(A),N=Et(C);O(y.rank>=2&&x.rank>=2&&y.rank===x.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+y.rank+" and "+x.rank+"."}),O(Ye(A,C),function(){return"Error in fused matMul: outer dimensions ("+A+") and ("+C+") of Tensors with shapes "+y.shape+" and "+x.shape+" must match."}),O(w===_,function(){return"Error in fused matMul: inner shapes ("+w+") and ("+_+") of Tensors with shapes "+y.shape+" and "+x.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var L,B,I=y.shape.slice(0,-2).concat([E,R]),F=o?y.as3D(T,w,E):y.as3D(T,E,w),W=s?x.as3D(N,R,_):x.as3D(N,_,R);f!=null&&qt(I,(L=xe(L=M(f,"bias","fused matMul"),y)[0]).shape),v!=null&&(B=M(v,"prelu weights","fused matMul"));var U={a:F,b:W};f!=null&&(U.bias=L),v!=null&&(U.preluActivationWeights=B);var at=[F,W];return G.runKernelFunc(function(nt,tt){var P=nt.fusedBatchMatMul({a:F,b:W,transposeA:o,transposeB:s,bias:L,activation:p,preluActivationWeights:B});return tt([F,W,P]),P},U,function(nt,tt){var P=tt[0],q=tt[1],K=tt[2],rt=np(nt,K,p),k={};return f!=null&&(k={bias:function(){return rp(L,rt)}}),Object.assign(o||s?!o&&s?{a:function(){return rt.matMul(q,!1,!1)},b:function(){return rt.matMul(P,!0,!1)}}:o&&!s?{a:function(){return q.matMul(rt,!1,!0)},b:function(){return P.matMul(rt,!1,!1)}}:{a:function(){return q.matMul(rt,!0,!0)},b:function(){return rt.matMul(P,!0,!0)}}:{a:function(){return rt.matMul(q,!1,!0)},b:function(){return P.matMul(rt,!0,!1)}},k)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:p},at,[!0]).reshape(I)}}),DA=H({fusedConv2d_:function(r){var n=r.x,t=r.filter,e=r.strides,a=r.pad,o=r.dataFormat,l=o===void 0?"NHWC":o,s=r.dilations,f=s===void 0?[1,1]:s,h=r.dimRoundingMode,p=r.bias,v=r.activation,g=v===void 0?"linear":v,y=r.preluActivationWeights;if(g=g||"linear",ep(G.state.gradientDepth,g)===!1){var x=or(n,t,e,a,l,f,h);return p!=null&&(x=Vt(x,p)),ap(x,g,y)}var w=M(n,"x","conv2d"),_=M(t,"filter","conv2d"),E=w,R=!1;w.rank===3&&(R=!0,E=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),O(E.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+E.rank+"."}),O(_.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+_.rank+"."}),h!=null&&O(Te(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+a+"."}),O(E.shape[3]===_.shape[2],function(){return"Error in conv2d: depth of input ("+E.shape[3]+") must match input depth for filter "+_.shape[2]+"."}),O(Tn(e,f),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+f+"'"}),O(l==="NHWC",function(){return"Error in conv2d: got dataFormat of "+l+" but only NHWC is currently supported."});var A,C,T=bi(E.shape,_.shape,e,f,a,h);p!=null&&(A=xe(A=M(p,"bias","fused conv2d"),w)[0],qt(T.outShape,A.shape)),y!=null&&(C=M(y,"prelu weights","fused conv2d"));var N={x:E,filter:_};p!=null&&(N.bias=A),y!=null&&(N.preluActivationWeights=C);var L=[_,E],B=G.runKernelFunc(function(I,F){var W=I.fusedConv2d({input:E,filter:_,convInfo:T,bias:A,activation:g,preluActivationWeights:C});return F([_,E,W]),W},N,function(I,F){var W=F,U=W[0],at=W[1],nt=W[2],tt=np(I,nt,g);O(Ro(f),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+f+"'"});var P={};return p!=null&&(P={bias:function(){return rp(A,tt)}}),Object.assign({x:function(){return X1(at.shape,tt,U,e,a)},filter:function(){return Kd(at,tt,U.shape,e,a)}},P)},"FusedConv2D",{convInfo:T,activation:g},L,[!0]);return R?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B}}),NA=H({fusedDepthwiseConv2d_:function(r){var n=r.x,t=r.filter,e=r.strides,a=r.pad,o=r.dataFormat,l=o===void 0?"NHWC":o,s=r.dilations,f=s===void 0?[1,1]:s,h=r.dimRoundingMode,p=r.bias,v=r.activation,g=v===void 0?"linear":v,y=r.preluActivationWeights;if(ep(G.state.gradientDepth,g)===!1){var x=ec(n,t,e,a,l,f,h);return p!=null&&(x=Vt(x,p)),ap(x,g,y)}var w=M(n,"x","depthwiseConv2d"),_=M(t,"filter","depthwiseConv2d"),E=w,R=!1;w.rank===3&&(R=!0,E=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),O(E.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+E.rank+"."}),O(_.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+_.rank+"."}),O(E.shape[3]===_.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+E.shape[3]+") must match the inChannels dimension in filter "+_.shape[2]+"."}),f==null&&(f=[1,1]),O(Tn(e,f),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+f+"'"}),h!=null&&O(Te(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+a+"."});var A,C,T=bi(E.shape,_.shape,e,f,a,h,!0);p!=null&&(A=xe(A=M(p,"bias","fused conv2d"),w)[0],qt(T.outShape,A.shape)),y!=null&&(C=M(y,"prelu weights","fused depthwiseConv2d"));var N={x:E,filter:_};p!=null&&(N.bias=A),y!=null&&(N.preluActivationWeights=C);var L=[_,E],B=G.runKernelFunc(function(I,F){var W=I.fusedDepthwiseConv2D({input:E,filter:_,convInfo:T,bias:A,activation:g,preluActivationWeights:C});return F([_,E,W]),W},N,function(I,F){O(Ro(f),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+f+"'"});var W=F[0],U=F[1],at=F[2],nt=np(I,at,g),tt={};return p!=null&&(tt={bias:function(){return rp(A,nt)}}),Object.assign({x:function(){return K1(U.shape,nt,W,T)},filter:function(){return Y1(U,nt,W.shape,T)}},tt)},"FusedDepthwiseConv2D",{convInfo:T,activation:g},L,[!0]);return R?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B}}),MA=Object.freeze({matMul:TA,conv2d:DA,depthwiseConv2d:NA}),kA=Object.freeze({image:tp,linalg:xA,losses:mA,spectral:eA,fused:MA,signal:oA,square:hS,squaredDifference:M1,conv1d:wR,conv2d:or,conv3d:_R,depthwiseConv2d:ec,separableConv2d:Yd,conv2dTranspose:ER,conv3dTranspose:CR,op:H,batchNormalization2d:VS,batchNormalization3d:WS,batchNormalization4d:GS,batchNormalization:qS,batchNorm:L1,batchNorm2d:jS,batchNorm3d:XS,batchNorm4d:KS,booleanMaskAsync:xR,complex:tn,real:ar,imag:Ar,concat:Be,concat1d:M_,concat2d:k_,concat3d:O_,concat4d:I_,split:Bd,matMul:nc,dot:SR,outerProduct:RR,reverse:Qu,reverse1d:AR,reverse2d:TR,reverse3d:DR,reverse4d:NR,maxPool:Ke,avgPool:Zu,pool:MR,maxPool3d:kR,avgPool3d:OR,slice:kr,slice1d:IR,slice2d:BR,slice3d:J1,slice4d:FR,abs:dS,acos:pS,acosh:vS,asin:mS,asinh:gS,atan:yS,atanh:bS,ceil:xS,clipByValue:qd,cos:wS,cosh:_S,erf:ES,exp:xd,expm1:CS,floor:SS,log:RS,log1p:AS,logSigmoid:TS,neg:Vl,reciprocal:DS,round:NS,rsqrt:k1,sigmoid:O1,sign:MS,isNaN:kS,isInf:OS,isFinite:IS,sin:BS,sinh:FS,softplus:LS,sqrt:zS,step:PS,tan:US,tanh:HS,all:LR,any:zR,argMax:PR,argMin:UR,logSumExp:HR,max:rc,mean:VR,min:WR,moments:GR,sum:tb,prod:qR,equal:V1,equalStrict:cR,greater:fR,greaterEqual:W1,greaterEqualStrict:hR,greaterStrict:dR,less:pR,lessEqual:vR,lessEqualStrict:mR,lessStrict:gR,notEqual:yR,notEqualStrict:bR,add:Vt,addN:ZS,addStrict:JS,atan2:$S,div:cr,divNoNan:tR,divStrict:eR,floorDiv:U1,maximum:jd,maximumStrict:nR,minimum:H1,minimumStrict:rR,mod:aR,modStrict:iR,mul:fn,mulStrict:oR,pow:Wl,powStrict:uR,squaredDifferenceStrict:sR,sub:ze,subStrict:lR,elu:eb,leakyRelu:jR,prelu:nb,relu:be,relu6:rb,selu:XR,logicalAnd:tc,logicalNot:YS,logicalOr:z1,logicalXor:QS,where:mi,whereAsync:P1,buffer:Bt,print:W_,batchToSpaceND:t1,broadcastTo:G_,cast:q_,clone:j_,cumsum:X_,depthToSpace:K_,expandDims:rr,eye:e1,multinomial:Y_,oneHot:md,pad:yi,pad1d:Q_,pad2d:Z_,pad3d:J_,pad4d:$_,rand:tE,randomNormal:eE,randomGamma:nE,randomUniform:n1,reshape:fr,spaceToBatchND:r1,squeeze:a1,stack:Wn,tile:go,truncatedNormal:rE,unstack:Fe,setdiff1dAsync:aE,fill:Mr,linspace:N_,ones:Do,range:Il,scalar:vt,tensor:nn,tensor1d:Me,tensor2d:Fa,tensor3d:Id,tensor4d:Cn,tensor5d:A_,tensor6d:T_,variable:D_,zeros:pe,onesLike:$0,zerosLike:Yt,transpose:Ua,softmax:ra,logSoftmax:fE,localResponseNormalization:KR,norm:ab,gather:Xd,unsortedSegmentSum:G1,basicLSTMCell:YR,multiRNNCell:QR,movingAverage:ZR,stridedSlice:JR,topk:$R,scatterND:tA,fft:Qd,ifft:Gl,rfft:Zd,irfft:ib,sparseToDense:nA,gatherND:rA,diag:aA,dropout:iA,hannWindow:Jd,hammingWindow:ub,frame:$d,stft:sb,inTopKAsync:uA});function ft(r,n){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&O(t.dtype!=="complex64",function(){return n+" does not support complex64 tensors."})})}function Yh(r,n,t,e){if(t==="linear")return r.linear(n);if(t==="relu")return r.relu(n);if(t==="elu")return r.elu(n);if(t==="relu6")return r.relu6(n);if(t==="prelu")return r.prelu(n,e);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var OA=function(r){function n(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new f1(t,G),t}return dr(n,r),n.prototype.write=function(t,e,a){this.firstUse&&(this.firstUse=!1,ut().get("IS_NODE")&&kl(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:a}),o},n.prototype.move=function(t,e,a,o){this.data.set(t,{values:e,dtype:o})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){return[2,this.readSync(t)]})})},n.prototype.readSync=function(t){var e=this.data.get(t),a=e.dtype,o=e.complexTensors;return a==="complex64"?bd(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},n.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),a=e;if(t.dtype==="string")try{a=e.map(function(o){return Dl(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Bt(t.shape,t.dtype,a)},n.prototype.makeOutput=function(t,e,a){var o=this.write(t,e,a);return G.makeTensorFromDataId(o,e,a,this)},n.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return wt(this,void 0,void 0,function(){var e;return _t(this,function(a){return e=Sr(),t(),[2,{kernelMs:Sr()-e}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,e){var a=this.makeOutput(null,t.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:G.keep(t.clone()),imag:G.keep(e.clone())},a},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,e,a){if(ft(t,"slice"),l1(t.shape,e,a)){var o=c1(e,t.strides),l=Et(a);return nn(this.readSync(t.dataId).subarray(o,o+l),a,t.dtype)}for(var s=Bt(a,t.dtype),f=this.bufferSync(t),h=0;h<s.size;++h){var p=s.indexToLoc(h).map(function(v,g){return v+e[g]});s.values[h]=f.get.apply(f,p)}return s.toTensor()},n.prototype.stridedSlice=function(t,e,a,o){ft(t,"stridedSlice");var l=Ld(e,a,o);if(l.some(function(y){return y===0}))return nn([],l);for(var s=Bt(l,t.dtype),f=this.bufferSync(t),h=0;h<s.size;h++){for(var p=s.indexToLoc(h),v=new Array(p.length),g=0;g<v.length;g++)v[g]=p[g]*o[g]+e[g];s.set.apply(s,[f.get.apply(f,v)].concat(p))}return s.toTensor()},n.prototype.diag=function(t){for(var e=this.readSync(t.dataId),a=Bt([t.size,t.size],t.dtype),o=a.values,l=0;l<e.length;l++)o[l*t.size+l]=e[l];return a.toTensor()},n.prototype.unstack=function(t,e){for(var a=t.shape[e],o=new Array(t.rank-1),l=0,s=0;s<t.rank;s++)s!==e&&(o[l++]=t.shape[s]);var f=new Array(t.rank).fill(0),h=t.shape.slice();h[e]=1;var p=new Array(a);for(s=0;s<p.length;s++)f[e]=s,p[s]=this.slice(t,f,h).reshape(o);return p},n.prototype.reverse=function(t,e){ft(t,"reverse");for(var a=Bt(t.shape,t.dtype),o=this.bufferSync(t),l=function(f){var h=a.indexToLoc(f),p=h.slice();e.forEach(function(v){return p[v]=t.shape[v]-1-p[v]}),a.set.apply(a,[o.get.apply(o,p)].concat(h))},s=0;s<a.size;s++)l(s);return a.toTensor()},n.prototype.concat=function(t,e){var a=this;if(t[0].dtype==="complex64"){var o=t.map(function(y){return ar(y)}),l=t.map(function(y){return Ar(y)});return tn(this.concat(o,e),this.concat(l,e))}var s=t.map(function(y){var x=Et(y.shape.slice(e));return y.as2D(-1,x)}),f=So(s.map(function(y){return y.shape}),1),h=Bt(f,t[0].dtype).values;if(s[0].shape[0]===1){var p=0;s.forEach(function(y){h.set(a.readSync(y.dataId),p),p+=y.size})}else{var v=0;s.forEach(function(y){for(var x=a.readSync(y.dataId),w=0,_=0;_<y.shape[0];++_)for(var E=_*f[1]+v,R=0;R<y.shape[1];++R)h[E+R]=x[w++];v+=y.shape[1]})}var g=So(t.map(function(y){return y.shape}),e);return nn(h,g,t[0].dtype)},n.prototype.neg=function(t){return ft(t,"neg"),this.multiply(vt(-1),t)},n.prototype.add=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(a,o,l,s){return{real:a+l,imag:o+s}}):this.broadcastedBinaryOp(t,e,en(t.dtype,e.dtype),function(a,o){return a+o})},n.prototype.addN=function(t){var e=this;ft(t,"addN");for(var a=t.map(function(p){return e.readSync(p.dataId)}),o=Bt(t[0].shape,t[0].dtype),l=o.values,s=0;s<t.length;s++)for(var f=a[s],h=0;h<l.length;h++)l[h]+=f[h];return o.toTensor()},n.prototype.softmax=function(t,e){var a=Pe([e],t.shape),o=this.max(t,a),l=An(o.shape,a),s=this.subtract(t,o.reshape(l)),f=this.exp(s),h=this.sum(f,a).reshape(l);return this.realDivide(f,h)},n.prototype.subtract=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(a,o,l,s){return{real:a-l,imag:o-s}}):this.broadcastedBinaryOp(t,e,en(t.dtype,e.dtype),function(a,o){return a-o})},n.prototype.pow=function(t,e){return ft([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){return Math.pow(a,o)})},n.prototype.batchMatMul=function(t,e,a,o){ft([t,e],"matMul");for(var l=a?t.shape[1]:t.shape[2],s=a?t.shape[2]:t.shape[1],f=o?e.shape[1]:e.shape[2],h=t.shape[0],p=this.readSync(t.dataId),v=this.readSync(e.dataId),g=a?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],y=g[0],x=g[1],w=g[2],_=o?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],E=_[0],R=_[1],A=_[2],C=s*f,T=Bt([h,s,f],t.dtype),N=T.values,L=this.blockSize,B=0;B<h;B++)for(var I=0;I<s;I+=L)for(var F=0;F<f;F+=L)for(var W=0;W<l;W+=L)for(var U=Math.min(I+L,s),at=Math.min(F+L,f),nt=Math.min(W+L,l),tt=I;tt<U;tt++)for(var P=F;P<at;P++){for(var q=0,K=W;K<nt;K++)q+=p[B*y+tt*x+K*w]*v[K*E+P*R+B*A];N[B*C+(tt*f+P)]+=q}return T.toTensor()},n.prototype.fusedBatchMatMul=function(t){var e=t.a,a=t.b,o=t.transposeA,l=t.transposeB,s=t.bias,f=t.activation,h=t.preluActivationWeights,p=this.batchMatMul(e,a,o,l);return s&&(p=this.add(p,s)),f&&(p=Yh(this,p,f,h)),p},n.prototype.multiply=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(a,o,l,s){return{real:a*l-o*s,imag:a*s+o*l}}):this.broadcastedBinaryOp(t,e,en(t.dtype,e.dtype),function(a,o){return a*o})},n.prototype.realDivide=function(t,e){return ft([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(a,o){return a/o})},n.prototype.floorDiv=function(t,e){return ft([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(a,o){return Math.floor(a/o)})},n.prototype.sum=function(t,e){ft(t,"sum"),zn("sum",e,t.rank);for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,en(t.dtype,"int32")),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=0,x=0;x<f;++x)y+=p[g+x];h[v]=y}return s},n.prototype.prod=function(t,e){ft(t,"sum");for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,en(t.dtype,"int32")),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=1,x=0;x<f;++x)y*=p[g+x];h[v]=y}return s},n.prototype.unsortedSegmentSum=function(t,e,a){ft(t,"unsortedSegmentSum");for(var o=[],l=t.rank-e.rank,s=0;s<l;++s)e=e.expandDims(s+1);for(s=0;s<a;++s){var f=vt(s,"int32"),h=V1(f,e).asType("float32").mul(t).sum(0);o.push(h)}return Wn(o)},n.prototype.argMin=function(t,e){ft(t,"argMin");var a=[e];zn("argMin",a,t.rank);for(var o=un(t.shape,a),l=o[0],s=o[1],f=pe(l,"int32"),h=Et(s),p=this.readSync(f.dataId),v=this.readSync(t.dataId),g=0;g<p.length;++g){for(var y=g*h,x=v[y],w=0,_=0;_<h;++_){var E=v[y+_];E<x&&(x=E,w=_)}p[g]=w}return f},n.prototype.argMax=function(t,e){ft(t,"argMax");var a=[e];zn("argMax",a,t.rank);for(var o=un(t.shape,a),l=o[0],s=o[1],f=pe(l,"int32"),h=Et(s),p=this.readSync(f.dataId),v=this.readSync(t.dataId),g=0;g<p.length;++g){for(var y=g*h,x=v[y],w=0,_=0;_<h;++_){var E=v[y+_];E>x&&(x=E,w=_)}p[g]=w}return f},n.prototype.cumsum=function(t,e,a,o){if(ft(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var l=en(t.dtype,"int32"),s=pe(t.shape,l),f=this.readSync(s.dataId),h=this.readSync(t.dataId),p=t.shape[t.rank-1],v=o?function(_,E){return _+p-E-1}:function(_,E){return _+E},g=0;g<h.length;g+=p)for(var y=0;y<p;y++){var x=v(g,y);if(y===0)f[x]=a?0:h[x];else{var w=v(g,y-1);f[x]=a?h[w]+f[w]:h[x]+f[w]}}return s},n.prototype.equal=function(t,e){return ft([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a===o?1:0})},n.prototype.notEqual=function(t,e){return ft([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a!==o?1:0})},n.prototype.less=function(t,e){return ft([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a<o?1:0})},n.prototype.lessEqual=function(t,e){return ft([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a<=o?1:0})},n.prototype.greater=function(t,e){return ft([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a>o?1:0})},n.prototype.greaterEqual=function(t,e){return ft([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a>=o?1:0})},n.prototype.logicalNot=function(t){ft(t,"logicalNot");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),o=0;o<e.length;++o)a[o]=e[o]?0:1;return this.makeOutput(a,t.shape,"bool")},n.prototype.logicalAnd=function(t,e){return ft([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a&&o})},n.prototype.logicalOr=function(t,e){return ft([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(a,o){return a||o})},n.prototype.select=function(t,e,a){ft([t,e,a],"select");for(var o=this.readSync(t.dataId),l=this.readSync(e.dataId),s=this.readSync(a.dataId),f=pe(e.shape,en(e.dtype,a.dtype)),h=this.readSync(f.dataId),p=0,v=t.rank===0||t.rank>1||e.rank===1?1:Et(e.shape.slice(1)),g=0;g<o.length;g++)for(var y=0;y<v;y++)o[g]===1?h[p++]=l[g]:h[p++]=s[g];return f},n.prototype.where=function(t){ft([t],"where");var e=this.readSync(t.dataId);return Hd(t.shape,e)},n.prototype.topk=function(t,e,a){return ft(t,"topk"),b1(this.readSync(t.dataId),t.shape,t.dtype,e)},n.prototype.min=function(t,e){ft(t,"min"),zn("min",e,t.rank);for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,t.dtype),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=p[g],x=0;x<f;++x){var w=p[g+x];w<y&&(y=w)}h[v]=y}return s},n.prototype.minimum=function(t,e){return ft([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){return Math.min(a,o)})},n.prototype.mod=function(t,e){return ft([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){var l=a%o;return a<0&&o<0||a>=0&&o>=0?l:(l+o)%o})},n.prototype.max=function(t,e){ft(t,"max"),zn("max",e,t.rank);for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,t.dtype),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=p[g],x=0;x<f;++x){var w=p[g+x];w>y&&(y=w)}h[v]=y}return s},n.prototype.maximum=function(t,e){return ft([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){return Math.max(a,o)})},n.prototype.all=function(t,e){ft(t,"all"),zn("all",e,t.rank);for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,t.dtype),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=p[g],x=0;x<f;++x){var w=p[g+x];y=y&&w}h[v]=y}return s},n.prototype.any=function(t,e){ft(t,"any"),zn("any",e,t.rank);for(var a=un(t.shape,e),o=a[0],l=a[1],s=pe(o,t.dtype),f=Et(l),h=this.readSync(s.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var g=v*f,y=p[g],x=0;x<f;++x){var w=p[g+x];y=y||w}h[v]=y}return s},n.prototype.squaredDifference=function(t,e){return ft([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){var l=a-o;return l*l})},n.prototype.ceil=function(t){ft(t,"ceil");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)a[o]=Math.ceil(e[o]);return this.makeOutput(a,t.shape,"float32")},n.prototype.floor=function(t){ft(t,"floor");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)a[o]=Math.floor(e[o]);return this.makeOutput(a,t.shape,"float32")},n.prototype.sign=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)e[o]<0?a[o]=-1:e[o]>0?a[o]=1:a[o]=0;return this.makeOutput(a,t.shape,"float32")},n.prototype.isNaN=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isNaN(e[o])&&(a[o]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.isInf=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),o=0;o<e.length;++o)Math.abs(e[o])===1/0&&(a[o]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.isFinite=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isFinite(e[o])&&(a[o]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.round=function(t){ft(t,"round");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o){var l=Math.floor(e[o]);e[o]-l<.5?a[o]=Math.floor(e[o]):e[o]-l>.5?a[o]=Math.ceil(e[o]):a[o]=l%2==0?l:l+1}return this.makeOutput(a,t.shape,"float32")},n.prototype.exp=function(t){ft(t,"exp");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)a[o]=Math.exp(e[o]);return this.makeOutput(a,t.shape,"float32")},n.prototype.expm1=function(t){ft(t,"expm1");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)a[o]=Math.expm1(e[o]);return this.makeOutput(a,t.shape,"float32")},n.prototype.log=function(t){ft(t,"log");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o){var l=e[o];a[o]=Math.log(l)}return this.makeOutput(a,t.shape,"float32")},n.prototype.log1p=function(t){ft(t,"log1p");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o){var l=e[o];a[o]=Math.log1p(l)}return this.makeOutput(a,t.shape,"float32")},n.prototype.sqrt=function(t){ft(t,"sqrt");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o){var l=e[o];a[o]=Math.sqrt(l)}return this.makeOutput(a,t.shape,"float32")},n.prototype.rsqrt=function(t){ft(t,"rsqrt");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o){var l=e[o];a[o]=1/Math.sqrt(l)}return this.makeOutput(a,t.shape,"float32")},n.prototype.reciprocal=function(t){ft(t,"reciprocal");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),o=0;o<e.length;++o)a[o]=1/e[o];return this.makeOutput(a,t.shape,"float32")},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){ft(t,"relu");for(var e=pe(t.shape,t.dtype),a=this.readSync(e.dataId),o=this.readSync(t.dataId),l=0;l<o.length;++l)a[l]=Math.max(0,o[l]);return e},n.prototype.relu6=function(t){ft(t,"relu");for(var e=pe(t.shape,t.dtype),a=this.readSync(e.dataId),o=this.readSync(t.dataId),l=0;l<o.length;++l)a[l]=Math.min(Math.max(0,o[l]),6);return e},n.prototype.prelu=function(t,e){return ft([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){return a<0?o*a:a})},n.prototype.elu=function(t){ft(t,"elu");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var l=a[o];e[o]=l>=0?l:Math.exp(l)-1}return this.makeOutput(e,t.shape,"float32")},n.prototype.eluDer=function(t,e){ft([t,e],"eluDer");for(var a=new Float32Array(e.size),o=this.readSync(e.dataId),l=this.readSync(t.dataId),s=0;s<o.length;++s){var f=o[s];a[s]=f>=1?l[s]:l[s]*(f+1)}return this.makeOutput(a,e.shape,"float32")},n.prototype.selu=function(t){ft(t,"selu");for(var e=Wd,a=Gd,o=new Float32Array(t.size),l=this.readSync(t.dataId),s=0;s<l.length;++s){var f=l[s];o[s]=f>=0?a*f:e*(Math.exp(f)-1)}return this.makeOutput(o,t.shape,"float32")},n.prototype.clip=function(t,e,a){ft(t,"clip");for(var o=new Float32Array(t.size),l=this.readSync(t.dataId),s=0;s<l.length;++s){var f=l[s];o[s]=f>a?a:f<e?e:f}return this.makeOutput(o,t.shape,"float32")},n.prototype.abs=function(t){for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.abs(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<t.size;++o){var l=a[2*o],s=a[2*o+1];e[o]=Math.hypot(l,s)}return this.makeOutput(e,t.shape,"float32")},n.prototype.int=function(t){ft(t,"int");for(var e=new Int32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=a[o];return this.makeOutput(e,t.shape,"int32")},n.prototype.sigmoid=function(t){ft(t,"sigmoid");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=1/(1+Math.exp(-a[o]));return this.makeOutput(e,t.shape,"float32")},n.prototype.softplus=function(t){ft(t,"softplus");for(var e=Math.log(11920928955078125e-23)+2,a=new Float32Array(t.size),o=this.readSync(t.dataId),l=0;l<o.length;++l){var s=o[l]>-e,f=o[l]<e,h=Math.exp(o[l]),p=void 0;p=f?h:s?o[l]:Math.log(1+h),a[l]=p}return this.makeOutput(a,t.shape,"float32")},n.prototype.sin=function(t){ft(t,"sin");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.sin(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.cos=function(t){ft(t,"cos");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.cos(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.tan=function(t){ft(t,"tan");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.tan(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.asin=function(t){ft(t,"asin");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.asin(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.acos=function(t){ft(t,"acos");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.acos(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atan=function(t){ft(t,"atan");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.atan(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atan2=function(t,e){return ft([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(a,o){return Math.atan2(a,o)})},n.prototype.sinh=function(t){ft(t,"sinh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.sinh(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.cosh=function(t){ft(t,"cosh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.cosh(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.tanh=function(t){ft(t,"tanh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Iw(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.asinh=function(t){ft(t,"asinh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.asinh(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.acosh=function(t){ft(t,"acosh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.acosh(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atanh=function(t){ft(t,"atanh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o)e[o]=Math.atanh(a[o]);return this.makeOutput(e,t.shape,"float32")},n.prototype.erf=function(t){ft(t,"erf");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var l=Math.sign(a[o]),s=Math.abs(a[o]),f=1/(1+.3275911*s);e[o]=l*(1-((((1.061405429*f-1.453152027)*f+1.421413741)*f-.284496736)*f+.254829592)*f*Math.exp(-s*s))}return this.makeOutput(e,t.shape,"float32")},n.prototype.step=function(t,e){e===void 0&&(e=0),ft(t,"step");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),l=0;l<o.length;++l){var s=o[l];isNaN(s)?a[l]=NaN:a[l]=s>0?1:e}return this.makeOutput(a,t.shape,"float32")},n.prototype.fusedConv2d=function(t){var e=t.input,a=t.filter,o=t.convInfo,l=t.bias,s=t.activation,f=t.preluActivationWeights,h=this.conv2d(e,a,o);return l&&(h=this.add(h,l)),s&&(h=Yh(this,h,s,f)),h},n.prototype.conv2d=function(t,e,a){ft([t,e],"conv2d");for(var o=a.filterHeight,l=a.filterWidth,s=a.dilationHeight,f=a.dilationWidth,h=a.padInfo.left,p=a.padInfo.top,v=a.dataFormat==="channelsLast",g=Bt(a.outShape,t.dtype),y=t.strides[0],x=v?t.strides[1]:t.strides[2],w=v?t.strides[2]:1,_=v?1:t.strides[1],E=g.strides[0],R=v?g.strides[1]:g.strides[2],A=v?g.strides[2]:1,C=v?1:g.strides[1],T=this.readSync(t.dataId),N=this.readSync(e.dataId),L=g.values,B=0;B<a.batchSize;++B)for(var I=B*y,F=B*E,W=0;W<a.outHeight;++W)for(var U=F+W*R,at=W*a.strideHeight-p,nt=0;nt<o;nt++){var tt=at+nt*s;if(!(tt<0||tt>=a.inHeight))for(var P=nt*e.strides[0],q=I+tt*x,K=0;K<a.outWidth;++K)for(var rt=U+K*A,k=K*a.strideWidth-h,X=0;X<l;X++){var it=k+X*f;if(!(it<0||it>=a.inWidth))for(var ot=q+it*w,dt=P+X*e.strides[1],mt=0;mt<a.inChannels;++mt){for(var pt=T[ot+mt*_],Tt=0;Tt<a.outChannels;++Tt)L[rt+Tt*C]+=pt*N[dt+Tt];dt+=a.outChannels}}}return g.toTensor()},n.prototype.conv3d=function(t,e,a){for(var o=a.filterDepth,l=a.filterHeight,s=a.filterWidth,f=a.dilationDepth,h=a.dilationHeight,p=a.dilationWidth,v=a.padInfo.front,g=a.padInfo.left,y=a.padInfo.top,x=Bt(a.outShape,t.dtype),w=this.readSync(t.dataId),_=this.readSync(e.dataId),E=x.values,R=0;R<a.batchSize;++R)for(var A=R*t.strides[0],C=R*x.strides[0],T=0;T<a.outDepth;++T)for(var N=C+T*x.strides[1],L=T*a.strideDepth-v,B=0;B<o;B++){var I=L+B*f;if(!(I<0||I>=a.inDepth))for(var F=B*e.strides[0],W=A+I*t.strides[1],U=0;U<a.outHeight;++U)for(var at=N+U*x.strides[2],nt=U*a.strideHeight-y,tt=0;tt<l;tt++){var P=nt+tt*h;if(!(P<0||P>=a.inHeight))for(var q=F+tt*e.strides[1],K=W+P*t.strides[2],rt=0;rt<a.outWidth;++rt)for(var k=at+rt*a.outChannels,X=rt*a.strideWidth-g,it=0;it<s;it++){var ot=X+it*p;if(!(ot<0||ot>=a.inWidth))for(var dt=q+it*e.strides[2],mt=K+ot*a.inChannels,pt=dt,Tt=0;Tt<a.inChannels;++Tt){for(var bt=w[mt+Tt],Ot=0;Ot<a.outChannels;++Ot)E[k+Ot]+=bt*_[pt+Ot];pt+=a.outChannels}}}}return x.toTensor()},n.prototype.conv2dDerInput=function(t,e,a){ft([t,e],"conv2dDerInput");for(var o=Bt(a.inShape,"float32"),l=o.values,s=this.readSync(t.dataId),f=this.readSync(e.dataId),h=e.strides,p=h[0],v=h[1],g=h[2],y=a.batchSize,x=a.filterHeight,w=a.filterWidth,_=a.inChannels,E=a.inHeight,R=a.inWidth,A=a.outChannels,C=a.outHeight,T=a.outWidth,N=a.strideHeight,L=a.strideWidth,B=a.dataFormat,I=x-1-a.padInfo.top,F=w-1-a.padInfo.left,W=B==="channelsLast",U=o.strides[0],at=W?o.strides[1]:o.strides[2],nt=W?o.strides[2]:1,tt=W?1:o.strides[1],P=t.strides[0],q=W?t.strides[1]:t.strides[2],K=W?t.strides[2]:1,rt=W?1:t.strides[1],k=0;k<y;++k)for(var X=0;X<_;++X)for(var it=0;it<E;++it)for(var ot=it-I,dt=Math.max(0,Math.ceil(ot/N)),mt=Math.min(C,(x+ot)/N),pt=0;pt<R;++pt){for(var Tt=pt-F,bt=Math.max(0,Math.ceil(Tt/L)),Ot=Math.min(T,(w+Tt)/L),$t=0,Ft=dt;Ft<mt;++Ft)for(var Xt=Ft*N-ot,Ut=bt;Ut<Ot;++Ut)for(var re=P*k+q*Ft+K*Ut,se=p*(x-1-Xt)+v*(w-1-(Ut*L-Tt))+g*X,le=0;le<A;++le)$t+=s[re+rt*le]*f[se+le];l[U*k+at*it+nt*pt+tt*X]=$t}return o.toTensor()},n.prototype.conv3dDerInput=function(t,e,a){for(var o=Bt(a.inShape,"float32"),l=o.values,s=o.strides,f=s[0],h=s[1],p=s[2],v=s[3],g=this.readSync(t.dataId),y=t.strides,x=y[0],w=y[1],_=y[2],E=y[3],R=this.readSync(e.dataId),A=e.strides,C=A[0],T=A[1],N=A[2],L=A[3],B=a.batchSize,I=a.filterDepth,F=a.filterHeight,W=a.filterWidth,U=a.inChannels,at=a.inDepth,nt=a.inHeight,tt=a.inWidth,P=a.outChannels,q=a.outDepth,K=a.outHeight,rt=a.outWidth,k=a.strideDepth,X=a.strideHeight,it=a.strideWidth,ot=I-1-a.padInfo.front,dt=F-1-a.padInfo.top,mt=W-1-a.padInfo.left,pt=0;pt<B;++pt)for(var Tt=0;Tt<U;++Tt)for(var bt=0;bt<at;++bt)for(var Ot=bt-ot,$t=Math.max(0,Math.ceil(Ot/k)),Ft=Math.min(q,(I+Ot)/k),Xt=0;Xt<nt;++Xt)for(var Ut=Xt-dt,re=Math.max(0,Math.ceil(Ut/X)),se=Math.min(K,(F+Ut)/X),le=0;le<tt;++le){for(var me=le-mt,jt=Math.max(0,Math.ceil(me/it)),Ue=Math.min(rt,(W+me)/it),qn=0,He=$t;He<Ft;++He)for(var jn=He*k-Ot,mn=re;mn<se;++mn)for(var vr=mn*X-Ut,Dn=jt;Dn<Ue;++Dn)for(var Nn=x*pt+w*He+_*mn+E*Dn,we=C*(I-1-jn)+T*(F-1-vr)+N*(W-1-(Dn*it-me))+L*Tt,Se=0;Se<P;++Se)qn+=g[Nn+Se]*R[we+Se];l[f*pt+h*bt+p*Xt+v*le+Tt]=qn}return o.toTensor()},n.prototype.conv2dDerFilter=function(t,e,a){ft([t,e],"conv2dDerFilter");for(var o=a.strideHeight,l=a.strideWidth,s=a.filterHeight,f=a.filterWidth,h=a.dataFormat==="channelsLast",p=Bt(a.filterShape,"float32"),v=a.padInfo.left,g=a.padInfo.top,y=this.bufferSync(t),x=this.bufferSync(e),w=0;w<s;++w)for(var _=Math.max(0,Math.ceil((g-w)/o)),E=Math.min(a.outHeight,(a.inHeight+g-w)/o),R=0;R<f;++R)for(var A=Math.max(0,Math.ceil((v-R)/l)),C=Math.min(a.outWidth,(a.inWidth+v-R)/l),T=0;T<a.inChannels;++T)for(var N=0;N<a.outChannels;++N){for(var L=0,B=0;B<a.batchSize;++B)for(var I=_;I<E;++I)for(var F=w+I*o-g,W=A;W<C;++W){var U=R+W*l-v;L+=h?y.get(B,F,U,T)*x.get(B,I,W,N):y.get(B,T,F,U)*x.get(B,N,I,W)}p.set(L,w,R,T,N)}return p.toTensor()},n.prototype.conv3dDerFilter=function(t,e,a){for(var o=a.strideDepth,l=a.strideHeight,s=a.strideWidth,f=a.filterDepth,h=a.filterHeight,p=a.filterWidth,v=Bt(a.filterShape,"float32"),g=v.values,y=v.strides,x=y[0],w=y[1],_=y[2],E=y[3],R=this.readSync(e.dataId),A=e.strides,C=A[0],T=A[1],N=A[2],L=A[3],B=this.readSync(t.dataId),I=t.strides,F=I[0],W=I[1],U=I[2],at=I[3],nt=a.padInfo.front,tt=a.padInfo.left,P=a.padInfo.top,q=0;q<f;++q)for(var K=Math.max(0,Math.ceil((nt-q)/o)),rt=Math.min(a.outDepth,(a.inDepth+nt-q)/o),k=q*x,X=0;X<h;++X)for(var it=Math.max(0,Math.ceil((P-X)/l)),ot=Math.min(a.outHeight,(a.inHeight+P-X)/l),dt=X*w+k,mt=0;mt<p;++mt)for(var pt=Math.max(0,Math.ceil((tt-mt)/s)),Tt=Math.min(a.outWidth,(a.inWidth+tt-mt)/s),bt=mt*_+dt,Ot=0;Ot<a.inChannels;++Ot)for(var $t=Ot*E+bt,Ft=0;Ft<a.outChannels;++Ft){for(var Xt=0,Ut=0;Ut<a.batchSize;++Ut)for(var re=Ut*F,se=Ut*C,le=K;le<rt;++le)for(var me=(q+le*o-nt)*W+re,jt=le*T+se,Ue=it;Ue<ot;++Ue)for(var qn=(X+Ue*l-P)*U+me,He=Ue*N+jt,jn=pt;jn<Tt;++jn){var mn=jn*L+He;Xt+=B[(mt+jn*s-tt)*at+qn+Ot]*R[mn+Ft]}g[$t+Ft]=Xt}return v.toTensor()},n.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,a=t.filter,o=t.convInfo,l=t.bias,s=t.activation,f=t.preluActivationWeights,h=this.depthwiseConv2D(e,a,o);return l&&(h=this.add(h,l)),s&&(h=Yh(this,h,s,f)),h},n.prototype.depthwiseConv2D=function(t,e,a){ft([t,e],"depthwiseConv2D");for(var o=a.filterHeight,l=a.filterWidth,s=a.dilationHeight,f=a.dilationWidth,h=a.padInfo.left,p=a.padInfo.top,v=a.outChannels/a.inChannels,g=Bt(a.outShape,t.dtype),y=this.readSync(t.dataId),x=this.readSync(e.dataId),w=g.values,_=0;_<a.batchSize;++_)for(var E=_*t.strides[0],R=_*g.strides[0],A=0;A<a.outHeight;++A)for(var C=R+A*g.strides[1],T=A*a.strideHeight-h,N=0;N<o;++N){var L=T+N*s;if(!(L<0||L>=a.inHeight))for(var B=N*e.strides[0],I=E+L*t.strides[1],F=0;F<a.outWidth;++F)for(var W=C+F*g.strides[2],U=F*a.strideWidth-p,at=0;at<l;++at){var nt=U+at*f;if(!(nt<0||nt>=a.inWidth))for(var tt=B+at*e.strides[1],P=I+nt*a.inChannels,q=W,K=tt,rt=0;rt<a.inChannels;++rt){for(var k=y[P+rt],X=0;X<v;++X)w[q+X]+=k*x[K+X];q+=v,K+=v}}}return g.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,e,a){ft([t,e],"depthwiseConv2DDerInput");for(var o=Bt(a.inShape,"float32"),l=o.values,s=o.strides,f=s[0],h=s[1],p=s[2],v=this.readSync(t.dataId),g=t.strides,y=g[0],x=g[1],w=g[2],_=this.readSync(e.dataId),E=e.strides,R=E[0],A=E[1],C=E[2],T=a.batchSize,N=a.filterHeight,L=a.filterWidth,B=a.inChannels,I=a.inHeight,F=a.inWidth,W=a.outChannels,U=a.outHeight,at=a.outWidth,nt=a.strideHeight,tt=a.strideWidth,P=N-1-a.padInfo.top,q=L-1-a.padInfo.left,K=W/B,rt=0;rt<T;++rt)for(var k=0;k<B;++k)for(var X=0;X<I;++X)for(var it=X-P,ot=Math.max(0,Math.ceil(it/nt)),dt=Math.min(U,(N+it)/nt),mt=0;mt<F;++mt){for(var pt=mt-q,Tt=Math.max(0,Math.ceil(pt/tt)),bt=Math.min(at,(L+pt)/tt),Ot=0,$t=ot;$t<dt;++$t)for(var Ft=$t*nt-it,Xt=Tt;Xt<bt;++Xt)for(var Ut=y*rt+x*$t+w*Xt,re=R*(N-1-Ft)+A*(L-1-(Xt*tt-pt))+C*k,se=0;se<K;++se)Ot+=v[Ut+(k*K+se)]*_[re+se];l[f*rt+h*X+p*mt+k]=Ot}return o.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,e,a){ft([t,e],"depthwiseConv2DDerFilter");for(var o=a.strideHeight,l=a.strideWidth,s=a.filterHeight,f=a.filterWidth,h=Bt(a.filterShape,"float32"),p=a.padInfo.left,v=a.padInfo.top,g=a.outChannels/a.inChannels,y=this.bufferSync(t),x=this.bufferSync(e),w=0;w<s;++w)for(var _=Math.max(0,Math.ceil((v-w)/o)),E=Math.min(a.outHeight,(a.inHeight+v-w)/o),R=0;R<f;++R)for(var A=Math.max(0,Math.ceil((p-R)/l)),C=Math.min(a.outWidth,(a.inWidth+p-R)/l),T=0;T<a.outChannels;++T){for(var N=Math.trunc(T/g),L=T%g,B=0,I=0;I<a.batchSize;++I)for(var F=_;F<E;++F)for(var W=w+F*o-v,U=A;U<C;++U){var at=R+U*l-p;B+=y.get(I,W,at,N)*x.get(I,F,U,T)}h.set(B,w,R,N,L)}return h.toTensor()},n.prototype.tile=function(t,e){return ft(t,"tile"),y1(this.bufferSync(t),e)},n.prototype.pad=function(t,e,a){ft(t,"pad");var o=e.map(function(g,y){return g[0]+t.shape[y]+g[1]}),l=e.map(function(g){return g[0]}),s=this.bufferSync(t),f=Bt(o,t.dtype);a!==0&&f.values.fill(a);for(var h=0;h<t.size;h++){var p=s.indexToLoc(h),v=p.map(function(g,y){return g+l[y]});f.set.apply(f,[s.get.apply(s,p)].concat(v))}return f.toTensor()},n.prototype.transpose=function(t,e){ft(t,"transpose");for(var a=new Array(t.rank),o=0;o<a.length;o++)a[o]=t.shape[e[o]];var l=this.readSync(t.dataId),s=Bt(a,t.dtype),f=this.bufferSync(t);for(o=0;o<t.size;++o){for(var h=f.indexToLoc(o),p=new Array(h.length),v=0;v<p.length;v++)p[v]=h[e[v]];var g=s.locToIndex(p);s.values[g]=l[o]}return s.toTensor()},n.prototype.gather=function(t,e,a){ft([t,e],"gather");var o=t.shape.slice(),l=this.readSync(e.dataId);o[a]=l.length;for(var s=Bt(o,t.dtype),f=this.bufferSync(t),h=0;h<s.size;++h){var p=s.indexToLoc(h),v=p.slice();v[a]=l[p[a]];var g=f.locToIndex(v);s.values[h]=f.values[g]}return s.toTensor()},n.prototype.batchToSpaceND=function(t,e,a){ft([t],"batchToSpaceND");var o=e.reduce(function(v,g){return v*g}),l=Bl(t.shape,e,o),s=Fl(l.length,e.length),f=Ll(t.shape,e,o),h=i1(a,e.length),p=o1(f,a,e.length);return t.reshape(l).transpose(s).reshape(f).slice(h,p)},n.prototype.spaceToBatchND=function(t,e,a){ft([t],"spaceToBatchND");var o=e.reduce(function(g,y){return g*y}),l=[[0,0]];l.push.apply(l,a);for(var s=1+e.length;s<t.shape.length;++s)l.push([0,0]);var f=t.pad(l),h=Bl(f.shape,e,o,!1),p=Fl(h.length,e.length,!1),v=Ll(f.shape,e,o,!1);return f.reshape(h).transpose(p).reshape(v)},n.prototype.pool=function(t,e,a){ft(t,"pool");for(var o=e.strideHeight,l=e.strideWidth,s=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.top,g=e.padInfo.left,y=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),w=Bt(e.outShape,t.dtype),_=w.values,E=e.outShape[1]*e.outShape[2]*e.outShape[3],R=e.outShape[2]*e.outShape[3],A=e.outShape[3],C=0;C<e.batchSize;++C)for(var T=C*E,N=C*t.strides[0],L=0;L<e.inChannels;++L)for(var B=0;B<e.outHeight;++B)for(var I=B*o-v,F=Math.max(0,I),W=Math.min(e.inHeight,h+I),U=T+B*R,at=0;at<e.outWidth;++at){for(var nt=at*l-g,tt=Math.max(0,nt),P=Math.min(e.inWidth,p+nt),q=y,K=0,rt=0,k=F;k<W;k+=s){for(var X=N+k*t.strides[1],it=tt;it<P;it+=f){var ot=x[X+it*t.strides[2]+L];a==="max"&&ot>q?q=ot:a==="avg"&&(K+=ot,rt++)}if(isNaN(q))break}_[U+at*A+L]=a==="avg"?K/rt:q}return w.toTensor()},n.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},n.prototype.maxPoolPositions=function(t,e){for(var a=Bt(e.outShape,"int32"),o=e.strideHeight,l=e.strideWidth,s=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.top,g=e.padInfo.left,y=this.bufferSync(t),x=0;x<e.batchSize;++x)for(var w=0;w<e.inChannels;++w)for(var _=0;_<e.outHeight;++_){for(var E=_*o-v,R=E;R<0;)R+=s;for(var A=Math.min(e.inHeight,h+E),C=0;C<e.outWidth;++C){for(var T=C*l-g,N=T;N<0;)N+=f;for(var L=Math.min(e.inWidth,p+T),B=Number.NEGATIVE_INFINITY,I=-1,F=R;F<A;F+=s)for(var W=F-E,U=N;U<L;U+=f){var at=U-T,nt=y.get(x,F,U,w);nt>B&&(B=nt,I=W*p+at)}a.set(I,x,_,C,w)}}return a.toTensor()},n.prototype.maxPoolBackprop=function(t,e,a,o){ft([e,a],"maxPoolBackprop");for(var l=this.maxPoolPositions(e,o),s=o.strideHeight,f=o.strideWidth,h=o.dilationHeight,p=o.dilationWidth,v=o.effectiveFilterHeight,g=o.effectiveFilterWidth,y=g-1-o.padInfo.left,x=v-1-o.padInfo.top,w=Bt(e.shape,"float32"),_=this.bufferSync(l),E=this.bufferSync(t),R=0;R<o.batchSize;++R)for(var A=0;A<o.inChannels;++A)for(var C=0;C<o.inHeight;++C)for(var T=0;T<o.inWidth;++T){for(var N=C-x,L=T-y,B=0,I=0;I<v;I+=h){var F=(N+I)/s;if(!(F<0||F>=o.outHeight||Math.floor(F)!==F))for(var W=0;W<g;W+=p){var U=(L+W)/f;if(!(U<0||U>=o.outWidth||Math.floor(U)!==U)){var at=v*g-1-_.get(R,F,U,A)===I*g+W?1:0;at!==0&&(B+=E.get(R,F,U,A)*at)}}}w.set(B,R,C,T,A)}return w.toTensor()},n.prototype.avgPoolBackprop=function(t,e,a){ft([t,e],"avgPoolBackprop");for(var o=a.strideHeight,l=a.strideWidth,s=a.filterHeight,f=a.filterWidth,h=a.dilationHeight,p=a.dilationWidth,v=a.effectiveFilterHeight,g=a.effectiveFilterWidth,y=g-1-a.padInfo.left,x=v-1-a.padInfo.top,w=Bt(e.shape,"float32"),_=1/(s*f),E=this.bufferSync(t),R=0;R<a.batchSize;++R)for(var A=0;A<a.inChannels;++A)for(var C=0;C<a.inHeight;++C)for(var T=0;T<a.inWidth;++T){for(var N=C-x,L=T-y,B=0,I=0;I<v;I+=h){var F=(N+I)/o;if(!(F<0||F>=a.outHeight||Math.floor(F)!==F))for(var W=0;W<g;W+=p){var U=(L+W)/l;U<0||U>=a.outWidth||Math.floor(U)!==U||(B+=E.get(R,F,U,A))}}w.set(B*_,R,C,T,A)}return w.toTensor()},n.prototype.pool3d=function(t,e,a){ft(t,"pool3d");for(var o=e.strideDepth,l=e.strideHeight,s=e.strideWidth,f=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,v=e.effectiveFilterDepth,g=e.effectiveFilterHeight,y=e.effectiveFilterWidth,x=e.padInfo.front,w=e.padInfo.top,_=e.padInfo.left,E=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=this.readSync(t.dataId),A=Bt(e.outShape,t.dtype),C=A.values,T=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],N=e.outShape[2]*e.outShape[3]*e.outShape[4],L=e.outShape[3]*e.outShape[4],B=e.outShape[4],I=0;I<e.batchSize;++I)for(var F=I*T,W=I*t.strides[0],U=0;U<e.inChannels;++U)for(var at=0;at<e.outDepth;++at){for(var nt=at*o-x,tt=nt;tt<0;)tt+=f;for(var P=Math.min(e.inDepth,v+nt),q=F+at*N,K=0;K<e.outHeight;++K){for(var rt=K*l-w,k=rt;k<0;)k+=h;for(var X=Math.min(e.inHeight,g+rt),it=q+K*L,ot=0;ot<e.outWidth;++ot){for(var dt=ot*s-_,mt=dt;mt<0;)mt+=p;for(var pt=Math.min(e.inWidth,y+dt),Tt=it+ot*B,bt=E,Ot=0,$t=0,Ft=tt;Ft<P;Ft+=f){for(var Xt=W+Ft*t.strides[1],Ut=k;Ut<X;Ut+=h){for(var re=Xt+Ut*t.strides[2],se=mt;se<pt;se+=p){var le=R[re+se*t.strides[3]+U];if(a==="max"&&le>bt?bt=le:a==="avg"&&(Ot+=le,$t++),isNaN(bt))break}if(isNaN(bt))break}if(isNaN(bt))break}C[Tt+U]=a==="avg"?Ot/$t:bt}}}return A.toTensor()},n.prototype.avgPool3d=function(t,e){return ft(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(t,e,a){ft([t,e],"avgPool3dBackprop");for(var o=a.strideDepth,l=a.strideHeight,s=a.strideWidth,f=a.filterDepth,h=a.filterHeight,p=a.filterWidth,v=a.dilationDepth,g=a.dilationHeight,y=a.dilationWidth,x=a.effectiveFilterDepth,w=a.effectiveFilterHeight,_=a.effectiveFilterWidth,E=x-1-a.padInfo.front,R=_-1-a.padInfo.left,A=w-1-a.padInfo.top,C=Bt(e.shape,"float32"),T=1/(f*h*p),N=this.bufferSync(t),L=0;L<a.batchSize;++L)for(var B=0;B<a.inChannels;++B)for(var I=0;I<a.inDepth;++I)for(var F=0;F<a.inHeight;++F)for(var W=0;W<a.inWidth;++W){for(var U=I-E,at=F-A,nt=W-R,tt=0,P=0;P<x;P+=v){var q=(U+P)/o;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var K=0;K<w;K+=g){var rt=(at+K)/l;if(!(rt<0||rt>=a.outHeight||Math.floor(rt)!==rt))for(var k=0;k<_;k+=y){var X=(nt+k)/s;X<0||X>=a.outWidth||Math.floor(X)!==X||(tt+=N.get(L,q,rt,X,B))}}}C.set(tt*T,L,I,F,W,B)}return C.toTensor()},n.prototype.maxPool3d=function(t,e){return ft(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},n.prototype.maxPool3dPositions=function(t,e){for(var a=Bt(e.outShape,"int32"),o=e.strideDepth,l=e.strideHeight,s=e.strideWidth,f=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,v=e.effectiveFilterDepth,g=e.effectiveFilterHeight,y=e.effectiveFilterWidth,x=e.padInfo.front,w=e.padInfo.top,_=e.padInfo.left,E=this.bufferSync(t),R=0;R<e.batchSize;++R)for(var A=0;A<e.inChannels;++A)for(var C=0;C<e.outDepth;++C){for(var T=C*o-x,N=T;N<0;)N+=f;for(var L=Math.min(e.inDepth,v+T),B=0;B<e.outHeight;++B){for(var I=B*l-w,F=I;F<0;)F+=h;for(var W=Math.min(e.inHeight,g+I),U=0;U<e.outWidth;++U){for(var at=U*s-_,nt=at;nt<0;)nt+=p;for(var tt=Math.min(e.inWidth,y+at),P=Number.NEGATIVE_INFINITY,q=-1,K=N;K<L;K+=f)for(var rt=K-T,k=F;k<W;k+=h)for(var X=k-I,it=nt;it<tt;it+=p){var ot=it-at,dt=E.get(R,K,k,it,A);dt>=P&&(P=dt,q=rt*g*y+X*g+ot)}a.set(q,R,C,B,U,A)}}}return a.toTensor()},n.prototype.maxPool3dBackprop=function(t,e,a,o){ft([e,a],"maxPool3dBackprop");for(var l=this.maxPool3dPositions(e,o),s=o.strideDepth,f=o.strideHeight,h=o.strideWidth,p=o.dilationDepth,v=o.dilationHeight,g=o.dilationWidth,y=o.effectiveFilterDepth,x=o.effectiveFilterHeight,w=o.effectiveFilterWidth,_=y-1-o.padInfo.front,E=w-1-o.padInfo.left,R=x-1-o.padInfo.top,A=Bt(e.shape,"float32"),C=this.bufferSync(l),T=this.bufferSync(t),N=0;N<o.batchSize;++N)for(var L=0;L<o.inChannels;++L)for(var B=0;B<o.inDepth;++B)for(var I=0;I<o.inHeight;++I)for(var F=0;F<o.inWidth;++F){for(var W=B-_,U=I-R,at=F-E,nt=0,tt=0;tt<y;tt+=p){var P=(W+tt)/s;if(!(P<0||P>=o.outDepth||Math.floor(P)!==P))for(var q=0;q<x;q+=v){var K=(U+q)/f;if(!(K<0||K>=o.outHeight||Math.floor(K)!==K))for(var rt=0;rt<w;rt+=g){var k=(at+rt)/h;if(!(k<0||k>=o.outWidth||Math.floor(k)!==k)){var X=y*x*w-1-C.get(N,P,K,k,L)===tt*x*w+q*w+rt?1:0;X!==0&&(nt+=T.get(N,P,K,k,L)*X)}}}}A.set(nt,N,B,I,F,L)}return A.toTensor()},n.prototype.cast=function(t,e){return p1(t,e,this)},n.prototype.reshape=function(t,e){return yd(t,e)},n.prototype.avgPool=function(t,e){return ft(t,"avgPool"),this.pool(t,e,"avg").toFloat()},n.prototype.resizeBilinear=function(t,e,a,o){ft(t,"resizeBilinear");for(var l=t.shape,s=l[0],f=l[1],h=l[2],p=l[3],v=this.readSync(t.dataId),g=new Float32Array(Et([s,e,a,p])),y=[o&&e>1?f-1:f,o&&a>1?h-1:h],x=[o&&e>1?e-1:e,o&&a>1?a-1:a],w=0,_=y[0]/x[0],E=y[1]/x[1],R=0;R<s;R++)for(var A=0;A<e;A++)for(var C=_*A,T=Math.floor(C),N=C-T,L=Math.min(f-1,Math.ceil(C)),B=R*t.strides[0]+T*t.strides[1],I=R*t.strides[0]+L*t.strides[1],F=0;F<a;F++)for(var W=E*F,U=Math.floor(W),at=W-U,nt=Math.min(h-1,Math.ceil(W)),tt=B+U*t.strides[2],P=I+U*t.strides[2],q=B+nt*t.strides[2],K=I+nt*t.strides[2],rt=0;rt<p;rt++){var k=v[tt+rt],X=v[P+rt],it=k+(v[q+rt]-k)*at,ot=it+(X+(v[K+rt]-X)*at-it)*N;g[w++]=ot}return nn(g,[s,e,a,p])},n.prototype.resizeBilinearBackprop=function(t,e,a){ft([t,e],"resizeBilinearBackprop");for(var o=e.shape,l=o[0],s=o[1],f=o[2],h=o[3],p=t.shape,v=p[1],g=p[2],y=new Float32Array(l*s*f*h),x=[a&&v>1?s-1:s,a&&g>1?f-1:f],w=[a&&v>1?v-1:v,a&&g>1?g-1:g],_=x[0]/w[0],E=x[1]/w[1],R=this.readSync(t.dataId),A=0,C=0;C<l;C++)for(var T=C*e.strides[0],N=0;N<v;N++)for(var L=N*_,B=Math.floor(L),I=Math.min(Math.ceil(L),s-1),F=T+B*e.strides[1],W=T+I*e.strides[1],U=L-B,at=1-U,nt=0;nt<g;nt++)for(var tt=nt*E,P=Math.floor(tt),q=Math.min(Math.ceil(tt),f-1),K=tt-P,rt=1-K,k=F+P*e.strides[2],X=F+q*e.strides[2],it=W+P*e.strides[2],ot=W+q*e.strides[2],dt=at*rt,mt=at*K,pt=U*rt,Tt=U*K,bt=0;bt<h;bt++){var Ot=R[A++];y[k+bt]+=Ot*dt,y[X+bt]+=Ot*mt,y[it+bt]+=Ot*pt,y[ot+bt]+=Ot*Tt}return Cn(y,[l,f,s,h],e.dtype)},n.prototype.resizeNearestNeighbor=function(t,e,a,o){ft(t,"resizeNearestNeighbor");for(var l=t.shape,s=l[0],f=l[1],h=l[2],p=l[3],v=this.readSync(t.dataId),g=new Float32Array(s*e*a*p),y=[o&&e>1?f-1:f,o&&a>1?h-1:h],x=[o&&e>1?e-1:e,o&&a>1?a-1:a],w=y[0]/x[0],_=y[1]/x[1],E=0,R=0;R<s;R++)for(var A=R*t.strides[0],C=0;C<e;C++)for(var T=w*C,N=A+Math.min(f-1,o?Math.round(T):Math.floor(T))*t.strides[1],L=0;L<a;L++)for(var B=_*L,I=N+Math.min(h-1,o?Math.round(B):Math.floor(B))*t.strides[2],F=0;F<p;F++){var W=v[I+F];g[E++]=W}return nn(g,[s,e,a,p],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,e,a){ft([t,e],"resizeNearestNeighborBackprop");for(var o=e.shape,l=o[0],s=o[1],f=o[2],h=o[3],p=t.shape,v=p[1],g=p[2],y=new Float32Array(l*s*f*h),x=this.readSync(t.dataId),w=[a&&v>1?s-1:s,a&&g>1?f-1:f],_=[a&&v>1?v-1:v,a&&g>1?g-1:g],E=w[0]/_[0],R=w[1]/_[1],A=1/E,C=1/R,T=2*Math.ceil(A)+2,N=2*Math.ceil(C)+2,L=0;L<l;L++)for(var B=L*e.strides[0],I=0;I<s;I++)for(var F=B+I*e.strides[1],W=Math.floor(I*A),U=Math.floor(W-T/2),at=0;at<f;at++)for(var nt=F+at*e.strides[2],tt=Math.floor(at*C),P=Math.floor(tt-N/2),q=0;q<h;q++){for(var K=0,rt=0;rt<T;rt++){var k=rt+U;if(!(k<0||k>=v)){var X=B+k*t.strides[1],it=k*E;if(I===Math.min(s-1,a?Math.round(it):Math.floor(it)))for(var ot=0;ot<N;ot++){var dt=ot+P;if(!(dt<0||dt>=g)){var mt=X+dt*t.strides[2],pt=dt*R;at===Math.min(f-1,a?Math.round(pt):Math.floor(pt))&&(K+=x[mt+q])}}}}y[nt+q]=K}return Cn(y,e.shape,e.dtype)},n.prototype.batchNormalization=function(t,e,a,o,l,s){ft([t,e,a,l,s],"batchNorm");for(var f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=this.readSync(a.dataId),v=l?this.readSync(l.dataId):new Float32Array([1]),g=s?this.readSync(s.dataId):new Float32Array([0]),y=new Float32Array(f.length),x=g.length,w=v.length,_=p.length,E=h.length,R=0,A=0,C=0,T=0,N=0;N<f.length;++N)y[N]=g[R++]+(f[N]-h[A++])*v[C++]/Math.sqrt(p[T++]+o),R>=x&&(R=0),A>=E&&(A=0),C>=w&&(C=0),T>=_&&(T=0);return Cn(y,t.shape)},n.prototype.localResponseNormalization4D=function(t,e,a,o,l){ft(t,"localResponseNormalization4D");var s=t.shape[3],f=s-1,h=this.readSync(t.dataId),p=t.size,v=new Float32Array(p);function g(_){for(var E=_%s,R=_-E+Math.max(0,E-e),A=_-E+Math.min(E+e,f),C=0;R<=A;R++){var T=h[R];C+=T*T}return C}for(var y=0;y<p;y++){var x=g(y),w=h[y]*Math.pow(a+o*x,-l);v[y]=w}return Cn(v,t.shape)},n.prototype.LRNGrad=function(t,e,a,o,l,s,f){ft(t,"LRNGrad");for(var h=t.shape[3],p=this.readSync(t.dataId),v=this.readSync(e.dataId),g=this.readSync(a.dataId),y=new Float32Array(t.size),x=t.size,w=0;w<x;w++){for(var _=w%h,E=w-_+Math.max(0,_-o),R=w-_+Math.min(h,_+o+1),A=0,C=E;C<R;C++)A+=Math.pow(v[C],2);for(A=s*A+l,C=E;C<R;C++){var T=-2*s*f*v[C]*g[w]/A;w===C&&(T+=Math.pow(A,-f)),T*=p[w],y[C]+=T}}return Cn(y,t.shape)},n.prototype.multinomial=function(t,e,a,o){ft(t,"multinomial");for(var l=e?t:ra(t),s=l.shape[0],f=l.shape[1],h=pe([s,a],"int32"),p=this.readSync(h.dataId),v=this.readSync(l.dataId),g=0;g<s;++g){var y=g*f,x=new Float32Array(f-1);x[0]=v[y];for(var w=1;w<x.length;++w)x[w]=x[w-1]+v[y+w];for(var _=Zl(o.toString()),E=g*a,R=0;R<a;++R){var A=_();p[E+R]=x.length;for(var C=0;C<x.length;C++)if(A<x[C]){p[E+R]=C;break}}}return h},n.prototype.oneHot=function(t,e,a,o){ft(t,"oneHot");var l=new Float32Array(t.size*e);l.fill(o);for(var s=this.readSync(t.dataId),f=0;f<t.size;++f)s[f]>=0&&s[f]<e&&(l[f*e+s[f]]=a);return Fa(l,[t.size,e],"int32")},n.prototype.nonMaxSuppression=function(t,e,a,o,l){return ft(t,"nonMaxSuppression"),Pd(this.readSync(t.dataId),this.readSync(e.dataId),a,o,l)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,e){for(var a=t.shape[0],o=t.shape[1],l=Bt(t.shape,"float32"),s=Bt(t.shape,"float32"),f=ar(t).as2D(a,o),h=Ar(t).as2D(a,o),p=0;p<a;p++)for(var v=f.slice([p,0],[1,o]),g=h.slice([p,0],[1,o]),y=tn(v,g),x=this.readSync(this.fftImpl(y,e).dataId),w=0;w<o;w++){var _=qy(x,w);l.values[p*o+w]=_.real,s.values[p*o+w]=_.imag}return tn(l.toTensor(),s.toTensor()).as2D(a,o)},n.prototype.fftImpl=function(t,e){var a=t.as1D(),o=a.size;if(this.isExponentOf2(o)){var l=this.fftRadix2(a,o,e).as2D(t.shape[0],t.shape[1]);return e&&(l=tn(ar(l).div(vt(o)),Ar(l).div(vt(o)))),l}var s=this.readSync(t.dataId),f=function(h){for(var p=new Float32Array(h.length/2),v=new Float32Array(h.length/2),g=0;g<h.length;g+=2)p[g/2]=h[g],v[g/2]=h[g+1];return{real:p,imag:v}}(this.fourierTransformByMatmul(s,o,e));return tn(f.real,f.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,e,a){if(e===1)return t;var o=this.readSync(t.dataId),l=e/2,s=function(E){for(var R=Math.ceil(E.length/4),A=new Float32Array(R),C=new Float32Array(R),T=0;T<E.length;T+=4)A[Math.floor(T/4)]=E[T],C[Math.floor(T/4)]=E[T+1];return{real:A,imag:C}}(o),f=tn(s.real,s.imag).as1D(),h=function(E){for(var R=Math.floor(E.length/4),A=new Float32Array(R),C=new Float32Array(R),T=2;T<E.length;T+=4)A[Math.floor(T/4)]=E[T],C[Math.floor(T/4)]=E[T+1];return{real:A,imag:C}}(o),p=tn(h.real,h.imag).as1D();f=this.fftRadix2(f,l,a),p=this.fftRadix2(p,l,a);var v=function(E,R){for(var A=new Float32Array(E/2),C=new Float32Array(E/2),T=0;T<Math.ceil(E/2);T++){var N=(R?2:-2)*Math.PI*(T/E);A[T]=Math.cos(N),C[T]=Math.sin(N)}return{real:A,imag:C}}(e,a),g=tn(v.real,v.imag).mul(p),y=f.add(g),x=f.sub(g),w=ar(y).concat(ar(x)),_=Ar(y).concat(Ar(x));return tn(w,_).as1D()},n.prototype.fourierTransformByMatmul=function(t,e,a){for(var o=new Float32Array(2*e),l=0;l<e;l++){for(var s=0,f=0,h=0;h<e;h++){var p=dE(l*h,e,a),v=qy(t,h);s+=v.real*p.real-v.imag*p.imag,f+=v.real*p.imag+v.imag*p.real}a&&(s/=e,f/=e),hE(o,s,f,l)}return o},n.prototype.depthToSpace=function(t,e,a){O(a==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),O(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var o=t.shape[0],l=t.shape[1],s=t.shape[2],f=t.shape[3],h=l*e,p=s*e,v=f/(e*e),g=this.readSync(t.dataId),y=new Float32Array(o*h*p*v),x=0,w=0;w<o;++w)for(var _=0;_<h;++_)for(var E=Math.floor(_/e),R=_%e,A=0;A<p;++A)for(var C=Math.floor(A/e),T=(R*e+A%e)*v,N=0;N<v;++N){var L=N+T+f*(C+s*(E+l*w));y[x++]=g[L]}return Cn(y,[o,h,p,v])},n.prototype.broadcastedBinaryOp=function(t,e,a,o){var l=qt(t.shape,e.shape),s=Bt(l,a),f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=Oa(t.shape,l),v=Oa(e.shape,l),g=s.values;if(p.length+v.length===0)for(var y=0;y<g.length;++y)g[y]=o(f[y%f.length],h[y%h.length]);else{var x=this.bufferSync(t),w=this.bufferSync(e),_=function(E){var R=s.indexToLoc(E),A=R.slice(-t.rank);p.forEach(function(L){return A[L]=0});var C=x.locToIndex(A),T=R.slice(-e.rank);v.forEach(function(L){return T[L]=0});var N=w.locToIndex(T);g[E]=o(f[C],h[N])};for(y=0;y<g.length;++y)_(y)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,e,a){var o=qt(t.shape,e.shape),l=Bt(o,"float32"),s=Bt(o,"float32"),f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=Oa(t.shape,o),v=Oa(e.shape,o),g=l.values,y=s.values;if(p.length+v.length===0)for(var x=0;x<g.length;x++){var w=x%f.length,_=x%h.length,E=a(f[2*w],f[2*w+1],h[2*_],h[2*_+1]);g[x]=E.real,y[x]=E.imag}else{var R=this.bufferSync(this.data.get(t.dataId).complexTensors.real),A=this.bufferSync(this.data.get(e.dataId).complexTensors.real),C=function(T){var N=l.indexToLoc(T),L=N.slice(-t.rank);p.forEach(function(U){return L[U]=0});var B=R.locToIndex(L),I=N.slice(-e.rank);v.forEach(function(U){return I[U]=0});var F=A.locToIndex(I),W=a(f[2*B],f[2*B+1],h[2*F],h[2*F+1]);g[T]=W.real,y[T]=W.imag};for(x=0;x<g.length;x++)C(x)}return this.complex(l.toTensor(),s.toTensor())},n.prototype.split=function(t,e,a){return g1(t,e,a)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(t,e,a,o,l,s){for(var f=t.shape,h=f[0],p=f[1],v=f[2],g=f[3],y=e.shape[0],x=o[0],w=o[1],_=Bt([y,x,w,g],"float32"),E=this.readSync(e.dataId),R=this.readSync(a.dataId),A=this.readSync(t.dataId),C=t.strides,T=_.strides,N=0;N<y;N++){var L=4*N,B=E[L],I=E[L+1],F=E[L+2],W=E[L+3],U=R[N];if(!(U>=h))for(var at=x>1?(F-B)*(p-1)/(x-1):0,nt=w>1?(W-I)*(v-1)/(w-1):0,tt=0;tt<x;tt++){var P=x>1?B*(p-1)+tt*at:.5*(B+F)*(p-1);if(P<0||P>p-1)for(var q=0;q<w;q++)for(var K=0;K<g;K++){var rt=K+q*T[2]+tt*T[1]+N*T[0];_.values[rt]=s}else if(l==="bilinear"){var k=Math.floor(P),X=Math.ceil(P),it=P-k;for(q=0;q<w;q++)if((Ft=w>1?I*(v-1)+q*nt:.5*(I+W)*(v-1))<0||Ft>v-1)for(K=0;K<g;K++)rt=K+q*T[2]+tt*T[1]+N*T[0],_.values[rt]=s;else{var ot=Math.floor(Ft),dt=Math.ceil(Ft),mt=Ft-ot;for(K=0;K<g;K++){var pt=A[rt=K+ot*C[2]+k*C[1]+U*C[0]],Tt=A[rt=K+dt*C[2]+k*C[1]+U*C[0]],bt=A[rt=K+ot*C[2]+X*C[1]+U*C[0]],Ot=pt+(Tt-pt)*mt,$t=bt+(A[rt=K+dt*C[2]+X*C[1]+U*C[0]]-bt)*mt;rt=K+q*T[2]+tt*T[1]+N*T[0],_.values[rt]=Ot+($t-Ot)*it}}}else for(q=0;q<w;++q){var Ft;if((Ft=w>1?I*(v-1)+q*nt:.5*(I+W)*(v-1))<0||Ft>v-1)for(K=0;K<g;K++)rt=K+q*T[2]+tt*T[1]+N*T[0],_.values[rt]=s;else{var Xt=Math.round(Ft),Ut=Math.round(P);for(K=0;K<g;K++){var re=K+Xt*C[2]+Ut*C[1]+U*C[0],se=K+q*T[2]+tt*T[1]+N*T[0];_.values[se]=A[re]}}}}}return _.toTensor()},n.prototype.sparseToDense=function(t,e,a,o){var l=zl(0,t,a),s=l.sliceRank,f=l.numUpdates,h=l.sliceSize,p=l.strides,v=l.outputSize;return this.scatter(t,e,a,v,h,f,s,p,o,!1)},n.prototype.gatherND=function(t,e){var a=e.shape,o=a[a.length-1],l=u1(t,e),s=l[0],f=l[1],h=l[2],p=l[3];if(f===0)return nn([],s,t.dtype);for(var v=new zu([f,h],t.dtype),g=this.readSync(e.dataId),y=this.readSync(t.dataId),x=0;x<f;x++){for(var w=[],_=0,E=0;E<o;E++){var R=g[x*o+E];_+=R*p[E],w.push(R)}if(_<0||_>=t.size/h)throw new Error("Invalid indices: "+w+" does not index into "+t.shape);for(var A=0;A<h;A++)v.values[x*h+A]=y[_*h+A]}return v.toTensor().reshape(s)},n.prototype.scatterND=function(t,e,a){var o=zl(0,t,a),l=o.sliceRank,s=o.numUpdates,f=o.sliceSize,h=o.strides,p=o.outputSize,v=vt(0);return this.scatter(t,e,a,p,f,s,l,h,v,!0)},n.prototype.fill=function(t,e,a){var o=Tl(a=a||qu(e),Et(t));return o.fill(e),G.makeTensor(o,t,a,this)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var e=Tl(t.dtype,Et(t.shape));return this.makeOutput(e,t.shape,t.dtype)},n.prototype.linspace=function(t,e,a){return v1(t,e,a)},n.prototype.scatter=function(t,e,a,o,l,s,f,h,p,v){var g=[o/l,l],y=this.readSync(t.dataId),x=this.readSync(e.dataId);if(o===0)return nn([],a,e.dtype);var w=new zu(g,e.dtype);w.values.fill(this.readSync(p.dataId)[0]);for(var _=0;_<s;_++){for(var E=[],R=0,A=0;A<f;A++){var C=y[_*f+A];E.push(C),R+=C*h[A]}if(R<0||R>=o/l)throw new Error("Invalid indices: "+E+" does not index into "+a);for(var T=0;T<l;T++)v?w.values[R*l+T]+=x[_*l+T]:w.values[R*l+T]=e.rank===0?x[0]:x[_*l+T]}return w.toTensor().reshape(a)},n}(h1);G.registerBackend("cpu",function(){return new OA},1);for(var Qh=0,d0=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs,a=n,o=a.boxes,l=a.scores,s=e,f=s.maxOutputSize,h=s.iouThreshold,p=s.scoreThreshold,v=s.softNmsSigma,g=t;ft(o,"NonMaxSuppressionWithScore");var y=Ud(g.data.get(o.dataId).values,g.data.get(l.dataId).values,f,h,p,v);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n.x,a=t;ft(e,"square");for(var o=a.data.get(e.dataId).values,l=new Float32Array(o.length),s=0;s<o.length;++s){var f=o[s];l[s]=f*f}return{dataId:a.write(l,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}},{kernelName:Hu,backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n,a=e.a,o=e.b,l=t;ft([a,o],Hu);var s=l.data.get(a.dataId).values,f=l.data.get(o.dataId).values,h=function(g,y,x,w,_,E){var R=qt(g,y),A=R.length,C=Nr(R),T=Lu(_,Et(R)),N=g.length,L=y.length,B=Nr(g),I=Nr(y),F=Oa(g,R),W=Oa(y,R);if(F.length+W.length===0)for(var U=0;U<T.length;++U)T[U]=E(x[U%x.length],w[U%w.length]);else{var at=function(nt){var tt=Ww(nt,A,C),P=tt.slice(-N);F.forEach(function(k){return P[k]=0});var q=Fy(P,N,B),K=tt.slice(-L);W.forEach(function(k){return K[k]=0});var rt=Fy(K,L,I);T[nt]=E(x[q],w[rt])};for(U=0;U<T.length;++U)at(U)}return[T,R]}(a.shape,o.shape,s,f,a.dtype,function(g,y){var x=g-y;return x*x}),p=h[0],v=h[1];return{dataId:l.write(p,v,a.dtype),shape:v,dtype:a.dtype}}}];Qh<d0.length;Qh++)U0(d0[Qh]);var so,IA=function(r){this.variableNames=["A"];var n=ln(),t=r[0],e=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+e+".0, "+t+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},BA=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=ln(),t=r[0],e=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+e+".0, "+t+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(var Zh=0,p0=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs,a=n.pixels,o=e.numChannels,l=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,f=l?[a.videoWidth,a.videoHeight]:[a.width,a.height],h=f[0],p=f[1],v=[p,h],g=[p,h,o];(s||l)&&(so==null&&(so=document.createElement("canvas").getContext("2d")),so.canvas.width=h,so.canvas.height=p,so.drawImage(a,0,0,h,p),a=so.canvas);var y=t.makeTensorInfo(v,"int32");t.texData.get(y.dataId).usage=Un.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(y.dataId),a);var x=ut().getBool("WEBGL_PACK")?new BA(g):new IA(g),w=t.runWebGLProgram(x,[y],"int32");return t.disposeData(y.dataId),w}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs;kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n,o=a.boxes,l=a.scores,s=e,f=s.maxOutputSize,h=s.iouThreshold,p=s.scoreThreshold,v=s.softNmsSigma,g=t,y=Ud(g.readSync(o.dataId),g.readSync(l.dataId),f,h,p,v);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n.x,a=t,o=new zt(e.shape,"return x * x;");return a.runWebGLProgram(o,[e],e.dtype)}},{kernelName:Hu,backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n,a=e.a,o=e.b,l=t,s=ut().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ta("return (a - b) * (a - b);",a.shape,o.shape):new Ce("return (a - b) * (a - b);",a.shape,o.shape);return l.compileAndRun(s,[a,o])}}];Zh<p0.length;Zh++)U0(p0[Zh]);for(var Jh=0,v0=[{kernelName:"Square",gradFunc:function(r,n){var t=n[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:Hu,gradFunc:function(r,n){var t=n[0],e=n[1],a=vt(2);return{a:function(){return fn(r,fn(a,ze(t,e)))},b:function(){return fn(r,fn(a,ze(e,t)))}}}}];Jh<v0.length;Jh++)kw(v0[Jh]);var FA=function(){function r(){}return r.prototype.fetch=function(n,t){return fetch(n,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},r.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},r}();ut().get("IS_BROWSER")&&ut().setPlatform("browser",new FA);var $h,LA=function(){return require("node-fetch")},zA=function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(n,t){return ut().global.fetch!=null?ut().global.fetch(n,t):($h==null&&($h=LA()),$h(n,t))},r.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},r.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},r.prototype.decode=function(n,t){return n.length===0?"":new this.util.TextDecoder(t).decode(n)},r}();ut().get("IS_NODE")&&ut().setPlatform("node",new zA);var wd={float32:4,int32:4,uint16:2,uint8:1,bool:1},ql=4;function lb(r,n){for(var t={},e=0,a=function(s){var f=s.name,h=s.dtype,p=s.shape,v=Et(p),g=void 0;if("quantization"in s){var y=s.quantization;if(y.dtype!=="uint8"&&y.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+y.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var x=wd[y.dtype],w=r.slice(e,e+v*x),_=y.dtype==="uint8"?new Uint8Array(w):new Uint16Array(w);if(h==="float32")g=Float32Array.from(_,function(N){return N*y.scale+y.min});else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+f+"': "+h);g=Int32Array.from(_,function(N){return Math.round(N*y.scale+y.min)})}e+=v*x}else if(h==="string"){var E=Et(s.shape);g=[];for(var R=0;R<E;R++){var A=new Uint32Array(r.slice(e,e+ql))[0];e+=ql;var C=new Uint8Array(r.slice(e,e+A));g.push(C),e+=A}}else{var T=wd[h];if(w=r.slice(e,e+v*T),h==="float32")g=new Float32Array(w);else if(h==="int32")g=new Int32Array(w);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+f+"': "+h);g=new Uint8Array(w)}e+=v*T}t[f]=nn(g,p,h)},o=0,l=n;o<l.length;o++)a(l[o]);return t}function PA(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var n=0,t=[];r.forEach(function(o){if(n+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var e=new Uint8Array(n),a=0;return t.forEach(function(o){e.set(new Uint8Array(o.buffer),a),a+=o.byteLength}),e.buffer}var _d=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function m0(r){return _d?Buffer.byteLength(r):new Blob([r]).size}function ip(r){var n=0;r.forEach(function(a){n+=a.byteLength});var t=new Uint8Array(n),e=0;return r.forEach(function(a){t.set(new Uint8Array(a),e),e+=a.byteLength}),t.buffer}function g0(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var n=r.split("/");return n[n.length-1]}function Ju(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:m0(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:m0(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var Hn=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(n){r.getInstance().saveRouters.push(n)},r.registerLoadRouter=function(n){r.getInstance().loadRouters.push(n)},r.getSaveHandlers=function(n){return r.getHandlers(n,"save")},r.getLoadHandlers=function(n,t){return r.getHandlers(n,"load",t)},r.getHandlers=function(n,t,e){var a=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(o){var l=o(n,e);l!==null&&a.push(l)}),a},r}(),bo="://",La=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(n,t){O(n!=null,function(){return"scheme must not be undefined or null."}),n.endsWith(bo)&&(n=n.slice(0,n.indexOf(bo))),O(n.length>0,function(){return"scheme must not be an empty string."});var e=r.getInstance();O(e.managers[n]==null,function(){return"A model store manager is already registered for scheme '"+n+"'."}),e.managers[n]=t},r.getManager=function(n){var t=this.getInstance().managers[n];if(t==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function Rl(r){if(r.indexOf(bo)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+La.getSchemes().join(","));return{scheme:r.split(bo)[0],path:r.split(bo)[1]}}function y0(r,n,t){return t===void 0&&(t=!1),wt(this,void 0,void 0,function(){var e,a,o,l,s,f,h,p,v;return _t(this,function(g){switch(g.label){case 0:return O(r!==n,function(){return"Old path and new path are the same: '"+r+"'"}),O((e=Hn.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),O(e.length<2,function(){return"Copying failed because more than one ("+e.length+") load handlers for source URL "+r+"."}),a=e[0],O((o=Hn.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),O(o.length<2,function(){return"Copying failed because more than one ("+e.length+") save handlers for destination URL "+n+"."}),l=o[0],s=Rl(r).scheme,f=Rl(r).path,h=s===Rl(r).scheme,[4,a.load()];case 1:return p=g.sent(),t&&h?[4,La.getManager(s).removeModel(f)]:[3,3];case 2:g.sent(),g.label=3;case 3:return[4,l.save(p)];case 4:return v=g.sent(),!t||h?[3,6]:[4,La.getManager(s).removeModel(f)];case 5:g.sent(),g.label=6;case 6:return[2,v.modelArtifactsInfo]}})})}var di="models_store",Ia="model_info_store";function cb(){if(!ut().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,n=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function Ed(r){var n=r.result;n.createObjectStore(di,{keyPath:"modelPath"}),n.createObjectStore(Ia,{keyPath:"modelPath"})}var xo=function(){function r(n){if(this.indexedDB=cb(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return r.prototype.save=function(n){return wt(this,void 0,void 0,function(){return _t(this,function(t){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},r.prototype.load=function(){return wt(this,void 0,void 0,function(){return _t(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(n,t){var e=this;return new Promise(function(a,o){var l=e.indexedDB.open("tensorflowjs",1);l.onupgradeneeded=function(){return Ed(l)},l.onsuccess=function(){var s=l.result;if(t==null){var f=s.transaction(di,"readonly"),h=f.objectStore(di).get(e.modelPath);h.onsuccess=function(){if(h.result==null)return s.close(),o(new Error("Cannot find model with path '"+e.modelPath+"' in IndexedDB."));a(h.result.modelArtifacts)},h.onerror=function(w){return s.close(),o(h.error)},f.oncomplete=function(){return s.close()}}else{var p,v=Ju(t),g=s.transaction(Ia,"readwrite"),y=g.objectStore(Ia),x=y.put({modelPath:e.modelPath,modelArtifactsInfo:v});x.onsuccess=function(){var w=(p=s.transaction(di,"readwrite")).objectStore(di).put({modelPath:e.modelPath,modelArtifacts:t,modelArtifactsInfo:v});w.onsuccess=function(){return a({modelArtifactsInfo:v})},w.onerror=function(_){var E=(y=g.objectStore(Ia)).delete(e.modelPath);E.onsuccess=function(){return s.close(),o(w.error)},E.onerror=function(R){return s.close(),o(w.error)}}},x.onerror=function(w){return s.close(),o(x.error)},g.oncomplete=function(){p==null?s.close():p.oncomplete=function(){return s.close()}}}},l.onerror=function(s){return o(l.error)}})},r.URL_SCHEME="indexeddb://",r}(),b0=function(r){return ut().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(xo.URL_SCHEME)?(n=r.slice(xo.URL_SCHEME.length),new xo(n)):null;var n};Hn.registerSaveRouter(b0),Hn.registerLoadRouter(b0);var UA=function(){function r(){this.indexedDB=cb()}return r.prototype.listModels=function(){return wt(this,void 0,void 0,function(){var n=this;return _t(this,function(t){return[2,new Promise(function(e,a){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Ed(o)},o.onsuccess=function(){var l=o.result,s=l.transaction(Ia,"readonly"),f=s.objectStore(Ia).getAll();f.onsuccess=function(){for(var h={},p=0,v=f.result;p<v.length;p++){var g=v[p];h[g.modelPath]=g.modelArtifactsInfo}e(h)},f.onerror=function(h){return l.close(),a(f.error)},s.oncomplete=function(){return l.close()}},o.onerror=function(l){return a(o.error)}})]})})},r.prototype.removeModel=function(n){return wt(this,void 0,void 0,function(){var t=this;return _t(this,function(e){var a;return n=(a=n).startsWith(xo.URL_SCHEME)?a.slice(xo.URL_SCHEME.length):a,[2,new Promise(function(o,l){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Ed(s)},s.onsuccess=function(){var f,h=s.result,p=h.transaction(Ia,"readwrite"),v=p.objectStore(Ia),g=v.get(n);g.onsuccess=function(){if(g.result==null)return h.close(),l(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var y=v.delete(n),x=function(){var w=(f=h.transaction(di,"readwrite")).objectStore(di).delete(n);w.onsuccess=function(){return o(g.result.modelArtifactsInfo)},w.onerror=function(_){return l(g.error)}};y.onsuccess=x,y.onerror=function(w){return x(),h.close(),l(g.error)}},g.onerror=function(y){return h.close(),l(g.error)},p.oncomplete=function(){f==null?h.close():f.oncomplete=function(){return h.close()}}},s.onerror=function(f){return l(s.error)}})]})})},r}();if(ut().getBool("IS_BROWSER"))try{La.registerManager(xo.URL_SCHEME,new UA)}catch{}var ea="/",vo="tensorflowjs_models",fb="info",HA="model_topology",VA="weight_specs",WA="weight_data",GA="model_metadata";function hb(r){return{info:[vo,r,fb].join(ea),topology:[vo,r,HA].join(ea),weightSpecs:[vo,r,VA].join(ea),weightData:[vo,r,WA].join(ea),modelMetadata:[vo,r,GA].join(ea)}}function qA(r){var n=r.split(ea);if(n.length<3)throw new Error("Invalid key format: "+r);return n.slice(1,n.length-1).join(ea)}var wo=function(){function r(n){if(!ut().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=hb(this.modelPath)}return r.prototype.save=function(n){return wt(this,void 0,void 0,function(){var t,e,a;return _t(this,function(o){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),e=JSON.stringify(n.weightSpecs),a=Ju(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,e),this.LS.setItem(this.keys.weightData,function(l){if(_d)return Buffer.from(l).toString("base64");for(var s=new Uint8Array(l),f="",h=0,p=s.length;h<p;h++)f+=String.fromCharCode(s[h]);return btoa(f)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return wt(this,void 0,void 0,function(){var n,t,e,a,o,l,s;return _t(this,function(f){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(e=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=e,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(l=JSON.parse(o),t.format=l.format,t.generatedBy=l.generatedBy,t.convertedBy=l.convertedBy,t.userDefinedMetadata=l.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(h){if(_d){var p=Buffer.from(h,"base64");return p.buffer.slice(p.byteOffset,p.byteOffset+p.byteLength)}for(var v=atob(h),g=new Uint8Array(v.length),y=0;y<v.length;++y)g.set([v.charCodeAt(y)],y);return g.buffer}(s),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),x0=function(r){return ut().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(wo.URL_SCHEME)?(n=r.slice(wo.URL_SCHEME.length),new wo(n)):null;var n};Hn.registerSaveRouter(x0),Hn.registerLoadRouter(x0);var jA=function(){function r(){O(ut().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),O(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return wt(this,void 0,void 0,function(){var n,t,e,a,o,l;return _t(this,function(s){for(n={},t=vo+ea,e=ea+fb,a=0;a<this.LS.length;++a)(o=this.LS.key(a)).startsWith(t)&&o.endsWith(e)&&(l=qA(o),n[l]=JSON.parse(this.LS.getItem(o)));return[2,n]})})},r.prototype.removeModel=function(n){return wt(this,void 0,void 0,function(){var t,e;return _t(this,function(a){var o;if(n=(o=n).startsWith(wo.URL_SCHEME)?o.slice(wo.URL_SCHEME.length):o,t=hb(n),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+n+"'");return e=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,e]})})},r}();if(ut().getBool("IS_BROWSER"))try{La.registerManager(wo.URL_SCHEME,new jA)}catch{}var XA="model",KA=".json",YA=".weights.bin";function w0(r){return new Promise(function(n){return setTimeout(n)}).then(r)}var td=function(){function r(n){if(!ut().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(r.URL_SCHEME)&&(n=n.slice(r.URL_SCHEME.length)),n!=null&&n.length!==0||(n=XA),this.modelTopologyFileName=n+KA,this.weightDataFileName=n+YA}return r.prototype.save=function(n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s;return _t(this,function(f){switch(f.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return e=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e},o=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(l=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,l.href=o,[4,w0(function(){return l.dispatchEvent(new MouseEvent("click"))})];case 2:return f.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,w0(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:f.sent(),f.label=4;case 4:return[2,{modelArtifactsInfo:Ju(n)}]}})})},r.URL_SCHEME="downloads://",r}(),QA=function(){function r(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return r.prototype.load=function(){return wt(this,void 0,void 0,function(){var n,t,e=this;return _t(this,function(a){return n=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,l){var s=new FileReader;s.onload=function(f){var h=JSON.parse(f.target.result),p=h.modelTopology;if(p!=null){t.length===0&&o({modelTopology:p});var v=h.weightsManifest;if(v!=null){var g;try{g=e.checkManifestAndWeightFiles(v,t)}catch(_){return void l(_)}var y=[],x=[],w=[];v.forEach(function(_){_.paths.forEach(function(E){x.push(E),w.push(null)}),y.push.apply(y,_.weights)}),v.forEach(function(_){_.paths.forEach(function(E){var R=new FileReader;R.onload=function(A){var C=A.target.result,T=x.indexOf(E);w[T]=C,w.indexOf(null)===-1&&o({modelTopology:p,weightSpecs:y,weightData:ip(w),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},R.onerror=function(A){return l("Failed to weights data from file of path '"+E+"'.")},R.readAsArrayBuffer(g[E])})})}else l(new Error("weightManifest field is missing from file "+n.name))}else l(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(f){return l("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},r.prototype.checkManifestAndWeightFiles=function(n,t){for(var e=[],a=t.map(function(f){return g0(f.name)}),o={},l=0,s=n;l<s.length;l++)s[l].paths.forEach(function(f){var h=g0(f);if(e.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(e.push(h),a.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");o[f]=t[a.indexOf(h)]});if(e.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+e.length+") and the number of weight files provided ("+t.length+").");return o},r}();function _0(r,n,t,e){(function(o){O(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(r),function(o,l){O(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),O(l>=0&&l<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+l}),O(l>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+l})}(t=t??0,e=e??1);var a=0;return Promise.all(r.map(function(o){return o.then(function(l){var s=t+ ++a/r.length*(e-t);return n(s),l}),o}))}function db(r,n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s,f,h,p;return _t(this,function(v){switch(v.label){case 0:return n==null&&(n={}),t=n.fetchFunc==null?ut().platform.fetch:n.fetchFunc,e=r.map(function(g){return t(g,n.requestInit,{isBinary:!0})}),a=0,o=.5,n.onProgress!=null?[3,2]:[4,Promise.all(e)];case 1:return l=v.sent(),[3,4];case 2:return[4,_0(e,n.onProgress,a,o)];case 3:l=v.sent(),v.label=4;case 4:return s=l.map(function(g){return g.arrayBuffer()}),f=.5,h=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return p=v.sent(),[3,8];case 6:return[4,_0(s,n.onProgress,f,h)];case 7:p=v.sent(),v.label=8;case 8:return[2,p]}})})}function E0(r){var n=this;return function(t,e,a){return e===void 0&&(e=""),wt(n,void 0,void 0,function(){var o,l,s,f,h,p,v,g,y,x;return _t(this,function(w){switch(w.label){case 0:if(o=t.map(function(){return!1}),l={},s=a!=null?a.map(function(){return!1}):[],f=[],t.forEach(function(_,E){var R=0;_.weights.forEach(function(A){var C="quantization"in A?A.quantization.dtype:A.dtype,T=wd[C]*Et(A.shape),N=function(){o[E]=!0,l[E]==null&&(l[E]=[]),l[E].push({manifestEntry:A,groupOffset:R,sizeBytes:T})};a!=null?a.forEach(function(L,B){L===A.name&&(N(),s[B]=!0)}):N(),f.push(A.name),R+=T})}),!s.every(function(_){return _}))throw h=a.filter(function(_,E){return!s[E]}),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+f.join(", ")+".");return p=o.reduce(function(_,E,R){return E&&_.push(R),_},[]),v=[],p.forEach(function(_){t[_].paths.forEach(function(E){var R=e+(e.endsWith("/")?"":"/")+E;v.push(R)})}),[4,r(v)];case 1:return g=w.sent(),y={},x=0,p.forEach(function(_){for(var E=t[_].paths.length,R=0,A=0;A<E;A++)R+=g[x+A].byteLength;for(var C=new ArrayBuffer(R),T=new Uint8Array(C),N=0,L=0;L<E;L++){var B=new Uint8Array(g[x+L]);T.set(B,N),N+=B.byteLength}l[_].forEach(function(I){var F=lb(C.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var W in F)y[W]=F[W]}),x+=E}),[2,y]}})})}}Hn.registerSaveRouter(function(r){return ut().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(td.URL_SCHEME)?function(n){return n===void 0&&(n="model"),new td(n)}(r.slice(td.URL_SCHEME.length)):null});var pb=function(){function r(n,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(O(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=ut().platform.fetch,O(n!=null&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&O(n.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(n){return wt(this,void 0,void 0,function(){var t,e,a,o;return _t(this,function(l){switch(l.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:e},t.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),n.weightData!=null&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=l.sent()).ok)return[2,{modelArtifactsInfo:Ju(n),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},r.prototype.load=function(){return wt(this,void 0,void 0,function(){var n,t,e,a,o,l,s,f,h,p,v,g;return _t(this,function(y){switch(y.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=y.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");y.label=2;case 2:return y.trys.push([2,4,,5]),[4,n.json()];case 3:return t=y.sent(),[3,5];case 4:throw y.sent(),e="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e);case 5:if(a=t.modelTopology,o=t.weightsManifest,l=t.generatedBy,s=t.convertedBy,f=t.format,h=t.userDefinedMetadata,a==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:g=y.sent(),p=g[0],v=g[1],y.label=7;case 7:return[2,{modelTopology:a,weightSpecs:p,weightData:v,userDefinedMetadata:h,generatedBy:l,convertedBy:s,format:f}]}})})},r.prototype.loadWeights=function(n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s,f,h,p,v,g;return _t(this,function(y){switch(y.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,e=function(x){var w=x.lastIndexOf("/"),_=x.lastIndexOf("?"),E=x.substring(0,w),R=_>w?x.substring(_):"";return[E+"/",R]}(t),a=e[0],o=e[1],l=this.weightPathPrefix||a,s=[],f=0,h=n;f<h.length;f++)p=h[f],s.push.apply(s,p.weights);return v=[],n.forEach(function(x){x.paths.forEach(function(w){v.push(l+w+o)})}),[4,db(v,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return g=y.sent(),[2,[s,ip(g)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function Cd(r){return r.match(pb.URL_SCHEME_REGEX)!=null}var C0=function(r,n){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return Cd(t)}):Cd(r))?Sd(r,{onProgress:n}):null};function Sd(r,n){return new pb(r,n)}Hn.registerSaveRouter(C0),Hn.registerLoadRouter(C0);var ed=function(){function r(n){this.modelArtifacts=n}return r.prototype.load=function(){return wt(this,void 0,void 0,function(){return _t(this,function(n){return[2,this.modelArtifacts]})})},r}(),ZA=function(){function r(n){this.saveHandler=n}return r.prototype.save=function(n){return wt(this,void 0,void 0,function(){return _t(this,function(t){return[2,this.saveHandler(n)]})})},r}(),vb=Object.freeze({browserFiles:function(r){return new QA(r)},browserHTTPRequest:function(r,n){return Sd(r,n)},concatenateArrayBuffers:ip,decodeWeights:lb,encodeWeights:function(r,n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s=this;return _t(this,function(f){switch(f.label){case 0:for(t=[],e=[],a=Array.isArray(r)?r.map(function(h){return h.name}):Object.keys(r),o=function(h){var p=a[h],v=Array.isArray(r)?r[h].tensor:r[p];if(v.dtype!=="float32"&&v.dtype!=="int32"&&v.dtype!=="bool"&&v.dtype!=="string")throw new Error("Unsupported dtype in weight '"+p+"': "+v.dtype);var g={name:p,shape:v.shape,dtype:v.dtype};if(v.dtype==="string"){var y=new Promise(function(x){return wt(s,void 0,void 0,function(){var w,_,E,R,A,C,T;return _t(this,function(N){switch(N.label){case 0:return[4,v.bytes()];case 1:for(w=N.sent(),_=w.reduce(function(L,B){return L+B.length},0)+ql*w.length,E=new Uint8Array(_),R=0,A=0;A<w.length;A++)C=w[A],T=new Uint8Array(new Uint32Array([C.length]).buffer),E.set(T,R),R+=ql,E.set(C,R),R+=C.length;return x(E),[2]}})})});e.push(y)}else e.push(v.data());n!=null&&(g.group=n),t.push(g)},l=0;l<a.length;++l)o(l);return[4,Promise.all(e)];case 1:return[2,{data:PA(f.sent()),specs:t}]}})})},fromMemory:function(r,n,t,e){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new ed(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ed({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ed({modelTopology:r,weightSpecs:n,weightData:t,trainingConfig:e}))},getLoadHandlers:function(r,n){return Hn.getLoadHandlers(r,n)},getModelArtifactsInfoForJSON:Ju,getSaveHandlers:function(r){return Hn.getSaveHandlers(r)},http:Sd,isHTTPScheme:Cd,loadWeights:function(r,n,t,e){return n===void 0&&(n=""),wt(this,void 0,void 0,function(){return _t(this,function(a){return[2,E0(function(o){return db(o,{requestInit:e})})(r,n,t)]})})},registerLoadRouter:function(r){return Hn.registerLoadRouter(r)},registerSaveRouter:function(r){return Hn.registerSaveRouter(r)},weightsLoaderFactory:E0,withSaveHandler:function(r){return new ZA(r)},copyModel:function(r,n){return wt(this,void 0,void 0,function(){return _t(this,function(t){return[2,y0(r,n,!1)]})})},listModels:function(){return wt(this,void 0,void 0,function(){var r,n,t,e,a,o,l;return _t(this,function(s){switch(s.label){case 0:r=La.getSchemes(),n={},t=0,e=r,s.label=1;case 1:return t<e.length?(a=e[t],[4,La.getManager(a).listModels()]):[3,4];case 2:for(l in o=s.sent())n[a+bo+l]=o[l];s.label=3;case 3:return t++,[3,1];case 4:return[2,n]}})})},moveModel:function(r,n){return wt(this,void 0,void 0,function(){return _t(this,function(t){return[2,y0(r,n,!0)]})})},removeModel:function(r){return wt(this,void 0,void 0,function(){var n;return _t(this,function(t){return n=Rl(r),[2,La.getManager(n.scheme).removeModel(n.path)]})})}}),lo;H({confusionMatrix_:function(r,n,t){var e=M(r,"labels","confusionMatrix"),a=M(n,"predictions","confusionMatrix");O(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),O(e.rank===1,function(){return"Expected the rank of labels to be 1, but got "+e.rank}),O(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),O(e.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+e.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),O(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=md(e.asType("int32"),t),l=md(a.asType("int32"),t);return o.transpose().matMul(l).asType("int32")}});var JA=H({fromPixels_:function(r,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,e=!1,a=!1,o=!1,l=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)e=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)o=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);l=!0}if(a&&a&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(P0("FromPixels",G.backendName)!=null)return G.runKernel("FromPixels",{pixels:r},{numChannels:n});var s,f,h=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],p=h[0],v=h[1];if(l?s=r.getContext("2d").getImageData(0,0,p,v).data:e||t?s=r.data:(o||a)&&(lo==null&&(lo=document.createElement("canvas").getContext("2d")),lo.canvas.width=p,lo.canvas.height=v,lo.drawImage(r,0,0,p,v),s=lo.getImageData(0,0,p,v).data),n===4)f=new Int32Array(s);else{var g=p*v;f=new Int32Array(g*n);for(var y=0;y<g;y++)for(var x=0;x<n;++x)f[y*n+x]=s[4*y+x]}return Id(f,[v,p,n],"int32")}}),op=Object.freeze({toPixels:function(r,n){return wt(this,void 0,void 0,function(){var t,e,a,o,l,s,f,h,p,v,g,y,x,w,_,E,R,A,C,T,N,L,B;return _t(this,function(I){switch(I.label){case 0:if(t=M(r,"img","toPixels"),r instanceof ye||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(e=t.shape.slice(0,2),a=e[0],o=e[1],(l=t.rank===2?1:t.shape[2])>4||l===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+l);return[4,t.data()];case 1:return s=I.sent(),f=t.min(),h=t.max(),[4,Promise.all([f.data(),h.data()])];case 2:if(p=I.sent(),v=p[0],g=p[1],y=v[0],x=g[0],f.dispose(),h.dispose(),t.dtype==="float32"){if(y<0||x>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+y+" - "+x+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(y<0||x>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+y+" - "+x+"].")}for(w=t.dtype==="float32"?255:1,_=new Uint8ClampedArray(o*a*4),E=0;E<a*o;++E)R=void 0,A=void 0,C=void 0,T=void 0,l===1?(R=s[E]*w,A=s[E]*w,C=s[E]*w,T=255):l===3?(R=s[3*E]*w,A=s[3*E+1]*w,C=s[3*E+2]*w,T=255):l===4&&(R=s[4*E]*w,A=s[4*E+1]*w,C=s[4*E+2]*w,T=s[4*E+3]*w),_[(N=4*E)+0]=Math.round(R),_[N+1]=Math.round(A),_[N+2]=Math.round(C),_[N+3]=Math.round(T);return n!=null&&(n.width=o,n.height=a,L=n.getContext("2d"),B=new ImageData(_,o,a),L.putImageData(B,0,0)),t!==r&&t.dispose(),[2,_]}})})},fromPixels:JA}),$A=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(n,t){return new n(t)},r}(),tT=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(n){r.getMap().classNameMap[n.className]=[n,n.fromConfig]},r}();function xi(r){O(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),O(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),O(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),tT.register(r)}var wi=function(r){function n(){return r!==null&&r.apply(this,arguments)||this}return dr(n,r),n.prototype.minimize=function(t,e,a){e===void 0&&(e=!1);var o=this.computeGradients(t,a),l=o.value,s=o.grads;if(a!=null){var f=a.map(function(h){return{name:h.name,tensor:s[h.name]}});this.applyGradients(f)}else this.applyGradients(s);return Rn(s),e?l:(l.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(t,e){return cE(t,e)},n.prototype.dispose=function(){this.iterations_!=null&&Rn(this.iterations_)},n.prototype.saveIterations=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:vt(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(t){return wt(this,void 0,void 0,function(){var e;return _t(this,function(a){switch(a.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=a.sent()[0],[2,t.slice(1)]}})})},n}($A);Object.defineProperty(wi,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var eT=function(r){function n(t,e,a){a===void 0&&(a=null);var o=r.call(this)||this;return o.learningRate=t,o.rho=e,o.epsilon=a,o.accumulatedGrads=[],o.accumulatedUpdates=[],a==null&&(o.epsilon=G.backend.epsilon()),o}return dr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t)).forEach(function(a,o){var l=G.registeredVariables[a];e.accumulatedGrads[o]==null&&(e.accumulatedGrads[o]={originalName:a+"/accum_grad",variable:yt(function(){return Yt(l).variable(!1)})}),e.accumulatedUpdates[o]==null&&(e.accumulatedUpdates[o]={originalName:a+"/accum_var",variable:yt(function(){return Yt(l).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[a];if(s!=null){var f=e.accumulatedGrads[o].variable,h=e.accumulatedUpdates[o].variable;yt(function(){var p=f.mul(e.rho).add(s.square().mul(1-e.rho)),v=h.add(e.epsilon).sqrt().div(f.add(e.epsilon).sqrt()).mul(s),g=h.mul(e.rho).add(v.square().mul(1-e.rho));f.assign(p),h.assign(g);var y=v.mul(-e.learningRate).add(l);l.assign(y)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Rn(this.accumulatedGrads.map(function(t){return t.variable})),Rn(this.accumulatedUpdates.map(function(t){return t.variable})))},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){var t;return _t(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){var e;return _t(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},n.className="Adadelta",n}(wi);xi(eT);var nT=function(r){function n(t,e){e===void 0&&(e=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=e,a.accumulatedGrads=[],a}return dr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t)).forEach(function(a,o){var l=G.registeredVariables[a];e.accumulatedGrads[o]==null&&(e.accumulatedGrads[o]={originalName:a+"/accumulator",variable:yt(function(){return Mr(l.shape,e.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[a];if(s!=null){var f=e.accumulatedGrads[o].variable;yt(function(){var h=f.add(s.square());f.assign(h);var p=s.div(h.add(G.backend.epsilon()).sqrt()).mul(-e.learningRate).add(l);l.assign(p)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&Rn(this.accumulatedGrads.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},n.className="Adagrad",n}(wi);xi(nT);var rT=function(r){function n(t,e,a,o){o===void 0&&(o=null);var l=r.call(this)||this;return l.learningRate=t,l.beta1=e,l.beta2=a,l.epsilon=o,l.accumulatedFirstMoment=[],l.accumulatedSecondMoment=[],yt(function(){l.accBeta1=vt(e).variable(),l.accBeta2=vt(a).variable()}),o==null&&(l.epsilon=G.backend.epsilon()),l}return dr(n,r),n.prototype.applyGradients=function(t){var e=this,a=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);yt(function(){var o=ze(1,e.accBeta1),l=ze(1,e.accBeta2);a.forEach(function(s,f){var h=G.registeredVariables[s];e.accumulatedFirstMoment[f]==null&&(e.accumulatedFirstMoment[f]={originalName:s+"/m",variable:yt(function(){return Yt(h).variable(!1)})}),e.accumulatedSecondMoment[f]==null&&(e.accumulatedSecondMoment[f]={originalName:s+"/v",variable:yt(function(){return Yt(h).variable(!1)})});var p=Array.isArray(t)?t[f].tensor:t[s];if(p!=null){var v=e.accumulatedFirstMoment[f].variable,g=e.accumulatedSecondMoment[f].variable,y=v.mul(e.beta1).add(p.mul(1-e.beta1)),x=g.mul(e.beta2).add(p.square().mul(1-e.beta2)),w=y.div(o),_=x.div(l);v.assign(y),g.assign(x);var E=w.div(_.sqrt().add(e.epsilon)).mul(-e.learningRate).add(h);h.assign(E)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Rn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Rn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){var t;return _t(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){var e,a=this;return _t(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),yt(function(){a.accBeta1.assign(Wl(a.beta1,a.iterations_+1)),a.accBeta2.assign(Wl(a.beta2,a.iterations_+1))}),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map(function(l){return{originalName:l.name,variable:l.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(l){return{originalName:l.name,variable:l.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},n.className="Adam",n}(wi);xi(rT);var aT=function(r){function n(t,e,a,o,l){o===void 0&&(o=null),l===void 0&&(l=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=e,s.beta2=a,s.epsilon=o,s.decay=l,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],yt(function(){s.iteration=vt(0).variable(),s.accBeta1=vt(e).variable()}),o==null&&(s.epsilon=G.backend.epsilon()),s}return dr(n,r),n.prototype.applyGradients=function(t){var e=this,a=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);yt(function(){var o=ze(1,e.accBeta1),l=cr(-e.learningRate,e.iteration.mul(e.decay).add(1));a.forEach(function(s,f){var h=G.registeredVariables[s];e.accumulatedFirstMoment[f]==null&&(e.accumulatedFirstMoment[f]={originalName:s+"/m",variable:Yt(h).variable(!1)}),e.accumulatedWeightedInfNorm[f]==null&&(e.accumulatedWeightedInfNorm[f]={originalName:s+"/v",variable:Yt(h).variable(!1)});var p=Array.isArray(t)?t[f].tensor:t[s];if(p!=null){var v=e.accumulatedFirstMoment[f].variable,g=e.accumulatedWeightedInfNorm[f].variable,y=v.mul(e.beta1).add(p.mul(1-e.beta1)),x=g.mul(e.beta2),w=p.abs(),_=x.maximum(w);v.assign(y),g.assign(_);var E=l.div(o).mul(y.div(_.add(e.epsilon))).add(h);h.assign(E)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Rn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Rn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},n.className="Adamax",n}(wi);xi(aT);var mb=function(r){function n(t){var e=r.call(this)||this;return e.learningRate=t,e.setLearningRate(t),e}return dr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t)).forEach(function(a,o){var l=Array.isArray(t)?t[o].tensor:t[a];if(l!=null){var s=G.registeredVariables[a];yt(function(){var f=e.c.mul(l).add(s);s.assign(f)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=C_(vt(-t))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=e.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(t,e){return new t(e.learningRate)},n.className="SGD",n}(wi);xi(mb);var iT=function(r){function n(t,e,a){a===void 0&&(a=!1);var o=r.call(this,t)||this;return o.learningRate=t,o.momentum=e,o.useNesterov=a,o.accumulations=[],o.m=vt(o.momentum),o}return dr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t)).forEach(function(a,o){var l=G.registeredVariables[a];e.accumulations[o]==null&&(e.accumulations[o]={originalName:a+"/momentum",variable:yt(function(){return Yt(l).variable(!1)})});var s=e.accumulations[o].variable,f=Array.isArray(t)?t[o].tensor:t[a];f!=null&&yt(function(){var h,p=e.m.mul(s).add(f);h=e.useNesterov?e.c.mul(f.add(p.mul(e.m))).add(l):e.c.mul(p).add(l),s.assign(p),l.assign(h)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Rn(this.accumulations.map(function(t){return t.variable}))},n.prototype.setMomentum=function(t){this.momentum=t},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){return _t(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){return _t(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},n.className="Momentum",n}(mb);xi(iT);var oT=function(r){function n(t,e,a,o,l){e===void 0&&(e=.9),a===void 0&&(a=0),o===void 0&&(o=null),l===void 0&&(l=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=e,s.momentum=a,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=l,o==null&&(s.epsilon=G.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return dr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t)).forEach(function(a,o){var l=G.registeredVariables[a];e.accumulatedMeanSquares[o]==null&&(e.accumulatedMeanSquares[o]={originalName:a+"/rms",variable:yt(function(){return Yt(l).variable(!1)})}),e.accumulatedMoments[o]==null&&(e.accumulatedMoments[o]={originalName:a+"/momentum",variable:yt(function(){return Yt(l).variable(!1)})}),e.accumulatedMeanGrads[o]==null&&e.centered&&(e.accumulatedMeanGrads[o]={originalName:a+"/mg",variable:yt(function(){return Yt(l).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[a];if(s!=null){var f=e.accumulatedMeanSquares[o].variable,h=e.accumulatedMoments[o].variable;yt(function(){var p=f.mul(e.decay).add(s.square().mul(1-e.decay));if(e.centered){var v=e.accumulatedMeanGrads[o].variable,g=v.mul(e.decay).add(s.mul(1-e.decay)),y=h.mul(e.momentum).add(s.mul(e.learningRate).div(p.sub(g.square().add(e.epsilon)).sqrt()));f.assign(p),v.assign(g),h.assign(y);var x=l.sub(y);l.assign(x)}else{var w=f.mul(e.decay).add(s.square().mul(1-e.decay));y=h.mul(e.momentum).add(s.mul(e.learningRate).div(w.add(e.epsilon).sqrt())),f.assign(w),h.assign(y),x=l.sub(y),l.assign(x)}})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Rn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Rn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Rn(this.accumulatedMoments.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return wt(this,void 0,void 0,function(){var t;return _t(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(t){return wt(this,void 0,void 0,function(){var e;return _t(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},n.className="RMSProp",n}(wi);xi(oT);ye.prototype.squaredDifference=function(r){return M1(this,r)},et=kA;function si(r,n,t){if(t===void 0&&(t=!1),r.beginPath(),n.slice(1).forEach(function(o,l){var s=o.x,f=o.y,h=n[l];r.moveTo(h.x,h.y),r.lineTo(s,f)}),t){var e=n[n.length-1],a=n[0];if(!e||!a)return;r.moveTo(e.x,e.y),r.lineTo(a.x,a.y)}r.stroke()}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Rd=function(r,n){return Rd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},Rd(r,n)};function It(r,n){Rd(r,n);function t(){this.constructor=r}r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var sn=function(){return sn=Object.assign||function(n){for(var t,e=1,a=arguments.length;e<a;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},sn.apply(this,arguments)};function St(r,n,t,e){function a(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(p){try{h(e.next(p))}catch(v){l(v)}}function f(p){try{h(e.throw(p))}catch(v){l(v)}}function h(p){p.done?o(p.value):a(p.value).then(s,f)}h((e=e.apply(r,[])).next())})}function Rt(r,n){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},e,a,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(h){return function(p){return f([h,p])}}function f(h){if(e)throw new TypeError("Generator is already executing.");for(;t;)try{if(e=1,a&&(o=h[0]&2?a.return:h[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,h[1])).done)return o;switch(a=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,a=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){t.label=h[1];break}if(h[0]===6&&t.label<o[1]){t.label=o[1],o=h;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(h);break}o[2]&&t.ops.pop(),t.trys.pop();continue}h=n.call(r,t)}catch(p){h=[6,p],a=0}finally{e=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Fu(){for(var r=0,n=0,t=arguments.length;n<t;n++)r+=arguments[n].length;for(var e=Array(r),a=0,n=0;n<t;n++)for(var o=arguments[n],l=0,s=o.length;l<s;l++,a++)e[a]=o[l];return e}var pi=function(){function r(n,t){if(!vi(n)||!vi(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:t}));this._width=n,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function ic(r,n){return r instanceof ye&&r.shape.length===n}function uT(r){return ic(r,2)}function oc(r){return ic(r,3)}function za(r){return ic(r,4)}function sT(r){return r%1!==0}function S0(r){return r%2===0}function gb(r,n){n===void 0&&(n=2);var t=Math.pow(10,n);return Math.floor(r*t)/t}function R0(r){return r&&r.width&&r.height}function lT(r,n){var t=r.width,e=r.height,a=n/Math.max(e,t);return new pi(Math.round(t*a),Math.round(e*a))}function up(r){return r.reduce(function(n,t){return n.add(t)},new Jt(0,0)).div(new Jt(r.length,r.length))}function Vu(r,n,t){return Array(r).fill(0).map(function(e,a){return n+a*t})}function vi(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function A0(r){return vi(r)&&0<=r&&r<=1}var Jt=function(){function r(n,t){this._x=n,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(n){return new r(this.x+n.x,this.y+n.y)},r.prototype.sub=function(n){return new r(this.x-n.x,this.y-n.y)},r.prototype.mul=function(n){return new r(this.x*n.x,this.y*n.y)},r.prototype.div=function(n){return new r(this.x/n.x,this.y/n.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}(),Or=function(){function r(n,t){t===void 0&&(t=!0);var e=n||{},a=[e.left,e.top,e.right,e.bottom].every(vi),o=[e.x,e.y,e.width,e.height].every(vi);if(!o&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(e));var l=o?[e.x,e.y,e.width,e.height]:[e.left,e.top,e.right-e.left,e.bottom-e.top],s=l[0],f=l[1],h=l[2],p=l[3];r.assertIsValidBox({x:s,y:f,width:h,height:p},"Box.constructor",t),this._x=s,this._y=f,this._width=h,this._height=p}return r.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(vi)},r.assertIsValidBox=function(n,t,e){if(e===void 0&&(e=!1),!r.isRect(n))throw new Error(t+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!e&&(n.width<0||n.height<0))throw new Error(t+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new Jt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new Jt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new Jt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new Jt(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(l){return Math.round(l)}),t=n[0],e=n[1],a=n[2],o=n[3];return new r({x:t,y:e,width:a,height:o})},r.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(l){return Math.floor(l)}),t=n[0],e=n[1],a=n[2],o=n[3];return new r({x:t,y:e,width:a,height:o})},r.prototype.toSquare=function(){var n=this,t=n.x,e=n.y,a=n.width,o=n.height,l=Math.abs(a-o);return a<o&&(t-=l/2,a+=l),o<a&&(e-=l/2,o+=l),new r({x:t,y:e,width:a,height:o})},r.prototype.rescale=function(n){var t=R0(n)?n.width:n,e=R0(n)?n.height:n;return new r({x:this.x*t,y:this.y*e,width:this.width*t,height:this.height*e})},r.prototype.pad=function(n,t){var e=[this.x-n/2,this.y-t/2,this.width+n,this.height+t],a=e[0],o=e[1],l=e[2],s=e[3];return new r({x:a,y:o,width:l,height:s})},r.prototype.clipAtImageBorders=function(n,t){var e=this,a=e.x,o=e.y,l=e.right,s=e.bottom,f=Math.max(a,0),h=Math.max(o,0),p=l-f,v=s-h,g=Math.min(p,n-f),y=Math.min(v,t-h);return new r({x:f,y:h,width:g,height:y}).floor()},r.prototype.shift=function(n,t){var e=this,a=e.width,o=e.height,l=this.x+n,s=this.y+t;return new r({x:l,y:s,width:a,height:o})},r.prototype.padAtBorders=function(n,t){var e=this.width+1,a=this.height+1,o=1,l=1,s=e,f=a,h=this.left,p=this.top,v=this.right,g=this.bottom;return v>t&&(s=-v+t+e,v=t),g>n&&(f=-g+n+a,g=n),h<1&&(f=2-h,h=1),p<1&&(f=2-p,p=1),{dy:l,edy:f,dx:o,edx:s,y:p,ey:g,x:h,ex:v,w:e,h:a}},r.prototype.calibrate=function(n){return new r({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},r}(),uc=function(r){It(n,r);function n(t,e,a,o,l){return l===void 0&&(l=!1),r.call(this,{left:t,top:e,right:a,bottom:o},l)||this}return n}(Or),yb=function(){function r(n,t,e,a,o){this._imageDims=new pi(o.width,o.height),this._score=n,this._classScore=t,this._className=e,this._box=new Or(a).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Or(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:t})},r}(),Gn=function(r){It(n,r);function n(t,e,a){return r.call(this,t,t,"",e,a)||this}return n.prototype.forSize=function(t,e){var a=r.prototype.forSize.call(this,t,e),o=a.score,l=a.relativeBox,s=a.imageDims;return new n(o,l,s)},n}(yb);function cT(r,n,t){t===void 0&&(t=!0);var e=Math.max(0,Math.min(r.right,n.right)-Math.max(r.left,n.left)),a=Math.max(0,Math.min(r.bottom,n.bottom)-Math.max(r.top,n.top)),o=e*a;return t?o/(r.area+n.area-o):o/Math.min(r.area,n.area)}function fT(r){var n=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),e=n.reduce(function(s,f){return f<s?f:s},1/0),a=t.reduce(function(s,f){return f<s?f:s},1/0),o=n.reduce(function(s,f){return s<f?f:s},0),l=t.reduce(function(s,f){return s<f?f:s},0);return new uc(e,a,o,l)}function Wu(r,n,t,e){e===void 0&&(e=!0);for(var a=n.map(function(s,f){return{score:s,boxIndex:f}}).sort(function(s,f){return s.score-f.score}).map(function(s){return s.boxIndex}),o=[],l=function(){var s=a.pop();o.push(s);for(var f=a,h=[],p=0;p<f.length;p++){var v=f[p],g=r[s],y=r[v];h.push(cT(g,y,e))}a=a.filter(function(x,w){return h[w]<=t})};a.length>0;)l();return o}function $u(r,n){return yt(function(){var t=n[0],e=n[1],a=n[2],o=Mr(Fu(r.shape.slice(0,3),[1]),t),l=Mr(Fu(r.shape.slice(0,3),[1]),e),s=Mr(Fu(r.shape.slice(0,3),[1]),a),f=Be([o,l,s],3);return ze(r,f)})}function hT(r,n){return n===void 0&&(n=!1),yt(function(){var t=r.shape.slice(1),e=t[0],a=t[1];if(e===a)return r;var o=Math.abs(e-a),l=Math.round(o*(n?.5:1)),s=e>a?2:1,f=function(y){var x=r.shape.slice();return x[s]=y,Mr(x,0)},h=f(l),p=o-h.shape[s],v=n&&p?f(p):null,g=[v,r,h].filter(function(y){return!!y}).map(function(y){return y.toFloat()});return Be(g,s)})}function nd(r){return 1/(1+Math.exp(-r))}var sp=function(r){It(n,r);function n(t,e,a,o,l){return l===void 0&&(l=!1),r.call(this,{x:t,y:e,width:a,height:o},l)||this}return n}(Or),dT=.5,pT=.43,vT=.45,Ao=function(){function r(n,t,e){e===void 0&&(e=new Jt(0,0));var a=t.width,o=t.height;this._imgDims=new pi(a,o),this._shift=e,this._positions=n.map(function(l){return l.mul(new Jt(a,o)).add(e)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new Jt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(t){return t.sub(n._shift).div(new Jt(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,t){return new this.constructor(this.relativePositions,{width:n,height:t})},r.prototype.shiftBy=function(n,t){return new this.constructor(this.relativePositions,this._imgDims,new Jt(n,t))},r.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},r.prototype.align=function(n,t){if(t===void 0&&(t={}),n){var e=n instanceof Gn?n.box.floor():new Or(n);return this.shiftBy(e.x,e.y).align(null,t)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=a.useDlibAlignment,l=a.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(l)},r.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[0],e=n[1],a=n[2],o=function(v){return a.sub(v).magnitude()},l=(o(t)+o(e))/2,s=Math.floor(l/vT),f=up(n),h=Math.floor(Math.max(0,f.x-dT*s)),p=Math.floor(Math.max(0,f.y-pT*s));return new sp(h,p,Math.min(s,this.imageWidth+h),Math.min(s,this.imageHeight+p))},r.prototype.alignMinBbox=function(n){var t=fT(this.positions);return t.pad(t.width*n,t.height*n)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}(),mT=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],up([t[3],t[4]])]},n}(Ao),bb=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(up)},n}(Ao),T0=function(){function r(n,t){this._label=n,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+gb(this.distance)+")":"")},r}(),D0=function(r){It(n,r);function n(t,e){var a=r.call(this,t)||this;return a._label=e,a}return n.assertIsValidLabeledBox=function(t,e){if(Or.assertIsValidBox(t,e),!vi(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(Or),Ou=function(){function r(n,t){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},r.fromJSON=function(n){var t=n.descriptors.map(function(e){return new Float32Array(e)});return new r(n.label,t)},r}();(function(r){It(n,r);function n(t,e,a,o){var l=r.call(this,t,e)||this;return l._score=a,l._classScore=o,l}return n.assertIsValidPredictedBox=function(t,e){if(D0.assertIsValidLabeledBox(t,e),!A0(t.score)||!A0(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n})(D0);function jl(r){return r.detection instanceof Gn}function Gu(r,n){var t={detection:n};return Object.assign({},r,t)}function xb(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:n}}function wb(r){var n="";if(!r)try{r=require("fs")}catch(e){n=e.toString()}var t=r?function(e){return new Promise(function(a,o){r.readFile(e,function(l,s){return l?o(l):a(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:t}}function _b(){var r=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},e=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=wb();return sn({Canvas:r||function(){function l(){}return l}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function l(){}return l}(),Image:n||function(){function l(){}return l}(),ImageData:global.ImageData||function(){function l(){}return l}(),Video:global.HTMLVideoElement||function(){function l(){}return l}(),createCanvasElement:t,createImageElement:e,fetch:a},o)}function Eb(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Cb(){return typeof global=="object"&&typeof require=="function"&&typeof ix<"u"&&typeof process<"u"&&!!process.version}var Ie;function gT(){if(!Ie)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Ie}function Ad(r){Ie=r}function lp(){Eb()&&Ad(xb()),Cb()&&Ad(_b())}function yT(r){if(Ie||lp(),!Ie)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=r.Canvas,t=n===void 0?Ie.Canvas:n,e=r.Image,a=e===void 0?Ie.Image:e;Ie.Canvas=t,Ie.Image=a,Ie.createCanvasElement=r.createCanvasElement||function(){return new t},Ie.createImageElement=r.createImageElement||function(){return new a},Ie.ImageData=r.ImageData||Ie.ImageData,Ie.Video=r.Video||Ie.Video,Ie.fetch=r.fetch||Ie.fetch,Ie.readFile=r.readFile||Ie.readFile}var dn={getEnv:gT,setEnv:Ad,initialize:lp,createBrowserEnv:xb,createFileSystem:wb,createNodejsEnv:_b,monkeyPatch:yT,isBrowser:Eb,isNodejs:Cb};lp();function cp(r){return!dn.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function Ir(r){var n=dn.getEnv(),t=n.Canvas,e=n.CanvasRenderingContext2D;if(r instanceof e)return r;var a=cp(r);if(!(a instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=a.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var Ba;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Ba||(Ba={}));var Sb=function(){function r(n){n===void 0&&(n={});var t=n.anchorPosition,e=n.backgroundColor,a=n.fontColor,o=n.fontSize,l=n.fontStyle,s=n.padding;this.anchorPosition=t||Ba.TOP_LEFT,this.backgroundColor=e||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=l||"Georgia",this.padding=s||4}return r}(),bT=function(){function r(n,t,e){e===void 0&&(e={}),this.text=typeof n=="string"?[n]:n instanceof r?n.text:n,this.anchor=t,this.options=new Sb(e)}return r.prototype.measureWidth=function(n){var t=this.options.padding;return this.text.map(function(e){return n.measureText(e).width}).reduce(function(e,a){return e<a?a:e},0)+2*t},r.prototype.measureHeight=function(){var n=this.options,t=n.fontSize,e=n.padding;return this.text.length*t+2*e},r.prototype.getUpperLeft=function(n,t){var e=this.options.anchorPosition,a=e===Ba.BOTTOM_RIGHT||e===Ba.TOP_RIGHT,o=e===Ba.BOTTOM_LEFT||e===Ba.BOTTOM_RIGHT,l=this.measureWidth(n),s=this.measureHeight(),f=a?this.anchor.x-l:this.anchor.x,h=o?this.anchor.y-s:this.anchor.y;if(t){var p=t.width,v=t.height,g=Math.max(Math.min(f,p-l),0),y=Math.max(Math.min(h,v-s),0);return{x:g,y}}return{x:f,y:h}},r.prototype.draw=function(n){var t=cp(n),e=Ir(t),a=this.options,o=a.backgroundColor,l=a.fontColor,s=a.fontSize,f=a.fontStyle,h=a.padding;e.font=s+"px "+f;var p=this.measureWidth(e),v=this.measureHeight();e.fillStyle=o;var g=this.getUpperLeft(e,t);e.fillRect(g.x,g.y,p,v),e.fillStyle=l,this.text.forEach(function(y,x){var w=h+g.x,_=h+g.y+(x+1)*s;e.fillText(y,w,_)})},r}(),xT=function(){function r(n){n===void 0&&(n={});var t=n.boxColor,e=n.lineWidth,a=n.label,o=n.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=e||2,this.label=a;var l={anchorPosition:Ba.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Sb(Object.assign({},l,o))}return r}(),Rb=function(){function r(n,t){t===void 0&&(t={}),this.box=new Or(n),this.options=new xT(t)}return r.prototype.draw=function(n){var t=Ir(n),e=this.options,a=e.boxColor,o=e.lineWidth,l=this.box,s=l.x,f=l.y,h=l.width,p=l.height;t.strokeStyle=a,t.lineWidth=o,t.strokeRect(s,f,h,p);var v=this.options.label;v&&new bT([v],{x:s-o/2,y:f},this.options.drawLabelOptions).draw(n)},r}();function wT(r,n){var t=Array.isArray(n)?n:[n];t.forEach(function(e){var a=e instanceof Gn?e.score:jl(e)?e.detection.score:void 0,o=e instanceof Gn?e.box:jl(e)?e.detection.box:new Or(e),l=a?""+gb(a):void 0;new Rb(o,{label:l}).draw(r)})}function Ab(r){var n=dn.getEnv(),t=n.Image,e=n.Video;return r instanceof t&&r.complete||r instanceof e&&r.readyState>=3}function _T(r){return new Promise(function(n,t){if(r instanceof dn.getEnv().Canvas||Ab(r))return n();function e(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",e),o.currentTarget.removeEventListener("error",a),n(o))}function a(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",e),o.currentTarget.removeEventListener("error",a),t(o))}r.addEventListener("load",e),r.addEventListener("error",a)})}function fp(r){var n=dn.getEnv(),t=n.Image,e=n.Video;return r instanceof t?new pi(r.naturalWidth,r.naturalHeight):r instanceof e?new pi(r.videoWidth,r.videoHeight):new pi(r.width,r.height)}function sc(r){var n=r.width,t=r.height,e=dn.getEnv().createCanvasElement,a=e();return a.width=n,a.height=t,a}function hp(r,n){var t=dn.getEnv().ImageData;if(!(r instanceof t)&&!Ab(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var e=fp(r),a=e.width,o=e.height,l=sc({width:a,height:o});return r instanceof t?Ir(l).putImageData(r,0,0):Ir(l).drawImage(r,0,0,a,o),l}function ET(r,n){return St(this,void 0,void 0,function(){var t,e,a,o,l,s;return Rt(this,function(f){switch(f.label){case 0:return t=dn.getEnv().createCanvasElement(),e=r.shape.slice(za(r)?1:0),a=e[0],o=e[1],l=e[2],s=yt(function(){return r.as3D(a,o,l).toInt()}),[4,op.toPixels(s,t)];case 1:return f.sent(),s.dispose(),[2,t]}})})}function N0(r){var n=dn.getEnv(),t=n.Image,e=n.Canvas,a=n.Video;return r instanceof t||r instanceof e||r instanceof a}function CT(r,n,t){t===void 0&&(t=!1);var e=dn.getEnv(),a=e.Image,o=e.Canvas;if(!(r instanceof a||r instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var l=fp(r),s=n/Math.max(l.height,l.width),f=s*l.width,h=s*l.height,p=sc({width:n,height:n}),v=r instanceof o?r:hp(r),g=Math.abs(f-h)/2,y=t&&f<h?g:0,x=t&&h<f?g:0;return Ir(p).drawImage(v,y,x,f,h),p}var Xl=function(){function r(n,t){var e=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=t,this._batchSize=n.length,n.forEach(function(a,o){if(oc(a)){e._imageTensors[o]=a,e._inputDimensions[o]=a.shape;return}if(za(a)){var l=a.shape[0];if(l!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+l+" passed, but not supported in input array");e._imageTensors[o]=a,e._inputDimensions[o]=a.shape.slice(1);return}var s=a instanceof dn.getEnv().Canvas?a:hp(a);e._canvases[o]=s,e._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Vu(this.batchSize,0,1).map(function(t,e){return n.getReshapedInputDimensions(e)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},r.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},r.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},r.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},r.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(n),e=this.getInputHeight(n);return lT({width:t,height:e},this.inputSize)},r.prototype.toBatchTensor=function(n,t){var e=this;return t===void 0&&(t=!0),this._inputSize=n,yt(function(){var a=Vu(e.batchSize,0,1).map(function(l){var s=e.getInput(l);if(s instanceof ye){var f=za(s)?s:s.expandDims();return f=hT(f,t),(f.shape[1]!==n||f.shape[2]!==n)&&(f=tp.resizeBilinear(f,[n,n])),f.as3D(n,n,3)}if(s instanceof dn.getEnv().Canvas)return op.fromPixels(CT(s,n,t));throw new Error("toBatchTensor - at batchIdx "+l+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=Wn(a.map(function(l){return l.toFloat()})).as4D(e.batchSize,n,n,3);return o})},r}();function Qe(r){return St(this,void 0,void 0,function(){var n,t,e;return Rt(this,function(a){switch(a.label){case 0:if(r instanceof Xl)return[2,r];if(n=Array.isArray(r)?r:[r],!n.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(r)?" at input index "+o+":":""},e=n.map(cp),e.forEach(function(o,l){if(!N0(o)&&!oc(o)&&!za(o))throw typeof n[l]=="string"?new Error("toNetInput -"+t(l)+" string passed, but could not resolve HTMLElement for element id "+n[l]):new Error("toNetInput -"+t(l)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(za(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(l)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(e.map(function(o){return N0(o)&&_T(o)}))];case 1:return a.sent(),[2,new Xl(e,Array.isArray(r))]}})})}function dp(r,n){return St(this,void 0,void 0,function(){var t,e,a,o,l,s,f;return Rt(this,function(h){switch(h.label){case 0:return t=dn.getEnv().Canvas,e=r,r instanceof t?[3,5]:[4,Qe(r)];case 1:if(a=h.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=a.getInput(0),o instanceof t?(l=o,[3,4]):[3,2];case 2:return[4,ET(o)];case 3:l=h.sent(),h.label=4;case 4:e=l,h.label=5;case 5:return s=Ir(e),f=n.map(function(p){return p instanceof Gn?p.forSize(e.width,e.height).box.floor():p}).map(function(p){return p.clipAtImageBorders(e.width,e.height)}),[2,f.map(function(p){var v=p.x,g=p.y,y=p.width,x=p.height,w=sc({width:y,height:x});return Ir(w).putImageData(s.getImageData(v,g,y,x),0,0),w})]}})})}function pp(r,n){return St(this,void 0,void 0,function(){return Rt(this,function(t){if(!oc(r)&&!za(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(za(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,yt(function(){var e=r.shape.slice(za(r)?1:0),a=e[0],o=e[1],l=e[2],s=n.map(function(h){return h instanceof Gn?h.forSize(o,a).box:h}).map(function(h){return h.clipAtImageBorders(o,a)}),f=s.map(function(h){var p=h.x,v=h.y,g=h.width,y=h.height;return J1(r.as3D(a,o,l),[v,p,0],[y,g,l])});return f})]})})}function ST(r,n){return St(this,void 0,void 0,function(){var t,e;return Rt(this,function(a){switch(a.label){case 0:return t=dn.getEnv().fetch,[4,t(r,n)];case 1:if(e=a.sent(),!(e.status<400))throw new Error("failed to fetch: ("+e.status+") "+e.statusText+", from url: "+e.url);return[2,e]}})})}function RT(r){return St(this,void 0,void 0,function(){return Rt(this,function(n){switch(n.label){case 0:return[4,ST(r)];case 1:return[2,n.sent().json()]}})})}function Tb(r,n){var t=n+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var e=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(e,"");var a=r.split("/").filter(function(s){return s}),o=r.endsWith(".json")?a[a.length-1]:t,l=e+(r.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return l=r.startsWith("/")?"/"+l:l,{modelBaseUri:l,manifestUri:l==="/"?"/"+o:l+"/"+o}}function AT(r,n){return St(this,void 0,void 0,function(){var t,e,a,o;return Rt(this,function(l){switch(l.label){case 0:return t=Tb(r,n),e=t.manifestUri,a=t.modelBaseUri,[4,RT(e)];case 1:return o=l.sent(),[2,vb.loadWeights(o,a)]}})})}function TT(r,n,t){t===void 0&&(t=!1);var e=t?fp(n):n,a=e.width,o=e.height;return r.width=a,r.height=o,{width:a,height:o}}var ia=function(){function r(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(n){var t=this.traversePropertyPath(n),e=t.obj,a=t.objProp;return e[a]},r.prototype.reassignParamFromPath=function(n,t){var e=this.traversePropertyPath(n),a=e.obj,o=e.objProp;a[o].dispose(),a[o]=t},r.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(t){var e=t.paramPath;return{path:e,tensor:n.getParamFromPath(e)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Co})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Co)})},r.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(t){var e=t.path,a=t.tensor;n.reassignParamFromPath(e,a.variable())})},r.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(t){var e=t.path,a=t.tensor,o=nn(a.dataSync());a.dispose(),n.reassignParamFromPath(e,o)})},r.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(t){if(n&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var t=n.tensor;return Array.from(t.dataSync())}).reduce(function(n,t){return n.concat(t)}))},r.prototype.load=function(n){return St(this,void 0,void 0,function(){return Rt(this,function(t){switch(t.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(n){return St(this,void 0,void 0,function(){var t;return Rt(this,function(e){switch(e.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,AT(n,this.getDefaultModelName())];case 1:return t=e.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(n){return St(this,void 0,void 0,function(){var t,e,a,o,l,s,f,h,p,v;return Rt(this,function(g){switch(g.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=dn.getEnv().readFile,e=Tb(n,this.getDefaultModelName()),a=e.manifestUri,o=e.modelBaseUri,l=function(y){return Promise.all(y.map(function(x){return t(x).then(function(w){return w.buffer})}))},s=vb.weightsLoaderFactory(l),p=(h=JSON).parse,[4,t(a)];case 1:return f=p.apply(h,[g.sent().toString()]),[4,s(f,o)];case 2:return v=g.sent(),this.loadFromWeightMap(v),[2]}})})},r.prototype.loadFromWeightMap=function(n){var t=this.extractParamsFromWeigthMap(n),e=t.paramMappings,a=t.params;this._paramMappings=e,this._params=a},r.prototype.extractWeights=function(n){var t=this.extractParams(n),e=t.paramMappings,a=t.params;this._paramMappings=e,this._params=a},r.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=n.split("/").reduce(function(o,l){if(!o.nextObj.hasOwnProperty(l))throw new Error("traversePropertyPath - object does not have property "+l+", for path "+n);return{obj:o.nextObj,objProp:l,nextObj:o.nextObj[l]}},{nextObj:this.params}),e=t.obj,a=t.objProp;if(!e||!a||!(e[a]instanceof ye))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:e,objProp:a}},r}();function Vn(r,n,t){return yt(function(){var e=Yd(r,n.depthwise_filter,n.pointwise_filter,t,"same");return e=Vt(e,n.bias),e})}function rd(r,n,t){return t===void 0&&(t=!1),yt(function(){var e=be(t?Vt(or(r,n.conv0.filters,[2,2],"same"),n.conv0.bias):Vn(r,n.conv0,[2,2])),a=Vn(e,n.conv1,[1,1]),o=be(Vt(e,a)),l=Vn(o,n.conv2,[1,1]);return be(Vt(e,Vt(a,l)))})}function wl(r,n,t,e){return t===void 0&&(t=!1),e===void 0&&(e=!0),yt(function(){var a=be(t?Vt(or(r,n.conv0.filters,e?[2,2]:[1,1],"same"),n.conv0.bias):Vn(r,n.conv0,e?[2,2]:[1,1])),o=Vn(a,n.conv1,[1,1]),l=be(Vt(a,o)),s=Vn(l,n.conv2,[1,1]),f=be(Vt(a,Vt(o,s))),h=Vn(f,n.conv3,[1,1]);return be(Vt(a,Vt(o,Vt(s,h))))})}function hr(r,n,t,e){return t===void 0&&(t="same"),e===void 0&&(e=!1),yt(function(){var a=Vt(or(r,n.filters,[1,1],t),n.bias);return e?be(a):a})}function oa(r,n){Object.keys(r).forEach(function(t){n.some(function(e){return e.originalPath===t})||r[t].dispose()})}function lc(r,n){return function(t,e,a,o){var l=Cn(r(t*e*a*a),[a,a,t,e]),s=Me(r(e));return n.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:l,bias:s}}}function vp(r,n){return function(t,e,a){var o=Fa(r(t*e),[t,e]),l=Me(r(e));return n.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:o,bias:l}}}var Db=function(){function r(n,t,e){this.depthwise_filter=n,this.pointwise_filter=t,this.bias=e}return r}();function mp(r,n){return function(t,e,a){var o=Cn(r(9*t),[3,3,t,1]),l=Cn(r(t*e),[1,1,t,e]),s=Me(r(e));return n.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Db(o,l,s)}}function gp(r){return function(n){var t=r(n+"/depthwise_filter",4),e=r(n+"/pointwise_filter",4),a=r(n+"/bias",1);return new Db(t,e,a)}}function Wa(r,n){return function(t,e,a){var o=r[t];if(!ic(o,e))throw new Error("expected weightMap["+t+"] to be a Tensor"+e+"D, instead have "+o);return n.push({originalPath:t,paramPath:a||t}),o}}function ua(r){var n=r;function t(a){var o=n.slice(0,a);return n=n.slice(a),o}function e(){return n}return{extractWeights:t,getRemainingWeights:e}}function Nb(r,n){var t=lc(r,n),e=mp(r,n);function a(l,s,f,h){h===void 0&&(h=!1);var p=h?t(l,s,3,f+"/conv0"):e(l,s,f+"/conv0"),v=e(s,s,f+"/conv1"),g=e(s,s,f+"/conv2");return{conv0:p,conv1:v,conv2:g}}function o(l,s,f,h){h===void 0&&(h=!1);var p=a(l,s,f,h),v=p.conv0,g=p.conv1,y=p.conv2,x=e(s,s,f+"/conv3");return{conv0:v,conv1:g,conv2:y,conv3:x}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function DT(r){var n=[],t=ua(r),e=t.extractWeights,a=t.getRemainingWeights,o=Nb(e,n).extractDenseBlock4Params,l=o(3,32,"dense0",!0),s=o(32,64,"dense1"),f=o(64,128,"dense2"),h=o(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:l,dense1:s,dense2:f,dense3:h}}}function Mb(r){return function(n){var t=r(n+"/filters",4),e=r(n+"/bias",1);return{filters:t,bias:e}}}function kb(r,n){var t=Wa(r,n),e=Mb(t),a=gp(t);function o(s,f){f===void 0&&(f=!1);var h=f?e(s+"/conv0"):a(s+"/conv0"),p=a(s+"/conv1"),v=a(s+"/conv2");return{conv0:h,conv1:p,conv2:v}}function l(s,f){f===void 0&&(f=!1);var h=f?e(s+"/conv0"):a(s+"/conv0"),p=a(s+"/conv1"),v=a(s+"/conv2"),g=a(s+"/conv3");return{conv0:h,conv1:p,conv2:v,conv3:g}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:l}}function NT(r){var n=[],t=kb(r,n).extractDenseBlock4Params,e={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return oa(r,n),{params:e,paramMappings:n}}var Ob=function(r){It(n,r);function n(){return r.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return yt(function(){var a=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],l=$u(a,o).div(vt(255)),s=wl(l,e.dense0,!0);return s=wl(s,e.dense1),s=wl(s,e.dense2),s=wl(s,e.dense3),s=Zu(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(t){return NT(t)},n.prototype.extractParams=function(t){return DT(t)},n}(ia);function Tr(r,n){return yt(function(){return Vt(nc(r,n.weights),n.bias)})}function MT(r,n,t){var e=[],a=ua(r),o=a.extractWeights,l=a.getRemainingWeights,s=vp(o,e),f=s(n,t,"fc");if(l().length!==0)throw new Error("weights remaing after extract: "+l().length);return{paramMappings:e,params:{fc:f}}}function kT(r){var n=[],t=Wa(r,n);function e(o){var l=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:l,bias:s}}var a={fc:e("fc")};return oa(r,n),{params:a,paramMappings:n}}function Ib(r){var n={},t={};return Object.keys(r).forEach(function(e){var a=e.startsWith("fc")?t:n;a[e]=r[e]}),{featureExtractorMap:n,classifierMap:t}}var Bb=function(r){It(n,r);function n(t,e){var a=r.call(this,t)||this;return a._faceFeatureExtractor=e,a}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var e=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return yt(function(){var o=t instanceof Xl?e.faceFeatureExtractor.forwardInput(t):t;return Tr(o.as2D(o.shape[0],-1),a.fc)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),a=e.params,o=e.paramMappings;this._params=a,this._paramMappings=o},n.prototype.extractClassifierParams=function(t){return MT(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(t){var e=Ib(t),a=e.featureExtractorMap,o=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),kT(o)},n.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),o=a*e+a,l=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(l),this.extractClassifierParams(s)},n}(ia),M0=["neutral","happy","sad","angry","fearful","disgusted","surprised"],OT=function(){function r(n){var t=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);M0.forEach(function(e,a){t[e]=n[a]})}return r.prototype.asSortedArray=function(){var n=this;return M0.map(function(t){return{expression:t,probability:n[t]}}).sort(function(t,e){return e.probability-t.probability})},r}(),IT=function(r){It(n,r);function n(t){return t===void 0&&(t=new Ob),r.call(this,"FaceExpressionNet",t)||this}return n.prototype.forwardInput=function(t){var e=this;return yt(function(){return ra(e.runNet(t))})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.predictExpressions=function(t){return St(this,void 0,void 0,function(){var e,a,o,l,s=this;return Rt(this,function(f){switch(f.label){case 0:return[4,Qe(t)];case 1:return e=f.sent(),[4,this.forwardInput(e)];case 2:return a=f.sent(),[4,Promise.all(Fe(a).map(function(h){return St(s,void 0,void 0,function(){var p;return Rt(this,function(v){switch(v.label){case 0:return[4,h.data()];case 1:return p=v.sent(),h.dispose(),[2,p]}})})}))];case 3:return o=f.sent(),a.dispose(),l=o.map(function(h){return new OT(h)}),[2,e.isBatchInput?l:l[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(Bb);function Fb(r,n){var t={expressions:n};return Object.assign({},r,t)}function yp(r){return jl(r)&&r.landmarks instanceof Ao&&r.unshiftedLandmarks instanceof Ao&&r.alignedRect instanceof Gn}function cc(r,n){var t=r.detection.box,e=n.shiftBy(t.x,t.y),a=e.align(),o=r.detection.imageDims,l=new Gn(r.detection.score,a.rescale(o.reverse()),o),s={landmarks:e,unshiftedLandmarks:n,alignedRect:l};return Object.assign({},r,s)}var BT=function(){function r(n){n===void 0&&(n={});var t=n.drawLines,e=t===void 0?!0:t,a=n.drawPoints,o=a===void 0?!0:a,l=n.lineWidth,s=n.lineColor,f=n.pointSize,h=n.pointColor;this.drawLines=e,this.drawPoints=o,this.lineWidth=l||1,this.pointSize=f||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=h||"rgba(255, 0, 255, 1)"}return r}(),FT=function(){function r(n,t){t===void 0&&(t={}),this.faceLandmarks=n,this.options=new BT(t)}return r.prototype.draw=function(n){var t=Ir(n),e=this.options,a=e.drawLines,o=e.drawPoints,l=e.lineWidth,s=e.lineColor,f=e.pointSize,h=e.pointColor;if(a&&this.faceLandmarks instanceof bb&&(t.strokeStyle=s,t.lineWidth=l,si(t,this.faceLandmarks.getJawOutline()),si(t,this.faceLandmarks.getLeftEyeBrow()),si(t,this.faceLandmarks.getRightEyeBrow()),si(t,this.faceLandmarks.getNose()),si(t,this.faceLandmarks.getLeftEye(),!0),si(t,this.faceLandmarks.getRightEye(),!0),si(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=h,t.fillStyle=h;var p=function(v){t.beginPath(),t.arc(v.x,v.y,f,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(p)}},r}();function LT(r,n){var t=Array.isArray(n)?n:[n];t.forEach(function(e){var a=e instanceof Ao?e:yp(e)?e.landmarks:void 0;if(!a)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new FT(a).draw(r)})}function zT(r,n){var t=lc(r,n),e=mp(r,n);function a(l,s,f){var h=e(l,s,f+"/separable_conv0"),p=e(s,s,f+"/separable_conv1"),v=t(l,s,1,f+"/expansion_conv");return{separable_conv0:h,separable_conv1:p,expansion_conv:v}}function o(l,s){var f=e(l,l,s+"/separable_conv0"),h=e(l,l,s+"/separable_conv1"),p=e(l,l,s+"/separable_conv2");return{separable_conv0:f,separable_conv1:h,separable_conv2:p}}return{extractConvParams:t,extractSeparableConvParams:e,extractReductionBlockParams:a,extractMainBlockParams:o}}function PT(r,n){var t=[],e=ua(r),a=e.extractWeights,o=e.getRemainingWeights,l=zT(a,t),s=l.extractConvParams,f=l.extractSeparableConvParams,h=l.extractReductionBlockParams,p=l.extractMainBlockParams,v=s(3,32,3,"entry_flow/conv_in"),g=h(32,64,"entry_flow/reduction_block_0"),y=h(64,128,"entry_flow/reduction_block_1"),x={conv_in:v,reduction_block_0:g,reduction_block_1:y},w={};Vu(n,0,1).forEach(function(A){w["main_block_"+A]=p(128,"middle_flow/main_block_"+A)});var _=h(128,256,"exit_flow/reduction_block"),E=f(256,512,"exit_flow/separable_conv"),R={reduction_block:_,separable_conv:E};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:x,middle_flow:w,exit_flow:R}}}function UT(r,n){var t=Wa(r,n),e=Mb(t),a=gp(t);function o(s){var f=a(s+"/separable_conv0"),h=a(s+"/separable_conv1"),p=e(s+"/expansion_conv");return{separable_conv0:f,separable_conv1:h,expansion_conv:p}}function l(s){var f=a(s+"/separable_conv0"),h=a(s+"/separable_conv1"),p=a(s+"/separable_conv2");return{separable_conv0:f,separable_conv1:h,separable_conv2:p}}return{extractConvParams:e,extractSeparableConvParams:a,extractReductionBlockParams:o,extractMainBlockParams:l}}function HT(r,n){var t=[],e=UT(r,t),a=e.extractConvParams,o=e.extractSeparableConvParams,l=e.extractReductionBlockParams,s=e.extractMainBlockParams,f=a("entry_flow/conv_in"),h=l("entry_flow/reduction_block_0"),p=l("entry_flow/reduction_block_1"),v={conv_in:f,reduction_block_0:h,reduction_block_1:p},g={};Vu(n,0,1).forEach(function(_){g["main_block_"+_]=s("middle_flow/main_block_"+_)});var y=l("exit_flow/reduction_block"),x=o("exit_flow/separable_conv"),w={reduction_block:y,separable_conv:x};return oa(r,t),{params:{entry_flow:v,middle_flow:g,exit_flow:w},paramMappings:t}}function Lb(r,n,t){return Vt(or(r,n.filters,t,"same"),n.bias)}function ad(r,n,t){t===void 0&&(t=!0);var e=t?be(r):r;return e=Vn(e,n.separable_conv0,[1,1]),e=Vn(be(e),n.separable_conv1,[1,1]),e=Ke(e,[3,3],[2,2],"same"),e=Vt(e,Lb(r,n.expansion_conv,[2,2])),e}function VT(r,n){var t=Vn(be(r),n.separable_conv0,[1,1]);return t=Vn(be(t),n.separable_conv1,[1,1]),t=Vn(be(t),n.separable_conv2,[1,1]),t=Vt(t,r),t}var WT=function(r){It(n,r);function n(t){var e=r.call(this,"TinyXception")||this;return e._numMainBlocks=t,e}return n.prototype.forwardInput=function(t){var e=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return yt(function(){var o=t.toBatchTensor(112,!0),l=[122.782,117.001,104.298],s=$u(o,l).div(vt(256)),f=be(Lb(s,a.entry_flow.conv_in,[2,2]));return f=ad(f,a.entry_flow.reduction_block_0,!1),f=ad(f,a.entry_flow.reduction_block_1),Vu(e._numMainBlocks,0,1).forEach(function(h){f=VT(f,a.middle_flow["main_block_"+h])}),f=ad(f,a.exit_flow.reduction_block),f=be(Vn(f,a.exit_flow.separable_conv,[1,1])),f})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(t){return HT(t,this._numMainBlocks)},n.prototype.extractParams=function(t){return PT(t,this._numMainBlocks)},n}(ia);function GT(r){var n=[],t=ua(r),e=t.extractWeights,a=t.getRemainingWeights,o=vp(e,n),l=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:{age:l,gender:s}}}}function qT(r){var n=[],t=Wa(r,n);function e(o){var l=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:l,bias:s}}var a={fc:{age:e("fc/age"),gender:e("fc/gender")}};return oa(r,n),{params:a,paramMappings:n}}var Kl;(function(r){r.FEMALE="female",r.MALE="male"})(Kl||(Kl={}));var jT=function(r){It(n,r);function n(t){t===void 0&&(t=new WT(2));var e=r.call(this,"AgeGenderNet")||this;return e._faceFeatureExtractor=t,e}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var e=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return yt(function(){var o=t instanceof Xl?e.faceFeatureExtractor.forwardInput(t):t,l=Zu(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=Tr(l,a.fc.age).as1D(),f=Tr(l,a.fc.gender);return{age:s,gender:f}})},n.prototype.forwardInput=function(t){var e=this;return yt(function(){var a=e.runNet(t),o=a.age,l=a.gender;return{age:o,gender:ra(l)}})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.predictAgeAndGender=function(t){return St(this,void 0,void 0,function(){var e,a,o,l,s,f,h=this;return Rt(this,function(p){switch(p.label){case 0:return[4,Qe(t)];case 1:return e=p.sent(),[4,this.forwardInput(e)];case 2:return a=p.sent(),o=Fe(a.age),l=Fe(a.gender),s=o.map(function(v,g){return{ageTensor:v,genderTensor:l[g]}}),[4,Promise.all(s.map(function(v){var g=v.ageTensor,y=v.genderTensor;return St(h,void 0,void 0,function(){var x,w,_,E,R;return Rt(this,function(A){switch(A.label){case 0:return[4,g.data()];case 1:return x=A.sent()[0],[4,y.data()];case 2:return w=A.sent()[0],_=w>.5,E=_?Kl.MALE:Kl.FEMALE,R=_?w:1-w,g.dispose(),y.dispose(),[2,{age:x,gender:E,genderProbability:R}]}})})}))];case 3:return f=p.sent(),a.age.dispose(),a.gender.dispose(),[2,e.isBatchInput?f:f[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),a=e.params,o=e.paramMappings;this._params=a,this._paramMappings=o},n.prototype.extractClassifierParams=function(t){return GT(t)},n.prototype.extractParamsFromWeigthMap=function(t){var e=Ib(t),a=e.featureExtractorMap,o=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),qT(o)},n.prototype.extractParams=function(t){var e=1539,a=t.slice(0,t.length-e),o=t.slice(t.length-e);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(o)},n}(ia),zb=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.postProcess=function(t,e,a){var o=a.map(function(s){var f=s.width,h=s.height,p=e/Math.max(h,f);return{width:f*p,height:h*p}}),l=o.length;return yt(function(){var s=function(g,y){return Wn([Mr([68],g),Mr([68],y)],1).as2D(1,136).as1D()},f=function(g,y){var x=o[g],w=x.width,_=x.height;return y(w,_)?Math.abs(w-_)/2:0},h=function(g){return f(g,function(y,x){return y<x})},p=function(g){return f(g,function(y,x){return x<y})},v=t.mul(Mr([l,136],e)).sub(Wn(Array.from(Array(l),function(g,y){return s(h(y),p(y))}))).div(Wn(Array.from(Array(l),function(g,y){return s(o[y].width,o[y].height)})));return v})},n.prototype.forwardInput=function(t){var e=this;return yt(function(){var a=e.runNet(t);return e.postProcess(a,t.inputSize,t.inputDimensions.map(function(o){var l=o[0],s=o[1];return{height:l,width:s}}))})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.detectLandmarks=function(t){return St(this,void 0,void 0,function(){var e,a,o,l=this;return Rt(this,function(s){switch(s.label){case 0:return[4,Qe(t)];case 1:return e=s.sent(),a=yt(function(){return Fe(l.forwardInput(e))}),[4,Promise.all(a.map(function(f,h){return St(l,void 0,void 0,function(){var p,v,g,y,x;return Rt(this,function(w){switch(w.label){case 0:return g=(v=Array).from,[4,f.data()];case 1:return p=g.apply(v,[w.sent()]),y=p.filter(function(_,E){return S0(E)}),x=p.filter(function(_,E){return!S0(E)}),[2,new bb(Array(68).fill(0).map(function(_,E){return new Jt(y[E],x[E])}),{height:e.getInputHeight(h),width:e.getInputWidth(h)})]}})})}))];case 2:return o=s.sent(),a.forEach(function(f){return f.dispose()}),[2,e.isBatchInput?o:o[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(Bb),Pb=function(r){It(n,r);function n(t){return t===void 0&&(t=new Ob),r.call(this,"FaceLandmark68Net",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(zb);function XT(r){var n=[],t=kb(r,n).extractDenseBlock3Params,e={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return oa(r,n),{params:e,paramMappings:n}}function KT(r){var n=[],t=ua(r),e=t.extractWeights,a=t.getRemainingWeights,o=Nb(e,n).extractDenseBlock3Params,l=o(3,32,"dense0",!0),s=o(32,64,"dense1"),f=o(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:l,dense1:s,dense2:f}}}var YT=function(r){It(n,r);function n(){return r.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return yt(function(){var a=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],l=$u(a,o).div(vt(255)),s=rd(l,e.dense0,!0);return s=rd(s,e.dense1),s=rd(s,e.dense2),s=Zu(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(t){return XT(t)},n.prototype.extractParams=function(t){return KT(t)},n}(ia),QT=function(r){It(n,r);function n(t){return t===void 0&&(t=new YT),r.call(this,"FaceLandmark68TinyNet",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(zb);(function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n})(Pb);function ZT(r,n){return Vt(fn(r,n.weights),n.biases)}function bp(r,n,t,e,a){a===void 0&&(a="same");var o=n.conv,l=o.filters,s=o.bias,f=or(r,l,t,a);return f=Vt(f,s),f=ZT(f,n.scale),e?be(f):f}function JT(r,n){return bp(r,n,[1,1],!0)}function Ub(r,n){return bp(r,n,[1,1],!1)}function Hb(r,n){return bp(r,n,[2,2],!0,"valid")}function $T(r,n){function t(s,f,h){var p=r(s),v=p.length/(f*h*h);if(sT(v))throw new Error("depth has to be an integer: "+v+", weights.length: "+p.length+", numFilters: "+f+", filterSize: "+h);return yt(function(){return Ua(Cn(p,[f,v,h,h]),[2,3,1,0])})}function e(s,f,h,p){var v=t(s,f,h),g=Me(r(f));return n.push({paramPath:p+"/filters"},{paramPath:p+"/bias"}),{filters:v,bias:g}}function a(s,f){var h=Me(r(s)),p=Me(r(s));return n.push({paramPath:f+"/weights"},{paramPath:f+"/biases"}),{weights:h,biases:p}}function o(s,f,h,p){var v=e(s,f,h,p+"/conv"),g=a(f,p+"/scale");return{conv:v,scale:g}}function l(s,f,h,p,v){v===void 0&&(v=!1);var g=o((v?.5:1)*s,f,h,p+"/conv1"),y=o(s,f,h,p+"/conv2");return{conv1:g,conv2:y}}return{extractConvLayerParams:o,extractResidualLayerParams:l}}function tD(r){var n=ua(r),t=n.extractWeights,e=n.getRemainingWeights,a=[],o=$T(t,a),l=o.extractConvLayerParams,s=o.extractResidualLayerParams,f=l(4704,32,7,"conv32_down"),h=s(9216,32,3,"conv32_1"),p=s(9216,32,3,"conv32_2"),v=s(9216,32,3,"conv32_3"),g=s(36864,64,3,"conv64_down",!0),y=s(36864,64,3,"conv64_1"),x=s(36864,64,3,"conv64_2"),w=s(36864,64,3,"conv64_3"),_=s(147456,128,3,"conv128_down",!0),E=s(147456,128,3,"conv128_1"),R=s(147456,128,3,"conv128_2"),A=s(589824,256,3,"conv256_down",!0),C=s(589824,256,3,"conv256_1"),T=s(589824,256,3,"conv256_2"),N=s(589824,256,3,"conv256_down_out"),L=yt(function(){return Ua(Fa(t(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),e().length!==0)throw new Error("weights remaing after extract: "+e().length);var B={conv32_down:f,conv32_1:h,conv32_2:p,conv32_3:v,conv64_down:g,conv64_1:y,conv64_2:x,conv64_3:w,conv128_down:_,conv128_1:E,conv128_2:R,conv256_down:A,conv256_1:C,conv256_2:T,conv256_down_out:N,fc:L};return{params:B,paramMappings:a}}function eD(r,n){var t=Wa(r,n);function e(l){var s=t(l+"/scale/weights",1),f=t(l+"/scale/biases",1);return{weights:s,biases:f}}function a(l){var s=t(l+"/conv/filters",4),f=t(l+"/conv/bias",1),h=e(l);return{conv:{filters:s,bias:f},scale:h}}function o(l){return{conv1:a(l+"/conv1"),conv2:a(l+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function nD(r){var n=[],t=eD(r,n),e=t.extractConvLayerParams,a=t.extractResidualLayerParams,o=e("conv32_down"),l=a("conv32_1"),s=a("conv32_2"),f=a("conv32_3"),h=a("conv64_down"),p=a("conv64_1"),v=a("conv64_2"),g=a("conv64_3"),y=a("conv128_down"),x=a("conv128_1"),w=a("conv128_2"),_=a("conv256_down"),E=a("conv256_1"),R=a("conv256_2"),A=a("conv256_down_out"),C=r.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!uT(C))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+C);var T={conv32_down:o,conv32_1:l,conv32_2:s,conv32_3:f,conv64_down:h,conv64_1:p,conv64_2:v,conv64_3:g,conv128_down:y,conv128_1:x,conv128_2:w,conv256_down:_,conv256_1:E,conv256_2:R,conv256_down_out:A,fc:C};return oa(r,n),{params:T,paramMappings:n}}function Er(r,n){var t=JT(r,n.conv1);return t=Ub(t,n.conv2),t=Vt(t,r),t=be(t),t}function _l(r,n){var t=Hb(r,n.conv1);t=Ub(t,n.conv2);var e=Zu(r,2,2,"valid"),a=pe(e.shape),o=e.shape[3]!==t.shape[3],l=e.shape[1]!==t.shape[1]||e.shape[2]!==t.shape[2];if(l){var s=Fu(t.shape);s[1]=1;var f=pe(s);t=Be([t,f],1);var h=Fu(t.shape);h[2]=1;var p=pe(h);t=Be([t,p],2)}return e=o?Be([e,a],3):e,t=Vt(e,t),t=be(t),t}var rD=function(r){It(n,r);function n(){return r.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return yt(function(){var a=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],l=$u(a,o).div(vt(256)),s=Hb(l,e.conv32_down);s=Ke(s,3,2,"valid"),s=Er(s,e.conv32_1),s=Er(s,e.conv32_2),s=Er(s,e.conv32_3),s=_l(s,e.conv64_down),s=Er(s,e.conv64_1),s=Er(s,e.conv64_2),s=Er(s,e.conv64_3),s=_l(s,e.conv128_down),s=Er(s,e.conv128_1),s=Er(s,e.conv128_2),s=_l(s,e.conv256_down),s=Er(s,e.conv256_1),s=Er(s,e.conv256_2),s=_l(s,e.conv256_down_out);var f=s.mean([1,2]),h=nc(f,e.fc);return h})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.computeFaceDescriptor=function(t){return St(this,void 0,void 0,function(){var e,a,o,l=this;return Rt(this,function(s){switch(s.label){case 0:return[4,Qe(t)];case 1:return e=s.sent(),a=yt(function(){return Fe(l.forwardInput(e))}),[4,Promise.all(a.map(function(f){return f.data()}))];case 2:return o=s.sent(),a.forEach(function(f){return f.dispose()}),[2,e.isBatchInput?o:o[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(t){return nD(t)},n.prototype.extractParams=function(t){return tD(t)},n}(ia);function Vb(r,n){var t={descriptor:n};return Object.assign({},r,t)}function Wb(r,n){var t={age:n};return Object.assign({},r,t)}function Gb(r,n,t){var e={gender:n,genderProbability:t};return Object.assign({},r,e)}var qb=function(){function r(n){var t=n===void 0?{}:n,e=t.minFaceSize,a=t.scaleFactor,o=t.maxNumScales,l=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=e||20,this._scaleFactor=a||.709,this._maxNumScales=o||10,this._scoreThresholds=l||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(f){return typeof f!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(f){return typeof f!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function aD(r,n){function t(f,h){var p=Cn(r(9*f),[3,3,f,1]),v=Me(r(f)),g=Me(r(f)),y=Me(r(f)),x=Me(r(f));return n.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:p,batch_norm_scale:v,batch_norm_offset:g,batch_norm_mean:y,batch_norm_variance:x}}function e(f,h,p,v,g){var y=Cn(r(f*h*p*p),[p,p,f,h]),x=Me(r(h));return n.push({paramPath:v+"/filters"},{paramPath:v+"/"+(g?"batch_norm_offset":"bias")}),{filters:y,bias:x}}function a(f,h,p,v){var g=e(f,h,p,v,!0),y=g.filters,x=g.bias;return{filters:y,batch_norm_offset:x}}function o(f,h,p){var v=t(f,p+"/depthwise_conv"),g=a(f,h,1,p+"/pointwise_conv");return{depthwise_conv:v,pointwise_conv:g}}function l(){var f=a(3,32,3,"mobilenetv1/conv_0"),h=o(32,64,"mobilenetv1/conv_1"),p=o(64,128,"mobilenetv1/conv_2"),v=o(128,128,"mobilenetv1/conv_3"),g=o(128,256,"mobilenetv1/conv_4"),y=o(256,256,"mobilenetv1/conv_5"),x=o(256,512,"mobilenetv1/conv_6"),w=o(512,512,"mobilenetv1/conv_7"),_=o(512,512,"mobilenetv1/conv_8"),E=o(512,512,"mobilenetv1/conv_9"),R=o(512,512,"mobilenetv1/conv_10"),A=o(512,512,"mobilenetv1/conv_11"),C=o(512,1024,"mobilenetv1/conv_12"),T=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:f,conv_1:h,conv_2:p,conv_3:v,conv_4:g,conv_5:y,conv_6:x,conv_7:w,conv_8:_,conv_9:E,conv_10:R,conv_11:A,conv_12:C,conv_13:T}}function s(){var f=a(1024,256,1,"prediction_layer/conv_0"),h=a(256,512,3,"prediction_layer/conv_1"),p=a(512,128,1,"prediction_layer/conv_2"),v=a(128,256,3,"prediction_layer/conv_3"),g=a(256,128,1,"prediction_layer/conv_4"),y=a(128,256,3,"prediction_layer/conv_5"),x=a(256,64,1,"prediction_layer/conv_6"),w=a(64,128,3,"prediction_layer/conv_7"),_=e(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),E=e(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),R=e(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),A=e(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),C=e(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),T=e(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),N=e(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),L=e(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),B=e(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=e(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),F=e(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),W=e(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),U={box_encoding_predictor:_,class_predictor:E},at={box_encoding_predictor:R,class_predictor:A},nt={box_encoding_predictor:C,class_predictor:T},tt={box_encoding_predictor:N,class_predictor:L},P={box_encoding_predictor:B,class_predictor:I},q={box_encoding_predictor:F,class_predictor:W};return{conv_0:f,conv_1:h,conv_2:p,conv_3:v,conv_4:g,conv_5:y,conv_6:x,conv_7:w,box_predictor_0:U,box_predictor_1:at,box_predictor_2:nt,box_predictor_3:tt,box_predictor_4:P,box_predictor_5:q}}return{extractMobilenetV1Params:l,extractPredictionLayerParams:s}}function iD(r){var n=[],t=ua(r),e=t.extractWeights,a=t.getRemainingWeights,o=aD(e,n),l=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,f=l(),h=s(),p=Id(e(5118*4),[1,5118,4]),v={extra_dim:p};if(n.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:f,prediction_layer:h,output_layer:v},paramMappings:n}}function oD(r,n){var t=Wa(r,n);function e(h,p,v){var g=t(h+"/Conv2d_"+p+"_pointwise/weights",4,v+"/filters"),y=t(h+"/Conv2d_"+p+"_pointwise/convolution_bn_offset",1,v+"/batch_norm_offset");return{filters:g,batch_norm_offset:y}}function a(h){var p="mobilenetv1/conv_"+h,v="MobilenetV1/Conv2d_"+h+"_depthwise",g=p+"/depthwise_conv",y=p+"/pointwise_conv",x=t(v+"/depthwise_weights",4,g+"/filters"),w=t(v+"/BatchNorm/gamma",1,g+"/batch_norm_scale"),_=t(v+"/BatchNorm/beta",1,g+"/batch_norm_offset"),E=t(v+"/BatchNorm/moving_mean",1,g+"/batch_norm_mean"),R=t(v+"/BatchNorm/moving_variance",1,g+"/batch_norm_variance");return{depthwise_conv:{filters:x,batch_norm_scale:w,batch_norm_offset:_,batch_norm_mean:E,batch_norm_variance:R},pointwise_conv:e("MobilenetV1",h,y)}}function o(){return{conv_0:e("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function l(h,p){var v=t(h+"/weights",4,p+"/filters"),g=t(h+"/biases",1,p+"/bias");return{filters:v,bias:g}}function s(h){var p=l("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),v=l("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:p,class_predictor:v}}function f(){return{conv_0:e("Prediction",0,"prediction_layer/conv_0"),conv_1:e("Prediction",1,"prediction_layer/conv_1"),conv_2:e("Prediction",2,"prediction_layer/conv_2"),conv_3:e("Prediction",3,"prediction_layer/conv_3"),conv_4:e("Prediction",4,"prediction_layer/conv_4"),conv_5:e("Prediction",5,"prediction_layer/conv_5"),conv_6:e("Prediction",6,"prediction_layer/conv_6"),conv_7:e("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:f}}function uD(r){var n=[],t=oD(r,n),e=t.extractMobilenetV1Params,a=t.extractPredictionLayerParams,o=r["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!oc(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var l={mobilenetv1:e(),prediction_layer:a(),output_layer:{extra_dim:o}};return oa(r,n),{params:l,paramMappings:n}}function Cr(r,n,t){return yt(function(){var e=or(r,n.filters,t,"same");return e=Vt(e,n.batch_norm_offset),qd(e,0,6)})}var sD=.0010000000474974513;function lD(r,n,t){return yt(function(){var e=ec(r,n.filters,t,"same");return e=L1(e,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,sD),qd(e,0,6)})}function cD(r){return[2,4,6,12].some(function(n){return n===r})?[2,2]:[1,1]}function fD(r,n){return yt(function(){var t=null,e=Cr(r,n.conv_0,[2,2]),a=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(a.forEach(function(o,l){var s=l+1,f=cD(s);e=lD(e,o.depthwise_conv,f),e=Cr(e,o.pointwise_conv,[1,1]),s===11&&(t=e)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:e,conv11:t}})}function hD(r,n,t,e,a){var o=r.shape[0],l=Math.min(t,o),s=n.map(function(p,v){return{score:p,boxIndex:v}}).filter(function(p){return p.score>a}).sort(function(p,v){return v.score-p.score}),f=function(p){return p<=e?1:0},h=[];return s.forEach(function(p){if(!(h.length>=l)){for(var v=p.score,g=h.length-1;g>=0;--g){var y=dD(r,p.boxIndex,h[g]);if(y!==0&&(p.score*=f(y),p.score<=a))break}v===p.score&&h.push(p.boxIndex)}}),h}function dD(r,n,t){var e=r.arraySync(),a=Math.min(e[n][0],e[n][2]),o=Math.min(e[n][1],e[n][3]),l=Math.max(e[n][0],e[n][2]),s=Math.max(e[n][1],e[n][3]),f=Math.min(e[t][0],e[t][2]),h=Math.min(e[t][1],e[t][3]),p=Math.max(e[t][0],e[t][2]),v=Math.max(e[t][1],e[t][3]),g=(l-a)*(s-o),y=(p-f)*(v-h);if(g<=0||y<=0)return 0;var x=Math.max(a,f),w=Math.max(o,h),_=Math.min(l,p),E=Math.min(s,v),R=Math.max(_-x,0)*Math.max(E-w,0);return R/(g+y-R)}function pD(r){var n=Fe(Ua(r,[1,0])),t=[ze(n[2],n[0]),ze(n[3],n[1])],e=[Vt(n[0],cr(t[0],vt(2))),Vt(n[1],cr(t[1],vt(2)))];return{sizes:t,centers:e}}function vD(r,n){var t=pD(r),e=t.sizes,a=t.centers,o=Fe(Ua(n,[1,0])),l=cr(fn(xd(cr(o[2],vt(5))),e[0]),vt(2)),s=Vt(fn(cr(o[0],vt(10)),e[0]),a[0]),f=cr(fn(xd(cr(o[3],vt(5))),e[1]),vt(2)),h=Vt(fn(cr(o[1],vt(10)),e[1]),a[1]);return Ua(Wn([ze(s,l),ze(h,f),Vt(s,l),Vt(h,f)]),[1,0])}function mD(r,n,t){return yt(function(){var e=r.shape[0],a=vD(fr(go(t.extra_dim,[e,1,1]),[-1,4]),fr(r,[-1,4]));a=fr(a,[e,a.shape[0]/e,4]);var o=O1(kr(n,[0,0,1],[-1,-1,-1])),l=kr(o,[0,0,0],[-1,-1,1]);l=fr(l,[e,l.shape[1]]);var s=Fe(a),f=Fe(l);return{boxes:s,scores:f}})}function co(r,n){return yt(function(){var t=r.shape[0],e=fr(hr(r,n.box_encoding_predictor),[t,-1,1,4]),a=fr(hr(r,n.class_predictor),[t,-1,3]);return{boxPredictionEncoding:e,classPrediction:a}})}function gD(r,n,t){return yt(function(){var e=Cr(r,t.conv_0,[1,1]),a=Cr(e,t.conv_1,[2,2]),o=Cr(a,t.conv_2,[1,1]),l=Cr(o,t.conv_3,[2,2]),s=Cr(l,t.conv_4,[1,1]),f=Cr(s,t.conv_5,[2,2]),h=Cr(f,t.conv_6,[1,1]),p=Cr(h,t.conv_7,[2,2]),v=co(n,t.box_predictor_0),g=co(r,t.box_predictor_1),y=co(a,t.box_predictor_2),x=co(l,t.box_predictor_3),w=co(f,t.box_predictor_4),_=co(p,t.box_predictor_5),E=Be([v.boxPredictionEncoding,g.boxPredictionEncoding,y.boxPredictionEncoding,x.boxPredictionEncoding,w.boxPredictionEncoding,_.boxPredictionEncoding],1),R=Be([v.classPrediction,g.classPrediction,y.classPrediction,x.classPrediction,w.classPrediction,_.classPrediction],1);return{boxPredictions:E,classPredictions:R}})}var Pa=function(){function r(n){var t=n===void 0?{}:n,e=t.minConfidence,a=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=e||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}(),jb=function(r){It(n,r);function n(){return r.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return yt(function(){var a=t.toBatchTensor(512,!1).toFloat(),o=ze(fn(a,vt(.007843137718737125)),vt(1)),l=fD(o,e.mobilenetv1),s=gD(l.out,l.conv11,e.prediction_layer),f=s.boxPredictions,h=s.classPredictions;return mD(f,h,e.output_layer)})},n.prototype.forward=function(t){return St(this,void 0,void 0,function(){var e;return Rt(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,Qe(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.locateFaces=function(t,e){return e===void 0&&(e={}),St(this,void 0,void 0,function(){var a,o,l,s,f,h,p,v,g,y,x,w,_,E,R,A,C,T,N,L,B;return Rt(this,function(I){switch(I.label){case 0:return a=new Pa(e),o=a.maxResults,l=a.minConfidence,[4,Qe(t)];case 1:for(s=I.sent(),f=this.forwardInput(s),h=f.boxes,p=f.scores,v=h[0],g=p[0],y=1;y<h.length;y++)h[y].dispose(),p[y].dispose();return _=(w=Array).from,[4,g.data()];case 2:return x=_.apply(w,[I.sent()]),E=.5,R=hD(v,x,o,E,l),A=s.getReshapedInputDimensions(0),C=s.inputSize,T=C/A.width,N=C/A.height,L=v.arraySync(),B=R.map(function(F){var W=[Math.max(0,L[F][0]),Math.min(1,L[F][2])].map(function(q){return q*N}),U=W[0],at=W[1],nt=[Math.max(0,L[F][1]),Math.min(1,L[F][3])].map(function(q){return q*T}),tt=nt[0],P=nt[1];return new Gn(x[F],new sp(tt,U,P-tt,at-U),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),v.dispose(),g.dispose(),[2,B]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(t){return uD(t)},n.prototype.extractParams=function(t){return iD(t)},n}(ia);(function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n})(jb);var yD=.4,bD=[new Jt(.738768,.874946),new Jt(2.42204,2.65704),new Jt(4.30971,7.04493),new Jt(10.246,4.59428),new Jt(12.6868,11.8741)],xD=[new Jt(1.603231,2.094468),new Jt(6.041143,7.080126),new Jt(2.882459,3.518061),new Jt(4.266906,5.178857),new Jt(9.041765,10.66308)],wD=[117.001,114.697,97.404],_D="tiny_yolov2_model",ED="tiny_yolov2_separable_conv_model",El=function(r){return typeof r=="number"};function CD(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!El(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(n){return n||{}}).every(function(n){return El(n.x)&&El(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(El)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function xp(r){return yt(function(){var n=fn(r,vt(.10000000149011612));return Vt(be(ze(r,n)),n)})}function Ma(r,n){return yt(function(){var t=yi(r,[[0,0],[1,1],[1,1],[0,0]]);return t=or(t,n.conv.filters,[1,1],"valid"),t=ze(t,n.bn.sub),t=fn(t,n.bn.truediv),t=Vt(t,n.conv.bias),xp(t)})}function ka(r,n){return yt(function(){var t=yi(r,[[0,0],[1,1],[1,1],[0,0]]);return t=Yd(t,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),t=Vt(t,n.bias),xp(t)})}function SD(r,n){var t=lc(r,n);function e(l,s){var f=Me(r(l)),h=Me(r(l));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:f,truediv:h}}function a(l,s,f){var h=t(l,s,3,f+"/conv"),p=e(s,f+"/bn");return{conv:h,bn:p}}var o=mp(r,n);return{extractConvParams:t,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function RD(r,n,t,e){var a=ua(r),o=a.extractWeights,l=a.getRemainingWeights,s=[],f=SD(o,s),h=f.extractConvParams,p=f.extractConvWithBatchNormParams,v=f.extractSeparableConvParams,g;if(n.withSeparableConvs){var y=e[0],x=e[1],w=e[2],_=e[3],E=e[4],R=e[5],A=e[6],C=e[7],T=e[8],N=n.isFirstLayerConv2d?h(y,x,3,"conv0"):v(y,x,"conv0"),L=v(x,w,"conv1"),B=v(w,_,"conv2"),I=v(_,E,"conv3"),F=v(E,R,"conv4"),W=v(R,A,"conv5"),U=C?v(A,C,"conv6"):void 0,at=T?v(C,T,"conv7"):void 0,nt=h(T||C||A,5*t,1,"conv8");g={conv0:N,conv1:L,conv2:B,conv3:I,conv4:F,conv5:W,conv6:U,conv7:at,conv8:nt}}else{var y=e[0],x=e[1],w=e[2],_=e[3],E=e[4],R=e[5],A=e[6],C=e[7],T=e[8],N=p(y,x,"conv0"),L=p(x,w,"conv1"),B=p(w,_,"conv2"),I=p(_,E,"conv3"),F=p(E,R,"conv4"),W=p(R,A,"conv5"),U=p(A,C,"conv6"),at=p(C,T,"conv7"),nt=h(T,5*t,1,"conv8");g={conv0:N,conv1:L,conv2:B,conv3:I,conv4:F,conv5:W,conv6:U,conv7:at,conv8:nt}}if(l().length!==0)throw new Error("weights remaing after extract: "+l().length);return{params:g,paramMappings:s}}function AD(r,n){var t=Wa(r,n);function e(s){var f=t(s+"/sub",1),h=t(s+"/truediv",1);return{sub:f,truediv:h}}function a(s){var f=t(s+"/filters",4),h=t(s+"/bias",1);return{filters:f,bias:h}}function o(s){var f=a(s+"/conv"),h=e(s+"/bn");return{conv:f,bn:h}}var l=gp(t);return{extractConvParams:a,extractConvWithBatchNormParams:o,extractSeparableConvParams:l}}function TD(r,n){var t=[],e=AD(r,t),a=e.extractConvParams,o=e.extractConvWithBatchNormParams,l=e.extractSeparableConvParams,s;if(n.withSeparableConvs){var f=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?a("conv0"):l("conv0"),conv1:l("conv1"),conv2:l("conv2"),conv3:l("conv3"),conv4:l("conv4"),conv5:l("conv5"),conv6:f>7?l("conv6"):void 0,conv7:f>8?l("conv7"):void 0,conv8:a("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return oa(r,t),{params:s,paramMappings:t}}var k0;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(k0||(k0={}));var wp=function(){function r(n){var t=n===void 0?{}:n,e=t.inputSize,a=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=e||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}(),Xb=function(r){It(n,r);function n(t){var e=r.call(this,"TinyYolov2")||this;return CD(t),e._config=t,e}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(t,e){var a=Ma(t,e.conv0);return a=Ke(a,[2,2],[2,2],"same"),a=Ma(a,e.conv1),a=Ke(a,[2,2],[2,2],"same"),a=Ma(a,e.conv2),a=Ke(a,[2,2],[2,2],"same"),a=Ma(a,e.conv3),a=Ke(a,[2,2],[2,2],"same"),a=Ma(a,e.conv4),a=Ke(a,[2,2],[2,2],"same"),a=Ma(a,e.conv5),a=Ke(a,[2,2],[1,1],"same"),a=Ma(a,e.conv6),a=Ma(a,e.conv7),hr(a,e.conv8,"valid",!1)},n.prototype.runMobilenet=function(t,e){var a=this.config.isFirstLayerConv2d?xp(hr(t,e.conv0,"valid",!1)):ka(t,e.conv0);return a=Ke(a,[2,2],[2,2],"same"),a=ka(a,e.conv1),a=Ke(a,[2,2],[2,2],"same"),a=ka(a,e.conv2),a=Ke(a,[2,2],[2,2],"same"),a=ka(a,e.conv3),a=Ke(a,[2,2],[2,2],"same"),a=ka(a,e.conv4),a=Ke(a,[2,2],[2,2],"same"),a=ka(a,e.conv5),a=Ke(a,[2,2],[1,1],"same"),a=e.conv6?ka(a,e.conv6):a,a=e.conv7?ka(a,e.conv7):a,hr(a,e.conv8,"valid",!1)},n.prototype.forwardInput=function(t,e){var a=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return yt(function(){var l=t.toBatchTensor(e,!1).toFloat();return l=a.config.meanRgb?$u(l,a.config.meanRgb):l,l=l.div(vt(256)),a.config.withSeparableConvs?a.runMobilenet(l,o):a.runTinyYolov2(l,o)})},n.prototype.forward=function(t,e){return St(this,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Qe(t)];case 1:return[4,a.apply(this,[o.sent(),e])];case 2:return[2,o.sent()]}})})},n.prototype.detect=function(t,e){return e===void 0&&(e={}),St(this,void 0,void 0,function(){var a,o,l,s,f,h,p,v,g,y,x,w,_,E,R=this;return Rt(this,function(A){switch(A.label){case 0:return a=new wp(e),o=a.inputSize,l=a.scoreThreshold,[4,Qe(t)];case 1:return s=A.sent(),[4,this.forwardInput(s,o)];case 2:return f=A.sent(),h=yt(function(){return Fe(f)[0].expandDims()}),p={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(h,s.getReshapedInputDimensions(0),l)];case 3:return v=A.sent(),f.dispose(),h.dispose(),g=v.map(function(C){return C.box}),y=v.map(function(C){return C.score}),x=v.map(function(C){return C.classScore}),w=v.map(function(C){return R.config.classes[C.label]}),_=Wu(g.map(function(C){return C.rescale(o)}),y,this.config.iouThreshold,!0),E=_.map(function(C){return new yb(y[C],x[C],w[C],g[C],p)}),[2,E]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(t){return TD(t,this.config)},n.prototype.extractParams=function(t){var e=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,a=e?e.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return RD(t,this.config,this.boxEncodingSize,e)},n.prototype.extractBoxes=function(t,e,a){return St(this,void 0,void 0,function(){var o,l,s,f,h,p,v,g,y,x,w,_,E,R,A,C,T,N,L,B,I,F,W,U,at,nt,tt,P,q,K=this;return Rt(this,function(rt){switch(rt.label){case 0:return o=e.width,l=e.height,s=Math.max(o,l),f=s/o,h=s/l,p=t.shape[1],v=this.config.anchors.length,g=yt(function(){var k=t.reshape([p,p,v,K.boxEncodingSize]),X=k.slice([0,0,0,0],[p,p,v,4]),it=k.slice([0,0,0,4],[p,p,v,1]),ot=K.withClassScores?ra(k.slice([0,0,0,5],[p,p,v,K.config.classes.length]),3):vt(0);return[X,it,ot]}),y=g[0],x=g[1],w=g[2],_=[],[4,x.array()];case 1:return E=rt.sent(),[4,y.array()];case 2:R=rt.sent(),A=0,rt.label=3;case 3:if(!(A<p))return[3,12];C=0,rt.label=4;case 4:if(!(C<p))return[3,11];T=0,rt.label=5;case 5:return T<v?(N=nd(E[A][C][T][0]),!a||N>a?(L=(C+nd(R[A][C][T][0]))/p*f,B=(A+nd(R[A][C][T][1]))/p*h,I=Math.exp(R[A][C][T][2])*this.config.anchors[T].x/p*f,F=Math.exp(R[A][C][T][3])*this.config.anchors[T].y/p*h,W=L-I/2,U=B-F/2,at={row:A,col:C,anchor:T},this.withClassScores?[4,this.extractPredictedClass(w,at)]:[3,7]):[3,9]):[3,10];case 6:return q=rt.sent(),[3,8];case 7:q={classScore:1,label:0},rt.label=8;case 8:nt=q,tt=nt.classScore,P=nt.label,_.push(sn({box:new uc(W,U,W+I,U+F),score:N,classScore:N*tt,label:P},at)),rt.label=9;case 9:return T++,[3,5];case 10:return C++,[3,4];case 11:return A++,[3,3];case 12:return y.dispose(),x.dispose(),w.dispose(),[2,_]}})})},n.prototype.extractPredictedClass=function(t,e){return St(this,void 0,void 0,function(){var a,o,l,s;return Rt(this,function(f){switch(f.label){case 0:return a=e.row,o=e.col,l=e.anchor,[4,t.array()];case 1:return s=f.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,p){return s[a][o][l][p]}).map(function(h,p){return{classScore:h,label:p}}).reduce(function(h,p){return h.classScore>p.classScore?h:p})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(ia),DD=function(r){It(n,r);function n(t){t===void 0&&(t=!0);var e=this,a=Object.assign({},{withSeparableConvs:t,iouThreshold:yD,classes:["face"]},t?{anchors:xD,meanRgb:wD}:{anchors:bD,withClassScores:!0});return e=r.call(this,a)||this,e}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,e){return St(this,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,e)];case 1:return a=o.sent(),[2,a.map(function(l){return new Gn(l.score,l.relativeBox,{width:l.imageWidth,height:l.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?ED:_D},n.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},n}(Xb),ND=function(r){It(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return n}(wp),ts=function(){function r(){}return r.prototype.then=function(n){return St(this,void 0,void 0,function(){var t;return Rt(this,function(e){switch(e.label){case 0:return t=n,[4,this.run()];case 1:return[2,t.apply(void 0,[e.sent()])]}})})},r.prototype.run=function(){return St(this,void 0,void 0,function(){return Rt(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},r}();function fc(r,n,t,e,a){return a===void 0&&(a=function(o){var l=o.alignedRect;return l}),St(this,void 0,void 0,function(){var o,l,s,f,h;return Rt(this,function(p){switch(p.label){case 0:return o=r.map(function(v){return yp(v)?a(v):v.detection}),s=e,s?[3,5]:n instanceof ye?[4,pp(n,o)]:[3,2];case 1:return f=p.sent(),[3,4];case 2:return[4,dp(n,o)];case 3:f=p.sent(),p.label=4;case 4:s=f,p.label=5;case 5:return l=s,[4,t(l)];case 6:return h=p.sent(),l.forEach(function(v){return v instanceof ye&&v.dispose()}),[2,h]}})})}function _p(r,n,t,e,a){return St(this,void 0,void 0,function(){var o=this;return Rt(this,function(l){return[2,fc([r],n,function(s){return St(o,void 0,void 0,function(){return Rt(this,function(f){return[2,t(s[0])]})})},e,a)]})})}function MD(r){return yt(function(){return Wn(Fe(r,3).reverse(),3)})}var Cl=2,Yl=12;function kD(r,n){var t=lc(r,n),e=vp(r,n);function a(h,p){var v=Me(r(h));return n.push({paramPath:p}),v}function o(h,p,v){v===void 0&&(v=!1);var g=t(h[0],h[1],3,p+"/conv1"),y=a(h[1],p+"/prelu1_alpha"),x=t(h[1],h[2],3,p+"/conv2"),w=a(h[2],p+"/prelu2_alpha"),_=t(h[2],h[3],v?2:3,p+"/conv3"),E=a(h[3],p+"/prelu3_alpha");return{conv1:g,prelu1_alpha:y,conv2:x,prelu2_alpha:w,conv3:_,prelu3_alpha:E}}function l(){var h=o([3,10,16,32],"pnet"),p=t(32,2,1,"pnet/conv4_1"),v=t(32,4,1,"pnet/conv4_2");return sn(sn({},h),{conv4_1:p,conv4_2:v})}function s(){var h=o([3,28,48,64],"rnet",!0),p=e(576,128,"rnet/fc1"),v=a(128,"rnet/prelu4_alpha"),g=e(128,2,"rnet/fc2_1"),y=e(128,4,"rnet/fc2_2");return sn(sn({},h),{fc1:p,prelu4_alpha:v,fc2_1:g,fc2_2:y})}function f(){var h=o([3,32,64,64],"onet"),p=t(64,128,2,"onet/conv4"),v=a(128,"onet/prelu4_alpha"),g=e(1152,256,"onet/fc1"),y=a(256,"onet/prelu5_alpha"),x=e(256,2,"onet/fc2_1"),w=e(256,4,"onet/fc2_2"),_=e(256,10,"onet/fc2_3");return sn(sn({},h),{conv4:p,prelu4_alpha:v,fc1:g,prelu5_alpha:y,fc2_1:x,fc2_2:w,fc2_3:_})}return{extractPNetParams:l,extractRNetParams:s,extractONetParams:f}}function OD(r){var n=ua(r),t=n.extractWeights,e=n.getRemainingWeights,a=[],o=kD(t,a),l=o.extractPNetParams,s=o.extractRNetParams,f=o.extractONetParams,h=l(),p=s(),v=f();if(e().length!==0)throw new Error("weights remaing after extract: "+e().length);return{params:{pnet:h,rnet:p,onet:v},paramMappings:a}}function ID(r,n){var t=Wa(r,n);function e(p){var v=t(p+"/weights",4,p+"/filters"),g=t(p+"/bias",1);return{filters:v,bias:g}}function a(p){var v=t(p+"/weights",2),g=t(p+"/bias",1);return{weights:v,bias:g}}function o(p){return t(p,1)}function l(p){var v=e(p+"/conv1"),g=o(p+"/prelu1_alpha"),y=e(p+"/conv2"),x=o(p+"/prelu2_alpha"),w=e(p+"/conv3"),_=o(p+"/prelu3_alpha");return{conv1:v,prelu1_alpha:g,conv2:y,prelu2_alpha:x,conv3:w,prelu3_alpha:_}}function s(){var p=l("pnet"),v=e("pnet/conv4_1"),g=e("pnet/conv4_2");return sn(sn({},p),{conv4_1:v,conv4_2:g})}function f(){var p=l("rnet"),v=a("rnet/fc1"),g=o("rnet/prelu4_alpha"),y=a("rnet/fc2_1"),x=a("rnet/fc2_2");return sn(sn({},p),{fc1:v,prelu4_alpha:g,fc2_1:y,fc2_2:x})}function h(){var p=l("onet"),v=e("onet/conv4"),g=o("onet/prelu4_alpha"),y=a("onet/fc1"),x=o("onet/prelu5_alpha"),w=a("onet/fc2_1"),_=a("onet/fc2_2"),E=a("onet/fc2_3");return sn(sn({},p),{conv4:v,prelu4_alpha:g,fc1:y,prelu5_alpha:x,fc2_1:w,fc2_2:_,fc2_3:E})}return{extractPNetParams:s,extractRNetParams:f,extractONetParams:h}}function BD(r){var n=[],t=ID(r,n),e=t.extractPNetParams,a=t.extractRNetParams,o=t.extractONetParams,l=e(),s=a(),f=o();return oa(r,n),{params:{pnet:l,rnet:s,onet:f},paramMappings:n}}function Td(r,n){var t=n[0],e=n[1];return{height:Math.floor(t*r),width:Math.floor(e*r)}}function FD(r,n,t){for(var e=t[0],a=t[1],o=Yl/r,l=[],s=Math.min(e,a)*o,f=0;s>=12;)l.push(o*Math.pow(n,f)),s=s*n,f+=1;return l}var Ep=function(r){It(n,r);function n(t,e,a,o){return r.call(this,{left:t,top:e,right:a,bottom:o},!0)||this}return n}(Or);function Kb(r){return yt(function(){return fn(ze(r,vt(127.5)),vt(.0078125))})}function _o(r,n){return yt(function(){return Vt(be(r),fn(n,Vl(be(Vl(r)))))})}function Cp(r,n,t){return t===void 0&&(t=!1),yt(function(){var e=hr(r,n.conv1,"valid");return e=_o(e,n.prelu1_alpha),e=Ke(e,t?[2,2]:[3,3],[2,2],"same"),e=hr(e,n.conv2,"valid"),e=_o(e,n.prelu2_alpha),e=t?e:Ke(e,[3,3],[2,2],"valid"),e=hr(e,n.conv3,"valid"),e=_o(e,n.prelu3_alpha),e})}function LD(r,n){return yt(function(){var t=Cp(r,n,!0),e=hr(t,n.conv4_1,"valid"),a=rr(rc(e,3),3),o=ra(ze(e,a),3),l=hr(t,n.conv4_2,"valid");return{prob:o,regions:l}})}function zD(r,n){return yt(function(){var t=Td(n,r.shape.slice(1)),e=t.height,a=t.width,o=tp.resizeBilinear(r,[e,a]),l=Kb(o);return Ua(l,[0,2,1,3])})}function PD(r,n,t,e){for(var a=[],o=r.arraySync(),l=0;l<r.shape[0];l++)for(var s=0;s<r.shape[1];s++)o[l][s]>=e&&a.push(new Jt(s,l));var f=a.map(function(h){var p=new uc(Math.round((h.y*Cl+1)/t),Math.round((h.x*Cl+1)/t),Math.round((h.y*Cl+Yl)/t),Math.round((h.x*Cl+Yl)/t)),v=o[h.y][h.x],g=n.arraySync(),y=new Ep(g[h.y][h.x][0],g[h.y][h.x][1],g[h.y][h.x][2],g[h.y][h.x][3]);return{cell:p,score:v,region:y}});return f}function UD(r,n,t,e,a){a.stage1=[];var o=n.map(function(g){return yt(function(){var y={scale:g},x=zD(r,g),w=Date.now(),_=LD(x,e),E=_.prob,R=_.regions;y.pnet=Date.now()-w;var A=Fe(Fe(E,3)[1])[0],C=Fe(R)[0];return{scoresTensor:A,regionsTensor:C,scale:g,statsForScale:y}})}),l=o.map(function(g){var y=g.scoresTensor,x=g.regionsTensor,w=g.scale,_=g.statsForScale,E=PD(y,x,w,t);if(y.dispose(),x.dispose(),!E.length)return a.stage1.push(_),[];var R=Date.now(),A=Wu(E.map(function(C){return C.cell}),E.map(function(C){return C.score}),.5);return _.nms=Date.now()-R,_.numBoxes=A.length,a.stage1.push(_),A.map(function(C){return E[C]})}),s=l.reduce(function(g,y){return g.concat(y)},[]),f=[],h=[];if(s.length>0){var p=Date.now(),v=Wu(s.map(function(g){return g.cell}),s.map(function(g){return g.score}),.7);a.stage1_nms=Date.now()-p,h=v.map(function(g){return s[g].score}),f=v.map(function(g){return s[g]}).map(function(g){var y=g.cell,x=g.region;return new uc(y.left+x.left*y.width,y.top+x.top*y.height,y.right+x.right*y.width,y.bottom+x.bottom*y.height).toSquare().round()})}return{boxes:f,scores:h}}function Yb(r,n,t){var e=t.width,a=t.height;return St(this,void 0,void 0,function(){var o,l,s,f=this;return Rt(this,function(h){switch(h.label){case 0:return o=Ir(r),[4,Promise.all(n.map(function(p){return St(f,void 0,void 0,function(){var v,g,y,x,w,_,E,R;return Rt(this,function(A){return v=p.padAtBorders(r.height,r.width),g=v.y,y=v.ey,x=v.x,w=v.ex,_=x-1,E=g-1,R=o.getImageData(_,E,w-_,y-E),[2,dn.isNodejs()?hp(R):createImageBitmap(R)]})})}))];case 1:return l=h.sent(),s=[],l.forEach(function(p){var v=sc({width:e,height:a}),g=Ir(v);g.drawImage(p,0,0,e,a);for(var y=g.getImageData(0,0,e,a).data,x=[],w=0;w<y.length;w+=4)x.push(y[w+2]),x.push(y[w+1]),x.push(y[w]);s.push(x)}),[2,s.map(function(p){var v=yt(function(){var g=Ua(Cn(p,[1,e,a,3]),[0,2,1,3]).toFloat();return Kb(g)});return v})]}})})}function HD(r,n){return yt(function(){var t=Cp(r,n),e=fr(t,[t.shape[0],n.fc1.weights.shape[0]]),a=Tr(e,n.fc1),o=_o(a,n.prelu4_alpha),l=Tr(o,n.fc2_1),s=rr(rc(l,1),1),f=ra(ze(l,s),1),h=Tr(o,n.fc2_2),p=Fe(f,1)[1];return{scores:p,regions:h}})}function VD(r,n,t,e,a){return St(this,void 0,void 0,function(){var o,l,s,f,h,p,v,g,y,x,w,_,E,R;return Rt(this,function(A){switch(A.label){case 0:return o=Date.now(),[4,Yb(r,n,{width:24,height:24})];case 1:return l=A.sent(),a.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=l.map(function(C){var T=HD(C,e);return C.dispose(),T}),a.stage2_rnet=Date.now()-o,f=s.length>1?Be(s.map(function(C){return C.scores})):s[0].scores,v=(p=Array).from,[4,f.data()];case 2:return h=v.apply(p,[A.sent()]),f.dispose(),g=h.map(function(C,T){return{score:C,idx:T}}).filter(function(C){return C.score>t}).map(function(C){var T=C.idx;return T}),y=g.map(function(C){return n[C]}),x=g.map(function(C){return h[C]}),w=[],_=[],y.length>0&&(o=Date.now(),E=Wu(y,x,.7),a.stage2_nms=Date.now()-o,R=E.map(function(C){var T=s[g[C]].regions.arraySync();return new Ep(T[0][0],T[0][1],T[0][2],T[0][3])}),_=E.map(function(C){return x[C]}),w=E.map(function(C,T){return y[C].calibrate(R[T])})),s.forEach(function(C){C.regions.dispose(),C.scores.dispose()}),[2,{boxes:w,scores:_}]}})})}function WD(r,n){return yt(function(){var t=Cp(r,n);t=Ke(t,[2,2],[2,2],"same"),t=hr(t,n.conv4,"valid"),t=_o(t,n.prelu4_alpha);var e=fr(t,[t.shape[0],n.fc1.weights.shape[0]]),a=Tr(e,n.fc1),o=_o(a,n.prelu5_alpha),l=Tr(o,n.fc2_1),s=rr(rc(l,1),1),f=ra(ze(l,s),1),h=Tr(o,n.fc2_2),p=Tr(o,n.fc2_3),v=Fe(f,1)[1];return{scores:v,regions:h,points:p}})}function GD(r,n,t,e,a){return St(this,void 0,void 0,function(){var o,l,s,f,h,p,v,g,y,x,w,_,E,R,A;return Rt(this,function(C){switch(C.label){case 0:return o=Date.now(),[4,Yb(r,n,{width:48,height:48})];case 1:return l=C.sent(),a.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=l.map(function(T){var N=WD(T,e);return T.dispose(),N}),a.stage3_onet=Date.now()-o,f=s.length>1?Be(s.map(function(T){return T.scores})):s[0].scores,v=(p=Array).from,[4,f.data()];case 2:return h=v.apply(p,[C.sent()]),f.dispose(),g=h.map(function(T,N){return{score:T,idx:N}}).filter(function(T){return T.score>t}).map(function(T){var N=T.idx;return N}),y=g.map(function(T){var N=s[T].regions.arraySync();return new Ep(N[0][0],N[0][1],N[0][2],N[0][3])}),x=g.map(function(T,N){return n[T].calibrate(y[N])}),w=g.map(function(T){return h[T]}),_=[],E=[],R=[],x.length>0&&(o=Date.now(),A=Wu(x,w,.7,!1),a.stage3_nms=Date.now()-o,_=A.map(function(T){return x[T]}),E=A.map(function(T){return w[T]}),R=A.map(function(T,N){return Array(5).fill(0).map(function(L,B){var I=s[T].points.arraySync();return new Jt(I[0][B]*(_[N].width+1)+_[N].left,I[0][B+5]*(_[N].height+1)+_[N].top)})})),s.forEach(function(T){T.regions.dispose(),T.scores.dispose(),T.points.dispose()}),[2,{boxes:_,scores:E,points:R}]}})})}var qD=function(r){It(n,r);function n(){return r.call(this,"Mtcnn")||this}return n.prototype.load=function(t){return St(this,void 0,void 0,function(){return Rt(this,function(e){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},n.prototype.loadFromDisk=function(t){return St(this,void 0,void 0,function(){return Rt(this,function(e){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},n.prototype.forwardInput=function(t,e){return e===void 0&&(e={}),St(this,void 0,void 0,function(){var a,o,l,s,f,h,p,v,g,y,x,w,_,E,R,A,C,T,N,L,B;return Rt(this,function(I){switch(I.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return l={},s=Date.now(),f=yt(function(){return MD(rr(op.fromPixels(o)).toFloat())}),h=function(F){return f.dispose(),l.total=Date.now()-s,F},p=f.shape.slice(1),v=p[0],g=p[1],y=new qb(e),x=y.minFaceSize,w=y.scaleFactor,_=y.maxNumScales,E=y.scoreThresholds,R=y.scaleSteps,A=(R||FD(x,w,[v,g])).filter(function(F){var W=Td(F,[v,g]);return Math.min(W.width,W.height)>Yl}).slice(0,_),l.scales=A,l.pyramid=A.map(function(F){return Td(F,[v,g])}),C=Date.now(),[4,UD(f,A,E[0],a.pnet,l)];case 1:return T=I.sent(),l.total_stage1=Date.now()-C,T.boxes.length?(l.stage2_numInputBoxes=T.boxes.length,C=Date.now(),[4,VD(o,T.boxes,E[1],a.rnet,l)]):[2,h({results:[],stats:l})];case 2:return N=I.sent(),l.total_stage2=Date.now()-C,N.boxes.length?(l.stage3_numInputBoxes=N.boxes.length,C=Date.now(),[4,GD(o,N.boxes,E[2],a.onet,l)]):[2,h({results:[],stats:l})];case 3:return L=I.sent(),l.total_stage3=Date.now()-C,B=L.boxes.map(function(F,W){return cc(Gu({},new Gn(L.scores[W],new sp(F.left/g,F.top/v,F.width/g,F.height/v),{height:v,width:g})),new mT(L.points[W].map(function(U){return U.sub(new Jt(F.left,F.top)).div(new Jt(F.width,F.height))}),{width:F.width,height:F.height}))}),[2,h({results:B,stats:l})]}})})},n.prototype.forward=function(t,e){return e===void 0&&(e={}),St(this,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Qe(t)];case 1:return[4,a.apply(this,[o.sent(),e])];case 2:return[2,o.sent().results]}})})},n.prototype.forwardWithStats=function(t,e){return e===void 0&&(e={}),St(this,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Qe(t)];case 1:return[2,a.apply(this,[o.sent(),e])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(t){return BD(t)},n.prototype.extractParams=function(t){return OD(t)},n}(ia),jD=.4,XD=[new Jt(1.603231,2.094468),new Jt(6.041143,7.080126),new Jt(2.882459,3.518061),new Jt(4.266906,5.178857),new Jt(9.041765,10.66308)],KD=[117.001,114.697,97.404],YD=function(r){It(n,r);function n(){var t=this,e={withSeparableConvs:!0,iouThreshold:jD,classes:["face"],anchors:XD,meanRgb:KD,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,e)||this,t}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,e){return St(this,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,e)];case 1:return a=o.sent(),[2,a.map(function(l){return new Gn(l.score,l.relativeBox,{width:l.imageWidth,height:l.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},n}(Xb),hn={ssdMobilenetv1:new jb,tinyFaceDetector:new YD,tinyYolov2:new DD,mtcnn:new qD,faceLandmark68Net:new Pb,faceLandmark68TinyNet:new QT,faceRecognitionNet:new rD,faceExpressionNet:new IT,ageGenderNet:new jT},Qb=function(r){It(n,r);function n(t,e,a){var o=r.call(this)||this;return o.parentTask=t,o.input=e,o.extractedFaces=a,o}return n}(ts),Sp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a=this;return Rt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,fc(t,this.input,function(l){return St(a,void 0,void 0,function(){return Rt(this,function(s){switch(s.label){case 0:return[4,Promise.all(l.map(function(f){return hn.faceExpressionNet.predictExpressions(f)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return e=o.sent(),[2,t.map(function(l,s){return Fb(l,e[s])})]}})})},n.prototype.withAgeAndGender=function(){return new Dp(this,this.input)},n}(Qb),Rp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e;return Rt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,_p(t,this.input,function(o){return hn.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return e=a.sent(),[2,Fb(t,e)]}})})},n.prototype.withAgeAndGender=function(){return new Np(this,this.input)},n}(Qb),Ap=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Mp(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Op(this,this.input)},n}(Sp),Tp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},n}(Rp),Zb=function(r){It(n,r);function n(t,e,a){var o=r.call(this)||this;return o.parentTask=t,o.input=e,o.extractedFaces=a,o}return n}(ts),Dp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a=this;return Rt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,fc(t,this.input,function(l){return St(a,void 0,void 0,function(){return Rt(this,function(s){switch(s.label){case 0:return[4,Promise.all(l.map(function(f){return hn.ageGenderNet.predictAgeAndGender(f)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return e=o.sent(),[2,t.map(function(l,s){var f=e[s],h=f.age,p=f.gender,v=f.genderProbability;return Wb(Gb(l,p,v),h)})]}})})},n.prototype.withFaceExpressions=function(){return new Sp(this,this.input)},n}(Zb),Np=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a,o,l;return Rt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,_p(t,this.input,function(f){return hn.ageGenderNet.predictAgeAndGender(f)},this.extractedFaces)]:[2];case 2:return e=s.sent(),a=e.age,o=e.gender,l=e.genderProbability,[2,Wb(Gb(t,o,l),a)]}})})},n.prototype.withFaceExpressions=function(){return new Rp(this,this.input)},n}(Zb),Mp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Ap(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Op(this,this.input)},n}(Dp),kp=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},n}(Np),Jb=function(r){It(n,r);function n(t,e){var a=r.call(this)||this;return a.parentTask=t,a.input=e,a}return n}(ts),Op=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e;return Rt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,fc(t,this.input,function(o){return Promise.all(o.map(function(l){return hn.faceRecognitionNet.computeFaceDescriptor(l)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return e=a.sent(),[2,e.map(function(o,l){return Vb(t[l],o)})]}})})},n.prototype.withFaceExpressions=function(){return new Ap(this,this.input)},n.prototype.withAgeAndGender=function(){return new Mp(this,this.input)},n}(Jb),Ip=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e;return Rt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,_p(t,this.input,function(o){return hn.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return e=a.sent(),[2,Vb(t,e)]}})})},n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n}(Jb),$b=function(r){It(n,r);function n(t,e,a){var o=r.call(this)||this;return o.parentTask=t,o.input=e,o.useTinyLandmarkNet=a,o}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?hn.faceLandmark68TinyNet:hn.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(ts),QD=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a,o,l,s=this;return Rt(this,function(f){switch(f.label){case 0:return[4,this.parentTask];case 1:return t=f.sent(),e=t.map(function(h){return h.detection}),this.input instanceof ye?[4,pp(this.input,e)]:[3,3];case 2:return o=f.sent(),[3,5];case 3:return[4,dp(this.input,e)];case 4:o=f.sent(),f.label=5;case 5:return a=o,[4,Promise.all(a.map(function(h){return s.landmarkNet.detectLandmarks(h)}))];case 6:return l=f.sent(),a.forEach(function(h){return h instanceof ye&&h.dispose()}),[2,t.map(function(h,p){return cc(h,l[p])})]}})})},n.prototype.withFaceExpressions=function(){return new Ap(this,this.input)},n.prototype.withAgeAndGender=function(){return new Mp(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Op(this,this.input)},n}($b),ZD=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a,o,l;return Rt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(e=t.detection,this.input instanceof ye?[4,pp(this.input,[e])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,dp(this.input,[e])];case 4:o=s.sent(),s.label=5;case 5:return a=o,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return l=s.sent(),a.forEach(function(f){return f instanceof ye&&f.dispose()}),[2,cc(t,l)]}})})},n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},n}($b),tx=function(r){It(n,r);function n(t,e){e===void 0&&(e=new Pa);var a=r.call(this)||this;return a.input=t,a.options=e,a}return n}(ts),ex=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e,a,o;return Rt(this,function(l){switch(l.label){case 0:return t=this,e=t.input,a=t.options,a instanceof qb?[4,hn.mtcnn.forward(e,a)]:[3,2];case 1:return[2,l.sent().map(function(s){return s.detection})];case 2:if(o=a instanceof ND?function(s){return hn.tinyFaceDetector.locateFaces(s,a)}:a instanceof Pa?function(s){return hn.ssdMobilenetv1.locateFaces(s,a)}:a instanceof wp?function(s){return hn.tinyYolov2.locateFaces(s,a)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(e)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return St(t,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,e(a.map(function(l){return Gu({},l)}))]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new QD(this.runAndExtendWithFaceDetections(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Sp(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Dp(this.runAndExtendWithFaceDetections(),this.input)},n}(tx),JD=function(r){It(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return St(this,void 0,void 0,function(){var t,e;return Rt(this,function(a){switch(a.label){case 0:return[4,new ex(this.input,this.options)];case 1:return t=a.sent(),e=t[0],t.forEach(function(o){o.score>e.score&&(e=o)}),[2,e]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return St(t,void 0,void 0,function(){var a;return Rt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,e(a?Gu({},a):void 0)]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new ZD(this.runAndExtendWithFaceDetection(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Rp(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Np(this.runAndExtendWithFaceDetection(),this.input)},n}(tx);function $D(r,n){return n===void 0&&(n=new Pa),new JD(r,n)}function O0(r,n){return n===void 0&&(n=new Pa),new ex(r,n)}function t3(r,n){if(r.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),e=Array.from(n);return Math.sqrt(t.map(function(a,o){return a-e[o]}).reduce(function(a,o){return a+Math.pow(o,2)},0))}var I0=function(){function r(n,t){t===void 0&&(t=.6),this._distanceThreshold=t;var e=Array.isArray(n)?n:[n];if(!e.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,o=function(){return"person "+a++};this._labeledDescriptors=e.map(function(l){if(l instanceof Ou)return l;if(l instanceof Float32Array)return new Ou(o(),[l]);if(l.descriptor&&l.descriptor instanceof Float32Array)return new Ou(o(),[l.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(n,t){return t.map(function(e){return t3(e,n)}).reduce(function(e,a){return e+a},0)/(t.length||1)},r.prototype.matchDescriptor=function(n){var t=this;return this.labeledDescriptors.map(function(e){var a=e.descriptors,o=e.label;return new T0(o,t.computeMeanDistance(n,a))}).reduce(function(e,a){return e.distance<a.distance?e:a})},r.prototype.findBestMatch=function(n){var t=this.matchDescriptor(n);return t.distance<this.distanceThreshold?t:new T0("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},r.fromJSON=function(n){var t=n.labeledDescriptors.map(function(e){return Ou.fromJSON(e)});return new r(t,n.distanceThreshold)},r}();function nx(r,n){var t=new pi(n.width,n.height),e=t.width,a=t.height;if(e<=0||a<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:e,height:a}));if(Array.isArray(r))return r.map(function(s){return nx(s,{width:e,height:a})});if(yp(r)){var o=r.detection.forSize(e,a),l=r.unshiftedLandmarks.forSize(o.box.width,o.box.height);return cc(Gu(r,o),l)}return jl(r)?Gu(r,r.detection.forSize(e,a)):r instanceof Ao||r instanceof Gn?r.forSize(e,a):r}const B0={admin_username:"admin",admin_password:"admin",min_capture_interval_minutes:0},rx="registered_faces",Dd="app_config",hc="attendance_log",dc=()=>{const r=localStorage.getItem(rx);return r?JSON.parse(r):[]},Bp=r=>{localStorage.setItem(rx,JSON.stringify(r))},e3=()=>dc(),n3=(r,n,t)=>{const e=dc();if(e.some(a=>a.id===r))throw new Error(`Employee with ID ${r} already exists.`);e.push({id:r,name:n,descriptor:Array.from(t)}),Bp(e)},r3=r=>{let n=dc();const t=n.length;return n=n.filter(e=>e.id!==r),n.length<t?(Bp(n),!0):!1},a3=(r,n)=>{const t=dc();let e=!1;for(const a of t)if(a.id===r){a.name=n,e=!0;break}return e&&Bp(t),e};async function ax(r){const t=new TextEncoder().encode(r),e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(l=>l.toString(16).padStart(2,"0")).join("")}const id=async()=>{let r=localStorage.getItem(Dd);if(r)r=JSON.parse(r);else{const n=await ax(B0.admin_password);r={...B0,admin_password:n},localStorage.setItem(Dd,JSON.stringify(r))}return r},F0=async r=>{r.admin_password&&!/^[0-9a-f]{64}$/i.test(r.admin_password)&&(r.admin_password=await ax(r.admin_password)),localStorage.setItem(Dd,JSON.stringify(r))},pc=(r=null)=>{const n=localStorage.getItem(hc);let t=n?JSON.parse(n):[];if(!r)return t;const e=r.toLowerCase();return t.filter(a=>a.toLowerCase().includes(e))},i3=r=>{const n=pc();n.push(r),localStorage.setItem(hc,JSON.stringify(n))},o3=r=>{let n=pc();const t=n.length;return n=n.filter(e=>e!==r),n.length<t?(localStorage.setItem(hc,JSON.stringify(n)),!0):!1},u3=(r,n)=>{let t=pc();const e=t.indexOf(r);return e!==-1?(t[e]=n,localStorage.setItem(hc,JSON.stringify(t)),!0):!1},s3=r=>{const n=`employee,time
`,t=r.map(l=>{const s=l.split(" - ");if(s.length>=3){const f=s[0],h=s[1],p=s.slice(2).join(" - ");return`"${f} (ID: ${h})","${p}"`}return`"${l}",""`}).join(`
`),e=n+t,a=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const l=URL.createObjectURL(a);o.setAttribute("href",l),o.setAttribute("download","attendance_report.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else alert("Your browser does not support downloading files directly. Please copy the content manually."),console.log(e)},Sl="./";function l3(){const r=ue.useRef(),n=ue.useRef(),[t,e]=ue.useState(!1),[a,o]=ue.useState(!1),[l,s]=ue.useState("Loading models..."),[f,h]=ue.useState([]),[p,v]=ue.useState(null),[g,y]=ue.useState(!1),[x,w]=ue.useState("attendance"),[_,E]=ue.useState({}),[R,A]=ue.useState({}),[C,T]=ue.useState(""),[N,L]=ue.useState(""),[B,I]=ue.useState(""),[F,W]=ue.useState(""),[U,at]=ue.useState(""),[nt,tt]=ue.useState(""),[P,q]=ue.useState(""),[K,rt]=ue.useState([]),[k,X]=ue.useState(""),[it,ot]=ue.useState(""),[dt,mt]=ue.useState(""),[pt,Tt]=ue.useState(""),[bt,Ot]=ue.useState("");ue.useEffect(()=>{(async()=>{try{await hn.tinyFaceDetector.loadFromUri(Sl),await hn.faceLandmark68Net.loadFromUri(Sl),await hn.faceRecognitionNet.loadFromUri(Sl),await hn.ssdMobilenetv1.loadFromUri(Sl),e(!0),s("Models loaded. Loading configuration...");const de=await id();A(de),s("Configuration loaded. Starting camera..."),Ft(),$t()}catch(de){console.error("Error initializing app:",de),s("Error initializing app. Please check console.")}})()},[]),ue.useEffect(()=>{if(f.length>0){const ht=f.map(de=>new Ou(de.id,[new Float32Array(de.descriptor)]));v(ht)}else v(null)},[f]);const $t=()=>{try{const ht=e3();h(ht),s(`Loaded ${ht.length} registered faces.`)}catch(ht){console.error("Error loading registered faces:",ht),s("Error loading registered faces.")}},Ft=async()=>{if(!a)try{const ht=await navigator.mediaDevices.getUserMedia({video:!0});r.current.srcObject=ht,r.current.play(),o(!0),s("Camera active. Ready for attendance.")}catch(ht){console.error("Error accessing camera:",ht),s("Error accessing camera. Please ensure camera is connected and permissions are granted.")}},Xt=()=>{r.current&&r.current.srcObject&&(r.current.srcObject.getTracks().forEach(ht=>ht.stop()),r.current.srcObject=null),o(!1),s("Camera stopped.")},Ut=()=>{if(!n.current||!r.current)return;if(r.current.videoWidth===0||r.current.videoHeight===0){console.log("Video dimensions not yet available. Retrying..."),setTimeout(Ut,100);return}const ht={width:r.current.videoWidth,height:r.current.videoHeight};TT(n.current,ht),setInterval(async()=>{if(!r.current||r.current.paused||r.current.ended||!t||r.current.videoWidth===0||r.current.videoHeight===0)return;const de=await O0(r.current,new Pa).withFaceLandmarks().withFaceDescriptors(),Ve=nx(de,ht);if(n.current.getContext("2d").clearRect(0,0,n.current.width,n.current.height),wT(n.current,Ve),LT(n.current,Ve),p){const pn=new I0(p,.6);Ve.forEach(gn=>{const We=pn.findBestMatch(gn.descriptor),yn=gn.detection.box;new Rb(yn,{label:We.toString()}).draw(n.current)})}},100)},re=async()=>{const ht=await id(),de=await Nn(F);B===ht.admin_username&&de===ht.admin_password?(y(!0),s("Admin logged in successfully!"),w("attendance")):s("Invalid admin credentials. Please try again.")},se=()=>{y(!1),I(""),W(""),s("Admin logged out."),w("attendance")},le=async()=>{if(console.log("Attempting to register face..."),!C||!N){s("Please enter both Employee ID and Name."),console.log("Validation failed: Employee ID or Name missing.");return}if(!r.current||r.current.paused||r.current.ended){s("Camera not active. Please start camera."),console.log("Validation failed: Camera not active.");return}console.log("Detecting single face...");const ht=await $D(r.current,new Pa).withFaceLandmarks().withFaceDescriptor();if(ht){console.log("Face detected:",ht);try{n3(C,N,ht.descriptor),$t(),s(`Face for ${N} (ID: ${C}) registered successfully!`),T(""),L(""),w("attendance"),console.log("Face registered successfully.")}catch(de){s(`Registration Error: ${de.message}`),console.error("Registration Error during saveFaceData:",de)}}else s("No face detected. Please ensure your face is clearly visible."),console.log("No face detected by face-api.js.")},[me,jt]=ue.useState("black"),Ue=async()=>{if(!r.current||r.current.paused||r.current.ended){s("Camera not active. Please start camera."),jt("red");return}if(!p||p.length===0){s("No faces registered. Please register faces first."),jt("orange");return}const ht=await O0(r.current,new Pa).withFaceLandmarks().withFaceDescriptors();if(ht.length===0){s("No face detected for attendance."),jt("red");return}const de=new I0(p,.6);let Ve=0,mr=0,pn=0;for(const gn of ht){const We=de.findBestMatch(gn.descriptor);if(We.label!=="unknown"){const yn=We.label,gr=f.find(Xn=>Xn.id===yn)?.name||"Unknown",No=new Date,Mo=R.min_capture_interval_minutes;if(_[yn]){const Xn=(No.getTime()-_[yn].getTime())/6e4;if(Xn<Mo){s(`${gr} (ID: ${yn}) already marked attendance recently. Please wait ${Math.ceil(Mo-Xn)} minutes.`),jt("orange"),pn++;continue}}const es=No.toISOString(),ko=`${gr} - ${yn} - ${es}`;i3(ko),E(Xn=>({...Xn,[yn]:No})),s(`Attendance Marked for: ${gr} (ID: ${yn})`),jt("green"),Ve++}else s("Unknown face detected."),jt("red"),mr++}Ve===0&&mr===0&&pn===0&&ht.length>0?(s("No registered faces detected for attendance."),jt("red")):Ve>0?jt("green"):mr>0?jt("red"):pn>0&&jt("orange")},qn=ht=>{if(!U){s("Please select an employee ID.");return}try{if(ht==="delete")window.confirm(`Are you sure you want to delete face data for ID: ${U}?`)&&(r3(U),$t(),s(`Face data for ID ${U} deleted.`),at(""));else if(ht==="update"){if(!nt){s("Please enter a new name.");return}a3(U,nt),$t(),s(`Name for ID ${U} updated to ${nt}.`),at(""),tt("")}}catch(de){s(`Error managing face: ${de.message}`)}},He=()=>{const ht=pc(P);rt(ht)},jn=()=>{if(!k||!it){s("Please select a log and enter a new entry to edit."),jt("orange");return}window.confirm(`Are you sure you want to edit this log entry?
Old: ${k}
New: ${it}`)&&(u3(k,it)?(s("Log entry updated successfully!"),He(),X(""),ot(""),jt("green")):(s("Failed to update log entry. Log not found or an error occurred."),jt("red")))},mn=()=>{if(!k){s("Please select a log to delete."),jt("orange");return}window.confirm(`Are you sure you want to delete this log entry?
${k}`)&&(o3(k)?(s("Log entry deleted successfully!"),He(),X(""),jt("green")):(s("Failed to delete log entry. Log not found or an error occurred."),jt("red")))},vr=()=>{if(K.length===0){s("No logs to export. Filtered logs list is empty."),jt("orange");return}s3(K),s("Attendance report downloaded as CSV successfully."),jt("green")},Dn=async()=>{try{const ht=parseInt(R.min_capture_interval_minutes);if(isNaN(ht)||ht<0){s("Minimum capture interval must be a non-negative number."),jt("orange");return}await F0(R),s("Admin settings saved successfully!"),jt("green")}catch(ht){s(`Error saving settings: ${ht.message}`),jt("red")}};async function Nn(ht){const Ve=new TextEncoder().encode(ht),mr=await crypto.subtle.digest("SHA-256",Ve);return Array.from(new Uint8Array(mr)).map(We=>We.toString(16).padStart(2,"0")).join("")}const we=async()=>{const ht=await id();if(await Nn(dt)!==ht.admin_password){s("Incorrect old password. Admin credentials not updated."),jt("red");return}const Ve={...ht};pt&&(Ve.admin_username=pt),bt&&(Ve.admin_password=await Nn(bt)),await F0(Ve),A(Ve),mt(""),Tt(""),Ot(""),s("Admin credentials updated successfully!"),jt("green")},Se=()=>{switch(x){case"attendance":return gt.jsxs("div",{className:"attendance-view",children:[gt.jsx("h2",{children:"Attendance Marking"}),gt.jsx("button",{onClick:Ue,disabled:!a||!t,children:"Mark Attendance"}),gt.jsxs("div",{className:"camera-controls",children:[gt.jsx("button",{onClick:Xt,disabled:!a,children:"Stop Camera"}),gt.jsx("button",{onClick:Ft,disabled:a,children:"Start Camera"})]})]});case"register":return gt.jsxs("div",{className:"register-view",children:[gt.jsx("h2",{children:"Register New Face"}),gt.jsx("input",{type:"text",placeholder:"Employee ID",value:C,onChange:ht=>T(ht.target.value)}),gt.jsx("input",{type:"text",placeholder:"Employee Name",value:N,onChange:ht=>setNewRegName(ht.target.value)}),gt.jsx("button",{onClick:le,disabled:!a||!t,children:"Capture and Register"})]});case"manage":return gt.jsxs("div",{className:"manage-view",children:[gt.jsx("h2",{children:"Manage Registered Faces"}),gt.jsxs("select",{value:U,onChange:ht=>at(ht.target.value),children:[gt.jsx("option",{value:"",children:"Select Employee ID"}),f.map(ht=>gt.jsxs("option",{value:ht.id,children:[ht.id," - ",ht.name]},ht.id))]}),gt.jsxs("div",{className:"manage-actions",children:[gt.jsx("button",{onClick:()=>qn("delete"),children:"Delete Selected"}),gt.jsx("input",{type:"text",placeholder:"New Name (for update)",value:nt,onChange:ht=>tt(ht.target.value)}),gt.jsx("button",{onClick:()=>qn("update"),children:"Update Name"})]}),gt.jsx("h3",{children:"Registered Faces:"}),gt.jsx("ul",{children:f.map(ht=>gt.jsxs("li",{children:[ht.id," - ",ht.name]},ht.id))})]});case"reports":return gt.jsxs("div",{className:"reports-view",children:[gt.jsx("h2",{children:"Attendance Reports"}),gt.jsx("input",{type:"text",placeholder:"Filter by Name/ID",value:P,onChange:ht=>q(ht.target.value)}),gt.jsx("button",{onClick:He,children:"Apply Filter"}),gt.jsx("button",{onClick:vr,children:"Save as CSV"}),gt.jsxs("div",{className:"log-list",children:[gt.jsx("h3",{children:"Logs:"}),gt.jsx("select",{size:"10",value:k,onChange:ht=>X(ht.target.value),children:K.map((ht,de)=>gt.jsx("option",{value:ht,children:ht},de))}),gt.jsx("input",{type:"text",placeholder:"Edit Log Entry",value:it,onChange:ht=>ot(ht.target.value)}),gt.jsx("button",{onClick:jn,children:"Edit Selected Log"}),gt.jsx("button",{onClick:mn,children:"Delete Selected Log"})]})]});case"settings":return gt.jsxs("div",{className:"settings-view",children:[gt.jsx("h2",{children:"Admin Settings"}),gt.jsxs("label",{children:["Minimum Capture Interval (minutes):",gt.jsx("input",{type:"number",value:R.min_capture_interval_minutes,onChange:ht=>A({...R,min_capture_interval_minutes:ht.target.value})})]}),gt.jsx("button",{onClick:Dn,children:"Save Settings"}),gt.jsx("h3",{children:"Change Admin Credentials"}),gt.jsx("input",{type:"password",placeholder:"Old Password",value:dt,onChange:ht=>mt(ht.target.value)}),gt.jsx("input",{type:"text",placeholder:"New Username (optional)",value:pt,onChange:ht=>Tt(ht.target.value)}),gt.jsx("input",{type:"password",placeholder:"New Password (optional)",value:bt,onChange:ht=>Ot(ht.target.value)}),gt.jsx("button",{onClick:we,children:"Update Credentials"})]});default:return null}};return gt.jsxs("div",{className:"App-container",children:[gt.jsxs("header",{className:"App-header",children:[gt.jsx("h1",{children:"Face Attendance System"}),gt.jsx("p",{className:"status-message",style:{color:l.includes("Error")||l.includes("Failed")||l.includes("Invalid")?"red":l.includes("successfully")?"green":"black"},children:l})]}),gt.jsxs("div",{className:"App-main",children:[gt.jsx("aside",{className:"App-sidebar",children:g?gt.jsxs("div",{className:"admin-panel",children:[gt.jsx("button",{onClick:()=>w("attendance"),children:"Attendance"}),gt.jsx("button",{onClick:()=>w("register"),children:"Register Face"}),gt.jsx("button",{onClick:()=>w("manage"),children:"Manage Faces"}),gt.jsx("button",{onClick:()=>w("reports"),children:"Reports"}),gt.jsx("button",{onClick:()=>w("settings"),children:"Settings"}),gt.jsx("button",{onClick:se,children:"Logout"})]}):gt.jsxs("div",{className:"admin-login",children:[gt.jsx("h2",{children:"Admin Login"}),gt.jsx("input",{type:"text",placeholder:"Username",value:B,onChange:ht=>I(ht.target.value)}),gt.jsx("input",{type:"password",placeholder:"Password",value:F,onChange:ht=>W(ht.target.value)}),gt.jsx("button",{onClick:re,children:"Login"})]})}),gt.jsxs("main",{className:"App-content",children:[gt.jsxs("div",{className:"camera-section",children:[gt.jsx("h2",{children:"Live Camera Feed"}),gt.jsxs("div",{className:"camera-feed-container",style:{borderColor:me},children:[gt.jsx("video",{ref:r,onPlay:Ut,width:"640",height:"480",muted:!0}),gt.jsx("canvas",{ref:n,className:"overlay-canvas"})]})]}),gt.jsx("div",{className:"feature-section",children:Se()})]})]})]})}Tw.createRoot(document.getElementById("root")).render(gt.jsx(ue.StrictMode,{children:gt.jsx(l3,{})}))});export default c3();
